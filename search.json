[{"title":"Raycast è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼","url":"/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/","content":"\n# å‰è¨€\n\nä¸çŸ¥é“å¤§å®¶æœƒä¸æœƒè¦ºå¾—åœ¨ä½¿ç”¨é›»è…¦æ™‚ï¼Œå¸¸å¸¸æœƒæœ‰éµç›¤æ»‘é¼ åˆ‡æ›çš„å‹•ä½œï¼Œå°è‡´å·¥ä½œæ•ˆç‡ä½ä¸‹ï¼Ÿä¾‹å¦‚åœ¨éœ€è¦é–‹å•Ÿä¸€å€‹æª”æ¡ˆçš„æ™‚å€™ï¼Œå¯èƒ½å°±æœƒéœ€è¦å…ˆæ‰“é–‹ Finderï¼Œå†ç”¨æ»‘é¼ é»æ“Šé–‹å•Ÿæª”æ¡ˆï¼›åˆæˆ–æ˜¯è‡¨æ™‚éœ€è¦ç¿»è­¯æ™‚ï¼Œå°±éœ€è¦å…ˆåˆ‡æ›åˆ°ç€è¦½å™¨æ‰“é–‹ Google Translate å†é€²è¡Œç¿»è­¯ï¼›æƒ³ç¢ºèªæ¥ä¸‹ä¾†çš„æœƒè­°é€£çµæ™‚ï¼Œåˆéœ€è¦é»æ“Šåˆ°æ—¥æ›†çš„ APP å†é–‹å•Ÿæœƒè­°é€£çµã€‚é€™äº›åˆ‡æ›åœ¨ç„¡å½¢ä¹‹ä¸­å°±æµªè²»äº†ä¸å°‘æ™‚é–“ï¼Œè€Œ Raycast å°±æ˜¯ä¸€å€‹å¯ä»¥å¹«åŠ©ä½ è§£æ±ºé€™äº›å•é¡Œçš„å·¥å…·ã€‚\n\n![Raycast](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/intro.png)\n\n<!-- More -->\n\n# ç°¡ä»‹\n\nå¾[å®˜ç¶²](https://www.raycast.com/)ä¸Šï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° Raycast æ˜¯ä¸€å€‹å•Ÿå‹•å™¨ï¼Œä»–æä¾›çµ¦ä½ ä¸€å€‹è¼¸å…¥æŒ‡ä»¤çš„è¦–çª—ï¼Œä½ å¯ä»¥è¼¸å…¥æŒ‡ä»¤ä¾†åŸ·è¡Œä½ æƒ³è¦çš„å‹•ä½œï¼Œä¾‹å¦‚é–‹å•Ÿæª”æ¡ˆã€ç¿»è­¯ã€è¨ˆç®—æ©Ÿã€å–®ä½è½‰æ›ç­‰ç­‰ã€‚ä¸¦ä¸” Raycast çš„ç¤¾ç¾¤éå¸¸å¼·å¤§ï¼Œçœ¾å¤šé–‹ç™¼è€…è£½ä½œçš„å„å¼å„æ¨£çš„ extensionsï¼Œä½¿å¾— Raycast æ“æœ‰éå¸¸å¤šçš„åŠŸèƒ½ã€‚\n\nå¦‚æœæœ‰ä½¿ç”¨é Spotlight çš„è®€è€…ï¼Œå¯ä»¥ç›´æ¥æŠŠ Raycast ç•¶ä½œ Spotlight çš„å‡ç´šç‰ˆä½¿ç”¨ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†[æ–‡ä»¶](https://manual.raycast.com/hotkey)æ•™ä½ å¦‚ä½•å°‡ Spotlight å–ä»£æˆ Raycastã€‚\n\nä»Šå¤©ç­†è€…å°‡æœƒä»‹ç´¹ Raycast ä¸­ï¼Œç­†è€…èªç‚ºæœ€å¯¦ç”¨ã€æœ€èƒ½å¤ æå‡ç”Ÿç”¢åŠ›çš„æŒ‡ä»¤ï¼Œåªè¦èƒ½å¤ ç†Ÿæ‚‰é€™äº›æŒ‡ä»¤çš„ä½¿ç”¨ï¼Œä¸€å®šèƒ½å¤ å¤§å¹…æå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼\n\nè®“æˆ‘å€‘æŒ‰ä¸‹ **<code style=\"color: red\">âŒ˜</code> <code style=\"color: red\">Space</code>**ï¼Œæ‰“é–‹ Raycastï¼Œé–‹å§‹æ¢ç´¢ Raycast çš„å¼·å¤§åŠŸèƒ½å§ï¼\n\n# å¸¸ç”¨åŠŸèƒ½ä»‹ç´¹\n\n{% note success %}\nğŸ‘‰ åœ¨ä½¿ç”¨ Raycast æ™‚ï¼Œä¸ä¸€å®šè¦è¼¸å…¥å®Œæ•´çš„æŒ‡ä»¤ï¼ŒRaycast æœ‰æ¨¡ç³Šæœå°‹åŠŸèƒ½ï¼Œä¹Ÿæœƒæ ¹æ“šä½ ä½¿ç”¨æŒ‡ä»¤çš„é »ç‡ä¾†æ’åºæŒ‡ä»¤ï¼Œåƒæ˜¯ç­†è€…è¼¸å…¥ **<code style=\"color: red\">tr</code>** å¾Œï¼ŒRaycast æœƒè‡ªå‹•æ¨è–¦ **<code style=\"color: red\">Translate</code>**ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨æ“”å¿ƒæ‰“å­—æ™‚è¼¸å…¥éŒ¯å­—æˆ–æ˜¯è¦æ‰“å¾ˆå¤šå­—å•¦ï½\n{% endnote %}\n\n{% note success %}\nğŸ‘‰ å¸¸ç”¨çš„æŒ‡ä»¤å¯ä»¥åŠ åˆ° Favoritesï¼ˆå°æŒ‡ä»¤æŒ‰ä¸‹ **<code style=\"color: red\">âŒ˜</code> **<code style=\"color: red\">â‡§</code>** <code style=\"color: red\">F</code>**ï¼‰ï¼Œé€™æ¨£å°±å¯ä»¥æŠŠå¸¸ç”¨çš„æŒ‡ä»¤å›ºå®šåœ¨ Raycast çš„æœ€ä¸Šé¢å›‰ã€‚\n{% endnote %}\n\n## ä¸€èˆ¬ä½¿ç”¨è€…\n\n### é–‹å•Ÿï¼åˆ‡æ› APP\n\næœ€åŸºæœ¬çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½†ç¿’æ…£ä¹‹å¾Œå°±å¯ä»¥çœä¸‹å¾ˆå¤šæ™‚é–“ï¼Œä¸ç”¨å†ç§»å‹•ä½ çš„æ»‘é¼ å»é» APP çš„ icon å•¦ã€‚åªè¦æ‰“é–‹ Raycast å¾Œè¼¸å…¥ APP çš„åç¨±å°±å¯ä»¥å¿«é€Ÿé–‹å•Ÿæˆ–æ˜¯åˆ‡æ›åˆ°è©² APPã€‚\n\n### æª”æ¡ˆæœå°‹\n\n- **<code style=\"color: red\">File Search</code>**\n\nRaycast ä¹Ÿå¯ä»¥å¿«é€Ÿçš„ç€è¦½æœ€è¿‘ä½¿ç”¨çš„æª”æ¡ˆæˆ–æ˜¯æœå°‹æª”æ¡ˆï¼Œè¼¸å…¥ **<code style=\"color: red\">File Search</code>** å°±å¯ä»¥çœ‹åˆ°æœ€è¿‘ä½¿ç”¨çš„æª”æ¡ˆæˆ–æ˜¯å†è¼¸å…¥é—œéµå­—æœå°‹æª”æ¡ˆï¼ŒæŒ‰ä¸‹ enter **<code style=\"color: red\">â†©</code>** å°±å¯ä»¥ç›´æ¥é–‹å•Ÿæª”æ¡ˆã€‚\n\n![Raycast æª”æ¡ˆæœå°‹](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/file-search.png)\n\n### å„ç¨®ç³»çµ±è¨­å®š\n\n- **<code style=\"color: red\">Lock Screen</code>**\n- **<code style=\"color: red\">Log Out</code>**\n\nRaycast é‚„æä¾›äº†å„ç¨®ç³»çµ±è¨­å®šçš„æŒ‡ä»¤ï¼Œåƒæ˜¯é–å®šè¢å¹•ã€ç™»å‡ºç³»çµ±ç­‰ç­‰ï¼Œè®€è€…å€‘å¯ä»¥è¼¸å…¥ **<code style=\"color: red\">Raycast Settings Extension</code>** åœ¨ Raycast è¨­å®šä¸­ï¼Œæ‰¾åˆ° System ä»¥åŠ System Settingsï¼Œå°±å¯ä»¥çœ‹åˆ°æ›´å¤šçš„ç³»çµ±è¨­å®šæŒ‡ä»¤ã€‚\n\n### å‰ªè²¼ç°¿æ­·å²\n\n- **<code style=\"color: red\">Clipboard History</code>**\n\nç­†è€…æœ€å–œæ­¡çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä¸ç”¨å†ç…©æƒ±ä¸€æ¬¡åªèƒ½è¤‡è£½è²¼ä¸Šä¸€å€‹æ±è¥¿å•¦ï½Raycast å¹«ä½ é€šé€šè¨˜ä½ï¼Œè€Œä¸”å¦‚æœè¤‡è£½çš„æ˜¯ä¸€å€‹é€£çµæˆ–æ˜¯ä¸€å€‹åœ–ç‰‡ï¼Œé‚„å¯ä»¥æœ‰ä¸€å€‹å¿«é€Ÿçš„ previewï¼Œè®“ä½ å¯ä»¥ç›´æ¥çœ‹åˆ°ä½ è¤‡è£½çš„å…§å®¹å–”ï¼\n\nç”šè‡³é‚„å¯ä»¥æŠŠå¸¸ç”¨çš„å…§å®¹ç›´æ¥ Pin åœ¨å‰ªè²¼ç°¿çš„æœ€ä¸Šé¢ï¼Œé€™æ¨£æ¯æ¬¡æ‰“é–‹ clipboard history å°±å¯ä»¥ç›´æ¥è²¼ä¸Šä½ å¸¸ç”¨çš„å…§å®¹äº†ï¼åƒæ˜¯ç­†è€…åœ¨å¯«é€™ç¯‡æ–‡ç« çš„æ™‚å€™å°±æœƒæŠŠä¸€äº›å¸¸ç”¨çš„æ–‡å­— pin ä½ï¼Œéå¸¸å¯¦ç”¨ï¼\n\n![Raycast Clipboard History](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/clipboard-history.png)\n\n{% note success %}\nğŸ‘‰ é¸å®šè¦è²¼ä¸Šçš„å…§å®¹å¾ŒæŒ‰ä¸‹ enter **<code style=\"color: red\">â†©</code>**ï¼Œå°±å¯ä»¥ç›´æ¥è²¼ä¸Šå…§å®¹åˆ°ç›®å‰çš„è¼¸å…¥æ¡†ä¸­ï¼\n{% endnote %}\n\n### è¨ˆç®—æ©Ÿ\n\nRaycast æœ‰æ¯” Spotlight æ›´å¼·å¤§çš„è¨ˆç®—æ©ŸåŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥åœ¨è¼¸å…¥æ¡†ä¸­è¼¸å…¥æ•¸å­¸é‹ç®—å¼ï¼Œç”šè‡³æ˜¯å–®ä½è½‰æ›ã€è²¨å¹£è½‰æ›ç­‰ç­‰ï¼Œéå¸¸å¯¦ç”¨ï¼æ›´å¤šä½¿ç”¨æŠ€å·§å¯ä»¥åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://raycast.com/extensions/calculator)ã€‚\n\n![Raycast å¯ä»¥åšåˆ°è²¨å¹£è½‰æ›](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/currency-conversion.png)\n![Raycast ä¹Ÿå¯ä»¥åšåˆ°é‹ç®—å¾Œå–®ä½è½‰æ›](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/calculator-conversion.png)\n\n{% note success %}\nğŸ‘‰ æŒ‰ä¸‹ enter **<code style=\"color: red\">â†©</code>** å¯ä»¥æŠŠé‹ç®—çµæœè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\n{% endnote %}\n\n### è¦–çª—ç®¡ç†\n\n- **<code style=\"color: red\">Maximize</code>**\n- **<code style=\"color: red\">Left Half</code>**\n- **<code style=\"color: red\">Right Half</code>**\n- **<code style=\"color: red\">Toggle Fullscreen</code>**\n\nå¾ˆå¤šæ™‚å€™æˆ‘å€‘æœƒæƒ³è¦æŠŠå‰›é–‹å•Ÿçš„è¦–çª—æœ€å¤§åŒ–ã€æˆ–æ˜¯åœ¨å¤šå·¥è™•ç†çš„æ™‚å€™æŠŠè¦–çª—åˆ†æˆå…©åŠï¼ŒRaycast æä¾›äº† 56 å€‹ç®¡ç†è¦–çª—çš„æŒ‡ä»¤ï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°æ²’æœ‰å®ƒåšä¸åˆ°ï¼\n\n![Raycast æœ‰è¶…å¤š Window Management æŒ‡ä»¤ï¼](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/window-management.png)\n\nç­†è€…æœ€å¸¸ç”¨çš„å°±æ˜¯ **<code style=\"color: red\">Maximize</code>**ï¼Œå¯ä»¥æŠŠè¦–çª—æœ€å¤§åŒ–ï¼Œå†ä¹Ÿä¸ç”¨æŒ‰è‘— <code style=\"color: red\">âŒ¥</code> å»é»è¦–çª—çš„ä¸Šé¢å°å°çš„ç¶ è‰²æŒ‰éˆ•äº†ï¼**<code style=\"color: red\">Left Half</code>** å’Œ **<code style=\"color: red\">Right Half</code>** åˆ†åˆ¥æœƒæŠŠè¦–çª—æ”¾ç½®åœ¨å·¦åŠéƒ¨æˆ–æ˜¯å³åŠéƒ¨ï¼Œé€™æ¨£å°±å¯ä»¥åœ¨åŒæ™‚è™•ç†å¤šå€‹è¦–çª—çš„æ™‚å€™ï¼Œå¿«é€Ÿçš„èª¿æ•´å¥½åˆ†å‰²çš„è¦–çª—å¤§å°å•¦ï¼\n\n![Raycast Maximize Window](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/maximize.gif)\n\n{% note success %}\nğŸ‘‰ ä½ å¯ä»¥æŠŠä¸æœƒä½¿ç”¨åˆ°çš„åŠŸèƒ½åœ¨ Raycast çš„è¨­å®šä¸­é—œé–‰ï¼Œæ‰“é–‹ Raycast è¼¸å…¥ **<code style=\"color: red\">Raycast Settings Extensions</code>** å°±å¯ä»¥çœ‹åˆ°è¨­å®šé é¢å›‰ï¼\n{% endnote %}\n\n### æ—¥æ›†\n\n- **<code style=\"color: red\">My Schedule</code>**\n\nè¼¸å…¥ **<code style=\"color: red\">My Schedule</code>** å°±å¯ä»¥å¿«é€Ÿç€è¦½æ¥ä¸‹ä¾†çš„è¡Œç¨‹ï¼Œå¦‚æœæœƒè­°ä¸Šæœ‰ç¶å®šæœƒè­°é€£çµï¼Œå‰‡æŒ‰ä¸‹ enter **<code style=\"color: red\">â†©</code>** å°±å¯ä»¥ç›´æ¥æ‰“é–‹æœƒè­°ï¼Œä¸ç”¨å†æ‰“é–‹æ—¥æ›†çš„ APP å•¦ï½Raycast é‚„æœ‰æ•´åˆ menu bar çš„åŠŸèƒ½ï¼Œå¯ä»¥æŠŠæ—¥æ›†çš„ icon æ”¾åœ¨ menu bar ä¸Šï¼Œè®“ä½ å¯ä»¥å¿«é€Ÿç€è¦½æ¥ä¸‹ä¾†çš„è¡Œç¨‹ã€‚\n\n![Raycast ç€è¦½è¡Œç¨‹](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/calendar.png)\n\n![Raycast æ—¥æ›†èˆ‡ Menu Bar çš„æ•´åˆ](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/calendar-menu-bar.png)\n\n{% note success %}\nğŸ‘‰ è¨˜å¾—å®‰è£ Raycast å¾Œè¦å…ˆ[è¨­å®šæ—¥æ›†](https://www.raycast.com/extensions/calendar)çš„æ¬Šé™ï¼Œè®“ Raycast å¯ä»¥è®€å– MacOS çš„æ—¥æ›†è³‡æ–™æ‰èƒ½ä½¿ç”¨å–”ï¼Menu Bar çš„ icon è¦åœ¨æœƒè­°é–‹å§‹å‰çš„ä»€éº¼æ™‚å€™é¡¯ç¤ºä¹Ÿå¯ä»¥è¨­å®šå–”ï¼\n{% endnote %}\n\n### Google ç¿»è­¯\n\n- **<code style=\"color: red\">Translate</code>**\n\næ¨è–¦æœƒæ‰“é–‹ Google ç¿»è­¯çš„å„ä½ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥åœ¨ Raycast è¼¸å…¥ **<code style=\"color: red\">Translate</code>**ï¼Œç„¶å¾Œè¼¸å…¥è¦ç¿»è­¯çš„æ–‡å­—ï¼Œå°±å¯ä»¥ç›´æ¥çœ‹åˆ°ç¿»è­¯çµæœå›‰ï¼\n\n![Raycast Google Translate](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/translate.png)\n\n{% note success %}\nğŸ‘‰ Raycast çš„ Google Translate å°±æ˜¯éå®˜æ–¹è£½ä½œçš„ extensionï¼Œåœ¨ Raycast ä¸­è¼¸å…¥ **<code style=\"color: red\">Store</code>** å†æœå°‹ Google Translate å°±å¯ä»¥å®‰è£å›‰ï¼æˆ–æ˜¯å¯ä»¥åˆ°[é€™è£¡](https://www.raycast.com/gebeto/translate)ä¸‹è¼‰ï¼\n{% endnote %}\n\n### å…¶ä»–\n\nRaycast é‚„æœ‰è¶…å¤š extensions ç­‰è‘—ä½ å»æ¢ç´¢å®‰è£ï¼Œåƒæ˜¯ï¼š\n- å–œæ­¡è½éŸ³æ¨‚çš„æœ‹å‹å¯ä»¥å®‰è£ [Spotify](https://www.raycast.com/mattisssa/spotify-player) æ’ä»¶ï¼Œå°±å¯ä»¥é€é Raycast çœ‹åˆ°ç›®å‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ§åˆ¶æ’­æ”¾ã€æš«åœã€ä¸‹ä¸€é¦–ã€ä¸Šä¸€é¦–å’Œæœå°‹æ­Œæ›²ï¼\n- å¸¸å¸¸éœ€è¦æœå°‹å¤©æ°£é å ±å—ï¼Ÿç¾åœ¨ä½ å¯ä»¥å®‰è£ [Weather](https://www.raycast.com/tonka3000/weather) æ’ä»¶ï¼Œä¸ä½†å¯ä»¥é€é **<code style=\"color: red\">Weather</code>** æŒ‡ä»¤æœå°‹åœ°é»çš„å¤©æ°£ï¼Œé‚„å¯ä»¥ç›´æ¥åœ¨ menu bar ä¸Šé¡¯ç¤ºå¤©æ°£é å ±ï¼Œå°±å¯ä»¥å¿«é€Ÿç€è¦½å¤©æ°£å›‰ï¼\n- æœ‰åœ¨ç”¨ Notion æˆ–æ˜¯ Obsidian é€™é¡çš„ç­†è¨˜è»Ÿé«”å—ï¼Ÿå¯ä»¥å®‰è£ [Notion](https://www.raycast.com/HenriChabrand/notion) æˆ–æ˜¯ [Obsidian](https://www.raycast.com/marcjulian/obsidian) çš„æ’ä»¶ï¼Œå¿«é€Ÿçš„æœå°‹å’Œç€è¦½ä½ çš„ç­†è¨˜ï¼\n- æƒ³è¦å¿«é€Ÿçš„é–‹å•Ÿç€è¦½å™¨æ›¸ç±¤å—ï¼Ÿä¸å¦‚è©¦è©¦ [Browser Bookmarks](https://www.raycast.com/raycast/browser-bookmarks) é€™å€‹æ’ä»¶ã€‚æˆ–æ˜¯å¦‚æœä½ æ˜¯ Arc Browser çš„ç”¨æˆ¶çš„è©±ï¼Œå¯ä»¥æ”¹è£ [Arc](https://www.raycast.com/the-browser-company/arc) çš„æ’ä»¶ï¼Œä¸ä½†å¯ä»¥å¾ Raycast é–‹å•Ÿæ›¸ç±¤ï¼Œé‚„èƒ½åœ¨ Raycast ä¸­æœå°‹ç€è¦½ç´€éŒ„å’Œåˆ‡æ›åˆ†é å–”ï¼\n\n## é–‹ç™¼è€…\n\næ¥ä¸‹ä¾†ç­†è€…æƒ³è¦ä»‹ç´¹ä¸€äº›èº«ç‚ºè»Ÿé«”é–‹ç™¼è€…ä¸€å®šæœƒå–œæ­¡çš„å·¥å…·ï¼Œç”¨ Raycast ä¾†æå‡è‡ªå·±çš„é–‹ç™¼ç”Ÿç”¢åŠ›å§ï¼\n\n### What's my IP\n\n- **<code style=\"color: red\">My IP</code>**\n- **<code style=\"color: red\">Query IP</code>**\n\né‚„åœ¨ä¸Šç€è¦½å™¨æœå°‹è‡ªå·±çš„ IP å—ï¼Ÿå®‰è£ [IP Geolocation](https://www.raycast.com/koinzhang/ip-geolocation) é€™å€‹æ’ä»¶ï¼Œå°±å¯ä»¥é€é **<code style=\"color: red\">My IP</code>** æŒ‡ä»¤å¿«é€Ÿçš„æŸ¥çœ‹è‡ªå·±çš„ IP å›‰ï¼ä¹Ÿå¯ä»¥é€é **<code style=\"color: red\">Query IP</code>** æŒ‡ä»¤æŸ¥è©¢ domain çš„ IPï¼\n\n![Raycast æŸ¥è©¢ç•¶å‰ IP è³‡è¨Š](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/myip.png)\n\n### Speedtest\n\n- **<code style=\"color: red\">Speedtest</code>**\n\næ¯æ¬¡éƒ½è¦ä¸Š speedtest.net æˆ–æ˜¯ fast.com æ¸¬ç¶²è·¯é€Ÿåº¦ï¼Ÿå®‰è£ [Speedtest](https://www.raycast.com/tonka3000/speedtest) é€™å€‹æ’ä»¶ï¼Œå°±å¯ä»¥é€é **<code style=\"color: red\">Speedtest</code>** æŒ‡ä»¤å¿«é€Ÿçš„åš speedtest å›‰ï¼\n\n![Raycast åš speedtest](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/speedtest.png)\n\n### Random Data Generator\n\n- **<code style=\"color: red\">Generate Random Data</code>**\n\néœ€è¦ç”Ÿæˆå‡è³‡æ–™æˆ–æ˜¯éš¨æ©Ÿçš„å¯†ç¢¼å—ï¼Ÿå®‰è£ [Random Data Generator](https://www.raycast.com/tonka3000/random-data-generator) é€™å€‹æ’ä»¶ï¼Œå°±å¯ä»¥é€é Raycast ç›´æ¥ä½¿ç”¨ç”± [faker.js](https://fakerjs.dev/api/) ç”¢ç”Ÿçš„éš¨æ©Ÿè³‡æ–™å›‰ï¼ä¸ç®¡ä½ æ˜¯æƒ³è¦éš¨æ©Ÿçš„ UUIDã€å§“åã€åœ°å€ã€é›»è©±è™Ÿç¢¼é‚„æ˜¯å…¶ä»–çš„è³‡æ–™ï¼Œéƒ½å¯ä»¥é€éé€™å€‹æ’ä»¶ä¾†ç”¢ç”Ÿå›‰ï¼\n\n![Raycast ç”¢ç”Ÿéš¨æ©Ÿ UUID](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/random-uuid.png)\n\n### VSCode Project Manager\n\n- **<code style=\"color: red\">Search Project Manager</code>**\n\næœ‰åœ¨ä½¿ç”¨ VSCode çš„é–‹ç™¼è€…ä¸€å®šè¦ä¾†è©¦è©¦çœ‹ [Project Manager](https://marketplace.visualstudio.com/items?itemName=alefragnani.project-manager) é€™å€‹æ’ä»¶èˆ‡ [Raycast æ’ä»¶](https://www.raycast.com/MarkusLanger/vscode-project-manager)çš„çµ„åˆï¼\n\næŠŠå¸¸ç”¨çš„ project éƒ½åŠ åˆ° VSCode çš„ project manager ä¸­ï¼Œå°±å¯ä»¥é€é Raycast å¿«é€Ÿçš„é–‹å•Ÿä½ çš„ project å›‰ï¼å†ä¹Ÿä¸ç”¨å…ˆæ‰“é–‹çµ‚ç«¯æ©Ÿ `cd` åˆ°å°ˆæ¡ˆç›®éŒ„ï¼Œå†ç”¨ `code .` ä¾†é–‹å•Ÿ VSCode äº†ã€‚\n\n{% note\tsuccess %}\nğŸ‘‰ ä½ ç”šè‡³å¯ä»¥åˆ° Raycast ä¸­å°‡é€™å€‹æ’ä»¶è¨­ç½® alias ç‚º **<code style=\"color: red\">code</code>**ï¼Œé€™æ¨£ä½ å°±å¯ä»¥åœ¨ Raycast ä¸­ç›´æ¥è¼¸å…¥ **<code style=\"color: red\">code</code>** **<code style=\"color: red\">Space</code>** **<code style=\"color: red\">{Project Name}</code>** ä¾†å¿«é€Ÿçš„é–‹å•Ÿä½ çš„ project å›‰ï¼\n{% endnote %}\n\n![Raycast é–‹å•Ÿ VSCode å°ˆæ¡ˆ](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/vscode.gif)\n\n### Toolbox\n\n- **<code style=\"color: red\">Toolbox</code>**\n\n[Toolbox](https://www.raycast.com/Kang/toolbox) é€™å€‹æ’ä»¶åŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„å·¥å…·ï¼Œä¾‹å¦‚ï¼š\n\n- Base64 Encode/Decode\n- JSON Format\n- Date to Unix Timestamp\n- JWT Decode\n\né›–ç„¶è¦ºå¾—åŠŸèƒ½é‚„å¯ä»¥å†é½Šå…¨ä¸€é»ï¼Œä½†å·²ç¶“å¯ä»¥æ»¿è¶³å¾ˆå¤šéœ€æ±‚äº†ï¼Œå†ä¹Ÿä¸ç”¨ä¸Šç¶²æ‰¾ç¶²ç«™ä¾†è½‰æ›å›‰ï¼\n\n### Github\n\nGithub æ‡‰è©²æ˜¯æ¯å€‹é–‹ç™¼è€…éƒ½ä½¿ç”¨éçš„å·¥å…·å§ï½ä½•ä¸ç”¨ç”¨çœ‹ [Github](https://www.raycast.com/raycast/github) çš„æ’ä»¶å‘¢ï¼Ÿå¯ä»¥å¿«é€Ÿçš„æœå°‹ Repositoryã€æŸ¥çœ‹ Pull Requestã€å‰µå»ºæˆ–æ˜¯æŸ¥çœ‹ Issueã€æŸ¥çœ‹ Github Actions çš„ç‹€æ…‹ï¼Œé‚„æ”¯æ´æŠŠ notification è¨­ç½®åœ¨ menu bar ä¸Šçš„åŠŸèƒ½å–”ï¼å”¯ä¸€çš„ç¼ºé»å¤§æ¦‚åªæœ‰å¦‚æœæƒ³è¦æŸ¥çœ‹ Organization è£¡é¢çš„ private è³‡è¨Šï¼Œå¿…é ˆè¦å…ˆç¶“é Organization çš„ owner æˆæ¬Šï¼Œé€™å°±è¦çœ‹å…¬å¸é¡˜ä¸é¡˜æ„æˆæ¬Šäº†ğŸ« ã€‚\n\n![Raycast Search Github Repository](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/github-search.png)\n\n# å½©è›‹\n\nRaycast é‚„éš±è—äº†ä¸€äº›å°å½©è›‹ï¼š\n\n- **<code style=\"color: red\">Confetti</code>** å¯ä»¥æ’­æ”¾æ…¶ç¥çš„å‹•ç•«ï¼\n\n\t![Raycast Confetti](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/confetti.gif)\n- **<code style=\"color: red\">Toggle Bounce Animation</code>** å¯ä»¥è®“ Raycast è¦–çª—åœ¨è¢å¹•ä¸Šä¾†å›å½ˆè·³ï¼\n\n\t![Raycast Toggle Bounce Animation](/assets/Raycast-è¶…è©³ç´°ä»‹ç´¹ï¼å¿«é€Ÿæå‡ç”Ÿç”¢åŠ›çš„è¶…å¥½ç”¨å·¥å…·ï¼/bounce.gif)\n\n# çµå°¾\n\nä¸€é–‹å§‹å®‰è£ Raycast å¯èƒ½å¸¸å¸¸æœƒå¿˜è¨˜è¦ä½¿ç”¨å®ƒï¼Œä½†æ˜¯ä¸€æ—¦ç¿’æ…£äº†ï¼Œä½ æœƒç™¼ç¾å®ƒå¯ä»¥å¹«ä½ çœä¸‹å¾ˆå¤šæ™‚é–“ï¼Œè®“ä½ çš„å·¥ä½œæ›´æœ‰æ•ˆç‡ã€‚Raycast é‚„æœ‰å¾ˆå¤šæ’ä»¶ç­‰è‘—ä½ å»æ¢ç´¢ï¼Œå» Raycast çš„[å•†åº—](https://www.raycast.com/store)çœ‹çœ‹è‡ªå·±æœ‰æ²’æœ‰ä»€éº¼å¥½ç”¨çš„æ’ä»¶å§ï¼å¦‚æœä½ æ¨è–¦æœ‰ä»€éº¼å¥½ç”¨çš„æ’ä»¶æˆ–æ˜¯åŠŸèƒ½ï¼Œä¹Ÿæ­¡è¿åœ¨ä¸‹é¢ç•™è¨€åˆ†äº«çµ¦æˆ‘å–”ï½\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["MacOS","Productivity"],"categories":["Others"]},{"title":"PostgreSQL å¦‚ä½•é ä¼° Function Return Rows ä»¥åŠå° Query çš„æ•ˆèƒ½å½±éŸ¿","url":"/PostgreSQL-å¦‚ä½•é ä¼°-Function-Return-Rows-ä»¥åŠå°-Query-çš„æ•ˆèƒ½å½±éŸ¿/","content":"\nä»Šå¤©è¦ä¾†è·Ÿå¤§å®¶åˆ†äº« PostgreSQL æ˜¯å¦‚ä½•é ä¼° function çš„ return rows çš„ï¼Ÿä»¥åŠ function çš„ return rows æœƒå° query çš„æ•ˆèƒ½æœ‰ä»€éº¼å½±éŸ¿ï¼Ÿ\n\né€éçœŸå¯¦æ¡ˆä¾‹å¯ä»¥çœ‹åˆ°ç•¶ function çš„ return rows èˆ‡å¯¦éš›ä¸åŒæ™‚ï¼Œæœƒé€ æˆçš„æ•ˆèƒ½å½±éŸ¿ï¼Œå†é€éç°¡å–®çš„åˆ†æå’Œ PostgreSQL åŸå§‹ç¢¼åˆ†æåšæ‰¾å‡ºåŸå› ï¼Œæœ€å¾Œå†ç”¨ç°¡å–®çš„å¹¾å€‹æ–¹å¼è®“ PostgreSQL å¯ä»¥æ›´æº–ç¢ºçš„é æ¸¬ function çš„ return rowsã€‚\n\nç’°å¢ƒï¼šPostgreSQL 11.17\n\n<!-- More -->\n\n# å…ˆå‚™çŸ¥è­˜\n\nPostgreSQL æœƒåˆ©ç”¨ cost estimation ä¾†å‰µå»º query planï¼Œè€Œå…¶ä¸­åœ¨æ¯å€‹æ­¥é©Ÿå¾Œæœƒæœ‰ä¸€å€‹ return rowsï¼Œä»£è¡¨ PostgreSQL é ä¼°é€™å€‹æ­¥é©Ÿæœƒå›å‚³å¤šå°‘ rowsã€‚\n\nèˆ‰å€‹ç°¡å–®çš„ä¾‹å­ä¾†èªªï¼š\n\n```sql\nCREATE TABLE IF NOT EXISTS test (\n\tid INT PRIMARY KEY,\n\tvalue INT NOT NULL\n);\n\nINSERT INTO test(id, value) SELECT generate_series(1, 100000), generate_series(1, 100000);\nVACUUM ANALYZE test;\n```\n\næˆ‘å€‘å…ˆå‰µå»ºä¸€å€‹ tableï¼Œä¸¦ä¸”æ’å…¥ id ç‚º 1 ~ 100000ï¼Œvalue ç‚º 1 ~ 100000 çš„è³‡æ–™ï¼Œä¸¦ä¸”åŸ·è¡Œ VACUUM ANALYZE ä¾†æ›´æ–° table çš„çµ±è¨ˆè³‡è¨Šã€‚\n\n```sql\nEXPLAIN SELECT * FROM test WHERE id > 100;\n                        QUERY PLAN\n-----------------------------------------------------------\nSeq Scan on test  (cost=0.00..1693.00 rows=99900 width=8)\n\tFilter: (id > 100)\n```\n\n```sql\nEXPLAIN SELECT * FROM test WHERE id > 99000;\n                                QUERY PLAN\n--------------------------------------------------------------------------\nIndex Scan using test_pkey on test  (cost=0.29..38.77 rows=1056 width=8)\n\tIndex Cond: (id > 99000)\n```\n\nå†ä¾†æˆ‘å€‘åˆ†åˆ¥æœå°‹ id > 100 å’Œ id > 99000 çš„è³‡æ–™ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€å€‹ query çš„ return rows ç‚º 99900ï¼Œè€Œç¬¬äºŒå€‹ query çš„ return rows ç‚º 1056ã€‚PostgreSQL å¾ˆå¥½çš„é ä¼°äº† return rows ä¸¦ä¸”å¯ä»¥æ ¹æ“š return rows ä¾†æ±ºå®šæ¥ä¸‹ä¾†çš„ query planã€‚\n\n# çœŸå¯¦æ¡ˆä¾‹\n\næˆ‘å€‘æœ‰ä¸€æ®µé¡ä¼¼é€™æ¨£çš„ queryï¼š\n\n```sql\nSELECT\n\tseries.date,\n\tCOALESCE(stats.count, 0) AS count\nFROM\n\t(\n\t\tSELECT GENERATE_SERIES((NOW() - INTERVAL '6 DAYS')::TIMESTAMP, NOW()::TIMESTAMP, '1 DAY')::DATE\n\t) AS series(date)\n\tLEFT JOIN stats ON stats.member_id = 123 AND stats.date = series.date;\n```\n\né€™æ®µ query æƒ³è¦åšçš„äº‹æƒ…å¾ˆç°¡å–®ï¼Œå°±æ˜¯å–å¾— `member_id = 123` çš„æœ€è¿‘ 7 å¤©çš„è³‡æ–™ï¼ˆcountï¼‰ï¼Œä¸¦ä¸”å¦‚æœæœ‰äº›æ—¥æœŸæ²’æœ‰è³‡æ–™ï¼Œå°±å›å‚³ 0ã€‚\n\nè€Œ `stats` è¡¨ä¸­æœ‰ `(member_id, date)` çš„ index `stats_pkey`ï¼Œä¸¦ä¸”æˆ‘å€‘çŸ¥é“ generate_series åªæœƒç”¢ç”Ÿ 7 å€‹ rowsï¼Œå› æ­¤æœŸæœ›ä¸Šå¦‚æœ PostgreSQL ä½¿ç”¨ [*Indexed Nested Loop Join*](https://www.interdb.jp/pg/pgsql03.html#_3.5.1.1.)ï¼Œå°±å¯ä»¥åœ¨ 7 æ¬¡ index scan å®Œæˆé€™å€‹ queryã€‚\n\n\nä½†äº‹å¯¦ä¸Šä½¿ç”¨ `EXPLAIN` å¾Œå»ç™¼ç¾ PostgreSQL å…ˆå° `stats` ä½¿ç”¨ `member_id` åšäº†ä¸€æ¬¡ index scan éæ¿¾å¾Œï¼Œæ‰ä½¿ç”¨ merge join å°‡å…©è¡¨åˆä½µã€‚\n\n```sql\nMerge Left Join  (cost=21048.31..21120.93 rows=4508 width=12)\n  Merge Cond: ((((generate_series(((now() - '6 days'::interval))::timestamp without time zone, (now())::timestamp without time zone, '1 day'::interval)))::date) = stats.date)\n  ->  Sort  (cost=92.36..94.86 rows=1000 width=4)\n\t\tSort Key: (((generate_series(((now() - '6 days'::interval))::timestamp without time zone, (now())::timestamp without time zone, '1 day'::interval)))::date)\n\t\t->  Result  (cost=0.00..32.53 rows=1000 width=4)\n\t\t\t->  ProjectSet  (cost=0.00..5.03 rows=1000 width=8)\n\t\t\t\t->  Result  (cost=0.00..0.01 rows=1 width=0)\n  ->  Sort  (cost=20955.95..20962.00 rows=2421 width=16)\n\t\tSort Key: stats.date\n\t\t->  Bitmap Heap Scan on stats  (cost=239.32..20819.87 rows=2421 width=16)\n\t\t\tRecheck Cond: (member_id = 123)\n\t\t\t->  Bitmap Index Scan on stats_pkey  (cost=0.00..238.72 rows=2421 width=0)\n\t\t\t\tIndex Cond: (member_id = 123)\n```\n\nå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ sort æ˜¯å° stats è¡¨ä½¿ç”¨ `member_id = 123` çš„ index é€²è¡Œéæ¿¾ï¼Œä¸¦ä¸”æ ¹æ“š `member_id` é¸æ“‡çš„ä¸åŒï¼ŒPostgreSQL æœƒå› ç‚º `member_id` åœ¨è¡¨ä¸­å‡ºç¾çš„é »ç‡ç”šè‡³å¯èƒ½é¸æ“‡ `(Parallel) Seq Scan`ï¼ˆé«˜é »ç‡æ™‚ï¼‰æˆ–æ˜¯ `Index Scan`ï¼ˆä½é »ç‡æ™‚ï¼‰ä¾†åšç¬¬ä¸€æ¬¡çš„éæ¿¾ã€‚\n\nè€Œä¸Šé¢çš„ sort æ˜¯å° `generate_series` ç”¢ç”Ÿçš„ rows é€²è¡Œéæ¿¾ï¼Œé›–ç„¶æˆ‘å€‘çŸ¥é“ `generate_series` åªæœƒç”¢ç”Ÿ 7 å€‹ rowsï¼Œä½† PostgreSQL çš„ query planner ä¸¦æ²’è¾¦æ³•çŸ¥é“é€™ä»¶äº‹æƒ…ï¼Œè€Œé ä¼°å‡ºä¾†çš„ rows ç«Ÿç„¶æ˜¯ 1000ï¼\n\n# åˆ†æ\n\næœ‰äº† `EXPLAIN` çš„çµæœï¼Œæ¥ä¸‹ä¾†å°±å¯ä»¥åˆ†æä»¥ä¸‹å…©å€‹å•é¡Œï¼š\n\n## ç‚ºä»€éº¼ PostgreSQL å° function ç”¢ç”Ÿçš„ rows æœƒé ä¼°æˆ 1000ï¼Ÿ\n\nPostgreSQL å„²å­˜ function çš„ç›¸é—œè³‡è¨Šæ˜¯åœ¨ `pg_proc` é€™å¼µè¡¨ä¸­ï¼Œè€Œç•¶ä¸­æœ‰ä¸€å€‹æ¬„ä½ [prorows](https://www.postgresql.org/docs/11/catalog-pg-proc.html#:~:text=prorows,not%20proretset)ï¼Œé€™å€‹æ¬„ä½å°±æ˜¯ç”¨ä¾†é ä¼° function ç”¢ç”Ÿçš„ rows æ•¸é‡çš„ã€‚\n\nè¦è¨­å®š `prorows` å¯ä»¥åœ¨ `CREATE FUNCTION` æ™‚æŒ‡å®šï¼Œè€Œæ ¹æ“š[æ–‡ä»¶](https://www.postgresql.org/docs/11/sql-createfunction.html#:~:text=often%20than%20necessary.-,ROWS%20result_rows,-A%20positive%20number)çš„èªªæ˜ï¼š\n\n{% note info %}\n\nRows: A positive number giving the estimated number of rows that the planner should expect the function to return. This is only allowed when the function is declared to return a set. The default assumption is 1000 rows.\n\n{% endnote %}\n\næˆ‘å€‘å¯ä»¥çŸ¥é“ `prorows` çš„é è¨­å€¼æ˜¯ 1000ï¼Œä¸¦ä¸”æˆ‘å€‘å¯ä»¥æŸ¥çœ‹ `generate_series` çš„ `prorows` æ˜¯å¤šå°‘ï¼š\n\n```sql\nSELECT proname, prosrc, prorows FROM pg_proc WHERE proname = 'generate_series';\n\n     proname     |            prosrc            | prorows\n-----------------+------------------------------+---------\n generate_series | generate_series_timestamp    |    1000\n generate_series | generate_series_step_int4    |    1000\n generate_series | generate_series_int4         |    1000\n generate_series | generate_series_step_int8    |    1000\n generate_series | generate_series_int8         |    1000\n generate_series | generate_series_step_numeric |    1000\n generate_series | generate_series_numeric      |    1000\n generate_series | generate_series_timestamptz  |    1000\n```\n\nå¯ä»¥çœ‹åˆ°ç¢ºå¯¦æ˜¯ 1000ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ PostgreSQL åœ¨ planning æ™‚ï¼Œé ä¼° `generate_series` æœƒç”¢ç”Ÿ 1000 å€‹ rowsã€‚\n\n## ç‚ºä»€éº¼ PostgreSQL æœƒé¸æ“‡å…ˆéæ¿¾ä¸€æ¬¡ `member_id` å†åš Joinï¼Ÿ\n\nåœ¨ä¸Šé¢ `EXPLAIN` çš„çµæœå¯ä»¥çœ‹åˆ°ï¼ŒPostgreSQL é¸æ“‡äº†å…ˆå°å…§è¡¨ï¼ˆ`stats`ï¼‰é€²è¡Œä¸€æ¬¡éæ¿¾æ‰åš Joinï¼Œè€Œä¸æ˜¯æˆ‘å€‘é æœŸçš„ç›´æ¥ä½¿ç”¨ *Indexed Nested Loop Join*ï¼ˆæˆ–åš´æ ¼ä¾†èªªæ˜¯ [*index scan with parameterized path*](https://github.com/postgres/postgres/blob/REL_11_STABLE/src/backend/optimizer/README#L705)ï¼‰ã€‚\n\n{% note info %}\n**Pseudo Plan of Index Nested Loop Join**\n```\nNest Loop\n\t-> Seq Scan on series\n\t-> Index Scan using stats_pkey on stats\n\t\tIndex Condition: (stats.member_id = 123) AND (stats.date = series.date)\n```\n{% endnote %}\n\nç”±ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå°æ–¼ indexed nested loop join ä¾†èªªï¼Œå¤–è¡¨ï¼ˆ`series`ï¼‰è¶Šå°è¶Šå¥½ï¼Œå› ç‚º nested loop join å°±æ˜¯å°æ¯å€‹å¤–è¡¨çš„ row é€²è¡Œä¸€æ¬¡å…§è¡¨çš„éæ¿¾ï¼Œä½†å…§è¡¨çš„å¤§å°ä¸¦ä¸æ˜¯å¤ªé‡è¦ã€‚\n\nå› æ­¤ç•¶å¤–è¡¨å¤ªå¤§æ™‚ï¼Œplanner å¯èƒ½å°±æœƒæ”¹ç”¨ merge join æˆ–æ˜¯ hash join çš„æ–¹å¼ä¾†åˆä½µå…©è¡¨ã€‚è€Œæ¡ç”¨ merge join æˆ–æ˜¯ hash join æ™‚ï¼Œplanner å°±å¯ä»¥å…ˆä½¿ç”¨ `member_id = 123` çš„æ¢ä»¶ä¾†éæ¿¾ `series`ï¼Œå¯ä»¥ç›´æ¥è®“å…§è¡¨çš„æ•¸é‡å¤§å¹…æ¸›å°‘ï¼ˆä»¥æˆ‘å€‘çš„ä¾‹å­ä¾†èªªå¤§ç´„æ˜¯ä¸€åƒè¬å€‹ rows -> æ•¸åƒå€‹ rowsï¼‰ï¼Œä¾†åŠ é€Ÿ merge join æˆ–æ˜¯ hash join çš„éç¨‹ã€‚\n\n## ç•¶ Function Return Rows éŒ¯èª¤æ™‚çš„ Nested Loop Join Cost\n\næˆ‘å€‘å¯ä»¥é€éæŠŠå…¶ä»– join method é—œé–‰çš„æ–¹å¼ä¾†å¼·åˆ¶ PostgreSQL ä½¿ç”¨ nested loop joinï¼Œä¾†çœ‹çœ‹ nested loop join çš„ cost æ˜¯å¤šå°‘ï¼š\n\n```sql\nSET enable_hashjoin = FALSE;\nSET enable_mergejoin = FALSE;\nSET enable_material = FALSE;\nEXPLAIN \nSELECT\n\tseries.date,\n\tCOALESCE(stats.count, 0) AS count\nFROM\n\t(\n\t\tSELECT GENERATE_SERIES((NOW() - INTERVAL '6 DAYS')::TIMESTAMP, NOW()::TIMESTAMP, '1 DAY')::DATE\n\t) AS series(date)\n\tLEFT JOIN stats ON stats.member_id = 123 AND stats.date = series.date;\n\nNested Loop Left Join  (cost=0.56..59249.13 rows=4524 width=12)\n  ->  Result  (cost=0.00..32.53 rows=1000 width=4)\n\t\t->  ProjectSet  (cost=0.00..5.03 rows=1000 width=8)\n\t\t\t->  Result  (cost=0.00..0.01 rows=1 width=0)\n  ->  Index Scan using stats_pkey on stats  (cost=0.56..59.16 rows=5 width=16)\n\t\tIndex Cond: ((member_id = 123) AND (date = (((generate_series(((now() - '6 days'::interval))::timestamp without time zone, (now())::timestamp without time zone, '1 day'::interval)))::date)))\n```\n\nå¯ä»¥çœ‹åˆ° index scan æ‰€éœ€çš„ cost ç‚º 59.16ï¼Œè€Œå› ç‚ºå¤–è¡¨ï¼ˆ`stats`ï¼‰é ä¼°æœ‰ 1000 å€‹ rowsï¼Œå› æ­¤ cost ç†æ‰€ç•¶ç„¶çš„æœƒæ˜¯ $59.16 \\times 1000 + C \\approx 59249.13$ã€‚ç¢ºå¯¦æ¯”[ä¸Šé¢](#çœŸå¯¦æ¡ˆä¾‹)ä½¿ç”¨ merge left join å¾—åˆ°çš„ cost 21120.13 é‚„è¦é«˜ã€‚\n\n{% note info %}\nè©³ç´°çš„ indexed nested loop join cost è¨ˆç®—æ–¹å¼å¯ä»¥åƒè€ƒ [The Internals of PostgreSQL](https://www.interdb.jp/pg/pgsql03.html#_3.5.1.3.) çš„ä»‹ç´¹ã€‚\n{% endnote %}\n\n{% note info %}\nå¯¦éš›ä¸Š index scan çš„ cost æœƒå—åˆ°è¨­å®šä¸­çš„ `random_page_cost` ä»¥åŠè³‡æ–™åˆ†å¸ƒï¼ˆindex selectivityã€most common valuesã€ï¼ï¼ï¼ï¼‰çš„å½±éŸ¿ï¼š\n\n- `random_page_cost` è¶Šä½ï¼Œindex scan çš„ cost è¶Šä½ã€‚ç­†è€…ä½¿ç”¨çš„æ˜¯é è¨­å€¼ 10ï¼Œç•¶æ”¹ç‚ºå¯¦éš›ä¸Šåœ¨ production ä¸Šçš„å€¼ 1.1 æ™‚ï¼Œindex scan çš„ cost åªå‰© 7.09ï¼Œtotal cost ç‚º 7187.16ã€‚ï¼ˆä½†åŒæ™‚ merge left join çš„ total cost ä¹Ÿé™åˆ° 2961.17ï¼Œæ‰€ä»¥ PostgreSQL é‚„æ˜¯æœƒé¸æ“‡ merge left joinï¼‰ã€‚\n- å¦‚æœ `member_id = 123` åœ¨è¡¨ä¸­å‡ºç¾çš„æ¬¡æ•¸éå¤šï¼Œindex scan çš„ cost ä¹Ÿæœƒå¢åŠ ï¼ˆå› ç‚ºéæ¿¾çš„æ•ˆç‡è®Šå·®äº†ï¼Œå°è‡´æ›´å¤šçš„ rows è¿”å›ï¼‰ã€‚PostgreSQL ä¹Ÿæœ‰å¯èƒ½æ”¹æ¡ç”¨ bitmap scan æˆ–æ˜¯ (parallel) seq scan çš„æ–¹å¼ä¾†éæ¿¾ã€‚\n{% endnote %}\n\n# åŸå§‹ç¢¼åˆ†æ\n\n## PostgreSQL Set Returning Function(SRF) Rows Estimation\n\næˆ‘å€‘ä¾†åˆ†æ PostgreSQL åº•å±¤æ˜¯å¦‚ä½•é ä¼° SRF ç”¢ç”Ÿçš„ rows æ•¸é‡çš„ã€‚\n\næ ¹æ“šä¸Šé¢éƒ¨åˆ†çš„ `EXPLAIN` çµæœï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°é¦–å…ˆæ˜¯ç”± `ProjectSet` é€™å€‹ç¯€é»ç”¢ç”Ÿ 1000 å€‹ rows é€™å€‹çµè«–çš„ï¼š\n\n```sql\nResult  (cost=0.00..37.53 rows=1000 width=8)\n\t->  ProjectSet  (cost=0.00..5.03 rows=1000 width=8)\n\t\t->  Result  (cost=0.00..0.01 rows=1 width=0)\n```\n\nè€Œ `ProjectSet` ç¯€é»æ˜¯ç”±å‡½æ•¸ [`create_set_projection_path`](https://github.com/postgres/postgres/blob/REL_11_STABLE/src/backend/optimizer/util/pathnode.c#L2634) ç”¢ç”Ÿã€‚Call path å¦‚ä¸‹ï¼š\n\n- {% codeblock pathnode.c/create_set_projection_path lang:c https://github.com/postgres/postgres/blob/REL_11_STABLE/src/backend/optimizer/util/pathnode.c#L2634 first_line:2668 %}\n\titemrows = expression_returns_set_rows(node);\n\t{% endcodeblock %}\n\n- {% codeblock clauses.c/expression_returns_set_rows lang:c https://github.com/postgres/postgres/blob/REL_11_STABLE/src/backend/optimizer/util/clauses.c#L804 first_line:812 %}\n\tif (expr->funcretset)\n\t\treturn clamp_row_est(get_func_rows(expr->funcid));\n\t{% endcodeblock %}\n\n- {% codeblock lsyscache.c/get_func_rows lang:c https://github.com/postgres/postgres/blob/REL_11_STABLE/src/backend/utils/cache/lsyscache.c#L1664 first_line:1673 %}\n\tresult = ((Form_pg_proc) GETSTRUCT(tp))->prorows;\n\tReleaseSysCache(tp);\n\treturn result;\n\t{% endcodeblock %}\n\nå¯ä»¥çœ‹åˆ° `ProjectSet` ç¢ºå¯¦æ˜¯ç”± function çš„ `prorows` ä¾†é æ¸¬ return rows çš„æ•¸é‡çš„ã€‚\n\n# è§£æ±ºæ–¹æ¡ˆ\n\n## æ›´æ”¹ `prorows` çš„å€¼\n\næˆ‘å€‘å¯ä»¥å…ˆåšä»¥ä¸‹çš„å¯¦é©—ï¼Œå‰µå»ºä¸€å€‹ `my_generate_series` functionï¼Œä¸¦å°‡ `prorows` è¨­ç‚º 7ï¼š\n\n```sql\nCREATE FUNCTION my_generate_series(TIMESTAMP WITH TIME ZONE, TIMESTAMP WITH TIME ZONE, INTERVAL)\n\tRETURNS TABLE (t TIMESTAMP WITH TIME ZONE) AS\n\t$$ SELECT * FROM generate_series($1, $2, $3) $$\n\tLANGUAGE SQL ROWS 7;\n\n      proname       |                   prosrc                    | prorows\n--------------------+---------------------------------------------+---------\n my_generate_series |  SELECT * FROM generate_series($1, $2, $3)  |      10\n```\n\nå°‡ query æ”¹ç‚ºä½¿ç”¨ `my_generate_series`ï¼š\n\n```sql\nEXPLAIN \nSELECT\n\tseries.date,\n\tCOALESCE(stats.count, 0) AS count\nFROM\n\t(\n\t\tSELECT my_generate_series((NOW() - INTERVAL '6 DAYS')::TIMESTAMP, NOW()::TIMESTAMP, '1 DAY')::DATE\n\t) AS series(date)\n\tLEFT JOIN stats ON stats.member_id = 123 AND stats.date = series.date;\n\nNested Loop Left Join  (cost=0.56..426.14 rows=32 width=12)\n  ->  Result  (cost=0.00..2.28 rows=7 width=4)\n\t\t->  ProjectSet  (cost=0.00..0.32 rows=7 width=8)\n\t\t\t->  Result  (cost=0.00..0.01 rows=1 width=0)\n  ->  Index Scan using stats_pkey on stats  (cost=0.56..60.49 rows=5 width=16)\n\t\tIndex Cond: ((member_id = 123) AND (date = (((my_generate_series((((now() - '6 days'::interval))::timestamp without time zone)::timestamp with time zone, ((now())::timestamp without time zone)::timestamp with time zone, '1 day'::interval)))::date)))\n```\n\nå¯ä»¥çœ‹åˆ° `ProjectSet` ç¯€é»çš„ rows æ•¸é‡å·²ç¶“å¾ 1000 è®Šæˆ 7ï¼Œä¸¦ä¸”æ­£ç¢ºçš„ä½¿ç”¨äº†æˆ‘å€‘é æœŸçš„ nested loop joinã€‚\n\nè€Œ total cost ä¹Ÿå¾å¾åŸæœ¬çš„ 59249.13 é™åˆ° $60.49 \\times 7 + C \\approx 426.14$ã€‚\n\n{% note info %}\nå¦‚æœè®€è€…ä½¿ç”¨çš„ PostgreSQL ç‰ˆæœ¬ >= 12ï¼Œä¹Ÿå¯ä»¥è©¦è©¦ç›´æ¥æ›´æ”¹ `generate_series` çš„ `prorows`ï¼š\n```sql\nALTER FUNCTION generate_series(TIMESTAMP WITH TIME ZONE, TIMESTAMP WITH TIME ZONE, INTERVAL) ROWS 7;\n```\n{% endnote %}\n\nä½†åœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œæˆ‘å€‘è¦ç‰¹åˆ¥å‰µå»ºä¸€å€‹ `generate_series` å‡½æ•¸æ„Ÿè¦ºæœ‰é»å¤šæ­¤ä¸€èˆ‰ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨å¦ä¸€å€‹æ–¹æ³•ã€‚\n\n## åŠ ä¸Š LIMIT\n\næˆ‘å€‘å¯ä»¥åœ¨ `generate_series` çš„ subquery å¾ŒåŠ ä¸Š `LIMIT`ï¼š\n\n```sql\nEXPLAIN\nSELECT\n\tseries.date,\n\tCOALESCE(stats.count, 0) AS count\nFROM\n\t(\n\t\tSELECT\n\t\t\tgenerate_series((NOW() - INTERVAL '6 DAYS')::TIMESTAMP, NOW()::TIMESTAMP, '1 DAY')::DATE\n\t\tLIMIT 7\n\t) AS series(date)\n\tLEFT JOIN stats ON stats.member_id = 123 AND stats.date = series.date;\n\nNested Loop Left Join  (cost=0.56..424.09 rows=32 width=12)\n  ->  Limit  (cost=0.00..0.23 rows=7 width=4)\n\t\t->  Result  (cost=0.00..32.53 rows=1000 width=4)\n\t\t\t->  ProjectSet  (cost=0.00..5.03 rows=1000 width=8)\n\t\t\t\t->  Result  (cost=0.00..0.01 rows=1 width=0)\n  ->  Index Scan using stats_pkey on stats  (cost=0.56..60.49 rows=5 width=16)\n\t\tIndex Cond: ((member_id = 123) AND (date = (((generate_series(((now() - '6 days'::interval))::timestamp without time zone, (now())::timestamp without time zone, '1 day'::interval)))::date)))\n```\n\nå¯ä»¥çœ‹åˆ°å› ç‚ºå¤šäº†ä¸€å€‹ `Limit` ç¯€é»å›å‚³äº† 7 å€‹ rows çµ¦ä¸Šå±¤ï¼Œæˆ‘å€‘ä¸€æ¨£èƒ½å¾—åˆ°é æœŸçš„çµæœã€‚\n\n# è£œå……\n\n## PostgreSQL 12 Planner Support Function\n\nç¾åœ¨æˆ‘å€‘å¯ä»¥é€é `prorows` çš„è¨­å®šæˆ–æ˜¯ `LIMIT` ä¾†è®“ planner æ›´å¥½çš„é æ¸¬ return rows çš„æ•¸é‡ã€‚ä½†ç•¶ function çš„ return rows çœŸçš„æ˜¯ dynamic çš„æ™‚å€™æ€éº¼è¾¦å‘¢ï¼Ÿ\n\nè€Œ PostgreSQL é‡å° function æ²’è¾¦æ³•å¾ˆå¥½çš„é ä¼° return rows åœ¨ PostgreSQL 12 æ™‚æå‡ºäº†è§£æ±ºè¾¦æ³•ï¼Œç¨±ä½œ [planner support function](https://www.postgresql.org/docs/12/xfunc-optimization.html)ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å…è¨±åœ¨ function ä¸Šé¢ç¶å®šä¸€å€‹ support function ç”¨ä¾†å¹«åŠ© planner æ ¹æ“šåƒæ•¸çš„ä¸åŒä¼°è¨ˆ return rows çš„æ•¸é‡ã€‚\n\næˆ‘å€‘å¯ä»¥å¾ˆå¿«çš„é«”é©—ä¸€ä¸‹æœ‰æ²’æœ‰ support function çš„å·®ç•°ï¼š\n\n```sql\n-- PG 11\nEXPLAIN SELECT GENERATE_SERIES(1, 10);\n\n                   QUERY PLAN\n------------------------------------------------\nProjectSet  (cost=0.00..5.02 rows=1000 width=4)\n  ->  Result  (cost=0.00..0.01 rows=1 width=0)\n\n-- PG 12\nEXPLAIN SELECT GENERATE_SERIES(1, 10);\n\n                   QUERY PLAN\n------------------------------------------------\n ProjectSet  (cost=0.00..0.52 rows=10 width=4)\n   ->  Result  (cost=0.00..0.01 rows=1 width=0)\n```\n\né€™æ˜¯å› ç‚ºåœ¨ PostgreSQL 12 æ•´æ•¸çš„ `generate_series` å·²ç¶“æœ‰äº†é è¨­çš„ support functionï¼Œæˆ‘å€‘å¯ä»¥çœ‹æ–°å¢çš„ `prosupport` æ¬„ä½ã€‚\n\n```sql\nSELECT proname, prosrc, prorows, prosupport FROM pg_proc WHERE proname = 'generate_series';\n     proname     |            prosrc            | prorows |          prosupport\n-----------------+------------------------------+---------+------------------------------\n generate_series | generate_series_timestamp    |    1000 | -\n generate_series | generate_series_step_int4    |    1000 | generate_series_int4_support\n generate_series | generate_series_int4         |    1000 | generate_series_int4_support\n generate_series | generate_series_step_int8    |    1000 | generate_series_int8_support\n generate_series | generate_series_int8         |    1000 | generate_series_int8_support\n generate_series | generate_series_step_numeric |    1000 | -\n generate_series | generate_series_numeric      |    1000 | -\n generate_series | generate_series_timestamptz  |    1000 | -\n```\n\nå¾ˆå¯æƒœç›´åˆ°ç›®å‰ï¼ˆPostgreSQL 15ï¼‰ç‚ºæ­¢ï¼Œ`generate_series` éƒ½é‚„æ˜¯åªæœ‰æ”¯æ´æ•´æ•¸çš„ support functionï¼Œæ‰€ä»¥å°æ–¼ä½¿ç”¨ timestamp ä¾†èªªï¼Œé‚„æ˜¯è¦ä½¿ç”¨ä¸Šé¢æåˆ°çš„æ–¹æ³•ã€‚\n\n# ç¸½çµ\n\nPostgreSQL ç›®å‰å°æ–¼ function çš„ return rows é›–ç„¶æœ‰äº†æ–°çš„ `prosupport` æ¬„ä½ä¾†æ”¯æ´ä¸€äº›ç°¡å–®å‡½æ•¸çš„ return rows é ä¼°ï¼Œä½†å¤§å¤šæ•¸çš„ functions éƒ½é‚„æ˜¯ä½¿ç”¨é è¨­å€¼ 1000 çš„ã€‚å› æ­¤åœ¨æœªä¾†å¦‚æœæœ‰åœ¨ query å…§ä½¿ç”¨åˆ° functionï¼Œä¸ä»¿ç”¨ `EXPLAIN` æ³¨æ„ PostgreSQL çš„ estimated function return rows æ˜¯å¦æœƒå½±éŸ¿åˆ° query planã€‚å¦‚æœç™¼ç¾èˆ‡é æƒ³ä¸­çš„ plan ä¸åŒï¼Œå¯ä»¥é€éä¸Šé¢æåˆ°çš„å¹¾å€‹æ–¹æ³•æ”¹å¯« query ä¾†é”åˆ°é æœŸçš„æ•ˆæœï¼\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["PostgreSQL"],"categories":["PostgreSQL"]},{"title":"LeetCode 629 - K Inverse Pairs Array","url":"/LeetCode-K-Inverse-Pairs-Array/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/k-inverse-pairs-array/](https://leetcode.com/problems/k-inverse-pairs-array/)\n\nçµ¦å®š $N$ ä»¥åŠ $K$ï¼Œæ±‚å‡ºåŒ…å« $1\\sim N$ çš„åºåˆ—ä¸­ï¼Œæœ‰å¤šå°‘ç¨®æ°å¥½æœ‰ $K$ å€‹é€†åºæ•¸å°ã€‚\n\nç­”æ¡ˆè¦å° $10^9 + 7$ å–é¤˜ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: n = 3, k = 0\nOutput: 1\nExplanation: Only the array [1,2,3] which consists of numbers from 1 to 3 has exactly 0 inverse pairs.\n```\n\n## Example 2:\n\n```\nInput: n = 3, k = 1\nOutput: 2\nExplanation: The array [1,3,2] and [2,1,3] have exactly 1 inverse pair.\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå‡è¨­æˆ‘å€‘è¦ç”¢ç”Ÿ $1\\sim N$ çš„ä»»æ„åºåˆ—ï¼Œæˆ‘å€‘å¯ä»¥å¾ç¬¬ä¸€å€‹ä½ç½®é–‹å§‹æ“ºèµ·ï¼Œå‡è¨­ $N=3$ ä¸” $K=2$ï¼Œå‰‡ï¼š\n\n1. è‹¥ç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 1ï¼Œå‰‡æˆ‘å€‘å¯ä»¥çŸ¥é“ä¸ç®¡å‰©ä¸‹çš„æ•¸å­—æ€éº¼æ“ºï¼Œ1 èˆ‡å‰©ä¸‹æ•¸å­—çš†ä¸æœƒç”¢ç”Ÿé€†åºæ•¸å°ã€‚å› æ­¤è‹¥å‰©ä¸‹çš„å…©å€‹æ•¸å­—ä¸­èƒ½ç”¢ç”Ÿ $k-0=2-0=2$ çµ„é€†åºæ•¸å°ï¼Œå°±æ»¿è¶³æˆ‘å€‘ $N=3$ ä¸” $K=2$ çš„è¦æ±‚ã€‚\n2. è‹¥ç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 2ï¼Œå‰‡æˆ‘å€‘å¯ä»¥çŸ¥é“ä¸ç®¡å‰©ä¸‹çš„æ•¸å­—æ€éº¼æ“ºï¼Œ2 èˆ‡å‰©ä¸‹çš„æ•¸å­—ä¸€å®šæœƒç”¢ç”Ÿä¸€çµ„é€†åºæ•¸å° $(2,1)$ï¼Œå› æ­¤è‹¥å‰©ä¸‹çš„å…©å€‹æ•¸å­—ä¸­èƒ½ç”¢ç”Ÿ $k-1=2-1=1$ çµ„é€†åºæ•¸å°ï¼Œå°±èƒ½æ»¿è¶³æˆ‘å€‘ $N=3$ ä¸” $K=2$ çš„éœ€æ±‚ã€‚\n3. è‹¥ç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 3ï¼Œå‰‡æˆ‘å€‘å¯ä»¥çŸ¥é“ä¸ç®¡å‰©ä¸‹çš„æ•¸å­—æ€éº¼æ“ºï¼Œ3 èˆ‡å‰©ä¸‹çš„æ•¸å­—ä¸€å®šæœƒç”¢ç”Ÿå…©çµ„é€†åºæ•¸å° $(3,1)$ èˆ‡ $(3,2)$ï¼Œå› æ­¤è‹¥å‰©ä¸‹çš„å…©å€‹æ•¸å­—ä¸­èƒ½ç”¢ç”Ÿ $k-2=2-2=0$ çµ„é€†åºæ•¸å°ï¼Œå°±èƒ½æ»¿è¶³æˆ‘å€‘ $N=3$ ä¸” $K=2$ çš„éœ€æ±‚ã€‚\n\nå› æ­¤æˆ‘å€‘å¯ä»¥å®šç¾© $dp(i,j)$ ç‚ºé•·åº¦ç‚º $i$ çš„åºåˆ—ä¸­æ°å¥½æœ‰ $j$ å€‹é€†åºæ•¸å°çš„åºåˆ—æ•¸é‡ã€‚å‰‡æˆ‘å€‘çŸ¥é“é•·åº¦ç‚º $i$ çš„åºåˆ—ä¸­ï¼Œç¬¬ä¸€å€‹æ•¸å­—æœ‰ $i$ ç¨®é¸æ“‡ï¼š\n\n- è‹¥ç¬¬ä¸€å€‹æ•¸å­—é¸æ“‡ç¬¬ 1 å°çš„æ•¸å­—ï¼Œç¬¬ä¸€å€‹æ•¸å­—ä¸æœƒèˆ‡å¾Œé¢çš„ä»»ä½•æ•¸å­—ç”¢ç”Ÿé€†åºæ•¸å°ï¼Œå› æ­¤ $dp(i,j)=dp(i-1,j)$ã€‚\n- è‹¥ç¬¬ä¸€å€‹æ•¸å­—é¸æ“‡ç¬¬ 2 å°çš„æ•¸å­—ï¼Œç¬¬ä¸€å€‹æ•¸å­—æ°å¥½èˆ‡å¾Œé¢çš„æ‰€æœ‰æ•¸å­—ç”¢ç”Ÿ 1 çµ„é€†åºæ•¸å°ï¼Œå› æ­¤ $dp(i,j)=dp(i-1,j-1)$ã€‚\n- ...\n- è‹¥ç¬¬ä¸€å€‹æ•¸å­—é¸æ“‡ç¬¬ $i$ å°çš„æ•¸å­—ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤§çš„ï¼‰ï¼Œç¬¬ä¸€å€‹æ•¸å­—æ°å¥½èˆ‡å¾Œé¢çš„ $i-1$ å€‹æ•¸å­—éƒ½ç”¢ç”Ÿé€†åºæ•¸å°ï¼Œå› æ­¤ $dp(i,j)=dp(i-1,j-i+1)$ã€‚\n\nå› æ­¤ç¸½çµä¾†èªªè½‰ç§»å³ç‚ºï¼š\n\n$$\\red{dp(i,j)=\\sum_{k=1}^{i}dp(i-1,j-k+1)}$$\n\nèˆ‰ä¾‹ä¾†èªªï¼š\n\n- $dp(3,0)=dp(2,0)+dp(2,-1)+dp(2,-2)$\n- $dp(3,1)=dp(2,1)+dp(2,0)+dp(2,-1)$\n- $dp(3,2)=dp(2,2)+dp(2,1)+dp(2,0)$\n- $dp(3,3)=dp(2,3)+dp(2,2)+dp(2,1)$\n- $dp(3,4)=dp(2,4)+dp(2,3)+dp(2,2)$\n- ...\n\nå› æ­¤æˆ‘å€‘å³å¯é–‹å§‹å¯¦ä½œã€‚\n\n# å¯¦ä½œç´°ç¯€\n\n## æ™‚é–“è¤‡é›œåº¦å„ªåŒ–\n\næ ¹æ“šä¸Šé¢çš„è½‰ç§»å¼ï¼Œæˆ‘å€‘å¯ä»¥å¾ˆç°¡å–®çš„åšå‡º $O(N\\cdot K^2)$ çš„ DPï¼Œpseudo code å¦‚ä¸‹ï¼ˆé€™è£¡å…ˆä¸è€ƒæ…®é‚Šç•Œå•é¡Œï¼‰ï¼š\n\n```cpp\nfor (int i = 1; i <= N; ++i) {\n  for (int j = 1; j <= K; ++j) {\n    for (int k = 1; k <= i; ++k) {\n      dp[i][j] += dp[i - 1][j - k + 1];\n    }\n  }\n}\n```\n\nä½†å¾ˆé¡¯ç„¶è§€å¯Ÿä¸Šé¢åˆ—å‡ºçš„è½‰ç§»ï¼Œæˆ‘å€‘å¯ä»¥è§€å¯Ÿåˆ°æ¯æ¬¡è¨ˆç®— $dp(i,j)$ æ™‚ï¼Œä¸¦ä¸éœ€è¦éƒ½ç¨ç«‹çš„ç”¨ä¸€å€‹ $k=1\\sim i$ çš„è¿´åœˆè¨ˆç®—ï¼Œè€Œå¯ä»¥å¾ $dp(i,j-1)$ ä¾†è½‰ç§»ï¼š\n\nä¾‹å¦‚è¨ˆç®— $dp(3,3)=dp(2,3)+dp(2,2)+dp(2,1)$ æ™‚ï¼Œæˆ‘å€‘å¯ä»¥é€é $dp(3,2)=dp(2,2)+dp(2,1)+dp(2,0)$ï¼Œå¾—åˆ° $dp(3,3)=dp(3,2)+dp(2,3)-dp(2,0)$ã€‚\n\nä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¯ä»¥å°‡è½‰ç§»å¼ç°¡åŒ–ç‚ºï¼š\n\n$$\\red{dp(i,j)=dp(i,j-1)+dp(i-1,j)-dp(i-1,j-i)}$$\n\nå› æ­¤ä¸­é–“çš„ $k$ è¿´åœˆå³å¯è¢«çœå»ï¼Œæ™‚é–“è¤‡é›œåº¦å¯ä»¥é™åˆ° $O(N \\cdot K)$ã€‚\n\nå¯¦ä½œæ™‚ï¼Œè¦æ³¨æ„ï¼š\n\n- é‚Šç•Œ $j-i$ å¯èƒ½æœƒå°æ–¼ 0ï¼Œç”±æ–¼æˆ‘å€‘çŸ¥é“ä¸å¯èƒ½æœƒæœ‰è² æ•¸å€‹é€†åºæ•¸å°çš„æƒ…æ³ï¼Œå› æ­¤å°æ–¼æ‰€æœ‰ $j \\lt 0$ï¼Œ$dp(i,j)=0$ã€‚\n- æ‰€æœ‰çš„ $dp(i,0)=1$ï¼ˆé•·åº¦ç‚º $i$ ä¸”æ²’æœ‰é€†åºæ•¸å°çš„åºåˆ—åªæœ‰ä¸€ç¨®ï¼‰ã€‚\n\næœ€å¾Œçš„ç­”æ¡ˆå³ç‚º $dp(N,K)$ã€‚\n\n## ç©ºé–“è¤‡é›œåº¦å„ªåŒ–\n\næˆ‘å€‘å¯ä»¥é–‹ä¸€å€‹ $(N + 1)\\times (K+1)$ å¤§å°çš„é™£åˆ—ä¾†å„²å­˜æ‰€æœ‰çš„ DP ç‹€æ…‹ï¼Œä½†æ˜¯é€éä¸Šè¿°çš„è½‰ç§»å¼å¯ä»¥ç™¼ç¾ï¼Œåœ¨è¨ˆç®— $dp(i,j)$ æ™‚ï¼Œåªæœƒç”¨åˆ° $dp(i-1,j)$ã€$dp(i,j-1)$ ä»¥åŠ $dp(i-1,j-i)$ é€™ä¸‰å€‹å€¼ï¼Œå› æ­¤æˆ‘å€‘åªéœ€è¦ä¿ç•™å…©å€‹ rows çš„ DP ç‹€æ…‹å°±è¶³å¤ äº†ã€‚\n\nå› æ­¤ç­†è€…åœ¨å¯¦ä½œæ™‚ä½¿ç”¨ `pre` é™£åˆ—ä»£è¡¨ $dp(i-1)$ï¼›`cur` é™£åˆ—ä»£è¡¨ $dp(i)$ï¼Œæ¯æ¬¡ $i$ è¿´åœˆå¾Œäº¤æ›å…©å€‹é™£åˆ—çš„æŒ‡æ¨™å³å¯ã€‚\n\nå¦‚æ­¤ä¸€ä¾†å¯ä»¥æŠŠç©ºé–“è¤‡é›œåº¦å¾ $O(N \\cdot K)$ é™åˆ° $O(K)$ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/k-inverse-pairs-array/\n * Runtime: 33ms\n * Time Complexity: O(NK)\n * Space Complexity: O(K)\n */\n\nclass Solution {\nprivate:\n  const int mod = 1e9 + 7;\npublic:\n  int kInversePairs(int n, int k) {\n    vector<int>* pre = new vector<int>(k + 1, 0);\n    vector<int>* cur = new vector<int>(k + 1, 0);\n    (*pre)[0] = 1;\n    (*cur)[0] = 1;\n\n    for (int i = 1; i <= n; ++i) {\n      swap(pre, cur); // cur->dp[i], pre->dp[i-1]\n      for (int j = 1; j <= k; ++j) {\n        if (j < i) {\n          // j - i < 0, so dp(i-1,j-i) = 0\n          (*cur)[j] = ((*cur)[j - 1] + (*pre)[j]) % mod;\n        } else {\n          (*cur)[j] = (((*cur)[j - 1] + (*pre)[j]) % mod - (*pre)[j - i] + mod) % mod;\n        }\n      }\n    }\n\n    int answer = (*cur)[k];\n    delete pre;\n    delete cur;\n\n    return answer;\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"Designing Data-Intensive Application ç¬¬äº”ç« ç­†è¨˜","url":"/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/","content":"\nè³‡æ–™å‰¯æœ¬ï¼ˆReplicationï¼‰çš„æ„æ€æ˜¯é€éç¶²è·¯ï¼Œå°‡è³‡æ–™è¤‡è£½åˆ°å¤šå€‹ç¯€é»ï¼ˆæ©Ÿå™¨ï¼‰ä¸Šé¢å„²å­˜ã€‚Replication æœ‰ä»¥ä¸‹ä¸‰å€‹å¥½è™•ï¼š\n\n1. è®“è³‡æ–™åœ¨åœ°ç†ä½ç½®ä¸Šé è¿‘ä½¿ç”¨è€…ä»¥é™ä½ network latencyã€‚\n2. ç•¶éƒ¨åˆ†ç¯€é»ä¸å¯ç”¨æ™‚ç³»çµ±ä¾ç„¶å¯ä»¥ä¿æŒé‹ä½œï¼Œæé«˜å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€‚\n3. åˆ†æ•£ read queriesï¼Œæé«˜ read throughputã€‚\n\nReplication çš„é›£è™•åœ¨æ–¼è³‡æ–™æ˜¯æœƒæ›´æ–°çš„ï¼Œå› æ­¤å¦‚ä½•é€éç¶²è·¯åŒæ­¥é€™äº›è³‡æ–™çš„æ›´æ–°æ˜¯æœ€å¤§çš„é›£é»ã€‚æœ¬ç« ç¯€ä¸»è¦æ¢è¨ä¸‰ç¨®å¸¸è¦‹çš„ replication modelï¼Œåˆ†åˆ¥æ˜¯ **single-leader replication**ã€**multi-leader replication** ä»¥åŠ **leaderless replication**ã€‚\n\n<!-- More -->\n\n# Leader and Followers\n\né¦–å…ˆï¼Œåªè¦æ¯å€‹ writes éƒ½èƒ½è¢«æ¯å€‹ replica æŒ‰ç…§ä¸€æ¨£çš„é †åºåŸ·è¡Œï¼Œé‚£éº¼æœ€å¾Œæ¯å€‹ replica éƒ½æœƒæ“æœ‰ç›¸åŒçš„è³‡æ–™ã€‚\n\nå› æ­¤æœ€å¸¸è¦‹çš„ replica æ–¹å¼å³å°‡æŸå€‹ç¯€é»è¦–ç‚º leaderï¼Œæ‰€æœ‰çš„ client writes éƒ½åªèƒ½é€çµ¦ leaderï¼Œåœ¨ leader ç¢ºèªè³‡æ–™å¯«å…¥å…¶æœ¬åœ°çš„å„²å­˜å¾Œï¼Œç”± leader é€é replication log æˆ–æ˜¯ stream å‘å…¶ä»–çš„ replicasï¼ˆç¨±ä½œ followersï¼‰é€å‡ºè³‡æ–™è®Šæ›´çš„è«‹æ±‚ã€‚æ¯å€‹ followers åªè¦åœ¨æ”¶åˆ°æ›´æ–°çš„ log å¾ŒæŒ‰ç…§èˆ‡ leader ä¸€æ¨£çš„é †åºæ›´æ–°å…¶æœ¬åœ°çš„å„²å­˜å³å¯ã€‚\n\nè€Œ client é›–ç„¶åªèƒ½å¯«å…¥åˆ° leaderï¼Œä½†æ˜¯å¯ä»¥é€é leader æˆ–æ˜¯ followers ä¾†è®€å–ã€‚\n\n![Single-leader replication.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/leader_follower.png)\n\nLeader-follower æ¨¡å¼å¯ä»¥é€éè®€å¯«åˆ†é›¢ä¾†å¤§å¹…é™ä½è³‡æ–™åº«çš„ loadingï¼Œä¸¦ä¸”ä¸€èˆ¬å¤šæ•¸çš„ web application éƒ½æ˜¯ read-heavy çš„ï¼Œå› æ­¤åœ¨ PostgreSQLã€MySQLã€MongoDB ç­‰å¸¸è¦‹çš„ databasesã€æˆ–æ˜¯ Kafkaã€RabbitMQ ç­‰ message queue systems ä¸­ï¼Œleader-based replication éƒ½æ˜¯å…§å»ºçš„ featuresã€‚\n\n## Synchronous Versus Asynchonous Replication\n\nåœ¨ replication çš„éç¨‹ä¸­ï¼Œå¯ä»¥ç™¼ç¾å¾ leader å¯«å…¥åˆ° followers å¯«å…¥ä¸­é–“æœƒæœ‰ä¸€æ®µ delayã€‚\n\nåœ¨ relational database ä¸­ï¼Œå¯ä»¥é¸æ“‡ä½¿ç”¨ synchronous æˆ–æ˜¯ asynchronous çš„æ–¹å¼ä¾†åš replicationã€‚\n\n- Synchronous Replicationï¼šLeader ç­‰åˆ° followers å›è¦†è³‡æ–™å¯«å…¥å¾Œæ‰è®“å¯«å…¥å¯è¦‹ä¸¦ä¸”å›å‚³æˆåŠŸã€‚\n- Asynchronous Replicationï¼šLeader ç¢ºèªå¯«å…¥åˆ°æœ¬åœ°å„²å­˜ç©ºé–“å¾Œç«‹åˆ»å›å‚³æˆåŠŸã€‚\n\nSynchronous çš„å¥½è™•èƒ½å¤ ç¢ºä¿è³‡æ–™çš„ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼Œå£è™•æ˜¯ç•¶ followers failure æ™‚è³‡æ–™å°±ç„¡æ³•å¯«å…¥ï¼Œé™ä½ç³»çµ±çš„å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€‚\n\nå› æ­¤æ‰€æœ‰çš„ followers éƒ½ä½¿ç”¨ synchronous replication æ˜¯ä¸å¯è¡Œçš„ï¼Œå¦å‰‡ä¸€å€‹ follower çš„ outage å°±æœƒå°è‡´æ‰€æœ‰å¯«å…¥ç„¡æ³•åŸ·è¡Œã€‚å¸¸è¦‹çš„é…ç½®åŒ…æ‹¬ï¼š\n\n- åªæœ‰ä¸€å€‹ follower æ¡ç”¨ synchronousï¼Œå…¶ä»– followers æ¡ç”¨ asynchronousã€‚æœ‰æ™‚ç¨±ä½œ *semi-synchronous* çš„è¨­å®šã€‚\n- å…¨éƒ¨çš„ followers éƒ½æ˜¯ asynchronousï¼Œå¯èƒ½æœƒé€ æˆè³‡æ–™çš„éºå¤±ï¼ˆå¯«å…¥åˆ° leader å¾Œ leader failureï¼Œå‰‡é€™ç­† commit ç„¡æ³•è¢«æäº¤åˆ°å…¶ä»–çš„ followers è€Œæ¶ˆå¤±ï¼‰ã€‚\n\n## Setting Up New Followers\n\nè¦åœ¨ zero-downtime çš„æƒ…æ³ä¸‹å¢åŠ æ–°çš„ followerï¼Œé¦–å…ˆå–å¾— leader åœ¨æŸå€‹æ™‚é–“é»çš„ snapshot ä¸¦è¤‡è£½åˆ° follower node ä¸­ï¼Œfollower é–‹å§‹å‘ leader è«‹æ±‚ snapshot å¾Œçš„ replication logï¼Œä¾‹å¦‚ log çš„ç´¢å¼•å€¼åœ¨ PostgreSQL ä¸­ç¨±ä½œ LSNï¼Œæœ€å¾ŒåŒæ­¥å®Œæˆã€‚\n\n## Handling Node Outages\n\n### Follower failure: Catch-up recovery\n\nåœ¨ follower çš„æœ¬åœ°å„²å­˜ä¸­æœ‰ç´€éŒ„å“ªäº› commit å·²ç¶“å®Œæˆçš„ logï¼Œå› æ­¤ç•¶ follower é‡å•Ÿæ™‚å¯ä»¥å¾æœ€å¾Œä¸€å€‹å®Œæˆçš„ transaction é–‹å§‹å‘ leader è«‹æ±‚æ‰€æœ‰çš„è®Šæ›´ã€‚\n\n### Leader failure: Failover\n\nLeader failure å¾ŒæŸå€‹ follower éœ€è¦æ™‰å‡æˆ leaderï¼Œé€™å€‹éç¨‹ç¨±ä½œ *failover*ã€‚\n\nFailover çš„éç¨‹åŒ…å«ä»¥ä¸‹å¹¾å€‹æ­¥é©Ÿï¼š\n\n1. åµæ¸¬ leader æ˜¯å¦é‚„æ­£å¸¸é‹ä½œï¼šé€šå¸¸é€é heartbeat èˆ‡ timeout é”æˆã€‚\n2. é¸æ“‡ä¸€å€‹æ–°çš„ leaderï¼šé€šå¸¸ç¨±ä½œ *leader election*ï¼Œæ–°çš„ leader æœ€å¥½çš„é¸æ“‡æ˜¯æ“æœ‰æœ€æ–°è³‡æ–™çš„ followerã€‚è¦è®“æ‰€æœ‰ followers å–å¾—æ–° leader çš„å…±è­˜æ˜¯ä¸€å€‹ *consensus problem*ï¼Œæœƒåœ¨å¾Œé¢çš„ç« ç¯€ä»‹ç´¹åˆ°ã€‚\n3. é‡æ–°è¨­ç½®ç³»çµ±ï¼šè¦è®“ client ç«¯ã€èˆŠçš„ leaderã€å…¶é¤˜ followers éƒ½èƒ½å¤ çŸ¥é“æœ‰æ–°çš„ leader ä»¥åŠæ–°çš„ leader æ˜¯å“ªå€‹ç¯€é»ã€‚\n\nå…¶ä¸­æœ‰ä¸€äº›é‡è¦çš„å•é¡Œè¦æ³¨æ„ï¼š\n\n- æ¡ç”¨ asynchronous replication å¯èƒ½å°è‡´è³‡æ–™çš„éºå¤±ï¼Œé•å durability çš„åŸå‰‡ã€‚\n- å°±ç®— durability çš„å•é¡Œå¯ä»¥è¢«å…è¨±ï¼Œä¹Ÿè¦å°å¿ƒä¸Ÿæ£„ writes å¯èƒ½é€ æˆçš„å•é¡Œã€‚\n\n\tä¾‹å¦‚ä½¿ç”¨ autoincrementing ID å¾Œï¼Œè‹¥æ–°çš„ leader ä½¿ç”¨åˆ°ä¸€äº›èˆŠ leader ä½¿ç”¨éçš„ IDï¼Œå¯èƒ½å°è‡´å„²å­˜åœ¨ Redis å¿«å–ä¸­ ID å°æ‡‰åˆ°çš„è³‡æ–™èˆ‡ DB ä¸­çš„è³‡æ–™ä¸ç¬¦è€Œå°è‡´è®€å–åˆ°éŒ¯èª¤çš„è³‡æ–™ï¼ˆå¯èƒ½é€ æˆè³‡æ–™å¤–æ´©ï¼‰ã€‚\n- è¦å°å¿ƒ *split brain* çš„ç™¼ç”Ÿï¼Œä¹Ÿå°±æ˜¯æœ‰å…©å€‹ nodes ä»»ç‚ºè‡ªå·±æ˜¯ leader ä¸¦åŒæ™‚æ¥æ”¶ client çš„å¯«å…¥ã€‚\n- Heartbeat timeout çš„æ™‚é–“å¦‚æœéçŸ­ï¼Œæœƒé€ æˆä¸å¿…è¦çš„ failoverï¼ˆleader å¯èƒ½åªæ˜¯ response time å¢åŠ ï¼‰ï¼›éé•·æœƒé€ æˆç³»çµ±èŠ±æ›´ä¹…çš„æ™‚é–“ recoveryã€‚\n\n## Implementation of Replication Logs\n\né—œæ–¼ replication logs çš„å¯¦ä½œæœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š\n\n### Statement-based replication\n\nå°‡ä¿®æ”¹ç›¸é—œçš„ statement è¤‡è£½åˆ° follower nodesï¼Œä¾‹å¦‚ SQL ä¸­å°±æ˜¯ `INSERT`ã€`UPDATE` èˆ‡ `DELETE`ã€‚é€™ç¨®æ–¹æ³•æœƒæœ‰ä¸€äº›å•é¡Œï¼š\n\n- Nondeterministic functions æœƒå¾—åˆ°ä¸ä¸€æ¨£çš„çµæœï¼šä¾‹å¦‚ `NOW()` æˆ–æ˜¯ `RAND()`ã€‚\n- ä¸€äº› statements çš„é †åºå°‡ä¸èƒ½æ”¹è®Šï¼Œä¾‹å¦‚ `INSERT` autoincrementing columnï¼Œæˆ–æ˜¯åŸºæ–¼ä¸€äº›æ¬„ä½çš„ `UPDATE`ã€‚é€™æœƒé™åˆ¶åŸæœ¬å¯ä»¥ä¸¦è¡Œçš„ transactions ä½¿ä»–å€‘ä¸€å®šè¦ä¸²è¡Œçš„åŸ·è¡Œã€‚\n\næ‰€ä»¥ leader éœ€è¦å…ˆå°‡ nondeterministic statement éƒ½å…ˆè®Šæˆ deterministic log æ‰èƒ½é€çµ¦ follower nodesã€‚å› æ­¤é€™å€‹æ–¹æ³•åªæœ‰åœ¨å°‘æ•¸æƒ…å¢ƒä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚ MySQL v5.1 ä¹‹å‰ã€‚\n\n### Write-ahead log (WAL) shipping\n\nFollowers é€éè®€å– leader çš„ WAL ä¾†åŒæ­¥è³‡æ–™ã€‚è¢« PostgreSQL ä»¥åŠ Oracle ä½¿ç”¨ã€‚\n\nå¦‚æ­¤ä¸€ä¾†å®Œå…¨å¯ä»¥è§£æ±º statement-based replication çš„å•é¡Œï¼Œä½†æ˜¯å£è™•æ˜¯ WAL æ˜¯éå¸¸åº•å±¤çš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯ç´€éŒ„ disk çš„å“ªå€‹ block çš„æ•¸å€¼è®ŠåŒ–ã€‚å› æ­¤åŸºæœ¬ä¸Šè·¨ç‰ˆæœ¬ä¹‹é–“çš„ WAL æ˜¯å¾ˆæœ‰å¯èƒ½ä¸ç›¸å®¹çš„ã€‚\n\nå¦‚æœ WAL å¯ä»¥è·¨ç‰ˆæœ¬ç›¸å®¹ï¼Œé‚£å¯ä»¥è¢«ç”¨åœ¨ zero-downtime å‡ç´šã€‚å…ˆå°‡ followers éƒ½å‡ç´šå¾Œï¼Œå†è®“ leader failover å³å¯ã€‚\n\n### Logical log replication\n\né€éé¡å¤–çš„ log æä¾›çµ¦ follower ä½¿ç”¨ï¼Œä¾‹å¦‚ MySQL çš„ binlogã€‚\n\nå› ç‚º logical log èˆ‡ storage engine ä½¿ç”¨çš„æ ¼å¼å®Œå…¨ä¸åŒï¼Œå› æ­¤é©åˆæä¾›çµ¦å¤–éƒ¨çš„æœå‹™ä½¿ç”¨ï¼Œä¾‹å¦‚å¯«åˆ° warehouse æˆ–æ˜¯åŒæ­¥åˆ°å…¶ä»– database ç­‰ç­‰ã€‚é€™ç¨®æŠ€è¡“è¢«ç¨±ä½œ *capture data change*ã€‚\n\n### Trigger-based replication\n\nä½¿ç”¨ database çš„ trigger è¨»å†Šä¸€å€‹ application layer çš„å‡½æ•¸ï¼Œè®“è³‡æ–™æ›´æ–°æ™‚è‡ªå‹•çš„å‘¼å«ã€‚\n\né©åˆç”¨åœ¨æ›´å½ˆæ€§ã€æ›´è¤‡é›œçš„ replication ä¸Šï¼Œä½†æ˜¯ overhead è¼ƒå¤§ã€‚\n\nä¾‹å¦‚ Databus for Oracleã€Bucardo for Postgresã€‚\n\n# Problems with Replication Log\n\nReplicaiton æä¾› fault-toleranceã€æå‡ scalability ä»¥åŠé™ä½ network latencyï¼ˆåœ°ç†ä½ç½®ä¸Šï¼‰ã€‚\n\næ¡ç”¨ leader-based replication å¯ä»¥é€éå¢åŠ  followers çš„æ•¸é‡æå‡ read scabilityï¼Œä¸¦ä¸”å¤§å¤šæ•¸ç¶²è·¯æ‡‰ç”¨ç¨‹å¼éƒ½æ˜¯ read-heavy çš„ã€‚å°±å¦‚åŒå‰é¢æåˆ°çš„ï¼Œä½¿ç”¨ leader-based replication å¿…é ˆæ¡ç”¨ asynchronous çš„æ¨¡å¼ï¼Œå¦å‰‡å–®ä¸€ç¯€é»æ•…éšœæœƒä½¿å¾—æ•´å€‹ç³»çµ±ç„¡æ³•é‹ä½œã€‚\n\nè€Œå¾Œé¢ä»‹ç´¹åˆ°çš„ multi-leader replication æˆ–æ˜¯ leaderless ä¹Ÿéƒ½æ¡ç”¨ asynchronous ä¾†ä¿è­‰ availabilityã€‚\n\næ¡ç”¨ asynchronous æ¨¡å¼å¯èƒ½æœƒè®€åˆ°å°šæœªæ›´æ–°çš„è³‡æ–™ï¼Œé€ æˆè³‡æ–™åº«é–“æš«æ™‚çš„ä¸ä¸€è‡´ï¼ˆdata inconsistencyï¼‰ã€‚å¦‚æœå°è³‡æ–™åº«çš„å¯«å…¥åœæ­¢ï¼Œé‚£ followers çµ‚ç©¶æœƒæ›´æ–°ä¸¦ä¸”é”åˆ°ä¸€è‡´ï¼Œé€™å°±æ˜¯æ‰€è¬‚çš„ *æœ€çµ‚ä¸€è‡´æ€§ eventual consistency*ã€‚\n\nä»¥ä¸‹æ¢è¨ *eventual consistency* é€ æˆçš„å¹¾å€‹å•é¡Œï¼š\n\n## Reading Your Own Writes\n\nä½¿ç”¨è€…é€äº†ä¸€ç­†æ›´æ–°ï¼Œä½†æ˜¯ä¸‹æ¬¡è®€å–æ™‚æ²’æœ‰è®€åˆ°ã€‚\n\nè‹¥æƒ³è¦é”åˆ° *read-your-writes consistency* or *read-after-writes consistency* ä¾†é¿å…é€™å€‹å•é¡Œï¼Œå¯ä»¥ï¼š\n\n- ç•¶ä½¿ç”¨è€…è®€å–è‡ªå·±å¯ä»¥ä¿®æ”¹åˆ°çš„è³‡æ–™æ™‚ï¼Œå¾ leader è®€å–ã€‚ä¾‹å¦‚å€‹äººè³‡æ–™åªæœ‰ä½¿ç”¨è€…æœ¬äººå¯ä»¥ä¿®æ”¹ï¼Œå› æ­¤åªè¦æ˜¯æœ¬äººè®€å–æ™‚çš†å¾ leader è®€å–ã€‚ä½†è‹¥è³‡æ–™å¯ä»¥è¢«å¤§å¤šä½¿ç”¨è€…ä¿®æ”¹å‰‡ä¸é©åˆé€™ç¨®æ–¹å¼ï¼ˆæœƒè®Šæˆæ¯å€‹ requests éƒ½è¦å¾ leader è®€å–ï¼‰ã€‚\n- ç”± client æä¾›ä¸Šæ¬¡ write çš„æ™‚é–“ï¼Œå‰‡ server åªå›å‚³å†é€™å€‹æ™‚é–“ä¹‹å¾Œçš„çµæœã€‚è‹¥ç•¶å‰çš„ follower é‚„æ²’æœ‰æ›´æ–°åˆ°é€™å€‹æ™‚é–“é»ï¼Œå¯ä»¥è½‰äº¤ requests çµ¦å…¶ä»– followers æˆ–æ˜¯å¤šç­‰å¾…ã€‚ä½†å¦‚æœä½¿ç”¨è€…å¾å¤šå€‹è£ç½®ä¸Šæ“ä½œï¼Œé€™å€‹æ–¹æ³•å°‡é›£ä»¥é”åˆ°ã€‚\n\n## Monotonic Reads\n\nè‹¥åŒä¸€å€‹ä½¿ç”¨è€…å‰å¾Œå…©æ¬¡ requests è®€åˆ°ä¸åŒçš„ followersï¼Œå¯èƒ½é€ æˆç¬¬ä¸€æ¬¡çš„ request è®€åˆ°æ¯”ç¬¬äºŒæ¬¡ request é‚„è¦æ–°çš„è³‡æ–™ã€‚\n\nè‹¥æƒ³è¦é”åˆ° *monotonic reads consistency* ä¾†é¿å…é€™å€‹å•é¡Œï¼Œå¯ä»¥è®“åŒä¸€å€‹ä½¿ç”¨è€…æ°¸é éƒ½åªè®€åˆ°åŒä¸€å€‹ replicaï¼Œä¾‹å¦‚é€é hash user ID ä¾†æ±ºå®šè®€å–çš„ replicaï¼Œä½†é€™æ¨£å°±å¿…é ˆè€ƒæ…® replica failed çš„æ™‚å€™é€™äº› requests è¦å¦‚ä½• re-route åˆ°å…¶ä»– replica çš„å•é¡Œã€‚\n\n## Consistent Prefix Reads\n\næœ‰å› æœé—œä¿‚çš„å…©å€‹æ›´æ–°ï¼Œè®€å–æ™‚è¦ä¿ç•™ç›¸åŒçš„é †åºã€‚\n\né€™å€‹æƒ…æ³åœ¨ single-leader replication ä¸¦ä¸æœƒç™¼ç”Ÿï¼Œåªæœ‰åœ¨è³‡æ–™åº«æœ‰ partitioned ä¸¦ä¸”å…©å€‹æ›´æ–°è¢«å¯«å…¥åˆ°ä¸åŒè³‡æ–™åº«æ™‚æ‰æœƒç™¼ç”Ÿã€‚å› æ­¤æˆ‘å€‘éœ€è¦ä¸€äº›æ–¹å¼ä¾†è¿½è¹¤æœ‰å› æœé—œä¿‚çš„å¯«å…¥ï¼Œæ–¹æ³•æœƒåœ¨æœ¬ç« ç¯€çš„å¾Œé¢æåˆ°ã€‚\n\n## Solutions for Replication Lag\n\nå› æ­¤åœ¨ä½¿ç”¨ *eventual consistency* çš„è³‡æ–™åº«æ™‚ï¼Œé–‹ç™¼è€…å¿…é ˆæ€è€ƒé€™äº› replication lag æœƒä¸æœƒå¸¶ä¾†å•é¡Œã€‚è‹¥æœ‰å•é¡Œçš„è©±ï¼Œå‰‡æ‡‰è©²è¦è€ƒæ…®æä¾›æ›´å¼·çš„ consistencyã€‚\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n\n# Multi-Leader Replication\n\nSingle-leader replication çš„ä¸»è¦ç¼ºé»æ˜¯æ‰€æœ‰çš„ write operations éƒ½è¦é€é leaderã€‚\n\nä¸€å€‹ç°¡å–®çš„æƒ³æ³•å°±æ˜¯ä½¿ç”¨å¤šå€‹ leadersï¼Œæ¯å€‹ leader ä¸¦ä¸”æ¯å€‹ leaders éƒ½è¦æŠŠæ”¶åˆ°çš„ writes forward çµ¦å…¶ä»–ç¯€é»ã€‚\n\n## Use Cases for Multi-Leader \n\nå¤šå€‹ datacenter çš„æ“ä½œå³æ˜¯ä¸€å€‹å¾ˆé©åˆ multi-leader replication çš„æ‡‰ç”¨å ´æ™¯ã€‚\n\n![Multi-leader replication.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/multi_leader.png)\n\nå¯ä»¥è€ƒæ…®æ¯å€‹ datacenter ä¸­åªæœ‰ä¸€å€‹ leaderï¼Œåœ¨ä¸€å€‹ data center å…§ä½¿ç”¨ single-leader replicationã€‚è€Œ datacenters ä¹‹é–“ç”± leader è¤‡è£½ writes çµ¦å…¶ä»–çš„ leadersã€‚\n\nMulti-leader replication æ¯” single-leader replication å¥½çš„åœ°æ–¹åœ¨æ–¼ï¼š\n\n- Performanceï¼šè‹¥ datacenters æ˜¯è·¨åœ‹çš„ï¼Œå‰‡å¯ä»¥é¸æ“‡æœ€è¿‘çš„ datacenter é€²è¡Œè®€å¯«å¤§å¹…é™ä½ network latencyã€‚\n- Tolerance of datacenter outagesï¼šå¯ä»¥å®¹å¿æ•´å€‹ datacenter çš„ failoverã€‚\n- Tolerance of network problemsï¼šç•¶ server èˆ‡ leader ä¹‹é–“æœ‰ network problems æ™‚å¯ä»¥ç›´æ¥å¯«å…¥åˆ°å…¶ä»– leadersã€‚\n\nä½¿ç”¨ Multi-leader replication æœ€å¤§çš„ç¼ºé»åœ¨å¿…é ˆè™•ç† concurrent writesï¼ŒåŒ…å« conflict detectionã€conflict avoidance ä»¥åŠ conflict resolutionã€‚é€™éƒ¨åˆ†æœƒåœ¨[æ¥ä¸‹ä¾†çš„ç¯‡å¹…ä¸­](#handling-write-conflicts)æåˆ°ã€‚\n\nä¸€äº› database æ˜¯å¯ä»¥é€éå¤–éƒ¨å·¥å…·æ”¯æ´ multi-leader replicationï¼Œä¾‹å¦‚ BDR for PostgreSQLã€‚\n\n## Handling Write Conflicts\n\nå‡è¨­å…©å€‹ä½¿ç”¨è€…åŒæ™‚å°ä¸€å€‹å€¼åšä¿®æ”¹ï¼Œè€Œä¸€å€‹ä¿®æ”¹è¢«æˆåŠŸå¯«åˆ° leader 1ï¼Œå¦ä¸€å€‹ä¿®æ”¹è¢«æˆåŠŸå¯«é“ leader 2ï¼Œé€™æ™‚å°±æœƒç”¢ç”Ÿè¡çªã€‚è¦è™•ç† write conflicts æœ‰ä»¥ä¸‹å¹¾ç¨®æ–¹å¼ï¼š\n\n1. Detect conflictsï¼šå¯ä»¥é€é lock write operations ä¾†åµæ¸¬ conflictsï¼Œä½†æ˜¯åœ¨ multi-leader replication ä¸‹ä½¿ç”¨ global lock æœƒå–ªå¤± multi-leader replication çš„ä¸»è¦å„ªé»ã€‚\n\n2. Avoid conflictsï¼š\n\t1. ç¢ºä¿è³‡æ–™ä¸æœƒåœ¨å…©å€‹ datacenter åŒæ™‚å¯«å…¥ï¼ˆè¦è€ƒæ…®åœ¨å…©åœ°çš„ user æœ‰å¤šå¤§æ©Ÿç‡å¯«å…¥åŒä¸€ç­†è³‡æ–™ï¼Œè‹¥æ©Ÿç‡å¾ˆå°å‰‡é©åˆï¼‰ã€‚\n\t2. åˆ©ç”¨ routing ä½¿å¾—åŒæ¨£çš„è³‡æ–™è¢«å¯«å…¥åˆ°åŒä¸€å€‹ leaderã€‚å£è™•æ˜¯å°æ–¼åŒä¸€ç­†è³‡æ–™ä¾†èªªå…¶å¯¦å°±æ˜¯ single-leader replicationã€‚\n\n3. Resolve conflictsï¼š\n\tä»¥ä¸‹æ˜¯å¹¾ç¨®å¯èƒ½ç™¼ç”Ÿçš„ conflicts èˆ‡å¸¸ç”¨çš„è§£æ±ºæ–¹æ¡ˆï¼š\n\n\t1. å¯«å…¥åŒä¸€ç­†è³‡æ–™ï¼š\n\t\t1. *Last write wins (LWW)*ï¼šæ³¨æ„åˆ†æ•£å¼ç³»çµ±ä¸‹æ™‚é–“æ˜¯ä¸å¯é çš„ï¼Œå¯èƒ½æœƒéœ€è¦ä½¿ç”¨ logical clockã€‚ä¸¦ä¸” *last write wins* ä»£è¡¨æœ‰ data loss çš„å¯èƒ½æ€§ã€‚\n\t\t2. Perserve all (*MVCC*)ï¼šä¿ç•™å…¨éƒ¨çš„è³‡è¨Šä¸¦ä¸”äº¤ç”± application layer ä¾†è§£æ±ºè¡çªã€‚\n\n\t\t*LWW* èˆ‡ *MVCC* æœƒåœ¨ [Leaderless Replication](#leaderless-replication) ä¸­å¤§é‡è¢«ä½¿ç”¨ä¸¦ä»‹ç´¹ã€‚\n\t\n\t2. Autoincrementing IDï¼šæ”¹ä½¿ç”¨ distributed sequence IDï¼Œä¾‹å¦‚ UUIDV1ï¼ŒTwitter's Snowflake ID ç­‰ç­‰ã€‚\n\n\t3. DDL Changeï¼šåœ¨æŸä¸€ leader ä¿®æ”¹ schemaï¼Œä¾‹å¦‚ `ALTER TABLE ADD COLUMN` æˆ–æ˜¯ `ALTER TABLE ALTER COLUMN`ã€‚è‹¥æŒ‡ä»¤æœ¬èº«éœ€è¦ lock whole table æ‰èƒ½é‹ä½œï¼Œé‚£å°±æœƒéœ€è¦ global leaders lockã€‚å¦å‰‡åªå°‡ DDL Change è¤‡è£½åˆ°å…¶ä»– leaders å°±å¥½ã€‚\n\n\t4. Trigger on slaveï¼šåœ¨ multi-leader replication ä¸‹ä½¿ç”¨ triggerï¼Œå¯èƒ½æœƒé€ æˆé‡è¤‡çš„å•é¡Œã€‚ä¾‹å¦‚ database ä¸­æœ‰ä¸€ trigger æœƒåœ¨è¡¨ A ä¿®æ”¹æ¬„ä½å¾Œå¯«å…¥ä¸€ç­†ç´€éŒ„åˆ°è¡¨ Bã€‚å‡è¨­ leader 1 ä¿®æ”¹è¡¨ A å¾Œ trigger è€Œæ–°å¢ä¸€ç­†ç´€éŒ„åˆ°è¡¨ Bï¼Œè¡¨ A çš„ä¿®æ”¹èˆ‡è¡¨ B çš„ä¿®æ”¹éƒ½æœƒè¢« replica åˆ° leader 2ï¼Œè€Œ leader 2 çš„ trigger åˆæœƒå› ç‚ºè¡¨ A çš„ä¿®æ”¹è€Œæ–°å¢ä¸€ç­†ç´€éŒ„åˆ°è¡¨ Bï¼Œé€ æˆé‡è¤‡ã€‚å› æ­¤åœ¨ multi-leader replication ä¸­ä¸èƒ½ä½¿ç”¨ triggerã€‚\n\n### Automatic Conflict Resolution\n\nå› ç‚º resolve conflicts çš„æ–¹å¼å¾ˆå¤šï¼Œè€Œè‡ªå·±å¯¦ä½œæœ‰æ™‚å®¹æ˜“æœ‰ error ç™¼ç”Ÿï¼Œè€Œåœ¨æŸäº›æƒ…æ³ä¸‹è¡çªæ˜¯å¯ä»¥è‡ªå‹•è¢«è§£æ±ºçš„ï¼Œä»¥ä¸‹æœ‰å¹¾ç¨®æ–¹æ¡ˆï¼š\n\n1. Conflict-free replicatec datatypes (CRDTs)ï¼šå¯ä»¥è‡ªå‹• resolve conflicts çš„ data structureã€‚Riakã€Redis ä¸­éƒ½æœ‰å¯¦ä½œ CRDTs ä¾†è‡ªå‹• resolve conflictsã€‚\n2. Mergable persistent data structuresï¼šé€éç´€éŒ„ version historyï¼Œæä¾› three-way merge çš„èƒ½åŠ›ã€‚\n\tThree-way merge æ˜¯æŒ‡é™¤äº†å…©å€‹ç‰ˆæœ¬ä¹‹å¤–ï¼Œå†å¤šåŠ ä¸Šä¸€å€‹ LSAï¼ˆBaseï¼‰çš„ç‰ˆæœ¬ä¸€èµ·åšæ¯”è¼ƒï¼ˆå› æ­¤ CRDTs æ˜¯ two-way mergeï¼‰ã€‚ä¾‹å¦‚ Git å°±æ˜¯ä½¿ç”¨ three-way mergeã€‚\n3. Operational transformationï¼šå¸¸è¢«ç”¨æ–¼å…±åŒç·¨è¼¯çš„ç®—æ³•ã€‚\n\n## Multi-Leader Replication Topologies\n\n![Multi-leader replication topologies.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/multi_leader_topologies.png)\n\nä½¿ç”¨ç’°ç‹€ã€æ˜Ÿç‹€æ‹“æ¨¸ï¼Œå¯«å…¥å¯èƒ½æœƒç¶“éåŒä¸€å€‹ node å¤šæ¬¡ï¼Œå› æ­¤æ¯å€‹ç¯€é»éœ€è¦åœ¨è‡ªå·±è™•ç†éçš„è³‡æ–™ä¸Šé¢åŠ ä¸Šè‡ªå·±çš„ node ID çš„ tagã€‚ä¸¦ä¸”è‹¥ä¸€å€‹ç¯€é» fail å¯èƒ½æœƒå°è‡´æ•´å€‹ cluster ç„¡æ³•é‹ä½œã€‚\n\næ‰€ä»¥ multi-leader replication æ¯”è¼ƒå–œæ­¡æ¡ç”¨ all-to-all çš„æ‹“æ¨¸å½¢å¼ï¼Œä½†æ˜¯é€™ç¨®æ¨¡å¼å¯èƒ½å°è‡´å› æœé—œä¿‚çš„é †åºæœ‰èª¤ï¼ˆç’°ç‹€ã€æ˜Ÿç‹€éƒ½ä¸€å®šä¸æœƒæœ‰ï¼‰ã€‚å¦‚ä¸‹åœ–ï¼š\n\n![All-to-all topology cause consistent prefix reads problem.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/multi_leader_all_to_all_topology_wrong_order.png)\n\nå¯ä»¥é€é version clock ä¾†è§£æ±º [consistent prefix reads](#consistent-prefix-reads) çš„å•é¡Œã€‚\n\n# Leaderless Replication\n\næ¯å€‹ replication éƒ½å…è¨±è®€å¯«ã€‚æœ€è‘—åçš„ leaderless replication æ‡‰ç”¨æ˜¯ [Dynamo](https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf)ã€‚æ ¹æ“šé€™ç¯‡ paper çš„æƒ³æ³•ï¼Œæœ‰äº† Riakã€Cassandraã€Voldermort ç­‰ opensource çš„ leaderless replication databaseã€‚\n\n## Writing to the Database When a Node Is Down\n\n### Read repair and anti-entropy\n\nåœ¨ leaderless replication ä¸­ï¼Œå¯«å…¥æ“ä½œæœƒä¸€æ¬¡å¯«åˆ° N å€‹ç¯€é»ï¼ˆN ä¸éœ€è¦ç­‰æ–¼ç¯€é»æ•¸é‡ï¼‰ã€‚å…ˆä¸è€ƒæ…® concurrent writes çš„å•é¡Œï¼Œå‡è¨­æœ‰ä¸€ç¯€é»æ­£åœ¨é‡å•Ÿï¼Œé‚£éº¼å¯«å…¥æ“ä½œæœƒç•¥éæ­¤ç¯€é»çš„å¯«å…¥ã€‚ç•¶æ­¤ç¯€é»é‡å•Ÿå®Œç•¢å¾Œï¼Œæœ‰ä»¥ä¸‹å…©å€‹å•é¡Œï¼š\n\n1. è‹¥ client å¾æ­¤ç¯€é»è®€è³‡æ–™ï¼Œå¯èƒ½æœƒè®€åˆ°èˆŠçš„è³‡æ–™ã€‚\n\tè§£æ±ºè¾¦æ³•ï¼šä¸€æ¬¡å¾å¤šå€‹ç¯€é»è®€å–ï¼Œé€é version å°±å¯ä»¥çŸ¥é“å“ªå€‹æ˜¯æœ€æ–°çš„è³‡æ–™ã€‚\n\n2. æ­¤ç¯€é»è¦å¦‚ä½•åŒæ­¥æ²’æ›´æ–°åˆ°çš„è³‡æ–™ï¼Ÿ\n\n\t1. Read repairï¼šç•¶ client è®€åˆ°èˆŠçš„è³‡æ–™æ™‚ï¼Œåšä¸€å€‹å¯«å…¥åˆ° replicaã€‚é©åˆå¤§é‡ read çš„æƒ…å¢ƒã€‚\n\t2. Anti-Entropyï¼šç”¨ä¸€å€‹èƒŒæ™¯ç¨‹åºä¸æ–·æª¢æŸ¥å…©å€‹ç¯€é»ä¹‹é–“çš„è³‡æ–™ã€‚æœƒæœ‰ delayï¼Œä½†æ˜¯å¾ˆå°‘è¢«è®€åˆ°çš„è³‡æ–™ä¹Ÿèƒ½è¢«åŒæ­¥ã€‚\n\n\t\t{% note info %}\n\t\t#### Merkle Tree\n\n\t\tå¦‚ä½•å¿«é€Ÿçš„æ¯”å°å…©å€‹ç¯€é»ä¹‹é–“çš„è³‡æ–™å‘¢ï¼Ÿå¯ä»¥é€é merkle treeï¼ˆé›œæ¹Šæ¨¹ï¼‰é€™å€‹è³‡æ–™çµæ§‹ã€‚\n\t\t- `IH: internal hash function`\n\t\t- `LH: leaf hash function`\n\t\t- `S1, S2, S3, S4, S5: data`\n\n\t\tæ¯å€‹ç¯€é»éƒ½å°è³‡æ–™å‰µå»ºä¸€å€‹ merkle treeï¼Œå› æ­¤è‹¥å…©ç¯€é»è³‡æ–™ç›¸åŒï¼Œåªéœ€è¦ `O(1)` çš„æ™‚é–“å°±å¯ä»¥ç¢ºèªã€‚è‹¥å…©ç¯€é»æœ‰ä¸€ç­†è³‡æ–™ä¸åŒï¼Œä¹Ÿåªéœ€è¦ `O(logN)` çš„æ™‚é–“å°±å¯ä»¥æ‰¾åˆ°ä¸åŒçš„è³‡æ–™ã€‚\n\n\t\t```plaintext\n                          ROOT=IH(H+E)\n                           /        \\\n                          /          \\\n                    H=IH(F+G)         E\n                   /       \\           \\\n                  /         \\           \\\n            F=IH(A+B)       G=IH(C+D)    E\n           /     \\           /     \\      \\\n          /       \\         /       \\      \\\n      A=LH(S1)  B=LH(S2) C=LH(S3)  D=LH(S4) E=LH(S5)\n\t\t```\n\n\t\t{% endnote %}\n\n### Quorums for reading and writing\n\nè‹¥æ¯ä¸€ç­†è³‡æ–™æœ‰ N å€‹å‰¯æœ¬ï¼Œåªè¦ä¿è­‰æ¯æ¬¡å¯«å…¥ $w$ å€‹å‰¯æœ¬ä¸¦ä¸”æ¯æ¬¡è®€å…¥ $r$ å€‹å‰¯æœ¬ä¸” $w+r \\gt n$ï¼Œå‰‡æ ¹æ“šé´¿ç± åŸç†è‡³å°‘æœ‰ä¸€å€‹ read å¯ä»¥è®€åˆ°æœ€æ–°çš„è³‡æ–™ã€‚\n\nåœ¨ dynamo-style è³‡æ–™åº«ä¸­ï¼Œ$w,\\ r,\\ n$ é€šå¸¸éƒ½æ˜¯å¯ä»¥èª¿æ•´çš„ï¼Œå¸¸è¦‹çš„é…ç½®æ˜¯ $w=r=\\lceil (n+1)/2 \\rceil$ã€‚åªè¦ç¯€é»æ•¸é‡ $n \\ge w\\And n \\ge r$ï¼Œç³»çµ±å°±å¯ä»¥ç¹¼çºŒé‹è¡Œã€‚ä¾‹å¦‚ $n=5,\\ w=3,\\ r=3$ å‰‡å¯ä»¥å®¹å¿ 2 å€‹ç¯€é»çš„ failureã€‚\n\n{% note warning %}\n\n#### Quorum\n\næ³¨æ„ï¼Œåœ¨ Dynamo çš„ paper ä¸­æåˆ°çš„ quorum èˆ‡ [wiki ä¸Šçš„ quorum](https://en.wikipedia.org/wiki/Quorum_(distributed_computing)) è§£é‡‹ä¸Šé¢æœ‰äº›ä¸åŒã€‚\n\nWiki ä¸Šé¢çš„ quorum åˆ©ç”¨ lock æœƒåœ¨ read/write æ“ä½œå‰é€²è¡Œ lock çš„å‹•ä½œï¼Œå› æ­¤è‹¥è¨­ç½® $w+r \\gt n$ï¼Œå‰‡è®€èˆ‡å¯«ä¸å¯èƒ½ä¸¦è¡Œã€‚è‹¥å†åŠ ä¸Š $w+w \\gt n$ çš„æ¢ä»¶ï¼Œå‰‡å¯«èˆ‡å¯«ä¹Ÿä¸å¯èƒ½ä¸¦è¡Œã€‚å¦‚æ­¤ä¸€ä¾†å³å¯ä¿è­‰ [**serializability**](https://en.wikipedia.org/wiki/Serializability)ã€‚\n\nä½†æ˜¯åœ¨ Dynamo çš„ paper ä¸­ä¸¦æ²’æœ‰æåˆ°è¦åšè®€å¯«ä¹‹å‰éœ€è¦ lockï¼Œ$w,\\ r$ åªæ˜¯ç”¨ä¾†ç¢ºèªå¯«å…¥èˆ‡è®€å–çš„ç¯€é»æ•¸é‡è€Œå·²ï¼Œå› æ­¤åœ¨ paper ä¸­ä¹Ÿæœ‰æåŠæ˜¯ä½¿ç”¨ quorum-like technique è€Œå·²ã€‚**å› æ­¤ dynamo-style çš„è³‡æ–™åº«å°±ç®—è¨­ç½® $w+r \\gt n \\And w+w \\gt n$ ä¹Ÿé€šå¸¸ä¸ä¿è­‰ linearizabilityã€‚**\n\n{% endnote %}\n\n## Limitations of Quorum Consistency\n\næ¡ç”¨ quorum å¯èƒ½æœƒæœ‰ä»¥ä¸‹çš„å•é¡Œï¼š\n\n- é€éè¨­ç½®æ›´å°çš„ $w,\\ r$ï¼Œå¯ä»¥æé«˜ç³»çµ±çš„å¯ç”¨æ€§ä»¥åŠé™ä½å»¶é²ï¼Œä½†å°±æœ‰å¯èƒ½æœƒè®€åˆ°èˆŠçš„è³‡æ–™ã€‚\n- å…©å€‹å¯«å…¥æ“ä½œå¯èƒ½æœƒé€ æˆè¡çªã€‚åœ¨ [æ–‡ç« å¾Œæ®µ](#detecting-concurrent-writes) æœƒä»‹ç´¹ LWW èˆ‡ MVCC çš„åšæ³•ä¾†è§£æ±ºè¡çªã€‚\n- å¦‚æœå¯«å…¥æ“ä½œåœ¨ä¸€äº›ç¯€é»æˆåŠŸä¸€äº›å¤±æ•—ï¼Œä¸¦ä¸”æœ€å¾Œåªå¯«å…¥å°‘æ–¼ $w$ å€‹ç¯€é»ä¸¦å›å‚³å¤±æ•—ã€‚é€™äº›æˆåŠŸçš„å¯«å…¥ä¸¦ç„¡æ³•è¢« rollback é€ æˆè³‡æ–™ä¸ä¸€è‡´ã€‚\n- å°±ç®—æ¡ç”¨ $w+r \\gt n$ï¼Œdynamo-style çš„è³‡æ–™åº«ä¸¦ä¸ä¿è­‰ linearizabilityã€‚\n\t![Reader B read stale value although strict quorum is applied.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/strict_quorum_not_linearizable.png)\n\nå› æ­¤é›–ç„¶æ­£å¸¸æƒ…æ³ä¸‹ä½¿ç”¨ $w+r \\gt n$ çš„ quorum é…ç½®å¯ä»¥ç¢ºä¿è®€åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯å¯¦éš›ä¸Šä¸¦æ²’æœ‰é‚£éº¼ç°¡å–®ã€‚Dynamo-style è³‡æ–™åº«é€šå¸¸éœ€è¦æ‡‰ç”¨èƒ½å¤ å®¹å¿æœ€çµ‚ä¸€è‡´æ€§ï¼Œè€Œ $w,\\ r$ çš„é…ç½®å¯ä»¥ç”¨ä¾†èª¿æ•´è®€åˆ°èˆŠè³‡æ–™çš„æ©Ÿç‡ã€‚\n\n## Sloppy Quorums and Hinted Handoff\n\nä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œdatabase cluster æœƒæœ‰å¾ˆå¤šç¯€é»ï¼Œè€Œæ¯å€‹å¯«å…¥æ“ä½œåªéœ€è¦ $n$ å€‹å‰¯æœ¬ï¼Œé€é [consistent hashing](https://justin0u0.notion.site/Consistent-Hashing-a9969a175f464d008d1c18e347b210db) å¯ä»¥æ±ºå®šè³‡æ–™è¦è¢«å¯«åˆ°å“ª $n$ å€‹ç¯€é»ã€‚\n\n![Consistent hashing shows that data with key K must write to node A, B and C.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/consistent_hashing.png)\n\nè‹¥ client å› ç‚ºç¶²è·¯å•é¡Œç„¡æ³•é€£æ¥åˆ°é€™ $n$ å€‹ç¯€é»ï¼Œæˆ‘å€‘å¯ä»¥å›å‚³ error å‘ŠçŸ¥å¤±æ•—ã€‚æˆ–æ˜¯å…è¨±å¯«å…¥åˆ°é€™ $n$ å€‹ç¯€é»ä»¥å¤–çš„ç¯€é»ï¼Œç¨±ä½œ *sloppy quorum*ã€‚\n\nä¾‹å¦‚ä¸Šåœ–ï¼Œè³‡æ–™è¦è¢«å¯«åˆ° Aã€Bã€C ç¯€é»ã€‚ç•¶ A ç¯€é»ä¸å¯ç”¨æ™‚ï¼Œå¯ä»¥å…ˆæš«æ™‚å¯«å…¥åˆ°ç¯€é» D çš„ç¨ç«‹å„²å­˜ç©ºé–“ï¼Œä¸¦ä¸”ç´€éŒ„åŸç¯€é»æ˜¯ A ç¯€é»ã€‚å¦‚æ­¤ä¸€ä¾†ç•¶ D ç¯€é»ç™¼ç¾ A ç¯€é»æ¢å¾©æ™‚ï¼Œå°±æœƒå°‡è³‡æ–™é‡æ–°å¯«å› A ç¯€é»ä¸¦å°‡ D ç¯€é»å…§çš„è³‡æ–™åˆªé™¤ã€‚é€™ç¨®æ–¹å¼å°±ç¨±ä½œ *hinted handoff*ã€‚\n\n## Detecting Concurrent Writes\n\nè€ƒæ…®å…©å€‹ clients æƒ³å¯«å…¥ `set(x, 1)` èˆ‡ `set(x, 2)`ï¼Œå› ç‚ºç¶²è·¯é€Ÿåº¦çš„ä¸åŒï¼Œä¸åŒç¯€é»å¯èƒ½æ”¶åˆ°ä¸ä¸€æ¨£çš„é †åºï¼Œå°è‡´æœ€å¾Œå…©å€‹ç¯€é»çš„è³‡æ–™æ˜¯ä¸ä¸€è‡´çš„ã€‚\n\nå› æ­¤é€™è£¡ä»‹ç´¹ LWW èˆ‡ MVCC å…©ç¨®æ–¹å¼ï¼š\n\n### Last write wins\n\nåœ¨æ¯å€‹ writes ä¸Šé¢éƒ½é™„åŠ ä¸€å€‹ timestampï¼Œç•¶ conflict ç™¼ç”Ÿæ™‚ï¼Œé¸æ“‡è¼ƒæ–°çš„ writeã€‚LWW å¯ä»¥é”æˆæœ€çµ‚ä¸€è‡´æ€§ï¼Œä½†å£è™•æ˜¯æœƒé€ æˆè³‡æ–™çš„éºå¤±ã€‚\n\nç”±æ–¼åœ¨åˆ†æ•£å¼ç³»çµ±ä¸‹æ¯å€‹ç¯€é»çš„æ™‚é–“éƒ½æ˜¯ä¸ä¸€æ¨£çš„ï¼Œå› æ­¤ç”šè‡³å¯èƒ½é€ æˆæœ‰å› æœé—œä¿‚çš„ writes çš„æ™‚é–“æ˜¯å°èª¿çš„ã€‚\n\n![A cause B but timestamp of A is after B.](/assets/Designing-Data-Intensive-Application-ç¬¬äº”ç« ç­†è¨˜/lww_time_skew.png)\n\nCassandra å³é¸æ“‡ LWW ä¾†è§£æ±ºè¡çªï¼Œè‡³æ–¼ç‚ºä»€éº¼ cassandra ä¸é¸æ“‡æ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„ *vector clock*ï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ [Why Cassandra Doesn't Need Vector Clocks](https://www.datastax.com/blog/why-cassandra-doesnt-need-vector-clocks)ã€‚\n\n### MVCC\n\nMVCC çš„æƒ³æ³•ç‚ºå¦‚æœæœ‰è¡çªç™¼ç”Ÿï¼Œé‚£éº¼å°±åµæ¸¬è¡çªä¸¦ä¸”ä¿ç•™å…¨éƒ¨çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸‹ä¸€æ¬¡ client è®€å–é€™ç­†è³‡æ–™æ™‚å°±å°‡å…¨éƒ¨ç‰ˆæœ¬è¿”å›äº¤ç”± client ä¾†è§£æ±ºè¡çªã€‚\n\næ‰€ä»¥é¦–å…ˆè¦å®šç¾©å°æ–¼åŒä¸€ç­†è³‡æ–™ä½•è¬‚è¡çªï¼Ÿ**Concurrent write** é€™å€‹è©å½™çœ‹ä¼¼æŒ‡çš„æ˜¯æ™‚é–“ä¸Šçš„åŒæ™‚ç™¼ç”Ÿï¼Œä½†è‹¥æŠŠæ™‚é–“çš„ç²’åº¦ç¸®å°ä¾†çœ‹å…©å€‹å¯«å…¥ä¸¦ä¸æœƒå®Œå…¨åŒæ™‚ç™¼ç”Ÿã€‚å› æ­¤ concurrent write çš„å®šç¾©æ‡‰è©²æ˜¯å…©å€‹å¯«å…¥æ˜¯æ²’æœ‰å› æœé—œä¿‚çš„ï¼Œå› æ­¤é€™å…©å€‹å¯«å…¥èª°å…ˆèª°å¾Œéƒ½æ²’æœ‰å•é¡Œï¼Œæ‰€ä»¥æ‰æœƒç…§æˆè¡çªã€‚\n\nä½¿ç”¨ **[vector clocks/version vectors](https://justin0u0.notion.site/Vector-Clock-8f7434edf4e34ed5a2649f13c496d31a)** ç‚ºæ¯å€‹ key ç¶­è­·å¤šå€‹ç‰ˆæœ¬è™Ÿç¢¼ï¼Œç•¶ç™¼ç”Ÿè¡çªæ™‚éƒ½ä¿ç•™ã€‚\n\né€™ç¨®åšæ³•å¯ä»¥ä¿è­‰è³‡æ–™ä¸æœƒéºå¤±ï¼Œä½†æ˜¯ client å¿…é ˆè‡ªå·±è§£æ±ºè¡çªã€‚\n\nDynamo çš„ paper ä¸­å³ä½¿ç”¨æ­¤æ–¹æ³•ä¾†åµæ¸¬è¡çªçš„ç™¼ç”Ÿï¼ŒVoldermortã€Riak éƒ½æ˜¯æ¡ç”¨æ­¤åšæ³•ã€‚\n\n# Summary\n\nç¸½çµ replication å¸¶ä¾†çš„å¥½è™•æœ‰ï¼š\n\n- High availabilityï¼šå°±ç®—æœ‰éƒ¨åˆ†ç¯€é»åœæ­¢ä¹Ÿèƒ½æ­£å¸¸é‹ä½œã€‚\n- Latencyï¼šé€éç¸®çŸ­åœ°ç†ä¸Šçš„è·é›¢ä¾†é™ä½å»¶é²ã€‚\n- Scalabilityï¼šå¯ä»¥é€éå¢åŠ æ©Ÿå™¨çš„æ•¸é‡ä¾†æå‡è®€å¯«èƒ½åŠ›ã€‚\n\nè€Œå¸¸è¦‹çš„ä¸‰ç¨® replication æ¨¡å¼åŒ…å«ï¼š\n\n- Single-leader replicationï¼šåªæœ‰ä¸€å€‹ leader ç¯€é»ä¸¦ä¸”æ‰€æœ‰çš„å¯«å…¥æ“ä½œåªèƒ½é€é leaderï¼Œç”± leader å°‡è³‡æ–™è¤‡è£½åˆ°å…¶ä»–çš„ follower ç¯€é»ã€‚é…ç½®ç°¡å–®ä¸”ä¸éœ€è¦è€ƒæ…® concurrent writes çš„å•é¡Œï¼›ä½†åªèƒ½æå‡ read scalabilityï¼Œä¸¦ä¸”è¦è€ƒæ…® leader failure çš„å•é¡Œ\n- Multi-leader replicationï¼šæœ‰å¤šå€‹ leader ç¯€é»ï¼Œé©åˆåœ¨ datacenter ä½¿ç”¨ä»¥é™ä½å¯«å…¥çš„ latencyï¼Œæœ‰æ›´é«˜çš„å¯ç”¨æ€§ã€‚ä½†æ˜¯å¿…é ˆè™•ç† concurrent writes çš„å•é¡Œã€‚\n- Leaderless replicationï¼šå¯ä»¥åœ¨ä»»ä½• nodes é€²è¡Œè®€å¯«ï¼Œæœ‰æ›´é«˜çš„ availability ä»¥åŠæ›´ä½çš„ consistencyï¼Œé©åˆèƒ½å®¹å¿ eventual consistency çš„æ‡‰ç”¨ä½¿ç”¨ã€‚\n\nå°æ–¼ replication lagï¼Œä½¿ç”¨æ™‚è¦è€ƒæ…®æ˜¯å¦èƒ½æ¥å— eventual consistencyï¼Œå¦å‰‡éœ€è¦è€ƒæ…®æé«˜ consistency levelï¼š\n\n- Read-after-write consistencyï¼šä½¿ç”¨è€…å¿…é ˆè®€åˆ°è‡ªå·±å¯«å…¥çš„è³‡æ–™ã€‚\n- Monotonic reads consistencyï¼šè®€åˆ°çš„è³‡æ–™ä¸èƒ½å›æœ”ã€‚\n- Consistency prefix reads consistencyï¼šæœ‰å› æœé—œä¿‚çš„è³‡æ–™è¦æ­£ç¢ºã€‚\n\næœ¬æ–‡çš„åœ–ç‰‡ä¾†æºï¼ˆImage creditsï¼‰ï¼š\n- https://dataintensive.net/\n- https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Notes","DDIA"],"categories":["Notes"]},{"title":"Dcard Backend å¯¦ç¿’å¿ƒå¾—","url":"/Dcard-Backend-å¯¦ç¿’å¿ƒå¾—/","content":"\nå—¨å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Justinï¼Œç›®å‰å°±è®€æ¸…è¯å¤§å­¸è³‡è¨Šå·¥ç¨‹å­¸ç³»å››å¹´ç´šï¼Œåœ¨ Dcard åš backend intern ä¹ŸåŠå¹´äº†ï¼Œæƒ³è·Ÿå¤§å®¶åˆ†äº«åœ¨ Dcard å¯¦ç¿’é€™åŠå¹´ä¾†çš„å¿ƒå¾—ï½\n\n![Dcard çœŸçš„æ˜¯ä¸€é–“å¾ˆæœ‰æ´»åŠ›çš„å…¬å¸ï¼ŒSlack ç¾¤çµ„å¸¸å¸¸æœ‰å„ç¨®æ¢—åœ–xD](/assets/Dcard-Backend-å¯¦ç¿’å¿ƒå¾—/slack.png)\n\nåœ¨é€²å…¥ Dcard ä¹‹å‰ï¼Œå› ç‚ºå·²ç¶“æœ‰äº›å¾Œç«¯é–‹ç™¼ç¶“é©—ï¼Œä½†æ˜¯ä¸¦æ²’æœ‰æ©Ÿæœƒæ¥è§¸åˆ°**é«˜æµé‡**çš„ç³»çµ±æ˜¯å¦‚ä½•è¨­è¨ˆèˆ‡é–‹ç™¼çš„ã€‚å› æ­¤æ‰¾å¯¦ç¿’æ™‚ï¼Œä¸»è¦å°±æ˜¯å¸Œæœ›èƒ½æ¥è§¸åˆ°å¤§å‹ç³»çµ±é–‹ç™¼ä»¥åŠèƒ½ä½¿ç”¨åˆ°æœ€æ–°æŠ€è¡“ã€‚Dcard åœ¨é€™æ–¹é¢ç®—æ˜¯éå¸¸ç¬¦åˆï¼Œæµé‡çš„éƒ¨åˆ†ç›¸ä¿¡ä¸ç”¨å¤šåšèªªæ˜ï¼Œä½¿ç”¨çš„æŠ€è¡“éƒ¨åˆ†ä¹Ÿæ˜¯ç›¸ç•¶çš„æ–°ï¼ŒåŒ…å« Golangã€Kubernetesã€Microservicesã€gRPC ä»¥åŠ OpenTelemetry é€™äº›é›²åŸç”Ÿç”Ÿæ…‹ç³»æœ€ç†±é–€æŠ€è¡“ Dcard éƒ½æœ‰åœ¨ä½¿ç”¨ï¼\n\n<!-- More -->\n\n# Dcard Backend Team æ—¥å¸¸\n\né–‹ç™¼æ–¹é¢ï¼ŒDcard Backend ç›®å‰ä¸»è¦ä½¿ç”¨ Golang ä½œç‚ºé–‹ç™¼èªè¨€ï¼Œä½†é‚„æ˜¯æœ‰å°‘éƒ¨åˆ†æ¯”è¼ƒæ—©æœŸçš„ repo ä½¿ç”¨ NodeJSã€‚ç›®å‰éƒ½æ¡ç”¨ Microservices æ¶æ§‹ï¼Œå°å…§æœå‹™ä½¿ç”¨ gRPCï¼Œå°å¤–å‰‡æ˜¯ä¸€èˆ¬çš„ RESTful APIã€‚è€Œ Backend å…§éƒ¨æœ‰ä¸€å¥— code generating toolï¼Œå¯ä»¥å¹«åŠ©é¿å… boilerplate code çš„æ’°å¯«ï¼Œè®“å·¥ç¨‹å¸«å€‘åªéœ€è¦å°ˆæ³¨æ–¼ business logic èˆ‡ architecture design ä¸Šã€‚è³‡æ–™åº«ä¸»è¦ä½¿ç”¨ PostgreSQL ä»¥åŠ Redisã€‚Infra çš„éƒ¨åˆ†å‰‡æ˜¯ Kubernetesã€‚\n\nåœ¨ Dcard Backend æœƒç”¨åˆ°å¾ˆå¤šæ–°çš„æŠ€è¡“ï¼Œä¾‹å¦‚ Capture Data Changeï¼ˆCDCï¼‰å°±æ˜¯æˆ‘åœ¨ Dcard æ‰ç¬¬ä¸€æ¬¡è½åˆ°ä¸¦ä¸”ä½¿ç”¨åˆ°çš„æŠ€è¡“ã€‚åœ¨ Microservices ä¸­ï¼Œæœ€é›£è™•ç†çš„å°±æ˜¯è·¨ services çš„è³‡æ–™åŒæ­¥å•é¡Œã€‚æ—©æœŸ Dcard å…§éƒ¨æ˜¯ä½¿ç”¨ event-driven çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é€é application layer ç™¼é€è¨Šæ¯åˆ° message queue ä¸­ï¼Œå†ç”±å¦ä¸€ç«¯çš„ service subscribe ä¸¦æ¶ˆè²»é€™äº› eventsã€‚ä½¿ç”¨ event-driven çš„éº»ç…©ä¹‹è™•åœ¨æ–¼å·¥ç¨‹å¸«é‚„è¦è‡ªå·±å®šç¾© event çš„å½¢å¼ä¸¦ä¸”æ’°å¯«ç™¼é€èˆ‡æ¥æ”¶çš„é‚è¼¯ï¼Œå¦å¤–è¦ç¢ºä¿è³‡æ–™çš„å¯«å…¥èˆ‡ event æ˜¯å¦æœ‰åŒæ™‚å¯«åˆ° message queue ä¸­ä¹Ÿæ˜¯ä¸€å€‹é›£é»ã€‚ç¾åœ¨ Dcard Backend éƒ½å¤§é‡æ”¹ç”¨ CDC ä¾†è™•ç†é€™äº›è³‡æ–™åŒæ­¥åŒ–çš„å•é¡Œï¼Œåˆ©ç”¨ PostgreSQL çš„ logical replication åŠŸèƒ½ï¼Œå·¥ç¨‹å¸«å°±åªéœ€è¦å°ˆæ³¨åœ¨è¨‚é–±è³‡æ–™çš„è®ŠåŒ–å³å¯ã€‚\n\næˆ‘èªç‚ºåœ¨ Dcard å¯¦ç¿’å¾ˆæ£’çš„ä¸€é»åœ¨æ–¼ï¼Œ**é€™é‚Šçš„å·¥ä½œç’°å¢ƒä¸æœƒè®“ä½ æ„Ÿå—åˆ°å› ç‚ºä½ æ˜¯å¯¦ç¿’ç”Ÿï¼Œè€Œå°±ä¸çœ‹é‡ä½ çš„æ„è¦‹ï¼Œæˆ–æ˜¯æœƒè®“ä½ æ„Ÿåˆ°ä¸æ•¢ç™¼è¨€ï¼Œåœ¨é€™è£¡å„ç¨®æ„è¦‹éƒ½æ˜¯æ­¡è¿çš„**ï¼Œä¸¦ä¸”å¤§å®¶éƒ½æœƒå¾ˆè¸´èºçš„æå‡ºçœ‹æ³•ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå› ç‚º Dcard Backend å¸¸å¸¸æœƒæœ‰ä¸€äº›æ–°æŠ€è¡“çš„ä½¿ç”¨æˆ–æ˜¯æ¶æ§‹ä¸Šçš„æ”¹é€²ï¼Œå› æ­¤ backend åœ¨æ¯é€±äº”éƒ½æœƒæœ‰ä¸€æ¬¡ sync up æœƒè­°é€²è¡Œåˆ†äº«èˆ‡è¨è«–ï¼Œåœ¨é€™äº›æœƒè­°ä¸Šæˆ‘ä¹Ÿå¸¸å¸¸èƒ½æå‡ºå¾ˆå¤šçœ‹æ³•æ„è¦‹ï½\n\nåœ¨ Dcard Backendï¼Œ**ä¸»ç®¡ä¹Ÿä¸æœƒå› ç‚ºä½ æ˜¯å¯¦ç¿’ç”Ÿï¼Œè€Œæ´¾é£ä¸€äº›ä¸é‡è¦çš„å·¥ä½œçµ¦ä½ **ã€‚åƒæˆ‘ç¾åœ¨å°±ç¨ç«‹çš„å¾…åœ¨ä¸€å€‹ delivery team è£¡é¢ï¼Œå­¸ç¿’èˆ‡ PM æºé€šé–‹å‡ºä½ èªç‚ºå¯ä»¥å¯¦ä½œçš„ specï¼Œèˆ‡ Android/iOS/Web å·¥ç¨‹å¸«å€‘æºé€šé©åˆçš„ API ä¸¦ä¸”å¸¸å¸¸æœƒéœ€è¦è¨˜å¾—ç‚ºä»–å€‘è€ƒæ…®å‘ä¸‹ç›¸å®¹çš„å•é¡Œã€‚æˆ‘ç›®å‰åšéæœ€æœ‰è¶£çš„å°ˆæ¡ˆæ˜¯æŠ½å¡åŒ¹é…ç®—æ³•çš„æ”¹å–„ï¼Œå› ç‚ºè‡ªå·±æœ¬èº«æ˜¯å°±æ˜¯æ‰“ç«¶è³½çš„ï¼Œå¾æ²’æƒ³éçœŸçš„æœ‰ä¸€å¤©èƒ½å°‡ç«¶è³½ç”¨åˆ°çš„ Dinic æ¼”ç®—æ³•ç”¨åœ¨å¯¦å‹™çš„ backend é–‹ç™¼ä¸Šï¼ŒçœŸçš„æ˜¯å¾ˆæœ‰æ„æ€ã€‚\n\nä½†å¦‚æœå¹³æ™‚éƒ½è‡ªå·±å¾…åœ¨ delivery teamï¼Œè¦æ€éº¼çŸ¥é“è‡ªå·±çš„æ¶æ§‹è¨­è¨ˆå¥½ä¸å¥½å‘¢ï¼Ÿåœ¨**é–‹ç™¼å¤§å‹å°ˆæ¡ˆä¹‹å‰ï¼Œæœƒé€éèˆ‰è¾¦ Design Review çš„å½¢å¼ï¼Œå¤§å®¶è‡ªç”±çš„åƒåŠ  review ä¾†è¨è«–é€™æ¨£çš„è¨­è¨ˆæ˜¯ä¸æ˜¯æœ‰ä»»ä½•æ”¹é€²çš„åœ°æ–¹**ã€‚è‹¥åœ¨è¨­è¨ˆä¸Šé¢æœ‰ä»»ä½•ç–‘å•ï¼Œå…¬å¸ä¸€äº›æ¯”è¼ƒè³‡æ·±çš„å‰è¼©æˆ–æ˜¯ä¸»ç®¡ä¹Ÿéƒ½éå¸¸å¥½ç›¸è™•ï¼Œæœ‰ä»»ä½•ä¸æ‡‚çš„åœ°æ–¹å°±å»æå•ã€è¨è«–ï¼Œä»–å€‘éƒ½èƒ½æä¾›å¾ˆæ£’çš„å»ºè­°ï¼\n\nåœ¨ Dcard Backend æ¯å…©é€±æœƒèˆ‰è¾¦ä¸€æ¬¡è®€æ›¸æœƒï¼Œåƒæ˜¯æˆ‘å‰›åŠ å…¥æ™‚å‰›å¥½é–‹å§‹è®€ä¸€æœ¬å«åš *Designing Data-Intensive Application* çš„æ›¸ï¼Œæœ€è¿‘ä¹Ÿå‰›è®€å®Œæ•´æœ¬æ›¸äº†ã€‚æ›¸ä¸­è¬›åˆ°çš„å„ç¨®åˆ†æ•£å¼ç³»çµ±æ¶æ§‹ä¸‹é‡è¦çš„ç†è«–ï¼ŒçœŸçš„æ˜¯è®“æˆ‘å—ç›Šè‰¯å¤šã€‚æˆ‘ä¹Ÿåœ¨è®€æ›¸æœƒä¸­è² è²¬åˆ†äº«äº†å…¶ä¸­çš„ä¸€å€‹ç« ç¯€ã€‚å°é€™æœ¬æ›¸æœ‰èˆˆè¶£çš„ä¹Ÿå¯ä»¥å»çœ‹æˆ‘çš„[éƒ¨è½æ ¼æ–‡ç« ](https://blog.justin0u0.com/tags/DDIA/)ï¼Œé›–ç„¶æˆ‘é‚„å‰©ä¸‹å¾ˆå¤šç« ç¯€çš„æ–‡ç« é‚„æ²’è£œå®ŒğŸ˜¢ã€‚\n\nå¦å¤–ï¼Œæ¯é€±äº”ä¸‹åˆæœƒèˆ‰è¾¦ developer's sessionï¼Œä¸åŒ team çš„å·¥ç¨‹å¸«å‡ºä¾†åˆ†äº«ä¸€äº›é–‹ç™¼ä¸Šçš„çŸ¥è­˜ã€‚ä¾‹å¦‚ backend åˆ†äº«é cache-control çš„æ©Ÿåˆ¶è®“å‰ç«¯å·¥ç¨‹å¸«äº†è§£ç‚ºä»€éº¼è³‡æ–™ä¸æœƒç«‹å³æ›´æ–°ï¼›Android ä¹‹å‰åˆ†äº«éå¦‚ä½•è™•ç† emoji å­—æ•¸çµ±è¨ˆçš„å•é¡Œã€‚\n\n# Dcard å…¬å¸ç¦åˆ©\n\nDcard å…¬å¸ç¦åˆ©ä¹Ÿæ˜¯å¾ˆè®šçš„ä¸€éƒ¨åˆ†ï¼Œåƒä¸å®Œçš„é›¶é£Ÿï¼Œå†°ç®±é£²æ–™æœ‰åˆå¾Œæ™‚å…‰ï¼Œæ¯é€±äºŒäº”å…¬å¸è«‹å®¢ä¸€æ¯æ‰‹æ–ï¼Œæ¯é€±äºŒé‚„æœƒæä¾›åˆé¤ï¼Œæ¯é€±äº”æä¾›ä¸‹åˆèŒ¶ï¼Œç‰¹æ®Šç¯€æ—¥ä¹Ÿæœƒé€ä¸€å †ç¦®ç‰©ï½\n\n{% img /assets/Dcard-Backend-å¯¦ç¿’å¿ƒå¾—/food.jpg 600 600 %}\n\nå¦å¤–å…¬å¸çš„ä¸Šç­æ™‚é–“ä¹Ÿå¾ˆå½ˆæ€§ï¼ŒåŸºæœ¬ä¸Šè¡¨å®šæ™‚é–“æ˜¯ä¸Šåˆ 10 é»åˆ°æ™šä¸Š 7 é»ï¼Œä½†æ˜¯æœ‰äº‹çš„è©±éƒ½å¯ä»¥ææ—©é›¢é–‹æ™‚æ•¸è‡ªå·±è£œã€‚é€™æ¨£çš„åˆ¶åº¦å°é‚„åœ¨ä¸Šå­¸çš„æˆ‘çœŸçš„å¾ˆè®šï¼Œä¸ç”¨ç‰¹åœ°ç‚ºäº†è€ƒå…©å°æ™‚çš„æœŸä¸­è€ƒè«‹å‡ï¼Œç›´æ¥ææ—©å…©å°æ™‚å»ä¸Šç­ï¼Œåœ¨å…¬å¸ç›´æ¥è€ƒè©¦å®Œå†ç¹¼çºŒå·¥ä½œXDï¼\n\n# æŠ• Dcard Backend å¯¦ç¿’\n\nå¦‚æœä½ æœ‰èˆˆè¶£æŠ• Dcard Backend å¯¦ç¿’ä½†æ“”å¿ƒä¸çŸ¥å¦‚ä½•æº–å‚™çš„ï¼Œå¯ä»¥å»çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« [2021-Dcard-Backend-Intern-é¢è©¦ç¶“é©—åˆ†äº«](https://blog.justin0u0.com/2021-Dcard-Web-Backend-Intern-%E9%9D%A2%E8%A9%A6%E7%B6%93%E9%A9%97%E5%88%86%E4%BA%AB/)ï¼Œç›¸ä¿¡æœƒå°ä½ çš„æº–å‚™å¾ˆæœ‰å¹«åŠ©çš„ï¼æœ‰ä»»ä½•ç–‘å•ä¹Ÿæ­¡è¿ä¾†æ‰¾æˆ‘è©¢å•ï½\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Dcard"],"categories":["Others"]},{"title":"ç¥å¥‡çš„æ•´æ•¸å£“ç¸®ç®—æ³•â€”â€”ZigZag","url":"/ç¥å¥‡çš„æ•´æ•¸å£“ç¸®ç®—æ³•-ZigZag/","content":"\nåœ¨ Thirft èˆ‡ Protocol Buffers ä¸­ï¼Œéƒ½ä½¿ç”¨äº†ä¸€ç¨®æ•´æ•¸å£“ç¸®çš„æ¼”ç®—æ³•å«åš ZigZagã€‚\n\nç®—æ³•æœ¬èº«å¾ˆç°¡å–®ï¼Œå»ä¹Ÿå¾ˆå¯¦ç”¨ï¼Œå› æ­¤åˆ†äº«çµ¦å¤§å®¶ ZigZag çš„å¯¦ä½œèˆ‡æƒ³æ³•ã€‚\n\n<!-- More -->\n\n# äºŒé€²åˆ¶èˆ‡äºŒè£œæ•¸\n\nåœ¨é›»è…¦çš„ä¸–ç•Œï¼Œæ‰€æœ‰æ•¸å­—éƒ½æ˜¯ä»¥äºŒé€²ä½å„²å­˜çš„ï¼Œæˆ‘å€‘å‡è¨­æ•¸å­—æ˜¯å„²å­˜åœ¨ 8 bits çš„è®Šæ•¸ä¸­ï¼Œä¾‹å¦‚ï¼š$(1)_{10}=(00000001)_{2}$ã€$(3)_{10}=(00000010)_{2}$ã€‚å› æ­¤å¦‚æœæ‰€æœ‰æ•¸å­—éƒ½æ˜¯æ­£æ•¸ï¼Œå‰‡ä½¿ç”¨ 8 å€‹ bits çš„æœ€å¤§æ•¸å­—å¾ˆæ˜é¡¯æ˜¯ $(255)_{10}=(11111111)_2$ã€‚\n\nå¯æƒœé€™å€‹ä¸–ç•Œæ˜¯æœ‰è² æ•¸å­˜åœ¨çš„ï¼Œå› æ­¤äººå€‘åœ¨è€ƒæ…®è¦å¦‚ä½•åœ¨äºŒé€²ä½ä¸­è¡¨ç¤ºè² æ•¸æ™‚ï¼Œæœ‰äº†ä»¥ä¸‹é€™äº›æƒ³æ³•ï¼š\n\n1. åŸç¢¼ï¼ˆTrue formï¼‰\n\té€™å€‹æƒ³æ³•å¾ˆç›´è§€ï¼Œä½¿ç”¨ç¬¬ä¸€å€‹ bit åšç‚º signed bitï¼Œå¦‚æœæ˜¯æ­£æ•¸å‰‡ç‚º 0ï¼Œè² æ•¸å‰‡ç‚º 1ã€‚\n\n\tå› æ­¤æ­£è² æ•¸é™¤äº†ç¬¬ä¸€å€‹ bit ä¹‹å¤–ï¼Œå‰©ä¸‹çš„è¡¨é”æ–¹å¼èˆ‡æ•¸å€¼æœ¬èº«ä¸€æ¨£ã€‚ä¾‹å¦‚ $(11)_{10}=(00001011)_{2}$ï¼Œ$(-11)_{10}=(10001011)_{2}$ã€‚\n\n2. 1's è£œæ•¸ï¼ˆOne's complementï¼‰\n\té€™å€‹çš„æƒ³æ³•ä¹Ÿå¾ˆç›´è§€ï¼Œç›´æ¥å°‡æ­£æ•¸çš„æ‰€æœ‰ bit å–åç•¶ä½œè² æ•¸çš„è¡¨é”å¼ã€‚ä¾‹å¦‚ $(11)_{10}=(00001011)_{2}$ï¼Œ$(-11)_{10}=(11110100)_{2}$ã€‚\n\n3. 2's è£œæ•¸ï¼ˆTwo's complementï¼‰\n\tç„¶è€Œä»¥ä¸Šå…©ç¨®æ–¹å¼éƒ½æœ‰å…©å€‹å•é¡Œï¼š\n\t1. æ•¸å­— 0 æœ‰å…©ç¨®è¡¨é”æ–¹å¼ï¼ŒåŸç¢¼ä¸­æœ‰ $+0=(00000000)_2$ èˆ‡ $-0=(10000000)_2$ï¼›1's è£œæ•¸ä¸­æœ‰ $+0=(00000000)_2)$ èˆ‡ $-0=(11111111)_2$ã€‚æœƒé€ æˆæ··æ·†ã€‚\n\t2. åŠ æ³•ä¸Šçš„ä¸ä¾¿ï¼šåœ¨åŠ æ³•çš„å¯¦ä½œä¸Šï¼Œå…©ç¨®æ–¹å¼è‹¥ç›´æ¥åšäºŒé€²ä½çš„åŠ æ³•ï¼Œéƒ½æœƒå‡ºç¾å¥‡æ€ªçš„ç¾è±¡ï¼ˆè«‹è®€è€…è‡ªå·±åŠ åŠ çœ‹ï¼Œå°±ä¸è£œå……ä¾‹å­äº†ï¼‰ã€‚\n\n\t2's è£œæ•¸å³å…ˆå–åï¼ˆåš 1's è£œæ•¸ï¼‰å¾Œï¼Œå† $+1$ã€‚\n\n\tä¾‹å¦‚ï¼š$(11)_{10}=(00001011)_{2}$ï¼Œ$(-11)_{10}=(11110101)_{2}$\n\n\t```\n\t(11)     ï¼š00001011\n\t(-11) 1'sï¼š11110100ï¼ˆå–åï¼‰\n\t(-11) 2'sï¼š11110101ï¼ˆ+1ï¼‰\n\t```\n\n# ZigZag\n\næ¥è‘—é€²å…¥æ­£é¡Œï¼Œåœ¨å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼Œè»Ÿé«”å·¥ç¨‹å¸«ç¿’æ…£ä½¿ç”¨ 32 bits çš„è®Šæ•¸ä¾†å„²å­˜æ•´æ•¸ï¼Œä¾‹å¦‚ C/C++ ä¸­çš„ `int`ã€Java ä¸­çš„ `int`ã€‚å› æ­¤åœ¨ç¶²è·¯å‚³è¼¸æ™‚ï¼Œå¾€å¾€ä¹Ÿæœƒç›´æ¥ä½¿ç”¨ 32 bits çš„æ•¸å­—åšç‚ºå‚³è¼¸é¡å‹ï¼Œè€Œ 32 bits çš„æœ‰è™Ÿæ•´æ•¸å¯ä»¥æœ€å¤§å¯ä»¥å„²å­˜åˆ° 2147483647ï¼Œä¹Ÿå°±æ˜¯ 21 å„„ã€‚\n\nä½†æ˜¯ç¾å¯¦ä¸–ç•Œä¸­ï¼Œè¼ƒå°çš„æ•¸å­—å¾€å¾€æ¯”è¼ƒå¸¸å‡ºç¾ï¼Œä¾‹å¦‚ä½¿ç”¨è€…çš„ IDã€å•†å“çš„æ•¸é‡ã€å•†å“çš„åƒ¹æ ¼ç­‰ï¼Œå¾€å¾€éƒ½æ˜¯å¹¾åå¹¾ç™¾å¹¾åƒåˆ°å¹¾è¬ä¸ç­‰çš„æ•¸å­—ã€‚å¦‚æœåªæ˜¯è¦å‚³è¼¸ä¸€å€‹æ•¸å­— $(1)_{10}=(00000000\\_00000000\\_00000000\\_00000001)_2$ï¼Œå»éœ€è¦å‚³è¼¸é€™éº¼å¤šä¸éœ€è¦çš„ 0ï¼Œæ„Ÿè¦ºå°±å¾ˆæµªè²»ã€‚\n\nå› æ­¤ ZigZag çš„æ ¸å¿ƒæƒ³æ³•å°±æ˜¯**ç•¶æ•¸å­—å¾ˆå°çš„æ™‚å€™ï¼Œå°±åªå‚³é€æœ‰éœ€è¦çš„ bytes å³å¯**ï¼Œä¾‹å¦‚æ•¸å­— $(1)_{10}$ åªå‚³é€ $(00000001)_2$ã€‚\n\nå¦‚æœåªæœ‰æ­£æ•¸çš„è©±å°±å¾ˆå®¹æ˜“å¯¦ä½œï¼Œå¯æƒœæˆ‘å€‘éœ€è¦è€ƒæ…®è² æ•¸çš„å­˜åœ¨ã€‚è² æ•¸ $(-1)_{10}=(11111111\\_11111111\\_11111111\\_11111111)_2$ï¼Œå‰é¢éƒ½æ˜¯ 1ï¼Œå°±æ²’è¾¦æ³•ç›´æ¥ä¸Ÿæ£„äº†ã€‚\n\nå› ç‚º ZigZag å¸Œæœ›æ¯”è¼ƒå°çš„æ•¸å­—éƒ½ç”¨æ¯”è¼ƒå°‘çš„ bytesï¼Œå› æ­¤ ZigZag æ±ºå®šå°‡æ•¸å­—ä¾ç…§çµ•å°å€¼å¤§å°æ’åºï¼Œé †åºå¦‚ä¸‹ï¼š\n\n```\né †åºï¼š 0  1  2  3  4  5  6 ...\næ•¸å­—ï¼š 0 -1 +1 -2 +2 -3 +3 ...\n```\n\nè§€å¯Ÿæ•¸å­—èˆ‡é †åºåœ¨äºŒé€²ä½çš„é—œä¿‚ï¼ˆé€™è£¡ç‚ºäº†æ–¹ä¾¿ï¼Œå…ˆå›åˆ° 8bitsï¼‰ï¼š\n\n```\næ•¸å­—ï¼š           é †åºï¼š          é †åºã€å»é™¤ last bitï¼š\n 0 (00000000)   0 (00000000)   0 (0000000)\n-1 (11111111)   1 (00000001)   1 (0000000)\n+1 (00000001)   2 (00000010)   2 (0000001)\n-2 (11111110)   3 (00000011)   3 (0000001)\n+2 (00000010)   4 (00000100)   4 (0000010)\n-3 (11111101)   5 (00000101)   5 (0000010)\n+3 (00000011)   6 (00000110)   6 (0000011)\n```\n\nå¯ä»¥è§€å¯Ÿåˆ°ï¼Œè‹¥å°‡é †åºä¸­çš„æœ€å¾Œä¸€å€‹ bit çœ‹æˆ signed bitï¼Œå‰‡å‰©ä¸‹çš„ bits ä¸­ï¼Œæ­£æ•¸å³åŸæœ¬çš„æ•¸å­—ï¼Œè€Œè² æ•¸å³åŸæ•¸å­—å–åã€‚\n\nå› æ­¤æˆ‘å€‘åªè¦**å°‡åŸæ•¸å­—å·¦ç§»ä¸€ä½ï¼Œè² æ•¸å†åšå–åå¾Œï¼Œå°‡ signed bit è£œåˆ°æœ€å¾Œä¸€ä½å³å¯**ã€‚å¯¦éš›æ“ä½œä¸€æ¬¡ï¼š\n\n```\n+3 = 00000011\n    \n   = 0000011xï¼ˆå·¦ç§»ä¸€ä½ï¼‰\n   = 00000110ï¼ˆè£œä¸Š signed bitï¼‰\n   = 6\n```\n\n```\n-3 = 11111101\n\n   = 1111101xï¼ˆå·¦ç§»ä¸€ä½ï¼‰\n\t = 0000010xï¼ˆå–åï¼‰\n\t = 00000101ï¼ˆè£œä¸Š signed bitï¼‰\n   = 5\n```\n\næœ€å¾Œ ZigZag å²å®³çš„åœ°æ–¹å°±åœ¨æ–¼ï¼Œç¨‹å¼ä¸Šçš„å¯¦ä½œä¹Ÿéå¸¸ç°¡å–®ï¼Œå¯ä»¥é€éä½å…ƒé‹ç®—é”æˆï¼š\n\n```go\nfunc int8ToZigZag(n int8) int8 {\n\treturn (n << 1) ^ (n >> 7)\n}\n\nfmt.Println(int8ToZigZag(3))  // 6\nfmt.Println(int8ToZigZag(-3)) // 5\n```\n\nå…¶åŸç†ä¹Ÿå¾ˆç°¡å–®ï¼Œé¦–å…ˆè¦çŸ¥é“ï¼Œ`<<` æ˜¯ç®—è¡“å·¦ç§»é‹ç®—å­ï¼ˆarithematic left shift operatorï¼‰ï¼Œæœƒå°‡æ‰€æœ‰ bits å‘å·¦ç§»å‹•ä¸€æ ¼å¾Œè£œä¸Š 0ï¼›è€Œ `>>` æ˜¯ ç®—è¡“å³ç§»é‹ç®—å­ï¼ˆarithematic right shift operatorï¼‰ï¼Œæœƒå°‡æ‰€æœ‰ bits å‘å³ç§»å‹•å¾Œ<font color=\"red\">è£œä¸Š signed bit</font>ã€‚\n\nå› æ­¤æ‰€æœ‰æ•¸åœ¨å³ç§» 7ï¼ˆ`n >> 7`ï¼‰å¾Œï¼Œæ­£æ•¸å› ç‚ºåŸ signed bit æ˜¯ 0ï¼Œæ¯æ¬¡å·¦ç§»ä¹‹å¾Œéƒ½æœƒåœ¨å·¦é‚Šè£œä¸Š 0ï¼Œæ‰€ä»¥æœ€å¾Œè®Šæˆ `00000000`ï¼›è€Œè² æ•¸å› ç‚ºåŸ signed bit æ˜¯ 1ï¼Œæ‰€ä»¥æ¯æ¬¡å³ç§»éƒ½æœƒåœ¨å·¦é‚Šè£œä¸Š 1ï¼Œæ‰€ä»¥æœ€å¾Œè®Šæˆ `11111111`ã€‚\n\nå†ä¾† `(n << 1)` å³æ•¸å­—å·¦ç§»ä¸€ä½ï¼Œä¸”æœ€å¾Œå³é‚Šä¸€ä½æœƒè£œä¸Š 0ã€‚æœ€å¾Œ `^` ç‚º xor é‹ç®—å­ï¼Œæ‰€ä»¥è§€å¯Ÿ `(n << 1) ^ (n >> 7)`ï¼š\n\n```\n(n >> 7)ï¼š\næ­£æ•¸ï¼š      è² æ•¸ï¼š\n00000000   11111111\n\n(n << 1)ï¼š\næ­£æ•¸ï¼š      è² æ•¸ï¼š\nxxxxxxx0   yyyyyyy0\n```\n\nå¯ä»¥ç™¼ç¾æœ€å³é‚Šçš„ signed bit éƒ¨åˆ†ï¼Œæ­£æ•¸çš„ä¸€å®šæ˜¯ 0ï¼Œè² æ•¸çš„ä¸€å®šæ˜¯ 1ã€‚å·¦é‚Šæ•¸å­—éƒ¨åˆ†ï¼Œæˆ‘å€‘çŸ¥é“ `0 ^ x = x` ä¸” `1 ^ y = ~y`ï¼Œæ‰€ä»¥æ­£æ•¸çš„æ•¸å­—ä¸€å®šä¿æŒä¸è®Šï¼Œè€Œè² æ•¸æœƒè¢«å–åã€‚\n\nè€Œé€™æ­£æ˜¯æˆ‘å€‘æƒ³è¦çš„çµæœã€‚\n\næœ€å¾Œå›åˆ° 32bits çš„æ•¸å­—ï¼š\n\n```go\nfunc int32ToZigZag(n int32) int32 {\n\treturn (n << 1) ^ (n >> 31)\n}\n```\n\nDecode æ™‚åªè¦å°‡æ“ä½œåéä¾†å³å¯ï¼ˆæ³¨æ„ golang åœ¨ unsigned int æ‰æœƒåš logical right shiftï¼Œæ‰€ä»¥è¦å…ˆè½‰ `uint32`ï¼‰ï¼š\n\n```go\nfunc zigZagToInt32(n int32) int32 {\n\tu := uint32(n)\n\treturn int32(u>>1) ^ -(n & 1)\n}\n```\n\nçŸ¥é“äº†å¦‚ä½•å°ä¸€å€‹æ•¸å­—åš ZigZag encoding å¾Œï¼Œæˆ‘å€‘åªè¦å†æ€è€ƒå¦‚ä½•æ±ºå®šå‚³è¼¸æ™‚è¦é€å¹¾å€‹ bytes å³å¯ï¼š\n\nä¸€ç¨®åšæ³•æ˜¯ç”¨é¡å¤–çš„ä¸€å€‹ byte ä»£è¡¨æ¥ä¸‹ä¾†çš„æ•´æ•¸æœ‰å¹¾å€‹ bytesï¼Œä¾‹å¦‚ $(00000001\\_00000010)_2$ çš„ç¬¬ä¸€å€‹ byte ä»£è¡¨æ¥ä¸‹ä¾†çš„æ•´æ•¸åªæœ‰ä¸€å€‹ byteï¼Œè€Œç¬¬äºŒå€‹ byte é–‹å§‹æ‰æ˜¯çœŸæ­£è¦å‚³è¼¸çš„æ•¸å­—ã€‚ä½†æ˜¯é€™æ¨£çš„åšæ³•æœ€å°‘éœ€è¦å…©å€‹ bytes æ‰èƒ½è¡¨ç¤ºä¸€å€‹æ•¸å­—ã€‚\n\nè€Œ ZigZag æ¡ç”¨äº†å¦ä¸€ç¨®åšæ³•ï¼Œå°±æ˜¯æ¯å€‹ byte ä¸­éƒ½**ä½¿ç”¨ç¬¬ä¸€å€‹ bit ä½œç‚ºã€Œé‚„æœ‰æ²’æœ‰ä¸‹ä¸€å€‹ byteã€çš„åˆ¤æ–·**ï¼Œä¹Ÿå°±æ˜¯èªªå¦‚æœ first bit æ˜¯ 1ï¼Œå‰‡ä»£è¡¨é€™å€‹æ•¸å­—é‚„æ²’æœ‰çµæŸï¼›å¦‚æœ first bit æ˜¯ 0ï¼Œå‰‡ä»£è¡¨é€™å€‹æ•¸å­—å·²ç¶“çµæŸã€‚å› æ­¤åœ¨å‚³è¼¸æ™‚ï¼Œå…¶å¯¦æ¯å€‹ byte èƒ½è¢«ä½¿ç”¨çš„ bits åªæœ‰ 7 å€‹ã€‚è€Œé€™ç¨®åšæ³•è¢«ç¨±ä½œ [*Base128 Varint*](https://developers.google.com/protocol-buffers/docs/encoding#varints)ã€‚\n\nèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘æƒ³è¦å‚³è¼¸ 1337 é€™å€‹æ•¸å­—ï¼Œå…ˆåš `int32ToZigZag(1337) = 2674 = 0b10100_1110010`ï¼Œå‚³è¼¸æ™‚ç”±ä½ä½å…ˆå‚³ï¼Œæ‰€ä»¥å‚³å‡ºçš„ç¬¬ä¸€å€‹ byte ç‚º `11110010`ï¼Œå¯ä»¥çœ‹åˆ°å› ç‚ºé‚„æ²’å‚³å®Œï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹ bit ç‚º 1ï¼Œå¾Œ 7 å€‹ bits æ‰æ˜¯çœŸæ­£çš„è³‡æ–™ `1110010`ï¼›å‚³å‡ºçš„ç¬¬äºŒå€‹ bit ç‚º `00010100`ï¼Œå› ç‚ºå·²ç¶“æ²’æœ‰ä¸‹ä¸€å€‹ byte äº†ï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹ bit ç‚º 0ã€‚\n\nå¯¦ä½œä¸Šä¹Ÿæ˜¯å¾ˆç°¡å–®ï¼Œ`^0x7F` æ˜¯ $(11111111\\_11111111\\_11111111\\_10000000)_2$ï¼Œæ‰€ä»¥ `n & ^0x7F` çš„ä½œç”¨åœ¨æ–¼æª¢æŸ¥ `n` æ˜¯ä¸æ˜¯åªæœ‰æœ€å¾Œ 7 å€‹ bits æœ‰æ•¸å­—ã€‚å¦‚æœæ˜¯çš„è©±ï¼Œå°±å¯«å…¥ `n`ï¼›å¦å‰‡å°±åªå¯«å…¥ `n` çš„æœ€å¾Œ 7 bits åŠ ä¸Šå‰é¢çš„ä¸€å€‹ 1ï¼ˆä»£è¡¨å¾Œé¢é‚„æœ‰æ•¸å­—ï¼‰ã€‚\n\n```go\nfunc writeVarint32(n int32) (int, []byte) {\n\ti32buf := make([]byte, 5)\n\tidx := 0\n\tfor {\n\t\tif (n & ^0x7F) == 0 {\n\t\t\ti32buf[idx] = byte(n)\n\t\t\tidx++\n\t\t\tbreak\n\t\t\t// return;\n\t\t} else {\n\t\t\ti32buf[idx] = byte((n & 0x7F) | 0x80)\n\t\t\tidx++\n\t\t\tu := uint32(n)\n\t\t\tn = int32(u >> 7)\n\t\t}\n\t}\n\treturn idx, i32buf\n}\n```\n\nä¹Ÿå› ç‚ºé€™ç¨®æ–¹å¼ä¸€æ¬¡åªèƒ½å‚³è¼¸ 7 å€‹ bits çš„çœŸå¯¦è³‡æ–™ï¼Œå› æ­¤ä¸€å€‹ 32bits çš„æ•´æ•¸æ˜¯æœ‰å¯èƒ½è¦èŠ±è²» 5 å€‹ bytes æ‰å‚³å®Œçš„ï¼ˆä¸éè¦åœ¨æ•¸å­—å¾ˆå¤§çš„æ™‚å€™ï¼‰ã€‚\n\n# ç¸½çµ\n\nZigZag åœ¨è™•ç†æœ‰è™Ÿæ•´æ•¸çš„å£“ç¸®æ˜¯éå¸¸ç²¾å¦™çš„ï¼Œåœ¨å¯¦ä½œä¸­ä¹Ÿåƒ…åƒ…ä½¿ç”¨ä¸åˆ°ç™¾è¡Œçš„ç¨‹å¼ç¢¼å°±å¯ä»¥å®Œæˆã€‚\n\nä¹Ÿå› æ­¤ Thriftã€Protobuf å’Œ Arvo é€™ä¸‰å¤§ binary encoding libraries éƒ½æœ‰é€é ZigZag encoding åšæœ‰è™Ÿæ•´æ•¸å£“ç¸®ä¾†æ¸›å°‘å‚³è¼¸çš„é‡ã€‚\n\nå…¨éƒ¨çš„å¯¦ä½œåœ¨é€™è£¡ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è‡ªå·±æ›¿æ›æ•¸å­—è·‘è·‘çœ‹ã€‚\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc int32ToZigZag(n int32) int32 {\n\treturn (n << 1) ^ (n >> 31)\n}\nfunc zigZagToInt32(n int32) int32 {\n\treturn int32((uint32(n) >> 1)) ^ -(n & 1)\n}\n\nfunc writeVarint32(n int32) (int, []byte) {\n\ti32buf := make([]byte, 5)\n\tidx := 0\n\tfor {\n\t\tif (n & ^0x7F) == 0 {\n\t\t\ti32buf[idx] = byte(n)\n\t\t\tidx++\n\t\t\t// p.writeByteDirect(byte(n));\n\t\t\tbreak\n\t\t\t// return;\n\t\t} else {\n\t\t\ti32buf[idx] = byte((n & 0x7F) | 0x80)\n\t\t\tidx++\n\t\t\t// p.writeByteDirect(byte(((n & 0x7F) | 0x80)));\n\t\t\tu := uint32(n)\n\t\t\tn = int32(u >> 7)\n\t\t}\n\t}\n\treturn idx, i32buf\n}\n\nfunc main() {\n\tfmt.Println(int32ToZigZag(1337)) // 2647\n\n\tfmt.Println(zigZagToInt32(2674)) // 1337\n\n  l, b := writeVarint32(2674)\n  for i := 0; i < l; i++ {\n    fmt.Printf(\"%08b \", b[i]) // 11110010 00010100\n  }\n  fmt.Println(\"\")\n}\n```\n\n# åƒè€ƒè³‡æ–™\n\n- [Thrift Compact protocol encoding](https://github.com/apache/thrift/blob/master/doc/specs/thrift-compact-protocol.md)\n- [Thrift Compact protocol encoding implementation in Golang](https://github.com/apache/thrift/blob/master/lib/go/thrift/compact_protocol.go)\n- [Protocol Buffers encoding - Signed Integers](https://developers.google.com/protocol-buffers/docs/encoding#signed_integers)\n- https://blog.csdn.net/zgwangbo/article/details/51590186\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","categories":["Others"]},{"title":"Designing Data-Intensive Application ç¬¬å››ç« ç­†è¨˜","url":"/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/","content":"\næ‡‰ç”¨ç¨‹å¼æ˜¯ä¸æœƒæ°¸æ†ä¸è®Šçš„ï¼Œéš¨è‘—æ–°çš„ features åŠ å…¥è³‡æ–™çš„å„²å­˜æ ¼å¼å¯èƒ½æ”¹è®Šã€‚å› æ­¤æœ¬ç« ç¯€ä¸»è¦æ¢è¨ç¬¬ä¸€ç« ç¯€ä¸­\bæ‰€æåˆ°çš„ maintainability ä¸­çš„ **evolvability**ã€‚\n\nåœ¨ relational database ä¸­ï¼Œé€šå¸¸éœ€è¦æ›´æ–° schemaï¼›è€Œåœ¨ schemaless database ä¸­ï¼Œæ–°èˆŠç‰ˆæœ¬çš„è³‡æ–™æ ¼å¼å¯ä»¥åŒæ™‚å­˜åœ¨ã€‚\n\nApplication code ä¹Ÿæœƒå› ç‚ºè³‡æ–™æ ¼å¼çš„æ”¹è®Šè€Œæœ‰æ‰€è®ŠåŒ–ï¼Œä½†æ˜¯åœ¨å¤§å‹æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œåšåˆ°ç¬é–“çš„ç‰ˆæœ¬æ›´æ–°æ˜¯ä¸å¯èƒ½çš„ï¼š\n\n- Server side applicationsï¼šé€šå¸¸æœƒåŸ·è¡Œ **rolling upgrade**ï¼Œå› æ­¤æ–°èˆŠç‰ˆæœ¬çš„ç¨‹å¼æœƒé€šæ™‚é‹ä½œã€‚\n\n\t{% note info %}\n\t#### Rolling Upgrade\n\n\té€éé€æ¼¸éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ° serverï¼Œç¢ºèªæ–°ç‰ˆæœ¬æ­£å¸¸é‹ä½œå¾Œï¼Œæ‰é€æ¼¸ç§»é™¤èˆŠç‰ˆæœ¬çš„éƒ¨ç½²ï¼Œä»¥é”åˆ° zero-downtime çš„ç‰ˆæœ¬å‡ç´šã€‚\n\t{% endnote %}\n\n- Client side applicationsï¼šæ˜¯å¦æ›´æ–°å–æ±ºæ–¼ä½¿ç”¨è€…ï¼Œå› æ­¤æœƒåŒæ™‚æ“æœ‰å¤šç¨®ç‰ˆæœ¬åœ¨é‹ä½œã€‚\n\nä»¥ä¸Šå…©é»å°±èªªæ˜äº†åœ¨è»Ÿé«”é–‹ç™¼ä¸­ï¼Œç›¸å®¹æ€§çš„é‡è¦æ€§ã€‚ç›¸å®¹æ€§åŒ…å«å…©å€‹æ–¹å‘ï¼š\n\n- **Backward compatibilityï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰**ï¼šæ–°çš„ç¨‹å¼ç¢¼å¯ä»¥è®€èˆŠçš„è³‡æ–™ã€‚\n- **Forward compatibilityï¼ˆå‘ä¸Šç›¸å®¹ï¼‰**ï¼šèˆŠçš„ç¨‹å¼ç¢¼å¯ä»¥è®€æ–°çš„è³‡æ–™ã€‚\n\næœ¬ç« ç¯€æœƒè¨è«–åœ¨ JSONã€XMLã€Protocol Buffersã€Thriftã€Arvo é€™äº›è³‡æ–™æ ¼å¼ä¸‹çš„ç›¸å®¹æ€§å•é¡Œï¼Œä»¥åŠåœ¨ RESTã€RPCã€Message Queue ä¸‹å¦‚ä½•ä½¿ç”¨é€™äº›è³‡æ–™æ ¼å¼å‚³è¼¸è³‡æ–™ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/data_formats.jpeg)\n\n<!-- More -->\n\n# Formats for Encoding Data\n\nè³‡æ–™åœ¨ç¨‹å¼ä¸­ä»¥ objectsã€structsã€listsã€hash tablesã€trees ç­‰æ ¼å¼å„²å­˜åœ¨ memory ä¸­ï¼Œé€™äº›è³‡æ–™çµæ§‹ç¶“å¸¸é€é pointers ä¾†å­˜å–è³‡æ–™ã€‚ä½†æ˜¯é€éç¶²è·¯å‚³è¼¸è³‡æ–™æ™‚ï¼Œé€™äº›è³‡æ–™å¿…é ˆè½‰æ›æˆ sequences of bytesï¼ˆä¾‹å¦‚ JSONï¼‰ã€‚\n\n<strong>é€™ç¨®å¾ in-memory çµæ§‹è½‰æ›åˆ° byte sequence çš„éç¨‹å«åš *encoding*ã€*serialization* æˆ–æ˜¯ *marshalling*ï¼›åéä¾†å‰‡å« *decoding*ã€*deserialization* æˆ–æ˜¯ *unmarshalling*ã€‚</strong>\n\n## Language-Specific Formats\n\nä¸€äº› programming language æœ‰è‡ªå·±çš„ encoding æ–¹å¼ï¼Œä¾‹å¦‚ Java ä¸­çš„ `java.io.Serialiable`ã€‚ä½¿ç”¨é€™äº› encoding å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¯èƒ½æœ‰ä»¥ä¸‹å•é¡Œï¼š\n\n- Language-specific encoding é€šå¸¸åªèƒ½åœ¨ä¸€å€‹ langauge ä½¿ç”¨ï¼Œè¦ä½¿ç”¨å…¶ä»– language è®€å–æ˜¯å¾ˆå›°é›£çš„ã€‚\n- é€™äº› encoding é€šå¸¸ä¸æ”¯æ´è³‡æ–™çš„ä¸Šä¸‹ç›¸å®¹ã€‚\n\t\n\t{% note info %}\n\t#### Golang gob library\n\n\tGolang å…§å»ºçš„ encoding `gob` å¯ä»¥è‡ªå‹•å¿½ç•¥ `struct` ä¸­æ–°å¢æˆ–æ˜¯åˆªé™¤çš„æ¬„ä½ï¼Œå¯ä»¥åšåˆ°ä¸€äº›ä¸Šä¸‹ç›¸å®¹ã€‚\n\n\tä¾‹å¦‚ encode ç«¯çš„çµæ§‹é•·é€™æ¨£ï¼š\n\t```go\n\tstruct { A, B int } // encode\n\t```\n\n\tåœ¨ decode ç«¯ä»¥ä¸‹æƒ…æ³éƒ½æ˜¯è¢«å…è¨±çš„ï¼š\n\t```go\n\tstruct { A, B int, C string } // new field\n\tstruct { A int } // missing field\n\t```\n\n\t{% endnote %}\n\n## JSON, XML and Binary Variants\n\næ¥è‘—ä»‹ç´¹ä¸€äº›æ¨™æº–çš„ encoding æ–¹å¼ï¼Œä¾‹å¦‚ JSONã€XMLã€CSVã€‚ä»–å€‘è¢«è¨­è¨ˆæˆ human-readable çš„æ ¼å¼ï¼Œè¢«å¤§å¤šæ•¸çš„èªè¨€æ”¯æ´ï¼Œä¸¦ä¸”è¢«å»£æ³›çš„ä½¿ç”¨ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å„è‡ªçš„å•é¡Œå­˜åœ¨ï¼š\n\n- XMLã€CSV ç„¡æ³•å€åˆ†æ•¸å­—ä»¥åŠåªåŒ…å«æ•¸å­—çš„å­—ä¸²ï¼›JSON ç„¡æ³•å€åˆ†æ•´æ•¸ä»¥åŠæµ®é»æ•¸ã€‚\n- XMLã€JSON éƒ½ä¸æ”¯æ´ **binary encoding**ã€‚\n\nä½†é€™äº›å•é¡Œä¾ç„¶ä¸å½±éŸ¿ JSONã€XML æˆ–æ˜¯ CSV åœ¨è³‡æ–™äº¤æ›ä¸Šçš„ä½¿ç”¨ï¼ˆå°¤å…¶æ˜¯è·¨æ©Ÿæ§‹çš„ï¼‰ï¼Œ**å› ç‚ºä»–å€‘è¢«å»£æ³›çš„æ”¯æ´ä»¥åŠèªå¯ï¼Œé€™æ¯”èµ·æ•ˆèƒ½æˆ–æ˜¯æ ¼å¼çš„å•é¡Œé‚„è¦é‡è¦**ã€‚\n\n### Binary encoding\n\nä¸Šé¢æœ‰æåˆ°ï¼ŒXML èˆ‡ JSON éƒ½ä¸æ”¯æ´ **binary encoding**ï¼Œä½†æ˜¯åœ¨è·¨æ©Ÿæ§‹çš„è³‡æ–™äº¤æ›ä¸Šé¢ï¼Œè¢«å»£æ³›ä½¿ç”¨ä»¥åŠæ”¯æ´çš„æ ¼å¼æ¯”èµ·æ•ˆèƒ½æˆ–æ ¼å¼å•é¡Œæ›´é‡è¦ã€‚åä¹‹ï¼Œåœ¨æ©Ÿæ§‹å…§è‡ªå·±ä½¿ç”¨ï¼Œå°±å¯ä»¥å¤šå»è€ƒæ…®æ•ˆèƒ½çš„å•é¡Œã€‚\n\nJSON é›–ç„¶æ¯” XML å¥½ï¼Œä½†æ˜¯æ¯”èµ· binary encoding format é‚„æ˜¯å¤šä½¿ç”¨äº†å¾ˆå¤šç©ºé–“\bï¼Œå› æ­¤å‡ºç¾äº†ä¸€äº› JSON binary encoding çš„å¯¦ä½œï¼Œä¾‹å¦‚ [MessagePack](https://msgpack.org/)ã€[BSON](https://docs.mongodb.com/manual/reference/bson-types/)ã€[BJSON](http://bjson.org/) ç­‰ç­‰ã€‚\n\nèˆ‰ä¾‹ä¾†èªªï¼ŒåŸæœ¬çš„ JSON è³‡æ–™å¦‚ä¸‹ï¼š\n\n```json\n{\n\t\"userName\": \"Martin\",\n\t\"favoriteNumber\": 1337,\n\t\"interests\": [\"daydreaming\", \"hacking\"]\n}\n```\n\næ‰£é™¤æ‰ç©ºç™½å­—å…ƒä»¥åŠæ›è¡Œå¾Œï¼Œä¸€å…±ä½¿ç”¨ 81 å€‹å­—å…ƒã€‚\n\n```javascript\nconst s = '{\"userName\":\"Martin\",\"favoriteNumber\":1337,\"interests\":[\"daydreaming\",\"hacking\"]}';\nconsole.log(s.length); // 81\n```\n\nè€Œ MessagePack encode éå¾Œçš„çµæœå¦‚ä¸‹ï¼š\n![MessagePack](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/message_pack.png)\n\nä¸€å…±åªä½¿ç”¨ 66 å€‹å­—å…ƒã€‚\n\n{% note %}\n\t#### è£œå……é—œæ–¼ MessagePack ç·¨ç¢¼æ–¹å¼\n\n\t[MessagePack encoding](https://github.com/msgpack/msgpack/blob/master/spec.md)\n\n\t- MessagePack ç”¨äºŒé€²ä½ `1000xxxx` ä»£è¡¨ JSON Objectï¼Œå…¶ä¸­ `xxxx` ä»£è¡¨ object çš„ keys æ•¸é‡ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°ç¬¬ä¸€å€‹ç·¨ç¢¼ç‚º 83 (`10000011`)ï¼Œä»£è¡¨æ˜¯ä¸€å€‹ JSON Object åŒ…å« 3 å€‹ keysã€‚\n\t\té‚£å¦‚æœ keys æ•¸é‡è¶…é 15 å€‹å‘¢ï¼Ÿå‰‡æœƒä½¿ç”¨ `0xde`ï¼ˆæœ‰å°æ–¼ 2^16 å€‹ keysï¼‰æˆ–æ˜¯ `0xdf`ï¼ˆæœ‰å°æ–¼ 2^32 å€‹ keysï¼‰ç•¶ä½œç¬¬ä¸€å€‹ç·¨ç¢¼å­—å…ƒï¼Œå†æ¥è‘— keys çš„é•·åº¦ã€‚\n\t\t[MessagePack encoding - Map format](https://github.com/msgpack/msgpack/blob/master/spec.md#int-format-family)\n\t\n\t- MessagePack å°å°æ–¼ 2^7 çš„ç„¡è™Ÿæ­£æ•´æ•¸ä½¿ç”¨ `0xxxxxxx` ç·¨ç¢¼ã€å°æ–¼å°æ–¼ 2^5 çš„æœ‰è™Ÿæ•´æ•¸ä½¿ç”¨ `111xxxxx` åšç·¨ç¢¼ï¼Œå…¶ä¸­ `x` çš„éƒ¨åˆ†ä»£è¡¨æ•¸å­—ï¼Œé€™å…©ç¨®éƒ½åªä½¿ç”¨äº†ä¸€å€‹ byte åšç·¨ç¢¼ã€‚å¦å¤–å°æ–¼å°æ–¼ 8bitsã€16bitsã€32bitsã€64bits çš„æ•´æ•¸èˆ‡æ­£æ•´æ•¸éƒ½ç”¨ä¸€å€‹ä¸åŒ first byte åšå€åˆ¥ï¼Œåˆ†åˆ¥ä½¿ç”¨ 2ã€3ã€5ã€9 å€‹ bytesã€‚\n\t\t[MessagePack encoding - Integer format](https://github.com/msgpack/msgpack/blob/master/spec.md#int-format-family)\n\n\t- MessagePack å°æ–¼ä¸åŒé•·åº¦çš„ string ä¹Ÿå°ä¸åŒé•·åº¦ç¯„åœçš„å­—ä¸²ä½¿ç”¨ä¸åŒçš„ first byte ä¾†ç·¨ç¢¼ã€‚\n\t\t[MessagePack encoding - String format](https://github.com/msgpack/msgpack/blob/master/spec.md#str-format-family)\n{% endnote %}\n\n## Thrift and Protocol Buffers\n\nThrift å’Œ Protocol Buffersï¼ˆprotobufï¼‰éƒ½æ˜¯é–‹æºçš„ binary encoding librariesï¼Œä»–å€‘éƒ½å¿…é ˆé€é schema å…ˆå®šç¾©å¥½è³‡æ–™çš„æ ¼å¼æ‰èƒ½åš encodingã€‚\n\n### Thrift\n\nThrift çš„ schema å®šç¾©å¦‚ä¸‹ï¼š\n\n```thrift\nstruct Person {\n\t1: required string userName,\n\t2: optional i64 favoriteNumber,\n\t3: optional list<string> interests\n}\n```\n\nè€Œ protobuf çš„ schema å®šç¾©å¦‚ä¸‹ï¼ˆä½œè€…é€™è£¡æä¾›çš„æ˜¯ proto2 çš„èªæ³•ï¼Œåœ¨ proto3 `required` èˆ‡ `optional` å·²ç¶“æ£„ç”¨ï¼‰ï¼š\n```protobuf\nmessage Person {\n\trequired string user_name       = 1;\n\toptional int64  favorite_number = 2;\n\trepeated string interests       = 3;\n}\n```\n\né€é schema çš„å®šç¾©ï¼ŒThrift å’Œ Protobuf éƒ½é€é code generation å·¥å…·ä¾†ç”Ÿæˆ schema åœ¨ä¸åŒèªè¨€çš„å¯¦ä½œï¼ŒåŒ…å«å¯ä»¥å„²å­˜ data çš„ in-memory æ ¼å¼ï¼ˆgolang structã€jave class ç­‰ï¼‰ä»¥åŠ encoding å’Œ decoding çš„å‡½æ•¸ã€‚\n\nThrift æœ‰å…©ç¨® encoding æ¨¡å¼ï¼Œåˆ†åˆ¥æ˜¯ *BinaryProtocol* èˆ‡ *CompactProtocol*ã€‚\n\n![Thrift - binary protocol](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/thrift_binary_protocol.png)\n\nThrift åœ¨ä½¿ç”¨ BinaryProtocol æ™‚ï¼Œåªä½¿ç”¨äº† 59 bytesï¼Œç›¸è¼ƒæ–¼ MessagePack çš„ 65 bytes åˆå°‘äº†ä¸€äº›ã€‚\n\n**å¯ä»¥ç™¼ç¾ä½¿ç”¨ schema å¾Œï¼Œå„ªå‹¢åœ¨æ–¼ä¸éœ€è¦åƒ JSONã€XML çš„ encoding ä¸€æ¨£å„²å­˜ key nameï¼ˆä¾‹å¦‚ `userName`ï¼‰ï¼Œè½‰è€Œå„²å­˜ field tagã€‚ä¹Ÿå› æ­¤ä¸ç®¡æ˜¯ Thrift é‚„æ˜¯ Protobufï¼Œéƒ½å¯ä»¥çœ‹åˆ°æ¯å€‹ key éƒ½æœƒæœ‰ä¸€å€‹ unique çš„ field tagã€‚**\n\n![Thrift - compact protocol](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/thrift_compact_protocol.png)\n\nThrift ä½¿ç”¨ CompactProtocol ç”šè‡³åªéœ€è¦ 34 bytes å°±å¯ä»¥å„²å­˜ç›¸åŒçš„è³‡æ–™ã€‚å¯ä»¥ç™¼ç¾åœ¨ CompactProtocol åšäº†é€™äº›ç©ºé–“å„ªåŒ–ï¼š\n\n- æŠŠ field tag è·Ÿ field type encode åœ¨åŒä¸€å€‹ byte å…§ã€‚\n- é—œæ–¼æ•´æ•¸çš„éƒ¨åˆ†ï¼ˆåŒ…å«è¡¨ç¤ºå­—ä¸²é•·åº¦çš„æ•´æ•¸ï¼‰ï¼Œä½¿ç”¨äº† zig-zag æ•´æ•¸å£“ç¸®ï¼Œå†é€é Base 128 Varint çš„æ–¹å¼å‚³è¼¸ã€‚\n\n\t{% note info %}\n\t#### ZigZag èˆ‡ Base 128 Varint\n\n\té€™è£¡ä½œè€…çµ¦çš„ schema ä¸­ï¼Œ`favorite_number` æ˜¯ `int64` æœ‰è™Ÿæ•´æ•¸ï¼Œæ ¹æ“š [Thrift æä¾›çš„ spec](https://github.com/apache/thrift/blob/master/doc/specs/thrift-compact-protocol.md#integer-encoding)ï¼Œ`int32` èˆ‡ `int64` éƒ½æœƒåš zig-zag encodingã€‚æ‰€ä»¥ 1337 çš„éƒ¨åˆ†ç·¨ç¢¼éå¾Œæ‡‰è©²æ˜¯ `11110010 00010100` æ‰å°ã€‚\n\n\té—œæ–¼ ZigZag æ•´æ•¸å£“ç¸®èˆ‡ Base 128 Varint çš„è©³ç´°ä»‹ç´¹ï¼Œå¯ä»¥çœ‹ç­†è€…çš„å¦ä¸€ç¯‡ blogï¼š[ç¥å¥‡çš„æ•´æ•¸å£“ç¸®ç®—æ³•-ZigZag](/ç¥å¥‡çš„æ•´æ•¸å£“ç¸®ç®—æ³•-ZigZag)ã€‚\n\t{% endnote %}\n\n### Protocol buffers\n\n![Protobol buffers](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/protobuf.png)\n\nåŸºæœ¬ä¸Š Protocol Buffers çš„ encode æ–¹å¼èˆ‡ Thrift ä¸­çš„ CompactProtocol é¡ä¼¼ï¼Œç‰¹åˆ¥æ³¨æ„å…©é»ï¼š\n\n- [Protobuf çš„æ–‡ä»¶](https://developers.google.com/protocol-buffers/docs/encoding#signed_integers)ä¸­æœ‰æåˆ°å¦‚æœä½¿ç”¨çš„æ˜¯ `int32` æˆ–æ˜¯ `int64` é¡å‹çš„è©±ï¼Œè² æ•¸éƒ½æœƒä½¿ç”¨å®Œæ•´çš„ 10 å€‹ bytesï¼Œåªæœ‰åœ¨é¸æ“‡ `sint32` æˆ–æ˜¯ `sint64` é€™å…©ç¨® signed types æ™‚æ‰æœƒä½¿ç”¨ zig-zag encodingï¼Œæœƒæœ‰æ›´å¥½çš„å£“ç¸®ç‡ã€‚\n- ä¸ç®¡æ˜¯ `required` æˆ–æ˜¯ `optional` éƒ½ä¸æœƒå° encode å¾Œçš„ data ç”¢ç”Ÿå½±éŸ¿ï¼Œ`required` è·Ÿ `optional` çš„ä½œç”¨åªæœ‰ runtime æ™‚çš„æª¢æŸ¥è€Œå·²ã€‚ä¹Ÿå› ç‚º `required` èˆ‡ `optional` åœ¨ schema evolution æ™‚é€ æˆä¸ä¾¿ï¼ˆä¸‹é¢æœƒä»‹ç´¹åˆ°ï¼‰ï¼Œå› æ­¤ protocol buffers 3 æ™‚ `required` èˆ‡ `optional` éƒ½è¢«ç§»é™¤ã€‚\n\t[Why required and optional is removed in Protocol Buffers 3?](https://stackoverflow.com/a/31814967)\n\n### Field tags and schema evolution\n\næ¯æ¬¡çš„ schema change éƒ½ç¨±ä½œ *schema evolution*ï¼Œfield name æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œä½†æ˜¯ field tag ä¸èƒ½æ›´æ”¹ã€‚\n\n- Forward compatibilityï¼ˆèˆŠç‰ˆæœ¬å¯ä»¥ç›¸å®¹æ–°ç‰ˆæœ¬è³‡æ–™ï¼‰ï¼š\n\t- å¯ä»¥å¢åŠ æ–°çš„ fieldï¼Œå› ç‚ºèˆŠç‰ˆæœ¬å¯ä»¥ç›´æ¥ omit ä¸èªè­˜çš„ field tagã€‚\n\t- å¯ä»¥åˆªé™¤ optional çš„ fieldï¼Œä¸€å€‹ `required` çš„ field ä¸èƒ½è¢«ç§»é™¤ã€‚åˆªé™¤ä¸€å€‹ `required` çš„ field æœƒè®“èˆŠç‰ˆæœ¬ code è®€åˆ°æ–°ç‰ˆæœ¬è³‡æ–™æ™‚å› ç‚ºè©² field ä¸å­˜åœ¨è€Œå ±éŒ¯ã€‚\n\n- Backward compatibilityï¼ˆæ–°ç‰ˆæœ¬å¯ä»¥ç›¸å®¹èˆŠç‰ˆæœ¬è³‡æ–™ï¼‰ï¼š\n\t- å¯ä»¥å¢åŠ æ–°çš„ fieldï¼Œä½†æ˜¯ä¸èƒ½å¢åŠ  `required` çš„ fieldã€‚å¢åŠ ä¸€å€‹ `required` çš„ field æœƒè®“æ–°ç‰ˆæœ¬ code è®€åˆ°èˆŠç‰ˆæœ¬è³‡æ–™æ™‚å› ç‚ºè©² field ä¸å­˜åœ¨è€Œå ±éŒ¯ã€‚\n\t- å¯ä»¥åˆªé™¤ä¸€å€‹ fieldï¼Œå› ç‚ºæ–°ç‰ˆæœ¬æœƒç›´æ¥ omit ä¸èªè­˜çš„ field tagã€‚\n\nåˆªé™¤ä¸€å€‹ field å¾Œï¼Œè©² field tag ä¹Ÿä¸èƒ½å†è¢«ä½¿ç”¨ï¼Œå› ç‚ºå¯èƒ½é‚„æœ‰èˆŠçš„è³‡æ–™æ˜¯ä½¿ç”¨è€…å€‹ field tag çš„ã€‚\n\n### Datatypes and schema evolution\n\nå°æ–¼åŒæ¨£çš„ fieldï¼Œä¸€äº›è³‡æ–™å‹æ…‹çš„è½‰è®Šæ˜¯ ok çš„ï¼š\n\n- å¾ int32 è®Šæˆ int64 å°æ–¼æ–°ç‰ˆæœ¬ç¨‹å¼æ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œä½†æ˜¯èˆŠç‰ˆæœ¬ç¨‹å¼è‹¥è®€åˆ° int64 çš„è³‡æ–™å°±æœƒéºå¤±é«˜ä½çš„ bitsã€‚\n- åœ¨ protobuf ä¸­ä½¿ç”¨ `repeated` ä½œç‚º array typeï¼Œè€Œå¯¦éš›ä¸Šè¢« encode æ™‚å¯ä»¥çœ‹åˆ°åªæ˜¯ç›¸åŒçš„ field tag å‡ºç¾å¤šæ¬¡è€Œå·²ï¼Œå› æ­¤åœ¨ protobuf ä¸­æŠŠ `optional` è½‰æˆ `repeated` æ˜¯å¯ä»¥çš„ã€‚æ–°ç‰ˆæœ¬å¯ä»¥è®€åˆ°èˆŠçš„è³‡æ–™ï¼Œè€ŒèˆŠç‰ˆæœ¬åªæœƒè®€åˆ° list ä¸­çš„æœ€å¾Œä¸€ç­†è³‡æ–™ã€‚è€Œåœ¨ thrift ä¸­æœ‰ list çš„ typeï¼Œå› æ­¤æ˜¯ç„¡æ³•åšè½‰è®Šçš„ã€‚\n\n## Arvo\n\nApache Arvo æ˜¯å¦ä¸€ç¨®èˆ‡ Thrift å’Œ Protocol Buffers ä¸å¤ªä¸€æ¨£çš„ binary encoding æ ¼å¼ã€‚Arvo ä¹Ÿä½¿ç”¨ schemaï¼Œæœ‰æ¯”è¼ƒé©åˆäººé¡ä½¿ç”¨çš„ Arvo IDL èˆ‡æ¯”è¼ƒé©åˆç¨‹å¼ä½¿ç”¨çš„ JSON æ ¼å¼ï¼š\n\n```arvo\nrecord Person {\n\tstring userName;\n\tunion { null, long } favoriteNumber = null;\n\tarray<string> interests;\n}\n```\n\n```json\n{\n\t\"type\": \"record\",\n\t\"name\": \"Person\",\n\t\"fields\": [\n\t\t{\"name\": \"userName\", \"type\": \"string\"},\n\t\t{\"name\": \"favoriteNumber\", \"type\": [\"null\", \"long\"], \"default\": null},\n\t\t{\"name\": \"interests\", \"type\": {\"type\": \"array\", \"items\": \"string\"}}\n\t]\n}\n```\n\n![Arvo](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/arvo.png)\n\nå¯ä»¥æ³¨æ„åˆ° Arvo æ²’æœ‰ tag numberï¼Œä¸¦ä¸” Arvo åœ¨ encode æ™‚ä¹Ÿä¸æœƒå„²å­˜ field nameï¼Œæ‰€ä»¥ encode å’Œ decode æ™‚ schema éœ€è¦åŒ¹é…æ‰èƒ½ä½¿ç”¨ã€‚\n\n### The writer's schema and the reader's schema\n\nEncode èˆ‡ decode å¯ä»¥ä½¿ç”¨ä¸åŒ schemaï¼Œä½† decode æ™‚å¿…é ˆæ“æœ‰ç•¶æ™‚ encode ç”¨çš„ schemaã€‚è€Œ decode ç«¯çš„ schema ç¨±ç‚º *reader's schema*ï¼Œç•¶æ™‚ encode æ‰€ä½¿ç”¨çš„ schema ç¨±ç‚º *writer's schema*ã€‚\n\n![Arvo reader's and writer's schema](/assets/Designing-Data-Intensive-Application-ç¬¬å››ç« ç­†è¨˜/arvo_reader_writer_schema.png)\n\nå¯ä»¥çœ‹åˆ°é€éæ¯”å° field nameï¼Œdecode æ™‚å¯ä»¥ä½¿ç”¨èˆ‡ encode ä¸åŒçš„ schemaã€‚ä¾‹å¦‚ writer's schema ä¸­æœ‰ reader's schema ä¸­ä¸å­˜åœ¨çš„ field `photoURL`ï¼Œå‰‡ reader å¿½ç•¥æ­¤æ¬„ä½ï¼›æˆ–æ˜¯ reader's schema ä¸­æœ‰ writer's schema ä¸­ä¸å­˜åœ¨çš„ field `userID`ï¼Œå‰‡ä½¿ç”¨é è¨­å€¼ã€‚\n\n### Schema evolution rules\n\nArvo ä¸­ï¼š\n\n- Forward compatibilityï¼šèˆŠç‰ˆæœ¬ reader's schema èˆ‡æ–°ç‰ˆæœ¬ writer's schemaã€‚\n- Backward compatibilityï¼šæ–°ç‰ˆæœ¬ reader's schema èˆ‡èˆŠç‰ˆæœ¬ reader's schemaã€‚\n\nè¦åŒæ™‚æ»¿è¶³å…©ç¨®ç›¸å®¹æ€§ï¼Œåªèƒ½æ–°å¢æˆ–åˆªé™¤æœ‰ default value çš„å€¼ã€‚\n\n### But what is the writer's schema\n\né‚£éº¼ writer's schema æœƒå„²å­˜åœ¨å“ªè£¡å‘¢ï¼Ÿæ ¹æ“š Arvo å¸¸è¢«ä½¿ç”¨çš„æƒ…å¢ƒï¼Œæœ‰ä»¥ä¸‹å¹¾ç¨®ä¾‹å­ï¼š\n\n- Fileï¼šå¸¸è¢«ä½¿ç”¨åœ¨ Hadoop ä¸­ï¼ŒHadoop æ˜¯å¤§å‹æª”æ¡ˆç³»çµ±ã€‚å› æ­¤ writer's schema å¯ä»¥ç›´æ¥è¢«å¯«åœ¨æª”æ¡ˆçš„ header ä¸­ã€‚\n- Databaseï¼šåœ¨ database ä¸­ï¼Œæ¯å€‹ rows å¯ä»¥å¤šå„²å­˜ä¸€å€‹ version numberï¼Œå†é€é version number é—œè¯å‡ºå¯«å…¥æ™‚çš„ writer's schemaã€‚\n- Networkï¼šé€éç¶²è·¯å‚³è¼¸çš„è©±ï¼Œå¯ä»¥é€é RPC çš„æ–¹å¼ã€‚\n\n### Dynamically generated schemas\n\nArvo èˆ‡ Thrift æˆ–æ˜¯ Protocol Buffers æœ€å¤§çš„ä¸åŒåœ¨æ–¼ Arvo é©åˆåš *dynamically generated schema*ï¼Œè€Œ Thrift æˆ–æ˜¯ Protocol Buffers å› ç‚ºæœ‰ tag number è¦å°å¿ƒä¸èƒ½é‡è¤‡ä½¿ç”¨åˆ°ï¼Œå› æ­¤é€šå¸¸åªèƒ½æ‰‹å‹•ä¿®æ”¹ schemaã€‚\n\n## The Merits of Schemas\n\nç¸½çµä¾†èªªæœ‰ schemas å¸¶ä¾†ä»¥ä¸‹çš„å¥½è™•ï¼š\n- æœ‰æ›´å¥½çš„å£“ç¸®ç‡ï¼Œå› ç‚ºä¸éœ€è¦å„²å­˜ field nameã€‚\n- æœ¬èº«å°±æ˜¯æœ‰åƒ¹å€¼çš„æ–‡ä»¶ï¼Œå› ç‚º schema å¿…é ˆè·Ÿè‘— code ä¸€èµ·è¢«ç‰ˆæœ¬æ›´æ–°ã€‚\n- ç¶­è­·ä¸€å€‹ schemas çš„è³‡æ–™åº«ï¼Œå¯ä»¥è®“é–‹ç™¼è€…åœ¨éƒ¨ç½²ä¹‹å‰ç¢ºèªæ‰€æœ‰çš„ç›¸å®¹æ€§ã€‚\n- å°æ–¼ statically typed programming languages ä¾†èªªï¼Œcode generation å¯ä»¥å¹«åŠ©ç·¨è­¯æœŸé–“çš„ type checkingã€‚\n\n# Modes of Dataflow\n\næ¥è‘—ä»‹ç´¹ä¸‰ç¨®é¡å‹çš„ Dataflowï¼š\n\n- Via databases\n- Via services\n- Via asynchronous message passing \n\n## Dataflow Through Databases\n\nè³‡æ–™é€²å‡ºè³‡æ–™åº«æ™‚ä¹Ÿéœ€è¦åš encode å’Œ decodeï¼Œå› æ­¤ä¹Ÿè¦è€ƒæ…®ç›¸å®¹å•é¡Œã€‚\n\nå‡è¨­æ–°ç‰ˆæœ¬æ–°å¢äº†ä¸€å€‹ fieldï¼Œä¸¦ä¸”å¯«äº†ä¸€ç­†è³‡æ–™åˆ°è³‡æ–™åº«ã€‚è€ŒèˆŠç‰ˆæœ¬ç¨‹å¼è®€åˆ°é€™ç­†è³‡æ–™å¾Œï¼Œé¸æ“‡ omit ä¸èªè­˜çš„ fieldï¼Œå†æ›´æ–°å›è³‡æ–™åº«ï¼Œé‚£éº¼é€™å€‹æ–°çš„ field ä¸Šé¢çš„å€¼å°±æœƒéºå¤±ã€‚\n\nè¦é¿å…é€™ç¨®æƒ…æ³ï¼Œå¯ä»¥æŒ‡å®šè¦æ›´æ–°çš„ fields è€Œä¸æ˜¯ä¸€æ¬¡æ›´æ–°æ•´ç­†è³‡æ–™ï¼ˆRelational database ä¸­ ORM çš„ Save é€šå¸¸å°±æ˜¯æ›´æ–°ä¸€æ•´ç­†è³‡æ–™ï¼Œå¯ä»¥é€é Update ä¾†æ›´æ–°éœ€è¦çš„æ¬„ä½å°±å¥½ï¼‰ã€‚\n\n## Dataflow Through Services: REST and RPC\n\nç•¶è³‡æ–™å‚³è¼¸éœ€è¦é€é networkï¼Œserver é€šå¸¸æœƒæš´éœ² API åœ¨ç¶²è·¯ä¸Šï¼Œclient å¯ä»¥é€é API å‘ server æ‹¿å–æˆ–æ˜¯é€å‡ºè³‡æ–™ã€‚è€Œ client å¯èƒ½ä¹Ÿæ˜¯ä¸€å€‹ server çš„è§’è‰²ï¼Œé€™ç¨® pattern è¢«ç¨±ä½œ *service-oriented architecture (SOA)*ï¼Œæˆ–æ˜¯è¢«ç¨±ä½œ *microservices*ã€‚*Microservices* çš„ä¸»è¦ç›®çš„ä¹‹ä¸€å°±æ˜¯è®“æ¯å€‹ services éƒ½å¯ä»¥ç¨ç«‹éƒ¨ç½²å’Œæ›´æ–°ï¼Œå› æ­¤ç›¸å®¹æ€§åœ¨ API è¨­è¨ˆä¸Šä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚\n\n### REST\n\nWeb services ä¸»è¦é€é REST ä¾†è¨­è¨ˆ APIï¼Œé€™ç¨®é¡å‹çš„ API è¢«ç¨±ä½œ RESTful APIã€‚\n\n[REST](https://zh.wikipedia.org/wiki/%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2) æ˜¯åŸºæ–¼ HTTP çš„ä¸€ç¨®è¨­è¨ˆæ–¹å¼ï¼Œä½¿ç”¨ URI ä¾†è¾¨è­˜è³‡æºï¼Œå°æ–¼è³‡æºçš„æ“ä½œåŒ…å«å–å¾—ã€å»ºç«‹ã€ä¿®æ”¹å’Œåˆªé™¤ï¼Œæ°å¥½å°æ‡‰åˆ° HTTP çš„ `GET`ã€`POST`ã€`PUT` å’Œ `DELETE`æ–¹æ³•ã€‚\n\nåœ¨ç‰ˆæœ¬æ›´æ–°æ™‚ï¼Œè‹¥ç„¡æ³•åšåˆ°ç›¸å®¹ï¼ŒRESTful APIs é€šå¸¸é€é URI ä¸­çš„ version number ä¾†æä¾›å¤šç‰ˆæœ¬çš„ APIsã€‚\n\n### RPC\n\næ—©æœŸçš„ RPC è¨­è¨ˆå¸Œæœ›ç¶²è·¯çš„è«‹æ±‚ä½¿ç”¨èµ·ä¾†è·Ÿå‘¼å« local function å¾ˆåƒï¼Œä½†å…¶å¯¦é€™å¾ˆé›£åšåˆ°ï¼Œå› ç‚ºæœ‰ä»¥ä¸‹çš„å·®åˆ¥ï¼š\n\n- Local function æ˜¯å¯é æœŸçµæœçš„ï¼ŒRPC å¯èƒ½å› ç‚º network issue æœ‰å¾ˆå¤šç„¡æ³•é æœŸçš„çµæœï¼ˆä¾‹å¦‚éºå¤±ã€ç­‰å¾…å¾ˆä¹…æ‰å›æ‡‰...ï¼‰ã€‚\n- RPC åœ¨é‡åˆ° error æ™‚å¯ä»¥é‡è©¦ï¼Œä½†æ˜¯ä¸Šä¸€æ¬¡çš„çµæœå¯èƒ½æ˜¯æˆåŠŸçš„ï¼Œåªæ˜¯æ²’æœ‰æˆåŠŸå›æ‡‰çµæœã€‚é‡è©¦å°±è¦é¿å…ä¸€äº›ç„¡æ³•é‡è¤‡åŸ·è¡Œçš„è«‹æ±‚é‡è¤‡åŸ·è¡Œã€‚\n- Local function æ¯æ¬¡åŸ·è¡Œæ™‚é–“å·®ä¸å¤šï¼›RPC æ¯æ¬¡åŸ·è¡Œæ™‚é–“å¯èƒ½è¢« network latency å½±éŸ¿è€Œå·®åˆ¥å¾ˆå¤§ã€‚\n- Local function å¯ä»¥ä½¿ç”¨ pointers æˆ–æ˜¯ referencesï¼›RPC éœ€è¦å°‡åƒæ•¸è½‰æ›æˆ sequence of bytesã€‚\n\né›–ç„¶ RPC æœ‰ä¸Šé¢æåˆ°çš„é€™äº›å•é¡Œï¼Œä½†æ˜¯æ–°å‹çš„ RPC frameworks ä¸¦æ²’æœ‰å°±æ­¤æ²’è½ï¼Œä¾‹å¦‚ Google gRPCã€‚å› ç‚ºé€™äº›æ–°å‹çš„ RPC frameworks æ›´æ˜ç¢ºçš„å€åˆ† RPC ä¸¦ä¸æ˜¯ä¸€ç¨® local function callï¼Œä¾‹å¦‚ [Finagle](https://twitter.github.io/finagle/) æä¾› `futures` ä¾†å°è£å¯èƒ½å¤±æ•—çš„è«‹æ±‚ã€‚\n\ngRPC ä½¿ç”¨ protocol buffers encodingï¼Œæ¯”èµ· REST JSON æœ‰æ›´å¥½çš„æ•ˆèƒ½ã€‚ä½†æ˜¯ç¼ºé»åœ¨æ–¼ä¸æ˜“ debug èˆ‡å¯¦é©—ï¼Œå› ç‚º RPC æ¸¬è©¦é€šå¸¸éœ€è¦é€éç¨‹å¼æˆ–æ˜¯ code generation å·¥å…·ã€‚\n\nRPC ä¸­è‹¥ä½¿ç”¨ Thrift æˆ–æ˜¯ Protocol Buffersï¼Œå‰‡å¯ä»¥ä¾ç…§ schema evolution çš„è¦å‰‡ä¾†åšåˆ°ä¸Šä¸‹ç›¸å®¹ã€‚\n\n## Message-Passing Dataflow\n\nREST & RPC éƒ½é€éç¶²è·¯å‚³éè¨Šæ¯ä¸¦æœŸæœ›åœ¨çŸ­æ™‚é–“å¾—åˆ°å›æ‡‰ã€‚\n\n*Asynchronous message-passing systems*ï¼Œé€éå°‡è³‡æ–™é€åˆ°ä¸€å€‹ä¸­ä»‹çš„ *message-broker (message queue, MQ)* æš«æ™‚å„²å­˜ï¼Œå†è½‰å‚³çµ¦å…¶ä»–æœå‹™ã€‚ä½¿ç”¨ message queue æœ‰ä»¥ä¸‹çš„å„ªé»ï¼š\n\n- å¦‚æœæ¥æ”¶è€…æš«æ™‚ç„¡æ³•å›æ‡‰ï¼Œè³‡æ–™å¯ä»¥ç·©å­˜åœ¨ MQ è£¡é¢ï¼Œæé«˜å¯ç”¨æ€§ã€‚\n- å¦‚æœè³‡æ–™æ²’æœ‰é€åˆ° MQ å¯ä»¥å¹«åŠ©é‡é€è¨Šæ¯ï¼Œåšåˆ° at-least-once deliveryã€‚\n- å¯ä»¥è®“ senders ä¸éœ€è¦çŸ¥é“ receivers çš„ä½ç½®ã€receivers ä¹Ÿä¸éœ€è¦çŸ¥é“ senders çš„ä½ç½®ã€‚å°‡å…©é‚Šçš„é‚è¼¯åˆ†é–‹ï¼Œsenders åªéœ€è¦å°ˆæ³¨åœ¨é€å‡ºçš„è¨Šæ¯ï¼Œè€Œ receivers åªéœ€è¦å°ˆæ³¨åœ¨è¨‚é–±ä¸¦è™•ç†æ¥æ”¶åˆ°çš„è¨Šæ¯ã€‚\n- å¯ä»¥é€éç¯©é¸æˆ–æ˜¯è¨‚é–±å°‡è¨Šæ¯é€çµ¦å¤šå€‹ receiversã€‚\n\nä¸€äº›ä¼æ¥­ç´šã€è‘—åçš„ Message Queue åŒ…æ‹¬ RabbitMQã€NATS ä»¥åŠ Apache Kafkaã€‚\n\n# Summary\n\næœ¬ç« ç¯€ä»‹ç´¹äº†å„ç¨®å¸¸è¦‹çš„ encoding formatsï¼Œæå‡ºä»–å€‘åœ¨æ•ˆèƒ½ä¸Šçš„ä¸åŒï¼Œä»¥åŠå°æ–¼ç³»çµ±æ¶æ§‹èˆ‡ç›¸å®¹æ€§çš„å½±éŸ¿ã€‚\n\n- Programming language-specific formatsï¼šé€šå¸¸åªé™æ–¼ä¸€ç¨®èªè¨€ä¸­ä½¿ç”¨ï¼Œä¸¦ä¸”é€šå¸¸ä¸èƒ½åšåˆ°ç›¸å®¹æ€§ã€‚\n- Texture formatsï¼šä¾‹å¦‚ JSONã€XMLï¼Œé€™äº›æ ¼å¼é€šå¸¸å°å‹æ…‹çš„å®šç¾©å¾ˆæ¨¡ç³Šï¼Œä½¿ç”¨æ™‚è¦ç‰¹åˆ¥æ³¨æ„ã€‚\n- Binary schema-driven formatsï¼šä¾‹å¦‚ Thriftã€Protocol Buffersï¼Œé€™äº›æ ¼å¼èƒ½å°‡è³‡æ–™å£“ç¸®çš„æ›´å°ï¼Œä¸¦ä¸”æä¾›ä¸Šä¸‹ç›¸å®¹çš„èƒ½åŠ›ã€‚å¦å¤– schema æœ¬èº«èƒ½å¤ ç”¢ç”Ÿæ–‡ä»¶ï¼Œä½†æ˜¯å£è™•æ˜¯ encoding å¾Œçš„çµæœä¸æ˜¯ human-readable çš„ã€‚\n\nå¦å¤–ä»‹ç´¹äº†ä¸‰ç¨® dataflowï¼š\n\n- Databasesï¼šå¯«çš„ process encode è³‡æ–™ï¼Œè®€çš„ process decode è³‡æ–™ã€‚\n- RPC and REST APIsï¼šServer ç«¯ encode è³‡æ–™ï¼Œclient ç«¯ decode è³‡æ–™ã€‚\n- Asynchronous message passingï¼šSender ç«¯ encode è³‡æ–™ï¼Œreceiver ç«¯ decode è³‡æ–™ã€‚\n\næœ€å¾Œï¼Œä¸ç®¡å“ªç¨® dataflowï¼Œä¸ç®¡æ˜¯ server-side é‚„æ˜¯ client-side æ‡‰ç”¨ï¼Œéƒ½æœƒæœ‰ä¸Šä¸‹ç›¸å®¹çš„å•é¡Œï¼Œæ›´æ–°æ‡‰ç”¨æ™‚å¤šæ³¨æ„ç›¸å®¹æ€§å•é¡Œï¼Œæ‡‰ç”¨å°±å¯ä»¥é »ç¹çš„æ›´æ–°èˆ‡éƒ¨ç½²äº†ã€‚\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Notes","DDIA"],"categories":["Notes"]},{"title":"Designing Data-Intensive Application ç¬¬ä¸‰ç« ç­†è¨˜","url":"/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/","content":"\næœ¬ç« ç¯€é¦–å…ˆä»‹ç´¹è³‡æ–™åº«çš„ storage engine æ˜¯å¦‚ä½•å„²å­˜è³‡æ–™ï¼Œä½¿å¾—æŸ¥è©¢å¯ä»¥è®Šå¾—æ›´å¿«é€Ÿã€‚ä¸¦ä»‹ç´¹å…©ç¨®å¸¸è¢«è³‡æ–™åº«ä½¿ç”¨çš„è³‡æ–™çµæ§‹ *LSM-Tree* ä»¥åŠ *B-Tree*ã€‚\n\nå†ä¾†æ·ºè«‡ä¸€èˆ¬ç”¨æ–¼ç¶²è·¯æœå‹™çš„è³‡æ–™åº«èˆ‡è³‡æ–™åˆ†æç”¨çš„è³‡æ–™åº«çš„è¨­è¨ˆç†å¿µæœ‰ä»€éº¼ä¸åŒã€‚\n\næœ€å¾Œä»‹ç´¹è¼ƒä¸å¸¸è¦‹çš„ *column-oriented database* çš„å„ªç¼ºé»ã€è¨­è¨ˆä»¥åŠä½¿ç”¨æƒ…å¢ƒã€‚\n\n![image source: https://www.omnisci.com/technical-glossary/columnar-database](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/column_vs_row_db.png)\n\né‚£èº«ç‚ºè³‡æ–™åº«çš„ä½¿ç”¨è€…ï¼Œç‚ºä»€éº¼éœ€è¦çŸ¥é“è³‡æ–™åº«çš„ storage engine æ˜¯å¦‚ä½•è¨­è¨ˆçš„å‘¢ï¼Ÿé™¤äº†è¦é¸å‡ºæœ€é©åˆçš„è³‡æ–™åº«ä¹‹å¤–ï¼Œç‚ºäº†è¦å°è³‡æ–™åº«æ€§èƒ½é€²è¡Œèª¿æ ¡ï¼Œä¹Ÿå¿…é ˆäº†è§£è³‡æ–™åº«åº•å±¤æ˜¯å¦‚ä½•å„²å­˜è³‡æ–™çš„ï¼Œæ‰èƒ½æ ¹æ“šä½¿ç”¨æƒ…æ³åšå‡ºæœ€å¥½çš„é¸æ“‡ã€‚\n\n<!-- More -->\n\n# Data Structures That Power Your Database\n\né€™æ•´å€‹æ®µè½æœƒä»¥ä¸€å€‹ç°¡å–®çš„ key-value è³‡æ–™åº«ä¾†è¨è«–å„²å­˜è³‡æ–™çš„æ–¹å¼ã€‚\n\né€™å€‹è³‡æ–™åº«å¿…é ˆæ”¯æ´å…©ç¨®æœ€åŸºæœ¬çš„æ“ä½œï¼š\n\n- `set(k, v)`ï¼šæŠŠ key `k` è¨­æˆå€¼ `v`ã€‚\n- `get(k)`ï¼šæŸ¥è©¢ key ç‚º `k` çš„å€¼ã€‚\n\né¦–å…ˆæœ€ç°¡å–®çš„åšæ³•å³æ¯æ¬¡ `set(k, v)` æ™‚å°‡ä¸€ç­† log æ’å…¥åˆ°æª”æ¡ˆçš„æœ€å¾Œä¸€è¡Œã€‚æŸ¥è©¢ `get(k)` æ™‚å¯ä»¥é€é sequence scan åœ¨æª”æ¡ˆä¸­ç”¨ $O(N)$ çš„æ™‚é–“æ‰¾åˆ°ç´€éŒ„ã€‚\n\nç•¶ç„¶ä¸€èˆ¬çš„è³‡æ–™åº«ä¸¦ä¸æœƒé€™æ¨£è¨­è¨ˆï¼Œå› ç‚ºé‚„å¿…é ˆè€ƒæ…®æ•ˆèƒ½ã€å„²å­˜ç©ºé–“ã€ä¸¦ç™¼ç­‰å•é¡Œï¼Œä½†æ˜¯å¯« log åœ¨è³‡æ–™åº«ä¸­æ˜¯å¾ˆå¸¸è¦‹çš„è¡Œç‚ºã€‚\n\n`O(N)` çš„æŸ¥è©¢ä¸æ˜¯å¾ˆæœ‰æ•ˆç‡ï¼Œè³‡æ–™åº«é€šå¸¸æœƒé€šé *index* ä¾†åŠ å¿«æŸ¥è©¢çš„é€Ÿåº¦ï¼Œindex çš„è¨­è¨ˆå³æ˜¯é€éå„²å­˜ä¸€äº›é¡å¤–çš„è³‡è¨Šä¾†å¹«åŠ©å¿«é€Ÿçš„æŸ¥æ‰¾è³‡æ–™ï¼Œå› æ­¤ä¸åŒçš„æŸ¥è©¢é€šå¸¸å°±éœ€è¦ä¸åŒçš„ indexã€‚\n\né›–ç„¶**å¥½çš„ index å¯ä»¥æå‡æŸ¥è©¢çš„é€Ÿåº¦ï¼Œä½†æ˜¯æ¯å€‹ index éƒ½æœƒé™ä½å¯«å…¥çš„é€Ÿåº¦**ï¼Œå› æ­¤èº«ç‚ºä¸€å€‹å¥½çš„å·¥ç¨‹å¸«è¦ä¹Ÿè¦å° index çš„é¸æ“‡åšå‡ºå¥½çš„æ±ºå®šã€‚\n\n## Hash Indexes\n\næˆ‘å€‘å¯ä»¥é€é in-memory hash table å°‡ key å°æ‡‰åˆ°å…¶çœŸæ­£åœ¨æª”æ¡ˆçš„ byte offsetï¼Œå¦‚æ­¤ä¸€ä¾†å°±å¯ä»¥åœ¨ $O(1)$ çš„æ™‚é–“æ‰¾åˆ° key çš„ä½ç½®ï¼Œå†é€é disk IO ç›´æ¥è®€å–è³‡æ–™ï¼›ä¸¦ä¸”åªè¦åœ¨ `set(k, v)` æ™‚åªè¦é †ä¾¿æ›´æ–° hash map å³å¯ã€‚\n\nHash index ä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ï¼š\n- Hash table è¦è¢«æ•´å€‹æ”¾é€² memory æ‰èƒ½æœ‰å¥½çš„æ•ˆèƒ½ï¼Œæ‰€ä»¥è³‡æ–™éå¤šæ™‚ memory å¯èƒ½ä¸å¤ ç”¨ã€‚\n- ä¸èƒ½åšç¯„åœçš„æŸ¥è©¢ï¼Œä¾‹å¦‚ key æ˜¯æ™‚é–“æˆ³çš„è©±ï¼Œhash index æ²’æœ‰è¾¦æ³•æŒ‡å®šæŸ¥è©¢ä¸€æ®µæ™‚é–“å…§çš„è³‡æ–™ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/hashmap.png)\n\nå¦å¤–ï¼Œç‚ºäº†é¿å…ä¸æ–·æ’å…¥è³‡æ–™é€ æˆæª”æ¡ˆç„¡é™å¢å¤§ï¼Œé€šå¸¸å¯ä»¥åšå…©ä»¶äº‹æƒ…ï¼š\n\n1. Segmentï¼šæ¯ç•¶æª”æ¡ˆé”åˆ°ä¸€å®šçš„å¤§å°ï¼Œå°±å¯«åˆ°ä¸€å€‹æ–°çš„æª”æ¡ˆï¼ˆsegment fileï¼‰ã€‚\n2. Compactionï¼šå°æ–¼ç›¸åŒçš„ keyï¼Œå¯ä»¥åªä¿ç•™æœ€æ–°çš„ç´€éŒ„ã€‚åšå®Œ compaction å¾Œ segment çš„å¤§å°æœƒè®Šå°ï¼Œå› æ­¤ä¹Ÿå¯ä»¥åŒæ™‚åš merge segment + compactionã€‚\n\næœ‰å¤šå€‹æª”æ¡ˆå¾Œï¼Œæ¯å€‹ segment éƒ½å¿…é ˆç¶­è­·ä¸€å€‹ in-memory hash tableï¼Œ`get(k)` æ™‚å¾æœ€æ–°çš„æª”æ¡ˆé–‹å§‹å°‹æ‰¾ï¼Œå› ç‚ºæœ‰åš merge segment çš„æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥é¿å…æª”æ¡ˆæ•¸é‡éå¤šã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/merge_segment_compaction.png)\n\nä¸Šè¿°çš„åšæ³•åœ¨ [Bitcask](https://en.wikipedia.org/wiki/Bitcask)ï¼Œä¸€å€‹å¿«é€Ÿçš„æ—¥èªŒå‹éµå€¼è³‡æ–™åº«ä¸­è¢«ä½¿ç”¨ã€‚ä½†æ˜¯å¯¦å‹™ä¸Šé‚„æœ‰å¹¾å€‹å•é¡Œè¦è™•ç†ï¼š\n\n- File formatï¼šå¯ä»¥å…ˆ encode å­—ä¸²æˆ bytes å†å„²å­˜ï¼Œæœƒæ›´åŠ æœ‰æ•ˆç‡ã€‚\n- Deleting recordsï¼šå¯ä»¥åœ¨ log ä¸­ç´€éŒ„ä¸€å€‹ç‰¹åˆ¥çš„åˆªé™¤ç´€éŒ„ï¼Œè®“ merge segment æ™‚å¯ä»¥çŸ¥é“ key ä¸è¢«ä¿ç•™ã€‚\n- Crash recoveryï¼šå¦‚æœè³‡æ–™åº«é‡å•Ÿï¼Œæ‰€æœ‰ in-memory hash table éƒ½æœƒä¸è¦‹ã€‚å¯ä»¥é€éå¾é ­è®€å– segment files ä¾†æ¢å¾© hash tableï¼Œä½†æ˜¯æœƒèŠ±å¾ˆä¹…çš„æ™‚é–“ã€‚å¯¦éš›ä¸Šå¯ä»¥é€éå®šæœŸçš„å° hash table é€²è¡Œ snapshot ä¾†å¿«é€Ÿçš„æ¢å¾©è³‡æ–™åº«ã€‚\n- Partially written recordsï¼šè³‡æ–™åº«éš¨æ™‚éƒ½æœ‰å¯èƒ½é‡å•Ÿï¼Œé‡å•Ÿå¯èƒ½é€ æˆå¯«åˆ°ä¸€åŠçš„ logï¼Œé€é checksum å¯ä»¥åµæ¸¬åˆ°éŒ¯èª¤çš„ log ä¸¦å¿½ç•¥ã€‚\n- Concurrency controlï¼šåªèƒ½æœ‰ä¸€å€‹å¯«å…¥ç·šç¨‹ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šå€‹è®€å–ç·šç¨‹ã€‚\n\n## SSTables and LSM-Trees\n\nå…ˆä¸è€ƒæ…®å¦‚ä½•åšåˆ°ï¼Œå‡è¨­è¦æ±‚å¯«å…¥ segment files æ™‚ï¼Œæ‰€æœ‰çš„ç´€éŒ„å¿…é ˆ *sorted by key*ï¼Œä¸¦ä¸”ç›¸åŒçš„ key åªå‡ºç¾ä¸€æ¬¡ï¼Œé€™æ¨£çš„æ ¼å¼å°±ç¨±ä½œ *Sorted String Table* æˆ–æ˜¯ç°¡ç¨± *SSTable\b\b\b*ã€‚å¦‚æ­¤ä¸€ä¾†å¯ä»¥å¾—åˆ°å¹¾å€‹å¥½è™•ï¼š\n\n- Merge segment files + compaction è®Šå¾—æ›´ç°¡å–®ï¼Œå¯ä»¥é€éé¡ä¼¼ *mergesort* åˆä½µæ™‚çš„æ–¹å¼ä¾†åˆä½µæª”æ¡ˆï¼ˆåˆ©ç”¨å¤šå€‹æŒ‡æ¨™æŒ‡å‘æª”æ¡ˆçš„é ­ï¼Œæ¯æ¬¡æŒ‘æœ€å°çš„ key å‡ºä¾†å°‡ç´€éŒ„åŠ å…¥åˆ°æ–°çš„æª”æ¡ˆï¼Œä¸¦å°‡è©²æŒ‡æ¨™å‘å¾Œç§»å‹•ä¸€æ ¼ï¼‰ã€‚ä¸¦ä¸”ç•¶ key ç›¸åŒæ™‚ï¼Œå¯ä»¥åªä¿ç•™è¼ƒæ–°æª”æ¡ˆå…§çš„ç´€éŒ„å³å¯ã€‚\n- å¯ä»¥åš sparse hash tableï¼Œåªå„²å­˜éƒ¨åˆ†çš„ key åœ¨ in-memory hash table ä¸­ï¼Œ`get(k)` æ™‚åªè¦æŸ¥åˆ° `k` åœ¨ hash map ä¸­çš„ä¸Šä¸€å€‹ï¼†ä¸‹ä¸€å€‹ keyï¼Œå³å¯ä»¥ç¢ºèª `k` å‡ºç¾çš„ç¯„åœã€‚å¦‚æ­¤ä¸€ä¾†å°±å¯ä»¥é¿å… hash table è¶…é memory å¤§å°ä¸Šé™çš„å•é¡Œã€‚\n\t![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/sstable_sparse_index.png)\n- å¯ä»¥åš range queryï¼Œå› ç‚ºæª”æ¡ˆæ˜¯æ ¹æ“š key æ’åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸€æ¬¡å°‡æŸå€‹ key range å…§çš„ç´€éŒ„è®€å‡ºã€‚\n\n### Constructing and maintaining SSTables\n\næ‰€ä»¥ç¾åœ¨ä¾†æ¢è¨å¦‚ä½•åšåˆ°å¼·åˆ¶ segment files å…§çš„æ‰€æœ‰ç´€éŒ„å¿…é ˆ *sorted by key*ã€‚\n\né€é in-memory çš„è‡ªå¹³è¡¡äºŒå…ƒæœå°‹æ¨¹ï¼Œä¾‹å¦‚ [*AVLæ¨¹*](https://zh.wikipedia.org/zh-tw/AVL%E6%A0%91) æˆ–æ˜¯ [*ç´…é»‘æ¨¹*](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91)ï¼Œæˆ‘å€‘å¯ä»¥å¾ˆç°¡å–®çš„åœ¨ memory ç¶­è­·ä¸€å€‹å¯æŸ¥è©¢ã€å¯æ’å…¥ï¼Œä¸¦ä¸”å¾ˆæœ‰æ•ˆç‡çš„è³‡æ–™çµæ§‹ã€‚\n\né€éé€™æ¨£çš„è³‡æ–™çµæ§‹ï¼Œå¯ä»¥å°‡è™•ç†è³‡æ–™çš„æµç¨‹æ”¹ç‚ºï¼š\n\n- `set(k, v)` æ™‚ï¼Œç›´æ¥æ’å…¥åˆ° in-memory çš„è³‡æ–™çµæ§‹ä¸­ï¼Œé€šå¸¸é€™ç¨® in-memory tree å«åš *memtable*ã€‚\n- ç•¶ memtable è¶…éä¸€å®šå¤§å°æ™‚ï¼Œå¯ä»¥åœ¨ $O(N)$ çš„æ™‚é–“ä¾ç…§ key çš„æ’åºéæ­·æ•´å€‹ memtableï¼Œå°‡è³‡æ–™å¯«å…¥åˆ°æ–°çš„ SSTable segment file ä¸­ã€‚ç•¶ SSTable æ­£åœ¨å¯«å…¥æ™‚ï¼Œæ‰€æœ‰çš„ `set(k, v)` éƒ½å¯«å…¥åˆ°æ–°çš„ memtable ä»¥é¿å… concurrency çš„å•é¡Œã€‚\n- `get(k)` æ™‚ï¼Œå…ˆæ‰¾ memtableï¼Œå†æ‰¾æœ€æ–°çš„ SSTableï¼Œå†æ‰¾æ¬¡æ–°çš„ SSTable ... ä»¥æ­¤é¡æ¨ã€‚\n- å®šæœŸçš„åœ¨èƒŒæ™¯åŸ·è¡Œ merging & compactionã€‚\n\né€™ç¨®æ–¹å¼å”¯ä¸€çš„å•é¡Œæ˜¯ç•¶è³‡æ–™åº«é‡å•Ÿæ™‚ï¼Œmemtable å…§çš„è³‡æ–™æœƒå…¨éƒ¨ä¸è¦‹ã€‚çˆ²äº†ç¶­è­· durabilityï¼Œå¯ä»¥é€éå¦å¤–çš„ log ç´€éŒ„ `set(k, v)`ï¼Œåƒ…ä½œç‚º recovery æ™‚æ¢å¾© memtable ä½¿ç”¨ï¼Œå› æ­¤ç•¶ memtable çš„è³‡æ–™ç¢ºèªå¯«å…¥ SSTable å¾Œï¼Œç›¸å°çš„ log å³å¯åˆªé™¤ã€‚\n\n### Making an LSM-tree out of SSTables\n\nLSM-Tree ä¸€è©æœ€æ—©å‡ºç¾ï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨ log-structuredï¼Œä¸¦ä¸”ä½¿ç”¨ merging å’Œ compaction sorted files çš„ storage engineã€‚\n\nå› æ­¤ SSTables å…¶å¯¦æ˜¯ LSM-Trees çš„ä¸€ç¨®å¯¦ä½œï¼Œæœ€æ—©åœ¨ [Google Bigtable çš„è«–æ–‡](https://storage.googleapis.com/pub-tools-public-publication-data/pdf/68a74a85e1662fe02ff3967497f31fda7f32225c.pdf) ä¸­å‡ºç¾ï¼Œå¾Œä¾†è¢«ä½¿ç”¨åœ¨ LevelDBã€RocksDBã€[Cassandra](https://cassandra.apache.org/doc/latest/cassandra/architecture/storage_engine.html) å’Œ [HBase](https://hbase.apache.org/book.html#_hfile_format) ç­‰è³‡æ–™åº«ä¸­ã€‚\n\n### Performance optimizations\n\næŸ¥è©¢ä¸å­˜åœ¨çš„ key å¿…é ˆéæ­· memtable ä»¥åŠæ‰€æœ‰çš„ SSTablesï¼Œå¯èƒ½æœƒå¾ˆèŠ±æ™‚é–“ã€‚å¯ä»¥é€é Bloom filterï¼Œä¸€å€‹ç©ºé–“ã€æ™‚é–“æ•ˆç‡æ¥µä½³ï¼Œå¯ä»¥ç”¨æ–¼åˆ¤æ–·ä¸€å€‹å€¼æ˜¯å¦å­˜åœ¨çš„è³‡æ–™çµæ§‹ï¼Œç¼ºé»æ˜¯ç„¡æ³•åšåˆªé™¤ï¼Œä»¥åŠæœ‰æ©Ÿç‡å°‡ä¸å­˜åœ¨çš„è³‡æ–™èª¤åˆ¤æˆå­˜åœ¨ã€‚\n\nå¦å¤–ï¼Œåœ¨ compaction strategy æ–¹é¢ï¼Œä¸»è¦åˆ†ç‚º [*sized-tiered*](https://docs.scylladb.com/kb/compaction/#size-tiered-compaction-strategy-stcs) èˆ‡ [*leveled-tiered*](https://docs.scylladb.com/kb/compaction/#leveled-compaction-strategy-lcs) å…©ç¨®æ–¹å¼ï¼Œåœ¨ [ScyllaDB çš„æ–‡æª”](https://docs.scylladb.com/kb/compaction/#compaction)ä¸­æœ‰å¾ˆè©³ç´°çš„ä»‹ç´¹å„ç¨® compaction æ–¹å¼ï¼Œé€™è£¡å°±ä¸å¤šæäº†ã€‚\n\n## B-Trees\n\nå†ä¾†ä»‹ç´¹æœ€å¸¸è¢«è³‡æ–™åº«ä½¿ç”¨çš„ index *B-Tree*ã€‚\n\nB-Trees èˆ‡ SSTables ä¸€æ¨£å°‡è³‡æ–™æ’åºå„²å­˜ï¼Œä½†æ˜¯ B-Trees ä¸åƒ SSTables å„²å­˜ä¸å®šå¤§å°çš„æª”æ¡ˆï¼Œè€Œæ˜¯å°‡è³‡æ–™ï¼ˆæ¯ä¸€å€‹ b-tree ç¯€é»ï¼‰å„²å­˜é€² fixed-size çš„ blocks/pages ä¸­ï¼Œæ¯æ¬¡éƒ½ä»¥ä¸€å€‹ page ç‚ºå–®ä½é€²è¡Œè®€å¯«ï¼Œå› æ­¤æ›´ç¬¦åˆç¡¬ç¢Ÿçš„è¨­è¨ˆã€‚\n\nB-Tree æ˜¯ä¸€ç¨®è‡ªå¹³è¡¡çš„æ¨¹ï¼Œå…ˆä»‹ç´¹ B-Tree çš„ä¸€äº›æ€§è³ªï¼š\n- æ¯ä¸€å€‹éè‘‰ç¯€é»æœƒå„²å­˜ä¸€äº› sorted çš„ keysï¼Œæ¯å€‹ç¯€é»æœ€å¤šå„²å­˜ $m$ å€‹ keysï¼Œå¯ä»¥åˆ†éš”å‡º $m+1$ å€‹å€é–“ï¼Œæ¯å€‹å€é–“æœƒæœ‰ä¸€å€‹ reference pointer æŒ‡å‘å­ç¯€é»ã€‚é€šå¸¸ $m+1$ æœƒè¢«ç¨±ä½œ b-tree çš„åˆ†æ”¯å› å­ï¼ˆbranching factorï¼‰ã€‚\n\t![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/b-tree.png)\n- æ‰€æœ‰çš„è‘‰ç¯€é»éƒ½åœ¨åŒæ¨£çš„é«˜åº¦ï¼Œå„²å­˜çœŸæ­£çš„å€¼ã€‚\n- é™¤äº†æ ¹ä¹‹å¤–çš„éè‘‰ç¯€é»éƒ½è‡³å°‘æœ‰ $\\lceil m/2\\rceil-1$ å€‹ keysï¼Œè€Œæ ¹ç¯€é»æœ€å°‘åªè¦æœ‰ $1$ å€‹ keyã€‚\n\næŸ¥è©¢ `get(k)` æ™‚ï¼Œå¾ b-tree çš„æ ¹é–‹å§‹å¯ä»¥é€éæ’åºçš„ key ä¾†ç¢ºå®šè³‡æ–™æ˜¯å­˜åœ¨å“ªä¸€å€‹å­ç¯€é»ä¸­ï¼Œä¸€ç›´åˆ° b-tree çš„è‘‰ç¯€é»å°±å¯ä»¥æ‰¾åˆ°è³‡æ–™çœŸæ­£çš„ä½ç½®ã€‚\n\n`set(k, v)` æ™‚ï¼š\n- è‹¥ `k` å·²å­˜åœ¨ï¼Œåªè¦æ‰¾åˆ°å„²å­˜ä½ç½®å†è¦†è“‹æ‰ value å³å¯ã€‚\n- è‹¥ `k` ä¸å­˜åœ¨ï¼Œå…ˆæ‰¾åˆ° key å°æ‡‰çš„è‘‰ç¯€é»ï¼Œå†å°‡æ–°çš„å€¼æ’å…¥åˆ°è‘‰ç¯€é»å³å¯ï¼Œä½†è‹¥è‘‰ç¯€é»ç©ºé–“ä¸è¶³ï¼Œå–è‘‰ç¯€é»ä¸­é–“çš„ key å‡ºä¾†ï¼Œå°‡è‘‰ç¯€é»åˆ†æˆå…©åŠå„²å­˜åˆ°å…©å€‹æ–°çš„ page ä¸Šï¼Œå†å°‡ä¸­é–“çš„ key æ’å…¥åˆ°ä¸Šå±¤ç¯€é»å³å¯ï¼Œä¸¦æ›´æ–°å…©å€‹æŒ‡æ¨™æŒ‡åˆ°å…©å€‹æ–°çš„è‘‰ç¯€é»ã€‚ç•¶ç„¶ï¼Œå¦‚æœä¸Šå±¤ç¯€é»ç©ºé–“ä¹Ÿä¸å¤ ï¼Œå°±æœƒå†åšä¸€æ¬¡ split & update parent node çš„å‹•ä½œã€‚\n\t![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/b-tree_growing.png)\n\nB-tree çš„ branching factor é€šå¸¸æœƒæ˜¯å¹¾ç™¾ï¼Œå› æ­¤å¯ä»¥è®“æ¨¹çš„é«˜åº¦ç¶­æŒåœ¨ 3 ~ 4 å±¤ï¼Œå¾è€ŒåŠ å¿«å­˜å–é€Ÿåº¦ï¼ˆä¸€å€‹ 4 å±¤ã€4KB Pageã€branching factor 500 çš„ b-tree å¯ä»¥å„²å­˜è¶…é 256TB çš„è³‡æ–™ï¼‰ã€‚\n\n### Making B-trees reliable\n\nä¸€å€‹ transaction å¯èƒ½åŒæ™‚å°å¤šå€‹ pages é€²è¡Œå¯«å…¥ï¼Œè‹¥æ–·é›»å¯èƒ½æœƒé€ æˆå¯«å…¥ä¸å®Œå…¨çš„ç‹€æ³ã€‚å› æ­¤é€šå¸¸æœƒé€é *write-ahead log*ï¼ˆWALï¼‰ï¼Œåœ¨ä¿®æ”¹åŸ·è¡Œä¹‹å‰å…ˆç´€éŒ„ä¸€ç­†ä¿®æ”¹çš„ logï¼Œä»¥ä¾¿åœ¨ recovery çš„æ™‚å€™é€²è¡Œ undo/redoã€‚\n\n## Comparing B-Trees and LSM-Trees\n\næœ€å¾Œåšä¸€äº› B-trees å’Œ LSM-trees çš„æ¯”è¼ƒï¼š\n\n- LSM-trees é€šå¸¸å¯«å…¥è¼ƒå¿«ï¼›B-trees é€šå¸¸è®€å–æ¯”è¼ƒå¿«ã€‚\n- LSM-trees é€šå¸¸æ¯”è¼ƒç¯€çœç©ºé–“ï¼›B-trees æœƒæœ‰ internal fragmentationï¼Œé€ æˆä¸€äº›ç©ºé–“æµªè²»ã€‚\n- LSM-trees çš„ throughput ä¸ç©©å®šï¼Œç•¶ merging + compaction æ™‚å¯èƒ½æœƒä½”æ“šå…¶ä»– queries è¦ä½¿ç”¨çš„ I/O Bandwidthï¼›ç›¸å°ä¾†èªª B-trees å°±è¼ƒç‚ºç©©å®šã€‚\n- LSM-trees çš„ key å¯èƒ½æœƒå‡ºç¾åœ¨å¤šå€‹æª”æ¡ˆä¸­ï¼›è€Œ B-tree çš„ index åªæœƒå‡ºç¾åœ¨ä¸€å€‹ä½ç½®ï¼Œå°æ–¼è³‡æ–™åº«ä¾†èªªæ¯”è¼ƒå¥½åš transaction æ™‚ lock çš„ implementationã€‚\n\n## Other Indexing Structures\n\nä¸Šé¢è¨è«–çš„éƒ½æ˜¯ä»¥ primary key ç•¶ä½œ index çš„åšæ³•ï¼Œé€šå¸¸ç‚ºäº†å…¶ä»–å¸¸ç”¨çš„æŸ¥è©¢ä¹Ÿæœƒåœ¨å…¶ä»–çš„ column ä¸Šé¢å»ºç«‹ *secondary indexes*ï¼Œå¯ä»¥é€é SQL çš„ `CREATE INDEX` å»ºç«‹ã€‚\n\n### Storing values within the index\n\nåœ¨ B-tree çš„è‘‰ç¯€é»ä¸­ï¼Œå„²å­˜çš„å€¼å¯ä»¥æ˜¯ row çœŸæ­£çš„è³‡æ–™ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘ row å„²å­˜ä½ç½®çš„åƒç…§ï¼Œè€ŒçœŸæ­£å„²å­˜è³‡æ–™çš„ä½ç½®é€šå¸¸å«åš *heap file*ã€‚åœ¨æœ‰å¤šå€‹ secondary indexes çš„æƒ…æ³ä¸‹ï¼Œä½¿ç”¨ heap file å¯ä»¥é¿å…é‡è¤‡è³‡æ–™ã€‚\n\næ›´æ–°è³‡æ–™æ™‚ï¼Œåªè¦æ›´æ–° *heap file* çš„å€¼å³å¯ã€‚ä½†å¦‚æœæ›´æ–°çš„ value æ¯”åŸæœ¬é‚„å¤§ï¼Œæœƒé€ æˆæ‰€æœ‰çš„ reference éƒ½éœ€è¦ç§»å‹•ï¼Œé€™æ™‚å¯ä»¥æ›´æ–°æ‰€æœ‰ index çš„åƒç…§ä½ç½®ï¼Œæˆ–æ˜¯åœ¨åŸæœ¬åƒç…§çš„ä½ç½®å†ç•™ä¸€å€‹æ–°çš„ä½ç½®åƒç…§ã€‚\n\nç›´æ¥å„²å­˜ row çœŸæ­£å¾—è³‡æ–™çš„æ–¹å¼å«åš *clustered index*ï¼Œåä¹‹å«åš *non-clustered index*ã€‚\n\n### Multi-column indexes\n\nå¦‚æœæŸ¥è©¢çš„æ¢ä»¶åŒ…å«å¤šå€‹æ¬„ä½ï¼Œé€™æ™‚åªæœ‰ä¸€å€‹æ¬„ä½çš„ index å¯èƒ½å°±ä¸å¤ å¥½ã€‚\n\nå¸¸è¦‹çš„åšæ³•æ˜¯ *concatenated index*ï¼Œç›´æ¥æŠŠå¤šå€‹ column çš„ key é€£æ¥åœ¨ä¸€èµ·æˆç‚ºæ–°çš„ keyï¼Œå› æ­¤é€£æ¥æ˜¯æœ‰é †åºæ€§çš„ã€‚ä¾‹å¦‚ `(lastname, firstname)` çš„ index å°±ç„¡æ³•åŠ é€Ÿå°åªæœ‰ `firstname` çš„æŸ¥è©¢ï¼Œä½†æ˜¯å¯ä»¥åŠ é€Ÿåªæœ‰ `lastname` çš„æŸ¥è©¢ã€‚\n\nå¦ä¸€ç¨®åšæ³•åœ¨åœ°ç†è³‡è¨Šè¼ƒå¸¸è¦‹ï¼Œé€éå¤šå€‹ column çš„ keys è¨ˆç®—æˆä¸€å€‹ç¨ç«‹çš„æ•¸å­—ï¼Œå¯ä»¥å° GEO çš„ç¯„åœæŸ¥è©¢åšåŠ é€Ÿã€‚ä¾‹å¦‚ [R-tree](https://zh.wikipedia.org/wiki/R%E6%A0%91)ã€‚\n\n### Full-text search and fuzzy indexes\n\nFull-text search å…è¨±åœ¨ä¸€ç¯‡å…§æ–‡ä¸­å°‹æ‰¾å–®è©æˆ–æ˜¯å¥å­ï¼Œä¸¦ä¸”å¿½ç•¥æ–‡æ³•ã€å–®è¤‡æ•¸ã€å¤§å°å¯«ç­‰ç­‰ã€‚\n\nElasticSearch ä¸­é€éåˆ†è©ã€éæ¿¾ã€æ–‡æ³•è½‰æ›ç­‰éç¨‹ï¼Œå°‡æ–‡ç«  parse æˆä¸€å€‹å€‹ tokenï¼Œå†åš token å°æ‡‰åˆ°æ–‡ç« çš„[å€’æ’ç´¢å¼•](https://www.elastic.co/guide/cn/elasticsearch/guide/current/inverted-index.html)ï¼ˆinverted indexï¼‰ä¾†é”æˆæœ‰æ•ˆç‡çš„ full-text searchã€‚\n\næ¨¡ç³Šæœå°‹å…è¨±æŸ¥è©¢ edit distance åœ¨ä¸€å®šç¯„åœå…§çš„æ‰€æœ‰å–®è©ï¼Œä¹Ÿå°±æ˜¯å°éŒ¯å­—æœ‰å®¹éŒ¯ã€‚\n\n### Keeping everything in memory\n\nRedis å³ç¾åœ¨å¾ˆå¸¸è¦‹çš„ in-memory è³‡æ–™åº«ï¼Œæ‰€æœ‰çš„è³‡æ–™éƒ½å„²å­˜åœ¨ memory è£¡é¢ï¼Œå› æ­¤å¯ä»¥åšåˆ°ä¸€äº›åœ¨ disk ä¸Šé¢é›£ä»¥å¯¦ä½œçš„è³‡æ–™çµæ§‹ï¼Œä¾‹å¦‚ set æˆ–æ˜¯ priority queueã€‚\n\nåœ¨ memory æœ€å¤§çš„å¥½è™•å°±æ˜¯å¿«ï¼Œä½†å£è™•å°±æ˜¯æ²’æœ‰ durabilityã€‚\n\n# Transaction Processing or Analytics\n\nä¸€èˆ¬äº¤æ˜“ã€ç¤¾äº¤å¹³å°ç­‰ç¶²è·¯æœå‹™éƒ½æœƒç”¨ Database ä¾†å„²å­˜è³‡æ–™ï¼Œé€šå¸¸æ‡‰ç”¨ç¨‹å¼æœƒé¢å°ä½¿ç”¨è€…ï¼Œå¸¸ç”¨ key ä¾†æŸ¥è©¢ä¸€å°éƒ¨åˆ†çš„è³‡æ–™ï¼Œè™•ç†å¤§é‡çš„æ’å…¥èˆ‡æ›´æ–°ã€‚å› ç‚ºé€™äº›æ‡‰ç”¨ç¨‹å¼é€šå¸¸æ˜¯äº’å‹•æ€§çš„ï¼Œæ‰€ä»¥é€™ç¨® pattern é€šå¸¸å«åš *online transaction processing*ï¼ˆOLTPï¼‰ã€‚\n\nç›¸å°çš„ï¼Œè³‡æ–™åº«ä¹Ÿè¶Šä¾†è¶Šå¸¸è¢«æ‡‰ç”¨åœ¨è³‡æ–™åˆ†æä¸Šï¼Œé€šå¸¸æœƒéœ€è¦æŸ¥è©¢å¾ˆå¤šç­†è³‡æ–™ï¼Œä½†æ˜¯åªè®€å–ä¸€å°éƒ¨åˆ†çš„æ¬„ä½ï¼Œä¸¦ä¸”è¿”å› aggregation (count, sum, average) å¾Œçš„è³‡æ–™ã€‚é€™ç¨® pattern å«åš *online analytic processing*ï¼ˆOLAPï¼‰ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/OLTP_OLAP.png)\n\n## Data Warehousing\n\nä¸€é–‹å§‹ä¸€äº› OLTP çš„è³‡æ–™åº«åœ¨ OLAP ä¸Šä¹Ÿæœ‰å¾ˆå¥½çš„è¡¨ç¾ï¼Œä½†æ˜¯ OLTP æœå‹™é€šå¸¸è¦æ±‚é«˜å¯ç”¨æ€§ä¸¦ä¸”è¦æœ‰å¥½çš„ performanceï¼Œè€Œå•†æ¥­åˆ†æé€šå¸¸æœƒæƒéå¤§é‡çš„æ•¸æ“šï¼Œé€²è€Œå½±éŸ¿å…¶ä»–è«‹æ±‚çš„æ•ˆèƒ½ã€‚å› æ­¤åœ¨ 1980 ~ 1990 å¹´ä»£ï¼Œä¸€äº›æ¯”è¼ƒå¤§å‹çš„å…¬å¸é–‹å§‹æŠŠåˆ†æç”¨çš„è³‡æ–™ç§»åˆ°ç¨ç«‹çš„è³‡æ–™åº«ï¼Œé€šå¸¸å«åš *data warehouse*ã€‚\n\nData warehouse åŒ…å«ä¸€äº›è³‡æ–™å‰¯æœ¬ï¼Œé€šéå®šæœŸçš„ dump æˆ–æ˜¯ä¸²æµæ›´æ–°ï¼Œå°‡è³‡æ–™è½‰æ›æˆå¥½ç”¨ä¾†åˆ†æçš„æ ¼å¼å†å„²å­˜é€²åˆ†æç”¨çš„è³‡æ–™åº«ï¼Œé€™ç¨®æµç¨‹å°±å«åš *Extract-Transform-Load*ï¼ˆETLï¼‰ã€‚ä¸€äº›è³‡æ–™åº«ä¹Ÿç‚º data warehousing è€Œç”Ÿï¼Œä¾‹å¦‚ Teradataã€Verticaã€SAP HANA å’Œ ParAccelã€‚ç”šè‡³ä¹Ÿæœ‰é©åˆç”¨åœ¨ data warehouse çš„ data modelï¼Œä¾‹å¦‚ *Star Schema*ã€‚\n\n## Stars and Snokeflakes: Schemas for Analytics\n\n*Star schema* é¦–å…ˆå°‡è³‡æ–™åˆ†ç‚ºã€Œäº‹å¯¦ï¼ˆfactï¼‰ã€èˆ‡ã€Œç¶­åº¦ï¼ˆdimensionï¼‰ã€å…©å€‹éƒ¨åˆ†ï¼š\n\n- Fact tablesï¼šå„²å­˜äº‹ä»¶ï¼Œä»¥åŠä»»ä½•å¯ä»¥ç”¨ä¾†åˆ†æçš„æ•¸å€¼æ¬„ä½ã€‚ä¾‹å¦‚é›»å•†å¹³å°çš„äº‹å¯¦è³‡æ–™å¯ä»¥æ˜¯éŠ·å”®ç´€éŒ„ï¼Œå¯ç”¨æ–¼åˆ†æçš„æ¬„ä½åŒ…æ‹¬åƒ¹æ ¼ã€æ•¸é‡ã€æ™‚é–“ç­‰ã€‚äº‹å¯¦è³‡æ–™è¡¨é€šå¸¸åŒ…å«è³‡æ–™æ¬„ä½ä»¥åŠä¸€äº› foreign key ä¾†é—œè¯å…¶ä»–çš„ç¶­åº¦è³‡æ–™ã€‚ä¸€èˆ¬è€Œè¨€äº‹å¯¦è³‡æ–™è¡¨çš„åˆ—æ•¸ï¼ˆrowsï¼‰éå¸¸å¤šï¼Œä¸¦ä¸”éš¨è‘—æ™‚é–“é‚„æœƒç¹¼çºŒæˆé•·ã€‚äº‹å¯¦è³‡æ–™è¡¨é€šå¸¸æœƒæœ‰å¾ˆå¤šæ¬„ä½ï¼ˆcolumnsï¼‰ï¼Œé€šå¸¸åœ¨ä¸Šç™¾åˆ°ä¸Šåƒå€‹ä¸ç­‰ã€‚\n- Dimension tablesï¼šå„²å­˜äº‹ä»¶çš„å¯¦é«”ï¼Œä¾‹å¦‚å•†å“ã€éŠ·å”®å“¡ã€éŠ·å”®æ´»å‹•ã€é¡§å®¢ç­‰è©³ç´°è³‡è¨Šã€‚ä¸€èˆ¬è€Œè¨€ç¶­åº¦è³‡æ–™è¡¨çš„åˆ—æ•¸è¼ƒå°‘ã€‚ç¶­åº¦è³‡æ–™è¡¨ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šæ¬„ä½ç”¨ä¾†æè¿°é€™äº›å¯¦é«”ã€‚\n\né€™æ¨£çš„è¨­è¨ˆå¯ä»¥å°‡è¦åˆ†æçš„è³‡æ–™éƒ½ä¿ç•™åœ¨æœ€ä¸­é–“çš„äº‹å¯¦è³‡æ–™è¡¨ä¸­ï¼Œä¸¦ä¸”å¯ä»¥é€éä¸€å±¤çš„ç°¡å–® join æ‹¿åˆ°å…¶ä»–èˆ‡äº‹ä»¶ç›¸é—œçš„è³‡è¨Šï¼Œå› æ­¤ star schema é©åˆç”¨æ–¼è³‡æ–™åˆ†æã€‚\n\n![Image source: https://docs.microsoft.com/zh-tw/power-bi/guidance/star-schema](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/star_schema.png)\n\nè€Œ *Snowflake schema* æ˜¯ star schema çš„ä¸€ç¨®è®Šé«”ï¼Œå…è¨± dimension tables å¯ä»¥æœ‰é™„å±¬çš„ sub-dimension tablesã€‚\n\n# Column-Oriented Storage\n\né€šå¸¸è³‡æ–™åˆ†ææ™‚æœƒè®€å¾ˆå¤š rows ä»¥åŠå¾ˆå°‘ä¸€éƒ¨åˆ†çš„ columnsï¼Œè€Œä¸€èˆ¬åœ¨ OLTP è³‡æ–™åº«çš„ storage engine éƒ½æ˜¯ *row-oriented* çš„ï¼Œä¹Ÿå°±æ˜¯èªªåœ¨ disk ä¸­è³‡æ–™æ˜¯ä¸€å€‹ row æ¥è‘—ä¸€å€‹ row å„²å­˜çš„ã€‚å› æ­¤åœ¨è³‡æ–™åˆ†ææ™‚ï¼Œrow-oriented çš„è¨­è¨ˆæœƒè®“è³‡æ–™åº«å¿…é ˆè®€å‡ºæ•´å€‹ row çš„è³‡æ–™åˆ° memoryï¼Œå†å»æ‰ä¸å¿…è¦çš„ columnsï¼Œé€™å¯èƒ½æœƒæµªè²»æ‰å¾ˆå¤šæ™‚é–“ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/row-oriented.png)\n\nå› æ­¤æœ‰ *column-oriented* çš„ storage engine å‡ºç¾ï¼Œå°‡ç›¸åŒçš„ column å„²å­˜åœ¨ä¸€èµ·ï¼ˆé€šå¸¸æ˜¯æ¯å€‹ column å„²å­˜åˆ°ç¨ç«‹æª”æ¡ˆï¼‰ï¼ŒæŸ¥è©¢æ™‚å°±å¯ä»¥åªå°‡éœ€è¦çš„ columns è®€å‡ºã€‚è¦æ³¨æ„å„å€‹ column å¿…é ˆæ˜¯ä»¥ä¸€æ¨£çš„æ’åºæ–¹å¼å„²å­˜çš„ï¼Œæ‰èƒ½å¤ é‚„åŸå‡ºåŸæœ¬çš„ rowsã€‚ä¾‹å¦‚æ‰€æœ‰ column ä¸­çš„ç¬¬ä¸€å€‹å€¼éƒ½æ˜¯å°æ‡‰åˆ°åŒä¸€å€‹ row çš„è³‡æ–™ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/column-oriented.png)\n\nå¦å¤–ï¼ŒCassandra å’Œ HBase éƒ½æœ‰ column familes çš„æ¦‚å¿µï¼Œä½†ä¸¦ä¸æ˜¯ column-orientedã€‚åœ¨æ¯å€‹ column family ä¸­è³‡æ–™é‚„æ˜¯ä¸€å€‹ä¸€å€‹ rows å„²å­˜çš„ï¼Œæ‰€ä»¥é‚„æ˜¯ç®— rows-orientedã€‚\n\n## Column Compression\n\nå°‡ column å„²å­˜åœ¨ä¸€èµ·å¯ä»¥åš column compression ä¾†ç¯€çœå„²å­˜ç©ºé–“ã€‚å…¶ä¸­ä¸€ç¨®å¸¸è¦‹çš„æ–¹å¼æ˜¯ *bitmap encoding*ã€‚\n\nBitmap encoding å°æ¯å€‹ä¸ä¸€æ¨£çš„å€¼éƒ½ç”¨ä¸€å€‹ bitmap ä¾†å„²å­˜ä»–å€‘åœ¨ç¬¬å¹¾å€‹ row å‡ºç¾ï¼Œä¾‹å¦‚ä¸‹åœ–ä¸­ `product_sk` é€™å€‹ column ä¸­ï¼Œç¸½å…±æœ‰ 6 å€‹ç›¸ç•°å€¼ï¼Œå› æ­¤å°±éœ€è¦ 6 å€‹ bitmaps ä¾†å„²å­˜ã€‚å…¶ä¸­ `product_sk=74` é€™å€‹æ•¸å­—æ’åœ¨ç¬¬ 5 å€‹ï¼Œå› æ­¤å°±å°‡å…¶ bitmap ä¸­çš„ç¬¬ 5 å€‹å€¼è¨­ç‚º 1ã€‚å¦‚æ­¤ä¸€ä¾†åªè¦å„²å­˜æ‰€æœ‰çš„ bitmaps å³å¯ã€‚\n\nè€Œå„²å­˜ bitmaps å¯ä»¥é€é run-length encoding ä¾†ç¯€çœç©ºé–“ã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/bitmap_encoding.png)\n\nåš bitmap index åœ¨ä¸€äº› data warehouse çš„ query ä¸­ä¹Ÿæœ‰å¥½çš„è¡¨ç¾ï¼Œä¾‹å¦‚ï¼š\n\n1. `WHERE product_sk IN (30, 68, 69)`ï¼šåªè¦ load `product_sk` æ˜¯ 30, 68, 69 çš„ bitmaps å¾Œåš bitwise OR å³å¯å¾—åˆ°çµæœã€‚\n2. `WHERE product_sk = 31 AND store_sk = 3`ï¼Œåªè¦ load `product_sk = 31` ä»¥åŠ `store_sk = 3` çš„ bitmaps å¾Œåš bitwise AND å¾Œå³å¯å¾—åˆ°çµæœã€‚\n\n## Sort Order in Column Storage\n\nåœ¨ column-oriented store ä¸­ **rows çš„å„²å­˜é †åºå¯ä»¥ä»»æ„ï¼Œä½†æ˜¯æ¯å€‹ columns éƒ½å¿…é ˆæ˜¯ä»¥ä¸€æ¨£çš„æ–¹å¼æ’åº**ã€‚\n\nä½¿ç”¨è€…å¯ä»¥æ ¹æ“šå¸¸ç”¨çš„ query ä¾†æ±ºå®šè¦æ ¹æ“šå“ªå€‹ column åšæ’åºã€‚ä¾‹å¦‚é¸æ“‡æ ¹æ“š date key åšæ’åºï¼Œå‰‡ query optimizer å°±å¯ä»¥å¹«ã€ŒæŸ¥è©¢ä¸€æ®µæ™‚é–“å…§çš„è³‡æ–™ã€é€™æ¨£çš„æŸ¥è©¢åšåŠ é€Ÿã€‚å¦å¤–å¦‚æœé€™å€‹æ¬„ä½é‚„æœ‰åš bitmap index çš„è©±ï¼Œå› ç‚ºè³‡æ–™å·²ç¶“æ’åºéï¼Œæ‰€ä»¥ bitmap ä¸­çš„æ‰€æœ‰ 0 è·Ÿ 1 éƒ½æœƒèšé›†åœ¨ä¸€èµ·ï¼Œé€é run-length encoding å¾Œå°±å¯ä»¥ç¯€çœéå¸¸å¤šçš„å„²å­˜ç©ºé–“ã€‚\n\n## Writing to Column-Oriented Storage\n\nä½¿ç”¨æ’åºå¾Œè³‡æ–™æ’å…¥æœƒè®Šå›°é›£ï¼Œå› ç‚ºç„¡æ³•åœ¨æª”æ¡ˆä¸­åšæ’å…¥ã€‚é€™æ™‚å¯ä»¥ä½¿ç”¨ LSM-treeï¼Œåœ¨ memory ä¸Šåšå¯«å…¥èˆ‡æ’åºï¼Œç­‰åˆ°ä¸€å®šçš„å¤§å°å¾Œèˆ‡èˆŠçš„ column files åˆä½µä¸¦å¯«åˆ°æ–°çš„æª”æ¡ˆä¸­ã€‚é€™ç¨®åšæ³•è¢« Vertica æ¡ç”¨ã€‚\n\n## Aggregation: Data Cubes and Materialized Views\n\nDate warehouse å¸¸æœƒä½¿ç”¨åˆ°ä¸€äº› aggregation functions ä¾‹å¦‚ `COUNT`ã€`SUM`ã€`AVG`ã€`MIN` èˆ‡ `MAX` ç­‰ç­‰ï¼Œå¦‚æœä¸€å€‹ aggregation çš„çµæœç¶“å¸¸è¢«å…¶ä»– query ä½¿ç”¨ï¼Œé‚£ cache ä½é€™å€‹çµæœæˆç‚ºä¸€å€‹ *materialized view*ï¼Œä¹‹å¾Œçš„ query å¯ä»¥ç›´æ¥åœ¨é€™å€‹ table ä¸Šé¢åš query ä»¥ç¯€çœæ™‚é–“ã€‚\n\nä¸€ç¨®åœ¨ OLAP å¸¸è¦‹çš„ *materialized view* å«åš *data cube* æˆ–æ˜¯ *OLAP cube*ï¼Œç”±å¤šå€‹ dimensions çš„è³‡æ–™é€é aggregation å¾Œå¾—åˆ°ï¼Œä»¥ä¸‹æ˜¯ä¸€å€‹ 2D çš„ OLAP cubeã€‚åœ¨è¡¨ä¸Šå¯ä»¥å¿«é€Ÿå¾—åˆ°æŸæ—¥çš„ç‡Ÿæ¥­é¡ã€æŸæœˆç‡Ÿæ¥­é¡ã€æŸå•†å“å–®æœˆç‡Ÿæ¥­é¡ç­‰ç­‰è³‡è¨Šã€‚\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸‰ç« ç­†è¨˜/OLAP_cube.png)\n\n# Summary\n\nç¸½çµä¾†èªªï¼Œæœ¬ç« ç¯€çš„é‡é»åœ¨ä»‹ç´¹è³‡æ–™åº«çš„å„ç¨® storage engine è¨­è¨ˆï¼Œä»¥åŠå…¶å„ªç¼ºé»ã€‚\n\né¦–å…ˆä»‹ç´¹äº† OLTP ä¸­å…©ç¨®å¸¸è¦‹çš„å„²å­˜æ–¹å¼ï¼š\n\n- Log-structuredï¼šåªèƒ½ä»¥æ’å…¥çš„æ–¹å¼å¯«æª”ã€‚æª”æ¡ˆé€éåˆä½µèˆ‡å£“ç¸®çš„æ–¹å¼ä¾†æ¸›å°‘å„²å­˜ç©ºé–“ã€‚SSTables èˆ‡ LSM-trees éƒ½æ˜¯å±¬æ–¼é€™ç¨®é¡å‹ã€‚\n- Update-in-placeï¼šå‹•æ…‹çš„å¯«å…¥ disk ä¸­çš„ pageã€‚B-trees æ˜¯å±¬æ–¼é€™ç¨®é¡å‹çš„ï¼Œä¸¦ä¸” B-trees è¢«æ‡‰ç”¨åœ¨å¤§å¤šæ•¸çš„ relational databases èˆ‡å¾ˆå¤š non-relational databases ä¸­ã€‚\n\nå¦å¤–ä»¥æ›´å¤§çš„é¢å‘å°‡è³‡æ–™åº«åˆ†æˆ OLTP èˆ‡ OLAP å…©ç¨®é¡å‹ï¼š\n\n- OLTP é€šå¸¸é¢å‘ä½¿ç”¨è€…ï¼Œæœ‰è¼ƒå¤šçš„ insert èˆ‡ update æ“ä½œï¼Œä¸”ä½¿ç”¨ key ä¾†å­˜å–å°‘é‡çš„è³‡æ–™ï¼Œå› æ­¤ storage engine é€éå„²å­˜ index ä¾†å¿«é€Ÿçš„æŸ¥è©¢è³‡æ–™ã€‚\n- OLAP é€šå¸¸åªåœ¨å¤§å…¬å¸çš„è³‡æ–™åˆ†æç”¨é€”ä¸­å‡ºç¾ï¼Œquery æ•¸é‡å°‘ä½†æ¯æ¬¡å­˜å–å¤§é‡è³‡æ–™ï¼Œé€é column-oriented storage ä¾†æ¸›å°‘ disk I/O bandwidthã€‚\n\nèº«ç‚ºæ‡‰ç”¨ç¨‹å¼çš„é–‹ç™¼è€…ï¼Œä¸Šè¿°é€™äº›å…§å®¹å¯ä»¥å¹«åŠ©ä½ æ›´å¥½çš„èª¿æ ¡è³‡æ–™åº«çš„ indexing æˆ–æ˜¯ storage engineï¼Œä¸¦ä¸”åœ¨é–±è®€è³‡æ–™åº«æ–‡æª”æ™‚æœ‰è¶³å¤ å……è¶³çš„çŸ¥è­˜ã€‚\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Notes","DDIA"],"categories":["Notes"]},{"title":"Designing Data-Intensive Application ç¬¬äºŒç« ç­†è¨˜","url":"/Designing-Data-Intensive-Application-ç¬¬äºŒç« ç­†è¨˜/","content":"\næœ¬ç« ç¯€ä¸»è¦åœ¨ä»‹ç´¹ç›®å‰ä¸»æµçš„ä¸‰å€‹ Data Modelï¼Œ**Relational Modelã€Document Model ä»¥åŠ Graph Model** çš„å„ªç¼ºé»ã€æ¼”é€²å²ä»¥åŠä½¿ç”¨æ™‚æ©Ÿã€‚\n\nData Model æ˜¯ä¸€å±¤ç–Šä¸€å±¤çš„ï¼š\n- åœ¨æ‡‰ç”¨å±¤ï¼Œè³‡æ–™å¯èƒ½æ˜¯è³¼ç‰©è»Šè³‡è¨Šã€é‡‘æµã€å•†å“ç­‰åœ¨ç¾å¯¦ä¸–ç•Œä¸­çš„è³‡è¨Šã€‚\n- åœ¨å¾Œç«¯ï¼Œæˆ‘å€‘å¿…é ˆæŠŠè³‡æ–™è½‰æ›æˆæ˜“æ–¼å„²å­˜çš„è³‡æ–™çµæ§‹ï¼Œå¯èƒ½æ˜¯ XML æˆ– JSONï¼Œåˆæˆ–æ˜¯é—œè¯å¼è³‡æ–™åº«ä¸­çš„ Tablesã€‚\n- åœ¨è³‡æ–™åº«ä¸­ï¼ŒXMLã€JSON æˆ–æ˜¯ Tables éƒ½å¿…é ˆè½‰è®Šæˆ bytes çš„å½¢å¼ï¼Œä½¿ä»–å€‘èƒ½å¤ è¢«å„²å­˜åœ¨ memory æˆ–æ˜¯ disk ä¸Šã€‚\n- åœ¨ç¡¬é«”å±¤ï¼Œbytes å¿…é ˆè½‰æ›æˆé›»æµã€ç£å ´ç­‰ç­‰ã€‚\n\nå±¤èˆ‡å±¤é€éå®šç¾©å¥½çš„ API ä¾†æºé€šï¼Œå¯ä»¥å°‡èƒŒå¾Œçš„è¤‡é›œå¯¦ä½œè—åœ¨ API ä¹‹å¾Œã€‚\n\nå„ç¨®ä¸åŒçš„ data model èƒŒå¾Œéƒ½æœƒä¸€äº›ä½¿ç”¨æƒ…å¢ƒçš„å‡è¨­ï¼Œå› æ­¤æ¯ä¸€ç¨® data model éƒ½æœ‰ä¸åŒçš„åŠŸèƒ½ã€æ“ä½œï¼Œå°æ–¼æ”¯æ´çš„æ“ä½œï¼Œæ•ˆèƒ½ä¹Ÿæœ‰å¥½èˆ‡å£ä¹‹å·®åˆ¥ã€‚\n\nä¹Ÿå› ç‚ºè¦ç²¾é€šä¸€ç¨® data model æ˜¯ååˆ†å›°é›£çš„ï¼ˆå…‰æ˜¯ relational data modeling å°±æœ‰é€™éº¼å¤šæ›¸ç±ï¼‰ï¼Œå› æ­¤åœ¨ä½¿ç”¨ä¹‹å‰å…ˆç¶œè§€çš„äº†è§£æ¯ä¸€ç¨® model çš„å„ªç¼ºé»ä»¥åŠä½¿ç”¨æ™‚æ©Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚\n\n<!-- More -->\n\n# Relational Model Versus Document Model\n\nRelational model åœ¨ 1970 å¹´æ™‚è¢«æå‡ºï¼Œåœ¨ 1980 å¹´ä»£é–‹å§‹è¢«å»£æ³›çš„ä½¿ç”¨ç›´åˆ°ç¾åœ¨ã€‚ç•¶æ™‚èˆ‡å…¶ç«¶çˆ­çš„é‚„æœ‰ network model ä»¥åŠ hierarchical modelï¼Œä½†æ˜¯å¾Œä¾†éƒ½è¢« relational model ä¸»å®°ï¼Œè€Œ relational model ä¹‹æ‰€ä»¥èƒ½å¤ æˆåŠŸä¸»è¦å› ç‚ºå…©é»ï¼š\n1. å…¶å°‡è¤‡é›œçš„ query å¯¦ä½œè—åœ¨ database æœ¬èº«çš„ query optimizer ä¸­ï¼Œæä¾›æ›´ä¹¾æ·¨çš„ä»‹é¢ä½¿ç”¨ï¼Œè®“é–‹ç™¼è€…ä¸éœ€çŸ¥é“è³‡æ–™æ˜¯å¦‚ä½•è¢«å„²å­˜åœ¨è³‡æ–™åº«ä¸­çš„ã€‚\n2. å…¶è§£æ±ºäº†ç•¶æ™‚ä¸€å€‹é‡è¦çš„å•é¡Œï¼šå¤šå°å¤šçš„é—œè¯ã€‚\n\n## The Birth of NoSQL\n\nNoSQL åœ¨ 2010 å¹´åˆæœŸèµ°ç´…ï¼Œç•¶æ™‚ NoSQL æŒ‡çš„æ˜¯éé—œè¯å¼ã€é–‹æºã€åˆ†æ•£å¼çš„è³‡æ–™åº«ã€‚å¾Œä¾†è½‰è®Šæˆ Not Only SQLã€‚\n\nNoSQL æœ€ä¸»è¦çš„æ¨åŠ›åœ¨ï¼š\n- æœ‰æ›´å¥½çš„ Scalabilityã€‚\n- æ”¯æ´ä¸€äº›é—œè¯å¼è³‡æ–™åº«ä¸æ”¯æ´çš„æ“ä½œã€‚\n- å¯ä»¥ä½¿ç”¨æ›´å½ˆæ€§ã€æ›´è‡ªç”±çš„å„²å­˜è³‡æ–™çµæ§‹ã€‚\n\n## The Object-Relational Mismatch\n\nç¨å¾®ä»‹ç´¹å®Œäº† Relational Model è·Ÿ Document Model çš„å‡ºç¾èˆ‡æ­·å²ï¼Œæ¥ä¸‹ä¾†è¬› Relational Model æœ€ä¸»è¦é‡åˆ°çš„å•é¡Œï¼š**Object-Relational Mismatch**ã€‚\n\nå¤§å¤šæ•¸çš„æ‡‰ç”¨ç¨‹å¼é–‹ç™¼éƒ½æ˜¯ object-oriented programmingï¼Œå› æ­¤åœ¨ object èˆ‡ table ä¹‹é–“çš„è½‰æ›æœƒé‡åˆ°å›°é›£ï¼Œå¹¸å¥½ç¾åœ¨ä¸»æµçš„ database éƒ½æœ‰ Object-relational mapping (ORM) æ¡†æ¶çš„å¹«åŠ©ä¾†æ¸›å°‘é€™äº›è½‰æ›çš„è¤‡é›œæ€§ã€‚ä½†æ˜¯ç•¶åŸè³‡æ–™å°±æ˜¯ä¸å¤ªé©åˆæ”¾é€² table æ™‚ï¼Œå°±æœƒé‡åˆ°å›°é›£ã€‚\n\né€™è£¡èˆ‰å±¥æ­·ç‚ºä¾‹å­ï¼ˆLinkedIn Profileï¼‰ï¼Œä¸€å€‹ä½¿ç”¨è€…æœƒæœ‰ä¸€å€‹ unique ID `user_id`ï¼Œæœƒæœ‰å§“ `last_name` èˆ‡å `first_name`ï¼Œé€™äº›æ¬„ä½éƒ½æ˜¯ä¸€å€‹å€¼ï¼Œå¯ä»¥è¢«ç•¶ä½œ `users` è¡¨çš„æ¬„ä½ã€‚\n\nä½†æ˜¯ä¸€å€‹ä½¿ç”¨è€…å¯èƒ½æœ‰å¤šå€‹å·¥ä½œã€å­¸æ­·ã€ç”šè‡³æ˜¯è¯çµ¡è³‡æ–™ï¼Œé€™äº›ä¸€å°å¤šçš„é—œè¯åœ¨ relational model ä¸­æœ‰å¹¾ç¨®è™•ç†æ–¹å¼ï¼š\n- å°‡å·¥ä½œã€å­¸æ­·ã€è¯çµ¡è³‡æ–™æ”¾åˆ°å¦ä¸€å¼µ table ä¾†å„²å­˜ï¼Œé€™ä¹Ÿæ˜¯æœ€å¸¸è¦‹çš„è³‡æ–™åº«æ­£è¦åŒ–æ–¹å¼\n- ä¸€äº›é—œè¯å¼è³‡æ–™åº«æ”¯æ´ Array æˆ–æ˜¯ JSON å„²å­˜æ ¼å¼ï¼Œä¾‹å¦‚ PostgreSQLã€‚\n- ç›´æ¥å°‡ JSON æˆ–æ˜¯ XML æ ¼å¼ç·¨ç¢¼æˆ bytes å†å„²å­˜é€²è³‡æ–™åº«çš„ä¸€å€‹æ¬„ä½ã€‚\n\n<img src=\"/assets/Designing-Data-Intensive-Application-ç¬¬äºŒç« ç­†è¨˜/linkedin_profile.png\" width=\"70%\" />\n\nå±¥æ­·çš„è³‡æ–™å°±æ¯”è¼ƒé©åˆæ”¾åœ¨ JSON æ ¼å¼ä¸‹ï¼Œä¾‹å¦‚ï¼š\n```json\n{\n  \"user_id\": 251,\n  \"first_name\": \"Bill\",\n  \"last_name\": \"Gates\",\n  \"summary\": \"Co-chair of the Bill & Melinda Gates... Active blogger.\",\n  \"region_id\": \"us:91\",\n  \"industry_id\": 131,\n  \"photo_url\": \"/p/7/000/253/05b/308dd6e.jpg\",\n  \"positions\": [\n    {\n      \"job_title\": \"Co-chair\",\n      \"organization\": \"Bill & Melinda Gates Foundation\"\n    },\n    {\n      \"job_title\": \"Co-founder, Chairman\",\n      \"organization\": \"Microsoft\"\n    }\n  ],\n  \"education\": [\n    {\n      \"school_name\": \"Harvard University\",\n      \"start\": 1973,\n      \"end\": 1975\n    },\n    {\n      \"school_name\": \"Lakeside School, Seattle\",\n      \"start\": null,\n      \"end\": null\n    }\n  ],\n  \"contact_info\": {\n    \"blog\": \"http://thegatesnotes.com\",\n    \"twitter\": \"http://twitter.com/BillGates\"\n  }\n}\n```\n\nç”±ä¸Šé¢çš„åœ–èˆ‡ JSON å¯ä»¥çœ‹å‡ºï¼ŒJSON æ ¼å¼æœ‰æ›´å¥½çš„ localityï¼Œä½¿ç”¨ relational model å°±å¿…é ˆä½¿ç”¨å¤šæ¬¡çš„ Join ä¾†é—œè¯å¤šå€‹è³‡æ–™åº«ï¼Œè€Œ JSON ä¸­æ‰€æœ‰èˆ‡æ­¤ä½¿ç”¨è€…ç›¸é—œçš„è³‡è¨Šéƒ½å„²å­˜åœ¨ä¸€èµ·ï¼Œä¸€å€‹ç°¡å–®çš„ query å°±èƒ½é”æˆã€‚\n\n## Many-to-One and Many-to-Many Relationships\n\nè¬›å®Œäº† relational model çš„ç¼ºé»ï¼Œå†ä¾†è¬› document model çš„ç¼ºé»ã€‚\n\né¦–å…ˆï¼Œå¯ä»¥ç™¼ç¾ä¸Šé¢çš„ JSON ä¸­ region èˆ‡ industry éƒ½åªå„²å­˜äº†ä¸€å€‹ IDï¼Œè€Œä¸æ˜¯ç›´æ¥å„²å­˜å­—ä¸²ï¼Œé€™æ¨£åšæœ‰å¹¾å€‹å¥½è™•ï¼š\n\n- ä¸€è‡´æ€§ï¼Œé¿å…ç›¸åŒæ„æ€ä½†æ˜¯æ‹¼æ³•ä¸åŒçš„å•é¡Œ\n- æ˜“æ–¼æ›´æ–°ï¼Œç•¶ä¸€å€‹åç¨±è®Šæ›´æ™‚ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€è™•çš„åå­—\n- æ”¯æ´å¤šèªç³»ï¼Œå¯ä»¥é€éå”¯ä¸€çš„ ID å°‡å…¶ç¿»è­¯æˆå„å€‹èªç³»çš„å­—ä¸²\n- æ›´å¥½çš„æ”¯æ´æœå°‹åŠŸèƒ½\n\nä½¿ç”¨ ID çš„å¥½è™•åœ¨æ–¼ ID å°æ–¼äººæ˜¯æ²’æœ‰æ„ç¾©çš„ï¼Œå› æ­¤ ID æ°¸é ä¸æœƒæ”¹è®Šã€‚å› æ­¤é€é ID å°‡é‡è¤‡çš„è³‡æ–™éƒ½è®Šæˆå”¯ä¸€çš„ rowï¼Œå¯ä»¥é¿å…æ›´æ–°ã€åˆªé™¤æ™‚éœ€è¦æ›´æ–°åˆ°å¤šå€‹ rows çš„å•é¡Œï¼Œé€™å°±æ˜¯è³‡æ–™æ­£è¦åŒ–çš„æ ¸å¿ƒæƒ³æ³•ã€‚\n\nåœ¨ relational database ä¸­ï¼Œå¤šå°ä¸€çš„é—œä¿‚å¾ˆå¥½è™•ç†ï¼Œé€é ID åŠ ä¸Š join çš„æ“ä½œå³å¯ã€‚åœ¨ document database ä¸­ï¼Œä¸€å°å¤šé—œè¯å¯ä»¥ç›´æ¥çš„å„²å­˜ï¼ˆåƒ JSON ä¸­çš„ Array å³æ˜¯ä¸€å°å¤šé—œè¯ï¼‰ï¼Œå› æ­¤ document model é€šå¸¸ä¸æ”¯æ´ join çš„æ“ä½œï¼Œå‰‡å¯èƒ½éœ€è¦åœ¨æ‡‰ç”¨å±¤æ‰‹å‹•çš„æ¨¡æ“¬ join çš„æ“ä½œã€‚\n\n> åœ¨ document model ä¸­ï¼Œä¸ä¸€å®šè¦åƒ relational model ä¸€æ¨£é€é ID åšå¤šå°ä¸€çš„é—œè¯ï¼Œå¯ä»¥é€é denormalizationï¼Œç›´æ¥è®“è³‡æ–™é‡è¤‡çš„å‡ºç¾ï¼Œä¾‹å¦‚ç›´æ¥å°‡ JSON ä¸­ `region_id` ç›´æ¥ç”¨ `region` çš„ object å–ä»£ã€‚å¥½è™•æ˜¯ä¸éœ€è¦å†æœ‰ join çš„æ“ä½œï¼Œå£è™•ç•¶ç„¶å°±æ˜¯å–ªå¤±ä¸Šé¢æåˆ°åªå„²å­˜ ID çš„å¹¾å€‹å¥½è™•ã€‚é€™å€‹æ–¹æ³•æ¯”è¼ƒé©åˆç”¨åœ¨å¾ˆå°‘è¢«æ›´æ”¹çš„è³‡æ–™ï¼Œå› ç‚º denormalization æœƒä½¿å¾— update, delete çš„æ“ä½œè®Šå¾—æ›´è¤‡é›œèˆ‡æ›´æ²’æ•ˆç‡ã€‚\n>\n> åœ¨ [MongoDB çš„ 6 Rules of Thumb for MongoDB Schema](https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-2) å°±æœ‰æåˆ°é€™å€‹æ–¹æ³•çš„ä½¿ç”¨æ™‚æ©Ÿèˆ‡è€ƒé‡ï¼Œå»ºè­°è®€è€…å¯ä»¥é–±è®€ï½\n\nå¦å¤–ï¼Œå°±ç®—è³‡æ–™åŸæœ¬å¾ˆç¬¦åˆ document model çš„æ ¼å¼ï¼Œåœ¨æœªä¾†ä¹Ÿæœ‰æ©Ÿæœƒå› ç‚ºéœ€æ±‚çš„è®Šæ›´è®Šå¾—æ›´åŠ è¤‡é›œè€Œç”¢ç”Ÿå¤šå°ä¸€ã€å¤šå°å¤šçš„é—œè¯ã€‚ä¾‹å¦‚ï¼š\n\n1. æ–°å¢å­¸æ ¡çš„ logoã€è¯çµ¡é›»è©±ã€åœ°å€ç­‰ç­‰ï¼Œé€™æ™‚ä¸å†åªèƒ½å„²å­˜ä¸€å€‹ `school_name` å­—ä¸²ï¼Œå°±å¯èƒ½éœ€è¦æœ‰ä¸€å€‹ `schools` çš„è¡¨ä¾†å„²å­˜è³‡è¨Šï¼Œå¦‚æ­¤ä¸€ä¾† `users` èˆ‡ `schools` å°±è®Šæˆå¤šå°ä¸€çš„é—œä¿‚äº†ã€‚\n2. æ–°å¢ä¸€å€‹æ¨è–¦åŠŸèƒ½å¯ä»¥è®“ä½¿ç”¨è€…çˆ²å¦ä¸€åä½¿ç”¨è€…å¯«æ¨è–¦ä¿¡ï¼Œå‰‡ç”¢ç”Ÿäº†å¤šå°å¤šçš„é—œä¿‚ã€‚\n\n## Are Document Databases Repeatng History\n\nè¬›å®Œäº† relational model èˆ‡ document model å„è‡ªçš„ä¸æ“…é•·ä¹‹è™•ï¼Œé€™è£¡ç¨å¾®è¬›å¤ä¸€ä¸‹ network model èˆ‡ hierarchical modelã€‚\n\nåœ¨ 1970 å¹´æœ€ç†±é–€çš„è³‡æ–™åº« IBM's Information Management System (IMS) æ¡ç”¨çš„æ˜¯ hierarchical modelï¼Œèˆ‡ç¾åœ¨ document model ä¸­ JSON çš„æ ¼å¼éå¸¸ç›¸ä¼¼ã€‚èˆ‡ç¾åœ¨ä½¿ç”¨ document model ä¸€æ¨£ï¼Œhierarchical model å¯ä»¥å¾ˆå¥½çš„è™•ç†ä¸€å°å¤šé—œè¯ï¼Œä½†æ˜¯ä¸é©åˆè™•ç†å¤šå°ä¸€æˆ–æ˜¯å¤šå°å¤šé—œè¯ã€‚\n\nå› æ­¤å…©å€‹æœ€çªå‡ºçš„è§£æ±ºæ–¹æ¡ˆå‡ºç¾äº†ï¼Œåˆ†åˆ¥æ˜¯ **network model** ä»¥åŠ **relational model**ã€‚\n\n### The network model\n\nNetwork model æ˜¯ç”±ä¸€å€‹æœƒè­° Conference on Data Systems Languages (CODASYL) åˆ¶å®šçš„ï¼Œå› æ­¤ä¹Ÿå«åš CODASYL modelã€‚\n\nNetwork model èˆ‡ hierarchical model å¾ˆåƒï¼Œæœ€å¤§çš„ä¸åŒåœ¨æ–¼æ¯å€‹ record å¯ä»¥æœ‰ä¸åªä¸€å€‹ parentã€‚\n\nåœ¨ network model ä¸­çš„ query å¿…é ˆé€éæŒ‡é‡å¾ root ç§»å‹•åˆ°æƒ³è¦çš„ recordï¼Œé–‹ç™¼è€…å¿…é ˆè‡ªå·±ç¶­è­·å¯èƒ½èµ°åˆ°é‡è¤‡çš„é»ã€æ±ºå®šè·¯å¾‘ç­‰å•é¡Œã€‚\n\n### The relational model\n\nRelational model å°‡è³‡æ–™æ”¾åœ¨è¡¨ä¸­çš„åˆ—ä¸Šï¼Œæœ€æˆåŠŸçš„éƒ¨åˆ†åœ¨æ–¼ relational model æŠŠ query çš„è¤‡é›œå¯¦ä½œéƒ½æŠ½è±¡åŒ–åœ¨ DBMS çš„ query optimizer ä¸­ï¼Œä½¿å¾—é–‹ç™¼è€…å¯ä»¥ç°¡å–®çš„é¸æ“‡æƒ³è¦çš„è³‡æ–™ï¼Œé€é query optimizer è‡ªè¡Œæ±ºå®šè¦æ€éº¼å­˜å–è³‡æ–™ã€è¦ä½¿ç”¨å“ªå€‹ indexã€‚\n\n### Comparison to document databases\n\næœ€å¾Œå›åˆ°æœ€åˆçš„å•é¡Œï¼Œé‚£éº¼ç¾åœ¨çš„ document model æ˜¯å¦æ˜¯é‡è¹ˆè¦†è½å‘¢ï¼Ÿ\n\nç¾åœ¨çš„ document model å¯ä»¥é€éé¡ä¼¼ relational model ä¸­ *foreign key* çš„æ–¹å¼ï¼Œä¾†é—œè¯å¤šå°ä¸€æˆ–æ˜¯å¤šå°å¤šçš„æ¨¡å‹ï¼Œç¨±ä½œ *document reference*ã€‚ä¸åƒæ˜¯ä¹‹å‰ network model æ‰€æ¡ç”¨çš„æ–¹å¼ã€‚\n\næœ€çµ‚è¦å¦‚ä½•é¸æ“‡ï¼Œåˆ°åº•æ˜¯ relational model é‚„æ˜¯ document model æ›´ç¬¦åˆä½¿ç”¨æƒ…å¢ƒï¼Œé‚„æ˜¯çœ‹å„ä½é–‹ç™¼è€…çš„æ±ºå®šäº†ï¼\n\n## Relational Versus Document Databases Today\n\næœ€å¾Œç¸½çµä¸€äº›ä»Šæ—¥ relational èˆ‡ document databases åœ¨ data model ä¸Šçš„æ¯”è¼ƒã€‚\n\n### Which data model leads to simpler application code\n\nè·Ÿåœ¨å‰é¢æåˆ°çš„ä¸€æ¨£ï¼Œå¦‚æœè³‡æ–™æ˜¯ document-likeï¼Œä¸¦æ²’æœ‰å¤šå°ä¸€ã€å¤šå°å¤šçš„é—œè¯ï¼Œå‰‡è¼ƒé©åˆ document modelã€‚\n\nè‹¥æœ‰å¾ˆå¤§é‡çš„å¤šå°å¤šé—œè¯å­˜åœ¨ï¼Œç”šè‡³ relational model ä¹Ÿä¸¦ä¸æ˜¯æœ€é©åˆçš„é¸é …ï¼Œå¾Œé¢æœƒä»‹ç´¹åˆ° graph model å°±æ˜¯å°ˆé–€è§£æ±ºé€™å€‹å•é¡Œè€Œç”¢ç”Ÿçš„ã€‚\n\n### Schema flexibility in the document model\n\né€šå¸¸ document databases æœƒè¢«å«åš *schemaless*ï¼Œä½†æ›´æº–ç¢ºä¾†èªªæ‡‰è©²ç¨±ä½œ *schema-on-read*ï¼Œä¹Ÿå°±æ˜¯è³‡æ–™çš„æ ¼å¼æ˜¯éš±è—ã€ä¸éœ€é å…ˆå®šç¾©çš„ï¼Œåœ¨è®€å‡ºæ™‚æ‰æ±ºå®šä»–çš„æ ¼å¼ã€‚\n\nç•¶å„²å­˜çš„è³‡æ–™çµæ§‹éœ€è¦æ”¹è®Šæ™‚ï¼Œä¾‹å¦‚å°‡åŸæœ¬çš„ `name` æ¬„ä½æ‹†æˆ `first_name` ä»¥åŠ `last_name`ï¼Œdocument model å¯ä»¥å¾ˆç°¡å–®çš„é€éæ‡‰ç”¨å±¤çš„ç¨‹å¼ç¢¼åœ¨è®€å‡ºèˆ‡å¯«å…¥æ™‚å°è³‡æ–™åšå‡ºæ”¹è®Šå³å¯ï¼Œå› çˆ² document databases é€šå¸¸å®¹è¨±ä¸€å€‹ collections å…§çš„è³‡æ–™é•·ç›¸ä¸åŒã€‚\n\n```js\nif (user && user.name && !user.first_name) {\n  first_name = user.name.split(\" \")[0];\n}\n```\n\nè€Œ relational database é€šå¸¸å¿…é ˆé€é *migration* ä¾†é”æˆï¼š\n\n```sql\nALTER TABLE users ADD COLUMN first_name text;\nUPDATE users SET first_name = split_part(name, ' ', 1); -- PostgreSQL\nUPDATE users SET first_name = substring_index(name, ' ', 1); -- MySQL\n```\n\n`ALTER TABLE` å°æ–¼å¤§å‹ç³»çµ±è€Œè¨€æ˜¯éå¸¸å¯æ€•çš„ï¼Œé€šå¸¸æœƒé€ æˆ database çš„ downtimeã€‚PostgreSQL åœ¨ v11 ä¹‹å‰ï¼Œ`ALTER TABLE ADD COLUMN` æœƒæ‹¿æ•´å¼µ table çš„ `ACCESS EXCLUSIVE` lockï¼Œé€ æˆæ‰€æœ‰çš„ transaction ä¸èƒ½ access é€™å¼µ tableã€‚\n\nå› æ­¤è‹¥è³‡æ–™çµæ§‹æ˜¯ç¶“å¸¸æ”¹å‹•ã€æˆ–æ˜¯è³‡æ–™çš„çµæ§‹è®ŠåŒ–å¾ˆå¤§ï¼Œå‰‡æœ‰ schema åè€Œæœƒæˆç‚ºä¸€ç¨®å›°é›£ï¼Œdocument model å¯èƒ½æœƒæ›´åŠ é©åˆã€‚\n\n### Data locality for queries\n\nDocument model é€šå¸¸å°‡æ•´å€‹ document å„²å­˜æˆä¸€æ®µ encoded çš„ JSON å­—ä¸²ï¼ˆæˆ–æ˜¯ MongoDB's BSONï¼‰ï¼Œå› æ­¤å­˜å–æœƒæ•´å€‹ document ä¸€èµ·å–å‡ºï¼Œä¹Ÿå°±æ˜¯ document model çš„ *storage locality*ã€‚\n\nè‹¥è³‡æ–™ç¶“å¸¸æ˜¯æ•´å€‹è¢«å­˜å–çš„ï¼Œå‰‡ document model å¯ä»¥é¿å…æ‰ relational model å› ç‚ºéœ€è¦å¤šæ¬¡ join è€Œå¯èƒ½é€ æˆå¤šæ¬¡ disk access çš„å•é¡Œã€‚ä½†åä¹‹è‹¥æ¯æ¬¡åªéœ€è¦ä¸€å°éƒ¨åˆ†çš„è³‡æ–™ï¼Œdocument é‚„æ˜¯æœƒè¢«æ•´å€‹ load åˆ° memory é€ æˆæµªè²»ã€‚ä¸¦ä¸” document æ›´æ–°æ™‚é€šå¸¸ä¹Ÿæ˜¯æ•´å€‹ document ä¸€èµ·å¯«å…¥ï¼Œå› æ­¤å°±ç®—åªä¿®æ”¹ä¸€å°éƒ¨åˆ†çš„è³‡æ–™ä¹Ÿæœƒé‡å¯«æ•´å€‹ documentã€‚\n\n### Convergence of document and relational databases\n\nPostgreSQL å¾ v9.3 é–‹å§‹ã€MySQL å¾ v5.7 é–‹å§‹æ”¯æ´ JSON æ ¼å¼çš„æ¬„ä½ã€‚\n\nMongoDB çš„ driver æœƒè‡ªå‹•çš„ join document referenceã€‚\n\nå› æ­¤ relational èˆ‡ document databases ç¾åœ¨æ˜¯è¶Šä¾†è¶Šç›¸è¿‘çš„ï¼Œè®“ä½¿ç”¨è€…åœ¨æ‡‰ç”¨å±¤èƒ½å¤ æ›´æ–¹ä¾¿çš„æŒ‘é¸é©åˆçš„ data modelã€‚\n\n# Query Languages for Data\n\né€™å€‹æ®µè½é–‹å§‹ä»‹ç´¹ declarative language èˆ‡ imperative programming çš„å·®ç•°ã€‚\n\nDeclarative language å³åªæè¿°ç›®æ¨™çš„æ€§è³ªï¼Œä¸é ˆæè¿°è¦å¦‚ä½•é”åˆ°æ­¤ç›®æ¨™ã€‚è€Œ imperative programming å‰‡æ˜¯å¾ˆåƒä¸€èˆ¬çš„ programming languageï¼Œè¦é”åˆ°ç›®æ¨™çš„è©±ä¸€å®šè¦å°‡æµç¨‹å¯«å‡ºã€‚\n\nç°¡å–®ä¾†èªªï¼š**declarative æ˜¯å®šç¾© what to doã€è€Œ imperative æ˜¯å®šç¾© how to do**ã€‚\n\nèˆ‰ä¾‹ä¾†èªª SQL å°±æ˜¯ä¸€ç¨® declarative languageã€CSS ä¹Ÿæ˜¯ä¸€ç¨® declarative languageã€‚\n\nè€Œè³‡æ–™åº«æ›´é©åˆ declarative languageï¼Œå› ç‚ºå¯ä»¥æŠŠå¯¦ä½œçš„è¤‡é›œéƒ½éš±è—èµ·ä¾†ï¼Œè®“ DBMS æ±ºå®šå¦‚ä½•å„ªåŒ–ï¼Œä¸¦ä¸”æ›´é©åˆåšå¹³è¡ŒåŒ–çš„è™•ç†ã€‚\n\n## MapReduce Querying\n\nMapReduce æ˜¯ google æå‡ºçš„è™•ç†å¤§é‡è³‡æ–™çš„ä¸€ç¨® programmingï¼ŒåŒæ™‚ç”¨åˆ°äº† declarative èˆ‡ imperative çš„æ–¹å¼ã€‚\n\n```js\ndb.observations.mapReduce(\n  function map() {\n    var year = this.observationTimestamp.getFullYear();\n    var month = this.observationTimestamp.getMonth() + 1;\n    emit(year + \"-\" + month, this.numAnimals);\n  },\n  function reduce(key, values) {\n    return Array.sum(values);\n  },\n  {\n    query: { family: \"Sharks\" },\n    out: \"monthlySharkReport\"\n  }\n)\n```\n\nå› ç‚º MapReduce éœ€è¦ä½¿ç”¨è€…è‡ªå·±å°å¿ƒçš„æ’°å¯« Javascript ç¨‹å¼ç¢¼ï¼Œé›–ç„¶å¯ä»¥åšåˆ°å¾ˆè¤‡é›œçš„æ“ä½œï¼Œä½†å°æ–¼ç°¡å–®çš„æ“ä½œä¾†èªªï¼Œé‚„æ˜¯ declarative language æ›´é©åˆä½œç‚ºè³‡æ–™åº«çš„æŸ¥è©¢èªè¨€ã€‚\n\nå› æ­¤ MongoDB åœ¨ v2.2 ä¹‹å¾Œæ”¯æ´äº† *aggregation pipeline* çš„ declarative query languageã€‚\n\n```js\ndb.observations.aggregate([\n  { $match: { family: \"Sharks\" } },\n  {\n    $group: {\n      _id: {\n        year:  { $year:  \"$observationTimestamp\" },\n        month: { $month: \"$observationTimestamp\" }\n      },\n      totalAnimals: { $sum: \"$numAnimals\" }\n    }\n  }\n]);\n```\n\n# Graph-Like Data Models\n\nç•¶è³‡æ–™åº«æœ‰å¾ˆå¤šçš„å¤šå°å¤šé—œè¯ï¼Œå°±å¾ˆé©åˆä½¿ç”¨ graph-like data modelã€‚\n\nGraph ä¸­åŒ…å«é»èˆ‡é‚Šï¼Œåœ¨ç¾å¯¦ä¸­çš„ä¾‹å­åŒ…å«ï¼š\n\n- Social graphs: é»ä»£è¡¨äººï¼Œé‚Šä»£è¡¨æœ‹å‹æˆ–æ˜¯è¿½è¹¤é—œä¿‚ã€‚\n- The web graph: é»ä»£è¡¨ç¶²é ï¼Œé‚Šä»£è¡¨é€£åˆ°åˆ¥çš„ç¶²é çš„ linkã€‚\n\nåœ¨ä¸€å¼µ graph ä¸­æ¯å€‹é»èˆ‡é‚Šä¹Ÿå¯ä»¥ä»£è¡¨ä¸åŒæ„ç¾©ï¼Œä¾‹å¦‚ Facebook ç¶­è­·äº†ä¸€å¼µ graphï¼Œå…¶ä¸­ vertex å¯èƒ½æ˜¯äººã€åœ°é»ã€äº‹ä»¶æˆ–æ˜¯ç•™è¨€ï¼Œè€Œé‚Šå¯èƒ½ä»£è¡¨äººåƒåŠ çš„äº‹ä»¶ã€äº‹ä»¶ç™¼ç”Ÿçš„åœ°é»æˆ–æ˜¯äººç•™ä¸‹çš„ç•™è¨€ã€‚\n\nGraph-like data models ä¸»è¦åˆ†ç‚ºå…©ç¨®ï¼Œ*property graph* model ä»¥åŠ *triple-store* modelã€‚\n\n## Property Graphs\n\næ¯å€‹é»éƒ½æœ‰ï¼š\n- ä¸€å€‹ unique ID\n- ä¸€äº›å‡ºé‚Š\n- ä¸€äº›å…¥é‚Š\n- ä¸€äº› propertiesï¼ˆkey-value pairsï¼‰\n\næ¯å€‹é‚Šéƒ½æœ‰ï¼š\n- ä¸€å€‹ unique ID\n- é‚Šçš„èµ·é»è·Ÿçµ‚é»\n- ä¸€å€‹ label\n- ä¸€äº› propertiesï¼ˆkey-value pairsï¼‰\n\n### The Cypher Query Language\n\n*Cypher* æ˜¯ä¸€ç¨® declarative languageï¼Œæ˜¯ Neo4j åœ–è³‡æ–™åº«çš„æŸ¥è©¢èªè¨€ã€‚\n\n```sql\nCREATE\n  (NAmerica:Location {name:'North America', type:'continent'}),\n  (USA:Location      {name:'United States', type:'country'  }),\n  (Idaho:Location    {name:'Idaho',         type:'state'    }),\n  (Lucy:Person       {name:'Lucy' }),\n  (Idaho) -[:WITHIN]->  (USA)  -[:WITHIN]-> (NAmerica),\n  (Lucy)  -[:BORN_IN]-> (Idaho)\n```\n\n```sql\nMATCH\n  (person) -[:BORN_IN]->  () -[:WITHIN*0..]-> (us:Location {name:'United States'}),\n  (person) -[:LIVES_IN]-> () -[:WITHIN*0..]-> (eu:Location {name:'Europe'})\n  RETURN person.name\n```\n\n`()` ä»£è¡¨é»ã€`[]` ä»£è¡¨é‚Šã€`:` ä»£è¡¨é‚Šæˆ–æ˜¯é»çš„ labelã€`{}` å…§çš„ä»£è¡¨ propertiesã€`->` ä»£è¡¨é‚Šçš„æ–¹å‘ï¼Œ`()` æˆ–æ˜¯ `[]` ä¸­æœ€å‰é¢çš„è®Šæ•¸å‰‡æ˜¯å‘½åã€‚\n\n## Graph Queries in SQL\n\nä½œè€…æå‡ºå¦‚æœæŠŠ graph data æ”¾åœ¨ relational structure å…§ï¼Œé‚£éº¼å¯ä»¥ä½¿ç”¨ SQL ä¾†åšæŸ¥è©¢å—ï¼Ÿ\n\nå¯ä»¥è§€å¯Ÿåˆ°ä¸Šé¢çš„ query æœ‰ä¸€å€‹ç‰¹åˆ¥çš„ç¬¦è™Ÿ `*0..`ï¼Œé€™ä»£è¡¨çš„ label æ˜¯ `WITHIN` çš„é‚Šå¯ä»¥å‡ºç¾ 0 åˆ°ä»»æ„å¤šæ¬¡ï¼Œä½†æ˜¯åœ¨ SQL ä¸­ï¼Œä¸¦æ²’æœ‰è¾¦æ³•æŒ‡å®š 0 ~ ä»»æ„å¤šæ¬¡çš„ joinï¼Œè¦åšåˆ°çš„è©±å¿…é ˆé€é SQL ä¸­çš„ `RECURSIVE` èªæ³•ï¼Œæ›´åŠ è¤‡é›œã€‚\n\n## Triple-Stores and SPARQL\n\nTriple-Stores é€éä¸‰å…ƒçµ„ `(subject, predicate, object)` ä¾†å„²å­˜è³‡æ–™ã€‚ä¾‹å¦‚ `(Jim, likes, bananas)`ã€‚\n\nä¸‰å…ƒçµ„ä¹Ÿå¯ä»¥ç”¨ä¾†æè¿° subject çš„ propertiesï¼Œä¾‹å¦‚ `(Jim, age, 33)`ã€‚\n\nå°æ‡‰åˆ°åœ–çš„è©±ï¼Œå‰‡ `subject` æ˜¯é»ã€`predicate` æ˜¯é‚Šã€`object` å¯ä»¥æ˜¯é»æˆ–æ˜¯å€¼ã€‚\n\n### The SPARQL query language\n\n```sql\nSELECT ?personName WHERE {\n  ?person :name ?personName.\n  ?person :bornIn  / :within* / :name \"United States\".\n  ?person :livesIn / :within* / :name \"Europe\".\n}\n```\n\n## Graph Databases Compared to the Network Model\n\nNetwork (CODASYL) model èˆ‡ç¾ä»Šçš„ graph databases çœ‹èµ·ä¾†ååˆ†ç›¸ä¼¼ï¼Œä½†æ˜¯ graph databases èƒ½æˆåŠŸå¤§è‡´æœ‰å¹¾å€‹åŸå› ï¼š\n- CODASYL æ²’æœ‰å¯ä»¥ç›´æ¥ access record çš„æ–¹å¼ï¼Œä½†æ˜¯ Graph Model ä¸­æ¯å€‹ vertex è·Ÿ edge éƒ½æœ‰ uid å¯ä»¥ç›´æ¥ accessã€‚\n- CODASYL ä¸¦æ²’æœ‰ declarative query languageï¼ˆex: Cypherï¼‰ï¼Œå› æ­¤ä¸å¥½åšæŸ¥è©¢ã€‚\n\n# ç¸½çµ\n\nå› ç‚ºæ¯ä¸€ç¨® data model éƒ½å¾ˆè¤‡é›œï¼Œå› æ­¤æœ¬ç« å…ˆä»¥ç¶œè§€çš„è§’åº¦çœ‹å„ç¨® data model çš„æ€§è³ªèˆ‡å„ªç¼ºé»ï¼ŒæœŸæœ›é–‹ç™¼è€…èƒ½å¤ åœ¨ä½¿ç”¨é€™äº› data model æ™‚çˆ²å„ç¨®æƒ…å¢ƒçš„æ‡‰ç”¨æŒ‘é¸æ­£ç¢ºçš„è³‡æ–™æ¨¡å‹ã€‚\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Notes","DDIA"],"categories":["Notes"]},{"title":"Designing Data-Intensive Application ç¬¬ä¸€ç« ç­†è¨˜","url":"/Designing-Data-Intensive-Application-ç¬¬ä¸€ç« ç­†è¨˜/","content":"\n<img src=\"/assets/Designing-Data-Intensive-Application-ç¬¬ä¸€ç« ç­†è¨˜/book-cover.png\" width=\"50%\">\n\n# Introduction\n\nç¾åœ¨çš„è»Ÿé«”åŸºæœ¬ä¸Šéƒ½ä¸æ˜¯ CPU Boundï¼Œè€Œæ˜¯ Data-Intensive çš„ï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•¸çš„ç“¶é ¸éƒ½åœ¨è³‡æ–™çš„é‡è€Œä¸æ˜¯è¨ˆç®—çš„é‡ã€‚å› æ­¤å¤§å¤šæ•¸çš„æ‡‰ç”¨ç¨‹å¼æœƒä¾é å¤šç¨®å·¥å…·ä¾†æ»¿è¶³ä¸åŒæƒ…å¢ƒä¸‹çš„è³‡æ–™ä½¿ç”¨ã€‚\n\nä¾‹å¦‚ä¸€å€‹å¾Œç«¯å¯èƒ½æœƒç”¨åˆ° MySQLã€PostgreSQL ä¾†å„²å­˜è³‡æ–™ï¼Œç”¨ Redis ä¾†åšå¿«å–ï¼Œç”¨ ElasticSearch ä¾†åšæœå°‹å¼•æ“ï¼Œç”¨ RabbitMQã€NATS ä¾†åšç•°æ­¥çš„æ¶ˆæ¯å‚³è¼¸ã€‚æœ‰å„ç¨®å·¥å…·å¯ä»¥æ»¿è¶³ä¸åŒéœ€æ±‚çš„è³‡æ–™ä½¿ç”¨æ–¹å¼ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦çŸ¥é“åœ¨è¨­è¨ˆä¸åŒéœ€æ±‚çš„ç³»çµ±æ™‚ï¼Œè¦å¦‚ä½•æŒ‘é¸ã€ä½¿ç”¨é€™äº›æŠ€è¡“èˆ‡å·¥å…·ã€‚ä¸‹åœ–å³æ˜¯ä¸€ç¨®å¯èƒ½çš„ç³»çµ±æ¶æ§‹ï¼š\n\n![](/assets/Designing-Data-Intensive-Application-ç¬¬ä¸€ç« ç­†è¨˜/system.png)\n\næœ¬ç« ç¯€é‡é»å…ˆæ”¾åœ¨ä¸‰é …è¨­è¨ˆç³»çµ±æ™‚çš„è¦é»ï¼šå¯é æ€§ï¼ˆReliabilityï¼‰ã€å¯æ“´å±•æ€§ï¼ˆScalabilityï¼‰ä»¥åŠå¯ç¶­è­·æ€§ï¼ˆMaintainabilityï¼‰ã€‚\n\n<!-- More -->\n\n# Reliability\n\nä¸€å€‹ç³»çµ±æ˜¯å¯é çš„ï¼Œå¦‚æœèƒ½å¤ åŠŸèƒ½æ­£å¸¸çš„é‹ä½œã€å®¹éŒ¯ï¼ˆFault Toleranceï¼‰ã€æœ‰å¥½çš„æ•ˆç‡ï¼ˆPerformanceï¼‰ä»¥åŠå¯ä»¥é¿å…è¢«æ”»æ“Šã€‚\n\né€™è£¡ç‰¹åˆ¥æåˆ° fault æŒ‡çš„æ˜¯ç³»çµ±èƒŒé›¢åŸæœ¬é æœŸçš„è¡Œç‚ºï¼Œè€Œ failure æŒ‡çš„æ˜¯æ•´å€‹ç³»çµ±å› ç‚ºéŒ¯èª¤è€Œåœæ­¢æœå‹™ã€‚å› ç‚ºä»»ä½•çš„ç³»çµ±éƒ½ä¸å¯èƒ½æ˜¯å®Œå…¨ä¸æœƒæœ‰éŒ¯èª¤ç™¼ç”Ÿçš„ï¼Œå› æ­¤æˆ‘å€‘æ‡‰è©²è¨­è¨ˆä¸€å€‹ fault tolerance çš„ç³»çµ±ä¾†é¿å… failure çš„ç™¼ç”Ÿã€‚\n\nå¦å¤–ï¼Œä½œè€…æåˆ°å¯ä»¥é€éæ•…æ„çš„ç”¢ç”ŸéŒ¯èª¤ä¾†æª¢æŸ¥ç³»çµ±æ˜¯å¦èƒ½å¤ æ‡‰ä»˜é€™äº›éŒ¯èª¤ï¼Œä¾‹å¦‚ Netflix çš„ [Chaos Monkey](https://github.com/Netflix/chaosmonkey) æœƒéš¨æ©Ÿçš„é—œæ‰ VM çš„å®¹å™¨ï¼Œå¼·è¿«å·¥ç¨‹å¸«å»ºç«‹æ›´èƒ½å®¹éŒ¯çš„ç³»çµ±ã€‚é€™å°±æ˜¯æ‰€è¬‚çš„ Chaos Engineeringã€‚\n\n## Hardware Faults\n\nç¡¬ç¢Ÿçš„ Mean Time to Failure(MTTF) åœ¨ 10 ~ 50 å¹´ä¹‹é–“ï¼Œå› æ­¤ä¸€å€‹æœ‰ 10000 å€‹ç¡¬ç¢Ÿçš„å¢é›†å¹³å‡æ¯å¤©éƒ½æœƒæœ‰ä¸€é¡†ç¡¬ç¢Ÿæ•…éšœã€‚\n\né¿å…ç¡¬ç¢Ÿæ•…éšœå°è‡´çš„å•é¡Œï¼Œå¯ä»¥ä½¿ç”¨ RAID ç£ç¢Ÿé™£åˆ—ã€‚å¦å¤–å„ç¨®ç¡¬é«”éƒ½æœ‰å¯èƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œå› æ­¤éƒ½éœ€è¦æœ‰å‚™æ´æ©Ÿåˆ¶ã€‚\n\n> ä¸éç­†è€…èªç‚ºç¾åœ¨å¤§å¤šæ•¸å…¬å¸éƒ½æœƒç›´æ¥æ¡ç”¨é›²ç«¯å¹³å°æä¾›çš„å„ç¨®æœå‹™èˆ‡è³‡æºï¼Œå› æ­¤é€™éƒ¨åˆ†çš„å•é¡Œæ‡‰è©²å¯ä»¥å¤§é‡é¿å…äº†ã€‚ä¸é GCP/AWS æ¯å¹´ä¹Ÿéƒ½æœƒæœ‰å¹¾æ¬¡çš„ System Outageï¼Œå› æ­¤è‹¥æ˜¯æœå‹™å¾ˆé‡è¦çš„è©±ï¼Œå¯èƒ½ç”šè‡³è¦è€ƒæ…®è·¨é›²çš„éƒ¨ç½²æˆ–æ˜¯æ•‘æ´ã€‚\n\n## Software Errors\n\nè»Ÿé«”ç³»çµ±éŒ¯èª¤å¯èƒ½æœƒå°è‡´å…¶ä»–ç³»çµ±ä¹Ÿå—åˆ°å½±éŸ¿ã€‚é›–ç„¶æ²’æœ‰ 100% èƒ½å¤ é¿å…è»Ÿé«”éŒ¯èª¤çš„æ–¹æ³•ï¼Œä½†æœ‰å¾ˆå¤šå°äº‹æƒ…å¯ä»¥å¹«åŠ©æ”¹å–„ï¼Œä¾‹å¦‚æ’°å¯«æ¸¬è©¦ï¼Œå¾å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦åˆ°ç«¯å°ç«¯æ¸¬è©¦ï¼›åšç›£æ§ä»¥ç¢ºå®šç³»çµ±æ­£å¸¸é‹ä½œã€‚\n\n## Human Errors\n\näººé¡æ˜¯ä¸å¯é çš„ï¼Œæ“šèª¿æŸ¥ç³»çµ±å¤§å¤šæ•¸éƒ½æ˜¯å› ç‚ºäººç‚ºæ“ä½œå¤±èª¤è€Œå°è‡´åœæ­¢é‹ä½œï¼Œè€Œå› ç‚ºç¡¬é«”éŒ¯èª¤è€Œå°è‡´çš„éŒ¯èª¤åªæœ‰ 10â€“25%ã€‚\n\nè¦ç›¡é‡é¿å…äººç‚ºæ“ä½œéŒ¯èª¤ï¼Œæœ‰å¹¾é …æ–¹å¼ï¼š\n- å®šç¾©è‰¯å¥½çš„æŠ½è±¡å±¤ã€APIsã€ç®¡ç†è€…ä»‹é¢ã€‚\n- æä¾›ä¸€å€‹è·Ÿé productionï¼Œä½†èˆ‡ production å¹¾ä¹åŠŸèƒ½ä¸€è‡´çš„ç’°å¢ƒã€‚é€šå¸¸å°±æ˜¯æ‰€è¬‚çš„ staging serverã€‚\n- æ’°å¯«å®Œæ•´çš„æ¸¬è©¦ã€‚\n- æœ‰å¿«é€Ÿçš„æ–¹æ³•å¯ä»¥æ¢å¾©éŒ¯èª¤ï¼Œä¾‹å¦‚ rollback changesã€‚\n- åš monitor ä»¥åŠ metricsï¼Œmonitor å¯ä»¥å¹«åŠ©ææ—©çš„ç™¼ç¾éŒ¯èª¤ï¼Œç•¶éŒ¯èª¤ç™¼ç”Ÿæ™‚é€é metrics ä¾†æ’æŸ¥ã€‚ \n\n# Scalability\n\nåœ¨æ€è€ƒå¦‚ä½•æ‡‰ä»˜å¤§é‡çš„æµé‡ä¹‹å‰ï¼Œæ‡‰è©²å…ˆå®šç¾©ç³»çµ±çš„æµé‡ã€‚\n\n## Describing Load\n\nèˆ‰ Twitter ç‚ºä¾‹ï¼Œè‹¥åªæœ‰å…©é …åŠŸèƒ½ï¼š\n1. Post tweetï¼šä½¿ç”¨è€…å¯ä»¥ç™¼å¸ƒ tweetï¼Œæ‰€æœ‰è¿½è¹¤è¨‚é–±è€…éƒ½æœƒæ”¶åˆ°é€šçŸ¥ã€‚4.6k requests/sec at average, 12k requests/sec at peakã€‚\n2. Home timelineï¼šä½¿ç”¨è€…å¯ä»¥æª¢è¦–æ‰€æœ‰çš„è¿½è¹¤è€…ç™¼å¸ƒçš„ tweetsã€‚ 300k requests/secã€‚\n\næœ‰å…©ç¨®ä¸åŒæ–¹å¼å¯ä»¥åšåˆ° View home timeline çš„åŠŸèƒ½ï¼š\n\n1. ä½¿ç”¨ SQL Join\n\n\t```sql\n\tSELECT tweets.*, users.* FROM tweets\n\tJOIN users ON tweets.sender_id = users.id\n\tJOIN follows ON follows.followee_id = users.id\n\tWHERE follows.follower_id = current_user\n\t```\n\n2. å°æ¯ä¸€å€‹ä½¿ç”¨è€…ç¶­è­·ä¸€å€‹ Cache Queueï¼Œç•¶ tweet ç™¼å‡ºæ™‚ï¼Œå°‡è¨Šæ¯é€åˆ°æ¯å€‹è¨‚é–±è€…çš„ Queueã€‚\n\nä¸€é–‹å§‹ Twitter æ¡ç”¨çš„æ˜¯æ–¹æ³• 1ï¼Œä½†æ˜¯ç•¶ä½¿ç”¨è€…å¤šèµ·ä¾†æ™‚ï¼Œæ¯æ¬¡çš„ view home timeline éƒ½è¦åš SQL Joinï¼Œé€ æˆéå¤šçš„æµé‡ã€‚\n\nå› ç‚ºä½¿ç”¨è€…çš„å¹³å‡è¿½è¹¤è€…æ˜¯ 75 äººï¼Œç­‰æ–¼æ¯æ¬¡çš„æ¨æ–‡å¹³å‡éœ€è¦ $75\\times 4.6k=345k$ æ¬¡çš„ cache writesï¼Œå› ç‚º post tweet çš„æµé‡æ˜¯æ¯” view home timeline ä½è¨±å¤šçš„ï¼Œå› æ­¤ Twitter æ”¹æ¡ç”¨äº†æ–¹æ³• 2ï¼Œä¾†é™ä½ view home timeline é€ æˆçš„ bottleneckã€‚\n\nä½†æ˜¯æœ‰äº›ä½¿ç”¨è€…æœ‰è¶…é3åƒè¬å€‹è¿½è¹¤è€…ï¼Œå› æ­¤æ¯æ¬¡ä»–ç™¼å¸ƒæ¨æ–‡æ™‚éœ€è¦3åƒè¬æ¬¡çš„ cache writesï¼Œå¯èƒ½æœƒé€ æˆç³»çµ±çš„è² æ“”ï¼Œå› æ­¤æœ€å¾Œ Twitter æ¡å–äº† Hybrid çš„åšæ³•ï¼Œå°æ–¼éå¤šè¿½è¹¤è€…çš„ç”¨æˆ¶ï¼Œä»–å€‘çš„ç™¼æ¨å°±ä¸æ¡ç”¨ç¬¬äºŒç¨®åšæ³•ã€‚\n\nç”±é€™å€‹ä¾‹å­å°±å¯ä»¥å¾ˆè¼•æ˜“çš„çŸ¥é“ï¼Œæ ¹æ“šæ¯å€‹ç³»çµ±ã€æ¯é …åŠŸèƒ½çš„ä¸åŒæµé‡é«˜ä½ï¼Œéƒ½æœƒæœ‰å°æ‡‰ä¸ä¸€æ¨£çš„è¨­è¨ˆæ–¹å¼ã€‚\n\n## Describing Performance\n\nå¯ä»¥ç”¨ä»¥ä¸‹å…©é»ä¾†åˆ†æç³»çµ±æ•ˆèƒ½ï¼š\n\n- ç•¶æµé‡å¢åŠ æ™‚ï¼Œç³»çµ±çš„æ•ˆèƒ½æœƒå—åˆ°å¤šå°‘å½±éŸ¿ï¼Ÿ\n- ç•¶æµé‡å¢åŠ æ™‚ï¼Œéœ€è¦å¢åŠ å¤šå°‘è³‡æºï¼ˆCPU, Memory, Network bandwithï¼‰æ‰èƒ½ä½¿çš„ç³»çµ±æ•ˆèƒ½ä¸è®Šã€‚\n\né€šå¸¸è©•ä¼°çš„æ–¹å¼æ˜¯ Response Timeï¼Œå¾ client ç™¼èµ·è«‹æ±‚åˆ°æ”¶åˆ°è«‹æ±‚æ‰€ç¶“éçš„æ™‚é–“ã€‚\n\né€šå¸¸ä¸æœƒçœ‹å¹³å‡ï¼Œå› ç‚ºå¹³å‡ç„¡æ³•ä»£è¡¨ä½¿ç”¨è€…çœŸæ­£æ”¶åˆ°çš„å»¶é²æ™‚é–“ã€‚é€šå¸¸æœƒæ¡ç”¨ç™¾åˆ†ä½æ•¸ï¼ˆPercentileï¼‰ï¼Œä¹Ÿå°±æ˜¯å°‡ response time ç”±ä½åˆ°é«˜æ’åºå¾ŒæŸå€‹ç™¾åˆ†é»å°æ‡‰çš„æ•¸å€¼ã€‚\n\n$p_k$ ä»£è¡¨ç¬¬kç™¾åˆ†ä½æ•¸ã€‚\n\n- $p_{50}$ å¯ä»¥çŸ¥é“ä½¿ç”¨è€…é€šå¸¸ç­‰å¾…çš„æ™‚é–“ã€‚\n- $p_{95}, p_{99}, p_{999}$ ä¹Ÿå¯ä»¥ç¨±ä½œ tail latencyï¼Œæ˜¯æ¯”è¼ƒé‡è¦çš„è§€å¯Ÿé»ï¼Œå¯ä»¥ç”¨ä¾†è§€å¯Ÿå¤§å¤šæ•¸çš„ä½¿ç”¨è€…çš„ç­‰å¾…æ™‚é–“ã€‚\n\n> ä½†ä¹Ÿä¸æ˜¯è¶Šå¤š 9 å°±è¶Šå¥½ï¼Œå› ç‚ºæ¯å¤šä¸€å€‹ 9 éƒ½æœƒä½¿å¾—ç¶­é‹æˆæœ¬å¤§å¹…å¢åŠ ã€‚\n\nåœ¨æ¸¬è©¦æ™‚ï¼Œè¦å¾ client ç«¯è¨ˆç®— response timeï¼Œä¸¦ä¸” requests è¦åŒæ™‚é€å‡ºï¼Œæ‰èƒ½é”åˆ°çœŸæ­£çš„æ•ˆæœã€‚\n\n## Approaches for Coping with Load\n\nåœ¨æµé‡å¢åŠ é€Ÿåº¦å¾ˆå¿«çš„æœå‹™ä¸‹ï¼Œå¿…ç„¶å¯èƒ½æœƒéœ€è¦é‡æ§‹ç³»çµ±æ¶æ§‹ã€‚\n\nä¸éåœ¨ä¸å‹•ç³»çµ±æ¶æ§‹çš„å‰æä¸‹ï¼Œé€šå¸¸æœ‰å…©ç¨®æ–¹å¼å¯ä»¥ scale upï¼š\n\n1. Vertical scalingï¼šå¢åŠ  CPUã€å¢åŠ  Memoryï¼Œä½¿ç”¨æ›´å¥½çš„æ©Ÿå™¨ã€‚\n2. Horizontal scalingï¼šå°‡æµé‡åˆ†æ•£åˆ°å¤šå° server ä¸Šã€‚\n\né€šå¸¸è¦ vertical scaling æ˜¯æ¯”è¼ƒå®¹æ˜“çš„ï¼Œä½†æ˜¯å¤ªé«˜è¦æ ¼çš„æ©Ÿå™¨æ˜¯éå¸¸æ˜‚è²´çš„ï¼Œå› æ­¤æœ‰ä¸€å®šæµé‡çš„ç³»çµ±é€šå¸¸æœƒç„¡å¯é¿å…çš„è¦åš horizontal scalingã€‚å°‡ stateless çš„æœå‹™ï¼ˆEx: front-end serverï¼‰åš horizontal scaling æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æ˜¯ stateful çš„æœå‹™è¦è®Šæˆ distributed system å°±æœƒè¡ç”Ÿå‡ºå¾ˆå¤šå•é¡Œï¼Œå› æ­¤é€šå¸¸æœƒæ¡ç”¨ vertical scaling ç›´åˆ°åƒ¹æ ¼ç„¡æ³•æ‡‰ä»˜ã€‚\n\nç•¶ç„¶å› æ‡‰ç¾åœ¨è³‡è¨Šçˆ†ç‚¸ï¼Œè³‡æ–™é‡è¶Šä¾†è¶Šå¤§çš„æƒ…å½¢ï¼Œç¾åœ¨ä¹Ÿå·²ç¶“æœ‰å¾ˆå¤š distributed system çš„å·¥å…·èˆ‡è§£æ±ºæ–¹æ¡ˆäº†ã€‚é€™äº›éƒ½æœƒåœ¨å¾Œé¢çš„æ›¸ä¸­å¾Œé¢çš„ç« ç¯€æåˆ°ã€‚\n\n# Maintainability\n\næ²’æœ‰å·¥ç¨‹å¸«æœƒæƒ³è¦æ¥æ‰‹ [legacy system](https://en.wikipedia.org/wiki/Legacy_system)ï¼Œå› æ­¤ï¼Œä¿æŒç³»çµ±çš„å¯ç¶­è­·æ€§ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚\n\n## Operability: Making Life Easy for Operations\n\nä¸€å€‹å¥½çš„ç¶­é‹åœ˜éšŠæ‡‰è©²è¦åšåˆ°ï¼š\n- ç›£æ§ç³»çµ±çš„å¥åº·ä¸¦ä¸”å¦‚æœç³»çµ±é™£äº¡èƒ½å¿«é€Ÿçš„å¾©åŸ\n- åšéŒ¯èª¤çš„è¿½è¹¤ä»¥åŠæ•ˆèƒ½çš„è¿½è¹¤ï¼Œä¾‹å¦‚ request åœ¨å“ªè£¡æ˜¯ bottleneck\n- ç³»çµ±å®‰å…¨æ€§çš„ä¿®è£œ\n- å»ºç«‹éƒ¨ç½²ã€é…ç½®ã€ç®¡ç†æ–¹é¢çš„å¯¦è¸æ–¹å¼èˆ‡å·¥å…·\n\nç•¶ç„¶é‚„æœ‰æ›´å¤šï¼Œé€™è£¡åªæä¸€äº›ç­†è€…èªç‚ºæ¯”è¼ƒé‡è¦çš„ã€‚\n\n## Simplicity: Managing Complexity\n\nå¯ä»¥åˆ©ç”¨æŠ½è±¡ä¾†ç°¡åŒ–ç¨‹å¼çš„è¤‡é›œåº¦ã€‚\n\n## Evolvability: Making Change Easy\n\nç³»çµ±æ˜¯ä¸æœƒæ°¸é ä¸è®Šçš„ã€‚Aglie æ•æ·é–‹ç™¼æ–¹æ³•å³æ˜¯æ¡ç”¨ä¸€ç¨®æ“æŠ±æ”¹è®Šçš„æ…‹åº¦ï¼Œå…¶ä¸­é‚„æå‡ºäº†ä¾‹å¦‚ TDDï¼ˆTest-Driven Designï¼‰èˆ‡ Refactoring çš„æ–¹æ³•ã€‚\n\n# Summary\n\nè¨­è¨ˆç³»çµ±æ™‚ä¸‰å€‹é‡è¦çš„è§€é»ï¼Œå¯é æ€§ï¼ˆReliabilityï¼‰ã€å¯æ“´å±•æ€§ï¼ˆScalabilityï¼‰ä»¥åŠå¯ç¶­è­·æ€§ï¼ˆMaintainabilityï¼‰ã€‚\n\n- Reliabilityï¼šç³»çµ±è¦å¯ä»¥å®¹éŒ¯ã€‚\n- Scalabilityï¼šç³»çµ±è² è¼‰å¢åŠ æ™‚ä¹Ÿèƒ½ä¿æŒæ€§èƒ½ã€‚\n- Maintainabilityï¼šé™ä½å·¥ç¨‹å¸«èˆ‡ç¶­é‹åœ˜éšŠå·¥ä½œçš„è¤‡é›œåº¦ã€‚\n\n> æœ€å¾Œï¼Œå¦‚æœä½ å–œæ­¡é€™ç¯‡æ–‡ç« ï¼Œæˆ–æ˜¯æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Notes","DDIA"],"categories":["Notes"]},{"title":"2021 Dcard Web Backend Intern é¢è©¦ç¶“é©—åˆ†äº«","url":"/2021-Dcard-Web-Backend-Intern-é¢è©¦ç¶“é©—åˆ†äº«/","content":"\nè·é›¢æ”¶åˆ°éŒ„å–é€šçŸ¥å·²ç¶“æœ‰å…©å€‹æœˆäº†ï¼Œæ±ºå®šä¾†åˆ†äº«ä¸€ä¸‹ç•¶åˆå» Dcard é¢è©¦çš„å¿ƒå¾—è·Ÿéç¨‹ï½\n\né›–ç„¶æˆ‘æœ¬ä¾†å°±æœ‰åœ¨æ–°å‰µå…¬å¸å·¥ä½œï¼Œä½†æ˜¯æ–°å‰µå…¬å¸æ¨£æ¨£éƒ½è¦è‡ªå·±ä¾†ï¼Œè€Œä¸”æ²’æœ‰ä¸€å€‹ Mentor å¸¶é ˜ï¼Œç”¢å“ä¹Ÿæ¯”è¼ƒæ²’æœ‰æµé‡ï¼Œå¾ˆé›£åˆ¤æ–·è‡ªå·±åšå‡ºçš„ç³»çµ±æ¶æ§‹æ˜¯ä¸æ˜¯ä¸€å€‹å¥½çš„æ¶æ§‹ï¼Œå› æ­¤ä»Šå¹´æ±ºå®šç”³è«‹ Dcard å¯¦ç¿’ï¼Œä¾†é«”é©—çœ‹çœ‹é«˜æµé‡çš„ backend é–‹ç™¼ï¼\n\n# é¢è©¦æµç¨‹\n\nDcard çš„é¢è©¦æµç¨‹ç®—æ˜¯æ»¿é€æ˜çš„ï¼ŒåŸºæœ¬ä¸Šåˆ†æˆ 3 å¤§é—œï¼Œå±¥æ­·å¯©æŸ¥ã€ç¬¬ä¸€æ¬¡é¢è©¦è·Ÿç¬¬äºŒæ¬¡é¢è©¦ã€‚\n\næ•´å€‹æµç¨‹èµ°çš„ä¹Ÿç®—æ»¿å¿«çš„ï¼Œå¤§æ¦‚ä¸€å€‹æœˆå°±æœƒæŠŠæ•´å€‹é¢è©¦æµç¨‹èµ°å®Œï¼Œè€Œä¸”å„å€‹éšæ®µæœ‰æ²’æœ‰é€šééƒ½æœƒå¯„ä¿¡é€šçŸ¥ï¼Œéå¸¸æ£’ï½\n\n<!-- More -->\n\n## å±¥æ­·å¯©æŸ¥\n\nä¸€é–‹å§‹ç•¶ç„¶æ˜¯é™„ä¸Šå±¥æ­·ï¼å±¥æ­·çš„éƒ¨åˆ†æˆ‘æ˜¯å¯«æ»¿ä¸€é æ•´è€Œå·²ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å¯«ä¸Šå·¥ä½œç¶“æ­·ã€å¯«éæ¯”è¼ƒé‡è¦çš„ Side Projectã€é»‘å®¢æ¾ã€è®€æ›¸æœƒç­‰ç­‰ã€‚\n\nå› ç‚ºæˆ‘å€‹äººèªç‚º Dcard é‚„æ»¿çœ‹é‡ä½ çš„è‡ªå­¸èƒ½åŠ›ä»¥åŠä½ æ˜¯ä¸æ˜¯å–œæ­¡èˆ‡äººåˆ†äº«äº¤æµï¼Œæ‰€ä»¥æ”¾çš„å…§å®¹éƒ½æ˜¯æ¯”è¼ƒåè‡ªå­¸ã€äº¤æµæ€§è³ªçš„æ´»å‹•ï¼Œä¸€äº›åœ¨å­¸æ ¡åšéçš„åŠ©æ•™è·Ÿç¶²é é–‹ç™¼çš„æ‰“å·¥å€’æ˜¯éƒ½æ²’æœ‰æ”¾é€²å»ã€‚\n\nå¦‚æœæƒ³è¦åƒè€ƒå±¥æ­·è¦æ€éº¼å¯«çš„è©±ï¼Œå¯ä»¥åˆ° [é—œæ–¼æˆ‘](/about) é é¢æŸ¥çœ‹ã€‚\n\nç”³è«‹ Dcard å¯¦ç¿’æœ‰å€‹æ¯”è¼ƒç‰¹åˆ¥çš„åœ°æ–¹æ˜¯è¦äº¤ä¸€ä»½ä½œæ¥­ï¼Œæ˜¯å¯¦ä½œä¸€å€‹ Rate Limiter Middlewareï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨ä¸€å®šæ™‚é–“å…§è¶…éä¸€å®šæ•¸é‡çš„ Requests è¦å›å‚³ 429 Too Many Requestsï¼ŒåŸºæœ¬ä¸Šèªè¨€æ–¹æ³•ä¸é™ï¼Œæˆ‘æ˜¯ç”¨ NodeJS + Redis ä¾†å¯¦ä½œçš„ã€‚è©³ç´°å¯ä»¥åƒè€ƒæˆ‘çš„ [Github Repo](https://github.com/justin0u0/rate-limiter)ã€‚\n\nå¦å¤–ç”³è«‹å¯¦ç¿’æ˜¯å¯ä»¥é™„ä¸Šæ‡‰å¾µä¿¡çš„ï¼Œè£¡é¢å¯ä»¥é™„ä¸Šä¸€äº›å±¥æ­·æ²’æœ‰æåˆ°çš„å…§å®¹ï¼ˆå±¥æ­·ä¸»è¦ä»¥æŠ€è¡“èƒŒæ™¯ç‚ºä¸»ï¼‰ï¼Œä¾‹å¦‚æˆ‘åœ¨æ‡‰å¾µä¿¡è£¡é¢æåˆ°äº†æˆ‘ç‚ºä»€éº¼æœƒæƒ³ä¾† Dcard åƒåŠ å¯¦ç¿’ä»¥åŠä¸€äº›å€‹äººç‰¹è³ªã€‚æƒ³åƒè€ƒçš„å¯ä»¥çœ‹[é€™è£¡](https://www.notion.so/justin0u0/Dcard-Web-Backend-Intern-2021-c13e8e7777d9421398f28049596b2b1a)ã€‚\n\n## ç¬¬ä¸€æ¬¡é¢è©¦\n\n### Talent Operation Team (HR)\n\né¦–å…ˆæ˜¯ HR é¢è©¦ï¼Œç¸½æ™‚é–“æ˜¯ä¸€å°æ™‚ï¼ˆä½†æˆ‘ä¸åˆ°ä¸€å°æ™‚å°±çµæŸäº†ï¼‰ã€‚ä¸€é–‹å§‹æ˜¯ 5 åˆ†é˜çš„è‡ªæˆ‘ä»‹ç´¹ï¼Œæƒ³åƒè€ƒçš„å¯ä»¥çœ‹[é€™è£¡](https://www.notion.so/justin0u0/73ec63ea80ab42b09fb18cbb68188930)ã€‚å†ä¾†å°±æ˜¯å›ç­” HR çš„å•é¡Œï¼ŒåŸºæœ¬ä¸Šæˆ‘å€‹äººæ„Ÿè¦º Dcard å¾ˆåœ¨ä¹ä½ å°å…¬å¸çš„çœ‹æ³•ã€ä½ ä¾†åƒåŠ çš„å‹•æ©Ÿç­‰ç­‰ï¼Œæ¯”å¦‚èªªæˆ‘æœ‰è¢«å•åˆ°ã€Œç‚ºä»€éº¼æœƒåœ¨å¤§ä¸‰çš„æ™‚å€™å°±æƒ³è¦ä¾†åš Internï¼Ÿã€æˆ–æ˜¯ã€Œç‚ºä»€éº¼æœƒèµ° Backend é€™æ¢è·¯è€Œä¸æ˜¯å…¶ä»–æ–¹å‘ã€ã€‚HR ä¹Ÿæœƒé‡å°ä½ çš„å±¥æ­·æå‡ºå•é¡Œï¼Œä¾‹å¦‚æˆ‘æœ‰è¢«å•åˆ°ã€Œç‚ºä»€éº¼æœƒå¯« Blogï¼Ÿã€ï¼Œè®“æˆ‘çœŸçš„è¦ºå¾— Dcard çš„ HR å¾ˆç”¨å¿ƒä¹Ÿå¾ˆè¦ªåˆ‡ï¼Œåœ¨èŠå¤©çš„éç¨‹ä¸­å°±èƒ½é«”æœƒå‡ºä¾†ä½ çš„å±¥æ­·æœ‰è¢«èªçœŸçš„çœ‹éï¼Œè€Œä¸” HR å°æ–¼è³‡è¨Šé€™æ–¹é¢çš„çŸ¥è­˜ä¹Ÿéƒ½ç•¥çŸ¥ä¸€äºŒã€‚\n\nç¸½ä¹‹ HR é¢è©¦é—œæ•´é«”ä¾†èªªå°±å¾ˆåƒåœ¨èŠå¤©ä¸€æ¨£ï¼Œé‡é»å°±æ˜¯å±¥æ­·ä¸€å®šä¸èƒ½é€ å‡ï¼æœ€å¾Œæœƒå•ä½ æœ‰æ²’æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œï¼Œå¦‚æœæ²’æœ‰çš„è©±å°±æœƒé€²åˆ°é–‹ç™¼é¢è©¦ã€‚\n\n### Development Team\n\nç”± Backend çš„æˆå“¡ä¾†é¢è©¦ï¼Œç¸½æ™‚é–“ä¹Ÿæ˜¯ä¸€å°æ™‚ï¼ˆä½†æˆ‘ä¹Ÿæ˜¯ä¸åˆ°ä¸€å°æ™‚ï¼‰ï¼Œè½èªªæœ¬ä¾†æ˜¯æœ‰ Backend Team çš„ä¸»ç®¡æœƒä¾†çš„ï¼Œä½†æˆ‘å»çš„æ™‚é–“å¥½åƒå‰›å¥½ä¸»ç®¡åœ¨é–‹æœƒï¼Œæ‰€ä»¥å°±æ˜¯å…©å Backend Engineer ä¾†å¹«æˆ‘é¢è©¦ï½\n\né€™é—œä¸»è¦å°±æ˜¯è€ƒé©—ä½ çš„æŠ€è¡“å¯¦åŠ›äº†ï¼Œä¸éæˆ‘è¦ºå¾—å•çš„å•é¡Œé‚„æ»¿éš¨æ€§çš„ï¼Œé™¤äº†æœ€å¾Œä¸€é¡Œä¹‹å¤–ï¼Œå…¶ä»–å•é¡Œéƒ½æ˜¯åœç¹è‘—ä½ çš„å±¥æ­·ä¸Šé¢æœ‰æåˆ°çš„æŠ€è¡“ï¼Œè·Ÿä¸€äº›æ»¿åŸºç¤çš„ Backend çŸ¥è­˜ä¾†æå•çš„ã€‚æˆ‘æœ‰è¢«å•åˆ°çš„å•é¡Œè·Ÿæˆ‘çš„ä¸€äº›å›ç­”åŒ…æ‹¬ï¼š\n\n1. RDBMS v.s NoSQL åˆ†åˆ¥æ˜¯ä»€éº¼ï¼Ÿ\n\tRDBMS ä¸»è¦åˆ©ç”¨è³‡æ–™æ­£è¦åŒ–ä¾†åˆ†å‰²è³‡æ–™åº«ï¼Œå»ºæˆä¸€å¼µå¼µè¡¨å¾Œåˆ©ç”¨ Join çš„æ–¹å¼ä¾†åˆä½µè³‡æ–™ã€‚\n\tNoSQL çµ¦äº†æ–¹ä¾¿çš„å½ˆæ€§ï¼Œæœ‰å¾ˆå¤šé¡å‹ï¼Œä¾‹å¦‚ï¼šDocument basedã€Graphã€Key-Value...\n2. RDBMS v.s NoSQL è¦æ€éº¼åšå‡ºé¸æ“‡ï¼Ÿ\n\tRDMBS è·Ÿ NoSQL çš„ use case ä¸å¤ªä¸€æ¨£ï¼ŒRDBMS æ¯”è¼ƒé©åˆè¢«ç”¨åœ¨éœ€è¦ç¢ºä¿ ACID çš„è³‡æ–™ä¸Šï¼Œä»¥ç¢ºä¿è³‡æ–™çš„ä¸€è‡´æ€§ï¼›è€Œ NoSQL é€šå¸¸éƒ½æ˜¯å¸Œæœ›å¯ä»¥åˆ†æ•£å¼ä¾†æé«˜å¯ä»¥æ€§ä»¥åŠå¯æ“´å……æ€§ã€‚å¦å¤–é‚„æœ‰ä¸€å€‹è€ƒé‡çš„é»æ˜¯ RDBMS çš„ Join æœƒä½¿å¾—ä»–ä¸é©åˆç”¨åœ¨å¾®æœå‹™ä¸Šï¼Œå› ç‚ºè·¨ services çš„ transactions éœ€è¦é¡å¤–çš„ effort ä¾†å¯¦ä½œã€‚\n3. ACID æ˜¯ä»€éº¼ï¼Ÿ\n\tA æ˜¯ Atomicï¼ŒåŸå­æ€§ï¼Œä¸€å€‹äº‹å‹™ä¸æ˜¯å…¨éƒ¨æˆåŠŸå°±æ˜¯å…¨éƒ¨å¤±æ•—ã€‚\n\tC æ˜¯ Consistencyï¼Œäº‹å‹™å®Œæˆå¾Œè³‡æ–™æ­£ç¢ºç„¡èª¤ã€‚\n\tI æ˜¯ Isolationï¼Œäº‹å‹™æœ‰éš”é›¢ç´šåˆ¥ï¼Œç¢ºä¿åŒæ™‚ç™¼ç”Ÿçš„äº‹å‹™ä¸æœƒç™¼ç”ŸéŒ¯èª¤ã€‚\n\tD æ˜¯ Durabilityï¼Œäº‹å‹™ä¸€æ—¦æˆåŠŸè³‡æ–™å°±ä¸æœƒéºå¤±ã€‚\n4. Authentication è·Ÿ Authorization çš„å·®åˆ¥ã€‚\n\tAuthentication é©—è­‰èº«ä»½ï¼Œä¾‹å¦‚å¸³è™Ÿå¯†ç¢¼ï¼›Authorization é©—è­‰æœ‰æ²’æœ‰æ¬Šé™ä½¿ç”¨é€™å€‹åŠŸèƒ½ã€‚\n5. Authentication æ€éº¼åšï¼Ÿ\n\tå¯ä»¥ç”¨ JWTã€‚\n6. ç°¡å–®çš„èªªæ˜ JWT çš„æŠ€è¡“ã€‚\n\tJWT æ˜¯ JSON Web Tokenï¼Œä¸»è¦åˆ†æˆä¸‰æ®µï¼Œç”¨ `.` é€£æ¥èµ·ä¾†ã€‚ç¬¬ä¸€æ®µæ˜¯ headerï¼Œç¬¬äºŒæ®µæ˜¯ payloadï¼Œå‰å…©æ®µéƒ½ç”¨ Base64 ç·¨ç¢¼ï¼Œæœ€å¾Œä¸€æ®µæ˜¯å‰å…©æ®µçš„åŠ å¯†æ–‡ã€‚å¯ä»¥ç”¨ä¾†é˜²æ­¢æ”œå¸¶çš„è³‡è¨Šè¢«ä¿®æ”¹ï¼Œå› ç‚ºç«„æ”¹è€…ç„¡æ³•çŸ¥é“ç¬¬ä¸‰æ®µçš„åŠ å¯†çµæœç‚ºä½•ã€‚\n7. çµ¦ä½ å…©å€‹å¾ˆé•·çš„ SQL è·Ÿä»–å€‘çš„ Explain çµæœï¼Œè«‹ä½ è¬›è§£å…©æ®µ SQL åšäº†ä»€éº¼ï¼Œä»¥åŠä»–å€‘çš„å·®åˆ¥ã€‚\n\té€™é¡ŒåŸºæœ¬ä¸Šæ˜¯æœ€é›£çš„äº†ï¼Œå› ç‚ºé‚£æ™‚å€™å° PostgreSQL é‚„ä¸æ˜¯å¾ˆç†Ÿï¼Œæ‰€ä»¥å…¶å¯¦æ²’æœ‰å›ç­”çš„å¾ˆå¥½ã€‚ä½†ä¸»è¦å°±æ˜¯è¦å° SQL èªæ³•æœ‰åŸºç¤çš„çŸ¥è­˜ï¼Œç‰¹åˆ¥æ˜¯å¸¸å¸¸ä½¿ç”¨ ORM è€Œä¸æ˜¯ç›´æ¥å¯« SQL çš„ï¼Œè‡³å°‘è¦çŸ¥é“ SQL Join æ€éº¼ä½¿ç”¨ã€‚\n\nç¸½ä¹‹æˆ‘è¦ºå¾—å›ç­”çš„é‡é»å°±åœ¨æ–¼ï¼Œä¸è¦æåˆ°è‡ªå·±ä¸ç†Ÿçš„æŠ€è¡“ï¼Œå› ç‚ºä»–å€‘å¾ˆæœ‰å¯èƒ½ç¹¼çºŒè¿½å•ä½ åœ¨å›ç­”ä¸­è¬›åˆ°çš„æŠ€è¡“ã€‚è€Œé€™éƒ¨åˆ†çš„é¡Œç›®å¤§æ¦‚ä¹Ÿæ˜¯å› äººè€Œç•°ï¼Œæˆ‘è¢«å•åˆ°çš„é¡Œç›®è·Ÿæˆ‘åœ¨æº–å‚™æ™‚çœ‹åˆ°å…¶ä»–äººåˆ†äº«çš„é¡Œç›®ä¹Ÿæ˜¯å®Œå…¨ä¸ç›¸åŒï¼Œæ‰€ä»¥åœ¨å±¥æ­·è£¡é¢ä¹Ÿè¿‘é‡åˆ¥å¯«è‡ªå·²ä¸ç†Ÿçš„æŠ€è¡“å§xDï¼Œä¸ç„¶å¤§æ¦‚æœ‰å¤§æ©Ÿæœƒæœƒè¢«å•å€’ã€‚\n\næœ€å¾Œä¹Ÿæœƒè©¢å•æœ‰æ²’æœ‰ä»€éº¼æƒ³å•çš„ï¼ŒåŸºæœ¬ä¸Šæˆ‘æœ‰è©¢å•ä»–å€‘ç”¨çš„æ¡†æ¶ã€ä»–å€‘çš„é–‹ç™¼æµç¨‹ç­‰ç­‰ã€‚\n\n## ç¬¬äºŒæ¬¡é¢è©¦\n\n### Talent Operation Manager (HR Manager)\n\né€™é—œæ˜¯ 30 åˆ†é˜ã€‚åŸºæœ¬ä¸Šè·Ÿç¬¬ä¸€æ¬¡é¢è©¦çš„ HR é¢è©¦å·®ä¸å¤šï¼Œä½†å…§å®¹æœƒåå‘æ›´å¤§æ–¹å‘çš„è¨è«–ã€‚ä¸€æ¨£çœŸçš„è¦ç¨±è®šä¸€ä¸‹ Dcard çš„ HRï¼Œéƒ½éå¸¸çš„è¦ªåˆ‡ï¼†æº–å‚™å……è¶³ã€‚\n\n### CEO - Kytu\n\né¦–å…ˆï¼ŒCEO çš„åå­—çš„å¿µæ³•è·Ÿ Kit æ˜¯åŒéŸ³çš„ï¼Œé€™å€‹æˆ‘åœ¨å»é¢è©¦å‰æŸ¥äº†å¥½ä¹…æ‰æŸ¥åˆ°xDã€‚\n\né€™é—œæ˜¯ 30 åˆ†é˜ã€‚åŸºæœ¬ä¸Šåœ¨åˆ¥äººçš„é¢è©¦åˆ†äº«æœ‰çœ‹åˆ°ï¼Œå°±æ˜¯è·Ÿ CEO çš„èŠå¤©é—œã€‚åŸºæœ¬ä¸Šä¸€åä¸‹å°±æœƒå•ä½ æœ‰æ²’æœ‰ä»€éº¼æƒ³å•çš„å•é¡Œï¼Œæ‰€ä»¥ä¸€å®šè¦æå‰æº–å‚™ä¸€äº›ä½ æƒ³è¦å•çš„å•é¡Œï¼Œé™¤éä½ çš„è‡¨å ´åæ‡‰çœŸçš„å¾ˆå¥½ã€‚\n\nåŸºæœ¬ä¸Šæƒ³è¦è·Ÿ CEO èŠä»€éº¼éƒ½æ²’å•é¡Œï¼Œæˆ‘æœ‰è©¢å•é—œæ–¼ Dcard å¾ä¸€å€‹ 10 äººåœ˜éšŠåˆ°ç¾åœ¨ 200 äººçš„ç®¡ç†å•é¡Œï¼Œé‚„æœ‰è©¢å•ä¸€äº›è·æ¶¯è¦åŠƒï¼Œè¨è«–è®€ç ”ã€æ˜¯å¦è¦å‡ºåœ‹ç­‰å•é¡Œã€‚\n\nå•é¡Œå¯ä»¥ç›¡é‡æº–å‚™å¤šä¸€é»ï¼Œå› ç‚º CEO å›ç­”çš„é€Ÿåº¦é‚„æ»¿å¿«çš„ã€‚\n\n# ç¸½çµ\n\nDcard çš„é¢è©¦ç¸½é«”æ„Ÿå—æ˜¯æ»¿å¥½çš„ï¼Œéå¸¸çœ‹é‡ä½ å°å…¬å¸çš„çœ‹æ³•ã€‚ç¬¬ä¸€æ¬¡é¢è©¦æ™‚é‚„æœƒå¸¶ä½ åƒè§€è¾¦å…¬å®¤ï¼Œå¸¶ä½ åˆ°ä»–å€‘çš„é›¶é£Ÿå€æ‹¿é£Ÿç‰©ï¼›ç¬¬äºŒæ¬¡é¢è©¦æ™‚ CEO é‚„è«‹å–æ˜Ÿå·´å…‹ï¼Œé›–ç„¶æˆ‘æ ¹æœ¬ä¸æ•¢åœ¨ç•¶ä¸‹å–å°±æ˜¯äº†xD\n\nåŸºæœ¬ä¸Šå¦‚æœèªªè¦æº–å‚™çš„è©±ï¼Œæˆ‘å¼·çƒˆå»ºè­°å¤šå»çœ‹çœ‹ä¸€äº›é—œæ–¼ Dcard çš„æ–‡ç« å ±å°ï¼Œæˆ–æ˜¯ CEO çš„æ¼”è¬›ä¹Ÿå¯ä»¥ç¨å¾®çœ‹çœ‹ï¼Œæœƒå°ä½ åœ¨é¢è©¦æ™‚çš„æ‡‰ç­”é‚„æ»¿æœ‰å¹«åŠ©çš„ï½\n\né›–ç„¶é¢è©¦æ•´é«”éç¨‹æ˜¯èµ°æ¯”è¼ƒè¼•é¬†çš„è·¯ç·šï¼Œä½†æˆ‘èªç‚º Dcard å°å¯¦ç¿’ç”Ÿçš„å¯©æ ¸æ˜¯éå¸¸é‡è¦–ä¹Ÿä¸éš¨ä¾¿çš„ï¼æˆ‘èªç‚º Dcard é‚„æ»¿é‡è¦–é¢å°å•é¡Œçš„é‚è¼¯æ€ç¶­å’Œä¸»å‹•å­¸ç¿’çš„èƒ½åŠ›ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰åœ¨å¯« blog çš„è©±ï¼Œæ‡‰è©²æ˜¯å¤§å¤§åŠ åˆ†ï¼\n\n> æœ€å¾Œï¼Œå¦‚æœé€™ç¯‡æ–‡ç« å°ä½ æœ‰å¹«åŠ©çš„è©±ï¼Œå¯ä»¥å¹«æˆ‘æŒ‰å€‹å–œæ­¡ã€æˆ–æ˜¯ç•™è¨€ï¼å„ä½çš„æ”¯æŒå°±æ˜¯æˆ‘å¯«ä½œçš„æœ€å¤§å‹•åŠ›ã€‚æœ‰ä»»ä½•æƒ³å•çš„å•é¡Œä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€å–”ï½\n","tags":["Dcard","Interview"],"categories":["Others"]},{"title":"LeetCode 309 - Best Time to Buy and Sell Stock with Cooldown","url":"/LeetCode-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/)\n\nçµ¦å®šæ¯ä¸€å¤©çš„è‚¡åƒ¹ï¼Œç¬¬ `i` å¤©çš„è‚¡åƒ¹ç‚º `prices[i]`ï¼Œæ±‚å‡ºæœ€å¤§çš„ç²åˆ©ç‚ºä½•ã€‚\n\nå¯ä»¥é€²è¡Œå¤šæ¬¡çš„è²·è³£ï¼Œä½†æ‰‹ä¸Šä¸€æ¬¡åªèƒ½æ¡æœ‰ä¸€å¼µè‚¡ç¥¨ã€‚ä¸¦ä¸”åœ¨è‚¡ç¥¨è³£å‡ºå¾Œï¼Œæœ‰ä¸€å¤©çš„å†·å»æ™‚é–“ä¸èƒ½é€²è¡Œè²·è³£ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: prices = [1,2,3,0,2]\nOutput: 3\nExplanation: transactions = [buy, sell, cooldown, buy, sell]\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: prices = [1]\nOutput: 0\n```\n\n# æƒ³æ³•\n\né€™å€‹é¡Œç›®æœ‰å¾ˆå¤šç¨®å®šç¾© DP ç‹€æ…‹çš„æ–¹å¼ï¼Œä»¥ä¸‹æä¾›ä¸‰ç¨®æƒ³æ³•ï¼š\n\n## æƒ³æ³•ä¸€\n\nå®šç¾© `dp(i)` ä»£è¡¨å°æ–¼ `prices[0:i]`ï¼Œä¸¦ä¸”ç¬¬ $i$ å¤©æ™‚é€²è¡Œäº†è³£çš„å‹•ä½œï¼Œæ‰€èƒ½ç²å¾—çš„æœ€å¤§ç²åˆ©ã€‚\n\nå› æ­¤å¯ä»¥çŸ¥é“ï¼š\n$$dp(i)=prices[i]+\\red{max\\{dp(j)-prices[k]\\}}\\quad\\forall\\ j\\lt k-1 \\lt k\\lt i$$\n\nä¹Ÿå°±æ˜¯ï¼Œåœ¨ç¬¬ $i$ å¤©è³£å‡ºè‚¡ç¥¨çš„æœ€å¤§ç²åˆ©ç‚ºåœ¨ç¬¬ $j$ å¤©è³£å‡ºè‚¡ç¥¨å¾Œï¼Œåœ¨ç¬¬ $k$ å¤©è²·è‚¡ç¥¨ï¼Œå…¶ä¸­å› ç‚ºæœ‰å†·å»æ™‚é–“çš„é—œä¿‚ï¼Œå› æ­¤ $j\\lt k-1$ï¼›è€Œè²·è‚¡ç¥¨è‡³å°‘è¦åœ¨è³£è‚¡ç¥¨å‰ä¸€å¤©ï¼Œå› æ­¤ $k\\lt i$ã€‚\n\næœ‰äº†ä¸Šè¿°çš„è½‰ç§»å¼ï¼Œæ‡‰è©²å¯ä»¥ç”¨ä¸€å€‹ $O(N^3)$ çš„ä¸‰å±¤è¿´åœˆä¾†è§£æ±ºï¼Œç„¶è€Œé€™å€‹é¡Œç›®æœ€å„ªå¯ä»¥åšåˆ° $O(N)$\bã€‚å› æ­¤è§€å¯Ÿè½‰é—œå¼ï¼Œå¯ä»¥ç™¼ç¾å…©ä»¶äº‹æƒ…ï¼š\n1. ç•¶ $i$ å¢åŠ ä¸€æ™‚ï¼Œæœƒç²å¾—ä¸€å€‹æ–°çš„ `prices[k]`ï¼ˆ$k'=i-1$ï¼‰ï¼Œè€Œç”± `prices[k']` ç”¢ç”Ÿçš„ $\\red{max\\{dp(j)-prices[k]\\}}=max\\{dp(j)\\}-prices[k']$ã€‚\n2. ç•¶ $i$ å¢åŠ ä¸€æ™‚ï¼Œä¹Ÿæœƒç²å¾—ä¸€å€‹æ–°çš„ `dp(j)`ï¼ˆ$j'=i-3$)ã€‚\n\næœ‰äº†ä¸Šè¿°çš„å…©å€‹è§€å¯Ÿï¼Œåˆ©ç”¨è®Šæ•¸ `maxDp` ä¾†ç´€éŒ„ $max\\{dp(j)\\}$ï¼Œä¸¦ä¸”åœ¨æ¯æ¬¡ $i$ å¢åŠ ä¸€æ™‚ï¼Œåˆ©ç”¨ $dp(j')$ æ›´æ–° `maxDp`ï¼›åˆ©ç”¨è®Šæ•¸ `best` ç´€éŒ„ $\\red{max\\{dp(j)-prices[k]\\}}$ï¼Œä¸¦ä¸”åœ¨æ¯æ¬¡ $i$ å¢åŠ ä¸€æ™‚ï¼Œåˆ©ç”¨ $prices[k']$ æ›´æ–° `best`ã€‚\n\næœ€çµ‚æ”¹è®Šä¸€ä¸‹è½‰ç§»å¼ï¼š\n$$dp(i)=prices[i]+\\red{max\\{dp(j)-prices[k]\\}}=prices[i]+best$$\n\nå¯¦ä½œéƒ¨åˆ†è«‹é–±è®€ [æƒ³æ³•ä¸€ä¹‹å¯¦ä½œç´°ç¯€](#æƒ³æ³•ä¸€ä¹‹å¯¦ä½œç´°ç¯€) ä»¥åŠ [æƒ³æ³•ä¸€ä¹‹ç¨‹å¼ç¢¼](#æƒ³æ³•ä¸€ä¹‹ç¨‹å¼ç¢¼)ã€‚\n\n## æƒ³æ³•äºŒ\n\nå¾…è£œ\n\n# å¯¦ä½œç´°ç¯€\n\n## æƒ³æ³•ä¸€ä¹‹å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œæ™‚ï¼Œå¯ä»¥é–‹ä¸€å€‹é•·åº¦ç‚º `N` çš„ DP é™£åˆ—ï¼Œä¸¦ä¸”ä¾ç…§ä¸Šé¢çš„æƒ³æ³•ï¼Œæ¯ç•¶ `i` å¢åŠ ä¸€æ™‚ï¼ˆä¹Ÿå°±æ˜¯å‰›é€²å…¥è¿´åœˆæ™‚ï¼‰ï¼Œæ›´æ–°å…©å€‹è®Šæ•¸ `maxDp` ä»¥åŠ `best`ã€‚\n\nå¦‚ä¸‹ï¼š\n```cpp\nfor (int i = 0; i < n; i++) {\n  maxDp = max(maxDp, dp[i - 3]);\n  best = max(best, maxDp, prices[i - 3]);\n\n  dp[i] = ...\n}\n```\n\nä¸éè¦æ³¨æ„ `maxDp` è¦åœ¨ $i\\le 3$ æ™‚æ‰èƒ½æ›´æ–°ï¼›`best` è¦åœ¨ $i\\le 1$ æ™‚æ‰èƒ½æ›´æ–°ã€‚ä¸¦ä¸”å°æ–¼å…©æ•¸çš„åˆå§‹å€¼ï¼Œ`maxDp` åˆå§‹å€¼ç­‰æ–¼ 0ï¼Œå› ç‚ºåœ¨ä»€éº¼è‚¡ç¥¨éƒ½é‚„æ²’æœ‰è³£å‡ºçš„æƒ…æ³ä¸‹ï¼Œæœ€å¤§ç²åˆ©ç‚º 0ï¼›è€Œ `best` çš„åˆæ™‚å€¼ç‚º $-\\infin$ï¼Œå°æ–¼é‚„æ²’é€²è¡Œç¬¬ä¸€æ¬¡è³¼è²·è‚¡ç¥¨æƒ…æ³ï¼Œæˆ‘å€‘ä¸æ‡‰è©²å¾é€™å€‹ `best` ä¾†è½‰ç§»ï¼Œå› æ­¤å°‡å€¼è¨­ç‚º $-\\infin$ ä¾†é¿å…å°‡å¾é€™å€‹é»è½‰ç§»çš„ç‹€æ…‹æˆç‚ºç­”æ¡ˆã€‚\n\nå› æ­¤è¿´åœˆå…§éƒ¨ä¹‹ç‹€æ…‹æ›´æ–°æ‡‰è©²å¦‚ä¸‹ï¼š\n\n```cpp\nfor (int i = 0; i < n; i++) {\n  // i increase by 1, update `maxDp` and `best`\n  if (i >= 3) maxDp = max(maxDp, dp[i - 3]);\n  if (i >= 1) best = max(best, maxDp - prices[i - 1]);\n\n  // transition\n  dp[i] = prices[i] + best;\n}\n```\n\næˆ‘å€‘å¯ä»¥æŠŠ `maxDp` ä»¥åŠ `best` çš„æ›´æ–°ç§»è‡³ DP è½‰ç§»çš„ä¸‹æ–¹ï¼š\n\n```cpp\nfor (int i = 0; i < n; i++) {\n  // transition\n  dp[i] = prices[i] + best;\n\n  // i is ready to increase by 1, update `maxDp` and `best`\n  if (i >= 2) maxDp = max(maxDp, dp[i - 2]);\n  best = max(best, maxDp - prices[i]);\n}\n```\n\nè§€å¯Ÿç™¼ç¾ï¼Œä¸¦ä¸éœ€è¦ç´€éŒ„æ•´å€‹é•·åº¦ç‚º N çš„é™£åˆ—ï¼Œå› ç‚ºè¿´åœˆä¸­åªä½¿ç”¨åˆ°äº† $dp(i-2)$ é€™å€‹ä½ç½®è€Œå·²ã€‚åˆ©ç”¨ä¸‰å€‹è®Šæ•¸ `dp0`, `dp1`, `dp2` åˆ†åˆ¥ç´€éŒ„ $dp(i),\\ dp(i-1),\\ dp(i-2)$ï¼Œå³å¯å°‡ç¨‹å¼ç¢¼å„ªåŒ–æˆ $O(1)$ ç©ºé–“ä½¿ç”¨ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## æƒ³æ³•ä¸€ä¹‹ç¨‹å¼ç¢¼\n\n### O(N) Space\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/\n * Runtime: 4ms\n * Time Complexity: O(N)\n * Space Complexity: O(N)\n */\n\nclass Solution {\npublic:\n  int maxProfit(vector<int>& prices) {\n    int n = prices.size();\n    vector<int> dp(n);\n\n    const int inf = 0x3f3f3f3f;\n    int maxDp = 0, best = -inf;\n    for (int i = 0; i < n; i++) {\n      // i increase by 1, update `maxDp` and `best`\n      if (i >= 3) maxDp = max(maxDp, dp[i - 3]);\n      if (i >= 1) best = max(best, maxDp - prices[i - 1]);\n\n      // transition\n      dp[i] = prices[i] + best;\n    }\n    for (int i = max(0, n - 3); i < n; i++)\n      maxDp = max(maxDp, dp[i]);\n    return maxDp;\n  }\n};\n```\n\n### O(1) Space\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/\n * Runtime: 0ms\n * Time Complexity: O(N)\n * Space Complexity: O(1)\n */\n\nclass Solution {\npublic:\n  int maxProfit(vector<int>& prices) {\n    // dp0 = dp(i), dp1 = dp(i - 1), dp2 = dp(i - 2)\n    int dp0, dp1 = 0, dp2 = 0;\n    int maxDp = 0, best = -0x3f3f3f3f;\n    for (int& price : prices) {\n      dp0 = price + best;\n      maxDp = max(maxDp, dp2);\n      best = max(best, maxDp - price);\n      dp2 = dp1;\n      dp1 = dp0;\n    }\n    return max(max(maxDp, dp2), max(dp1, dp0));\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 312 - Burst Ballons","url":"/LeetCode-Burst-Ballons/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/burst-balloons/](https://leetcode.com/problems/burst-balloons/)\n\nçµ¦ä¸€é•·åº¦ç‚º `n` çš„åºåˆ— `nums`ï¼Œä¾ç…§ä»»æ„é †åºåˆªé™¤ä¸€å€‹æ•¸å­—ï¼Œç›´åˆ°æ‰€æœ‰æ•¸å­—æ¶ˆå¤±ã€‚\n\næ¯æ¬¡åˆªé™¤ä¸€å€‹æ•¸å­— `x` æ™‚ï¼Œå‡è¨­ `x` çš„å·¦é‚Šç‚º `y`ï¼Œå³é‚Šç‚º `z`ï¼Œå‰‡èŠ±è²» `x*y*z` å…ƒï¼›ç•¶å·¦é‚Šæ²’æœ‰æ•¸å­—ï¼Œ`y` è¦–ç‚º 1ï¼Œç•¶å³é‚Šæ²’æœ‰æ•¸å­—æ™‚ï¼Œ`z` è¦–ç‚º 1ã€‚\n\næ±‚å‡ºæœ€å¤§èŠ±è²»ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: nums = [3,1,5,8]\nOutput: 167\nExplanation:\nnums = [3,1,5,8] --> [3,5,8] --> [3,8] --> [8] --> []\ncoins =  3*1*5    +   3*5*8   +  1*3*8  + 1*8*1 = 167\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: nums = [1,5]\nOutput: 10\n```\n\n# æƒ³æ³•\n\né¦–å…ˆï¼Œè‹¥æƒ³è¦åˆ©ç”¨ DP ä¾†ç´€éŒ„é‡è¤‡çš„ç‹€æ…‹ï¼ŒæœŸæœ›ä¸Šçš„ç‹€æ…‹æ‡‰è©²ç‚º `dp(i,j)` ä»£è¡¨å°‡ `nums[i:j]` ä¾ç…§ä»»æ„é †åºåˆªé™¤ç›´åˆ°æ‰€æœ‰æ•¸å­—æ¶ˆå¤±çš„æœ€å¤§èŠ±è²»ï¼Œä¸¦ä¸”å¸Œæœ› `dp(i,j)` çš„ç­”æ¡ˆå¯ä»¥ç”±ä¸€å€‹åœ¨ $i\\sim j$ çš„å­å€é–“çš„ DP å€¼æ±‚å¾—ã€‚\n\nå¯ä»¥è©¦åœ–æšèˆ‰åœ¨ $i\\sim j$ ä¹‹é–“è¦åˆªé™¤çš„æ•¸å­—ï¼Œä½†æ˜¯æœƒå°è‡´ç‹€æ…‹ç„¡æ³•è¡¨è¿°ç•¶å‰å‰©ä¸‹çš„æ•¸å­—ã€‚ä¾‹å¦‚ï¼Œåˆå§‹ç‹€æ…‹çš„ `dp(0,n-1)` è‹¥åˆªé™¤æ•¸å­— 1 å‰‡å‰©ä¸‹çš„æ•¸å­—ç‚º `[3,5,8]`ï¼Œç„¶è€Œå¦‚æ­¤ä¸€ä¾†å°±æ²’æœ‰ä¸€å€‹ç‹€æ…‹èƒ½å¤ è¡¨è¿°äº†ã€‚å› æ­¤æƒ³è¾¦æ³•æ”¹è®Šè½‰ç§»çš„æ–¹å¼ã€‚è§€å¯Ÿç¯„ä¾‹æ¸¬è³‡ï¼š\n```\nnums = [3,1,5,8] --> [3,5,8] --> [3,8] --> [8] --> []\ncoins =  3*1*5    +   3*5*8   +  1*3*8  + 1*8*1 = 167\n```\nç‚ºäº†é¿å…åˆªé™¤æ•¸å­—æ™‚ï¼Œå¯èƒ½æ²’æœ‰å·¦é‚Šæˆ–å³é‚Šçš„æ•¸å­—çš„å•é¡Œï¼Œå…ˆåœ¨æ•´å€‹åºåˆ—çš„å…©å´åŠ ä¸Šå…©å€‹ 1ï¼Œä¸¦æŠŠé¡Œç›®æ”¹ç‚ºå°‡åºåˆ—å…§æ‰€æœ‰é™¤äº†å…©å´çš„æ•¸å­—åˆªé™¤çš„æœ€å¤§èŠ±è²»ã€‚\n```\nnums = [1,3,1,5,8,1] --> [1,3,5,8,1] --> [1,3,8,1] --> [1,8,1] --> [1,1]\ncoins =    3*1*5      +     3*5*8     +    1*3*8    +   1*8*1   =   167\n```\nå†åº¦è§€å¯Ÿï¼Œå¯ä»¥ç™¼ç¾æšèˆ‰ä¸€å€‹å€é–“å…§è¦åˆªé™¤çš„æ•¸å­—æœƒä½¿å¾—ç‹€æ…‹ç„¡æ³•è¡¨è¿°ï¼Œé‚£éº¼åéä¾†æ”¹ç‚ºæšèˆ‰ä¸€å€‹å€é–“å…§æœ€å¾Œä¸€å€‹è¢«åˆªé™¤çš„æ•¸å­—ï¼Œå°±æœ‰é»åƒå°‡ä¸Šè¿°çš„é †åºå€’éä¾†ã€‚å¯ä»¥ç™¼ç¾è½‰ç§»å¼å³ç‚ºï¼š\n$$dp(i,j)=max\\big(dp(i,k), dp(k,j)\\big)+nums[i]\\times nums[k]\\times nums[j]\\quad\\forall\\ k\\in[i+1,j-1]$$\n\nä¹Ÿå°±æ˜¯ï¼Œè¦æ±‚å‡º $i\\sim j$ çš„æœ€å¤§èŠ±è²»ï¼Œä¸”ä¸åŒ…å« $i,\\ j$ï¼Œè‹¥æœ€å¾Œä¸€å€‹è¢«åˆªé™¤çš„æ•¸å­—ç‚º $k$ï¼Œå‰‡ä¸€å®šæœƒæœ‰ $nums[i]\\times nums[k] \\times nums[j]$ ä¹‹èŠ±è²»ï¼Œä¸¦ä¸”å†åŠ ä¸Š $i\\sim k$ èˆ‡ $k\\sim j$ ä¹‹èŠ±è²»ï¼Œåˆ†åˆ¥æ˜¯ $dp(i,k)$ èˆ‡ $dp(k,j)$ã€‚\n\nå¦‚æ­¤ä¸€ä¾†ï¼Œç‹€æ…‹æœ‰ $O(N^2)$ ä¸­ï¼Œæ¯ä¸€å€‹ç‹€æ…‹éœ€è¦èŠ± $O(N)$ çš„æ™‚é–“è½‰ç§»ï¼Œå› æ­¤å¾—åˆ°ä¸€å€‹ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º $O(N^3)$ çš„ DPã€‚\n\n# å¯¦ä½œç´°ç¯€\n\né¦–å…ˆä¾ç…§ä¸Šè¿°æƒ³æ³•åœ¨æœ€å·¦ä»¥åŠæœ€å³å€‹åŠ å…¥ä¸€å€‹ 1ã€‚\n\nå†ä¾†æ³¨æ„ DP çš„è½‰ç§»ï¼Œå€é–“æ˜¯ç”±å°å€é–“ä¹‹ç­”æ¡ˆæ±‚å¾—ï¼Œå› æ­¤è¦ç‰¹åˆ¥æ³¨æ„è¿´åœˆé †åºã€‚ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„è¿´åœˆé †åºï¼š\n\n```cpp\nfor (int i = n - 1; i >= 0; i--) {\n  for (int j = i + 1; j < n; j++) {\n    // ...\n  }\n}\n```\n\nå†ä¾†æ³¨æ„é‚Šç•Œæ¢ä»¶ï¼Œç”±æ–¼ç‹€æ…‹ $dp(i,j)$ å®šç‚ºåˆªé™¤ $i\\sim j$ ä¹‹é–“çš„æ‰€æœ‰æ•¸å­—ï¼Œä¸åŒ…å« $i,\\ j$ï¼Œå› æ­¤ $dp(i,i+1)=0$ã€‚å› æ­¤ç¬¬äºŒå±¤çš„ $j$ è¿´åœˆç”± $i+2$ é–‹å§‹ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/burst-balloons/\n * Runtime: 372ms\n * Time Complexity: O(N^3)\n */\n\nclass Solution {\npublic:\n  int maxCoins(vector<int>& nums) {\n    nums.insert(nums.begin(), 1);\n    nums.emplace_back(1);\n    int n = nums.size();\n\n    int **dp = new int*[n];\n    for (int i = n - 1; i >= 0; i--) {\n      dp[i] = new int[n + 1];\n      dp[i][i + 1] = 0;\n\n      for (int j = i + 2; j < n; j++) {\n        for (int k = i + 1; k < j; k++)\n          dp[i][j] = max(dp[i][j], dp[i][k] + dp[k][j] + nums[i] * nums[k] * nums[j]);\n      }\n    }\n    return dp[0][n - 1];\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 132 - Palindrome Partitioning II","url":"/LeetCode-Palindrome-Partitioning-II/","content":"\n# é¡Œç›®\n\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/palindrome-partitioning-ii/](https://leetcode.com/problems/palindrome-partitioning-ii/)\n\nçµ¦å®šä¸€å€‹å­—ä¸² `s`ï¼Œæ‰¾å‡ºæœ€å°‘éœ€è¦å°‡å­—ä¸² `s` åˆ‡æˆå¹¾æ®µä½¿å¾—æ¯ä¸€æ®µéƒ½æ˜¯è¿´æ–‡ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: s = \"aab\"\nOutput: 1\nExplanation: The palindrome partitioning [\"aa\",\"b\"] could be produced using 1 cut.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: s = \"a\"\nOutput: 0\n```\n\n## Example 3:\n\n```\nInput: s = \"ab\"\nOutput: 1\n```\n\n# æƒ³æ³•\n\nè¦å°‡å­—ä¸² `s` åˆ‡åˆ†ï¼Œä½¿å¾—æ¯ä¸€æ®µéƒ½æ˜¯è¿´æ–‡ã€‚å¯ä»¥ç™¼ç¾è¦æ±‚ `s[0:n-1]` çš„æœ€å°è¿´æ–‡åˆ‡å‰²æ®µæ•¸ï¼Œå¯ä»¥æšèˆ‰ä»»ä½•ä¸€æ®µæ˜¯è¿´æ–‡ `s[j:n-1]` çš„ï¼Œå°‡ `s[j:n-1]` ç•¶åšæ˜¯ä¸€æ®µè¿´æ–‡ï¼Œå†æ¥è‘—æ±‚ `s[0:j-1]` ä¹‹æœ€å°è¿´æ–‡åˆ‡å‰²æ®µæ•¸å³å¯ã€‚\n\næœ‰äº†ä¸Šè¿°çš„æƒ³æ³•ï¼Œå¯ä»¥ç™¼ç¾é€™æ˜¯ä¸€å€‹ DP å•é¡Œï¼Œå› ç‚ºç­”æ¡ˆå¯ä»¥ç”±æŸä¸€å€‹å­ç­”æ¡ˆä¸­æ±‚å¾—ã€‚\n\nå› æ­¤ï¼Œé¦–å…ˆå®šç¾©ç‹€æ…‹ `dp(i)` ä»£è¡¨å°‡ `s[0:i]` åˆ‡æ®µä½¿å¾—æ¯ä¸€æ®µéƒ½æ˜¯è¿´æ–‡æ‰€éœ€çš„æœ€å°æ®µæ•¸ã€‚ å‰‡è½‰ç§»ç‚ºï¼š\n$$dp(i)=\\min\\big(dp(j)+1\\big)\\quad\\forall\\ j\\lt i,\\ if\\ s[j+1:i]\\text{ is palindrome}$$\n\nå› æ­¤å‰©ä¸‹çš„å•é¡Œè®Šæˆï¼Œå¦‚ä½•å¾ˆå¿«çš„æ±‚å¾—ä»»ä½•ä¸€æ®µ `s[j+1:i]` æ˜¯å¦ç‚ºè¿´æ–‡ã€‚åˆ©ç”¨é è™•ç†çš„æ–¹å¼ï¼Œå¯ä»¥å¾ˆç°¡å–®çš„åœ¨ $O(N^2)$ çš„æ™‚é–“æ±‚å‡ºæ¯ä¸€æ®µå­å­—ä¸²æ˜¯å¦ç‚ºè¿´æ–‡ï¼Œä¸¦å„²å­˜é€²ä¸€å€‹äºŒç¶­é™£åˆ— `isPalindrome[i][j]` ä»£è¡¨ `s[i:j]` æ˜¯è¿´æ–‡å­—ä¸²ã€‚ä¸»è¦æœ‰å…©å€‹åšæ³•ï¼š\n1. æšèˆ‰æ¯ä¸€å€‹ä½ç½®åšç‚ºè¿´æ–‡çš„ä¸­å¿ƒé»ï¼ˆæ³¨æ„å¶æ•¸é•·åº¦è¿´æ–‡çš„æƒ…æ³ï¼‰ï¼Œå¾€å¤–æ“´å±•ï¼ˆå·¦å³å„å¾€å¤–ä¸€æ ¼å­—å…ƒï¼Œå¦‚æœç›¸ç­‰çš„è©±ï¼‰ç›´åˆ°ä¸èƒ½åœ¨æ“´å±•ã€‚å¦‚æ­¤ä¸€ä¾†åªæœƒæœ‰ $O(N)$ å€‹ä¸­å¿ƒé»ä¸”æ¯å€‹ä¸­å¿ƒé»æœ€å¤šå¾€å¤–æ“´å±• $O(N)$ æ¬¡ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º $O(N^2)$ã€‚\n2. åˆ©ç”¨ DP çš„æ–¹å¼ï¼Œå¯ä»¥ç™¼ç¾ï¼š\n  $$isPalindrome(i,j)=1\\quad if\\ s[i]=s[j]\\And isPalindrome(i+1,j-1)=1$$\n  å› æ­¤åªè¦å¾å°å€é–“åˆ°å¤§å€é–“ä¾æ¬¡ç®—å‡ºç­”æ¡ˆå³å¯ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\né¦–å…ˆå°æ–¼æ±‚ `isPalindrome` çš„éƒ¨åˆ†ï¼Œç­†è€…æ˜¯æ¡ç”¨ç¬¬äºŒç¨®æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ DPã€‚\n\nè¦ç”±å°å€é–“åˆ°å¤§å€é–“åš DPï¼Œå‹™å¿…æ³¨æ„è¿´åœˆçš„é †åºï¼Œé€šå¸¸éƒ½å¯ä»¥æ¡ç”¨ä»¥ä¸‹çš„é †åºï¼š\n\n```cpp\nfor (int i = n - 1; i >= 0; i--) {\n  for (int j = i + 1; j < n; j++) {\n    // ...\n  }\n}\n```\n\nå¦å¤–æ³¨æ„é‚Šç•Œæƒ…æ³ï¼Œä¾ç…§è½‰ç§»å¼å¯ä»¥çŸ¥é“ `isPalindrome[i][j]` æœƒç”± `isPalindrome[i+1][j-1]` å¾—åˆ°ç­”æ¡ˆï¼Œä¸” $i\\lt j$ï¼›å› æ­¤ç•¶ $j=i+1$ æ™‚ï¼Œ`isPalindrome[i][i+1]` ç”± `isPalindrome[i+1][i]`ï¼›ç•¶ $j=i+2$ æ™‚ï¼Œ`isPalindrome[i][i+2]` ç”± `isPalindrome[i+1][i+1]` å¾—åˆ°ã€‚\n\næ‰€ä»¥é‚Šç•Œç‚º $isPalindrome[i][i] = isPalindrome[i+1][i] = true\\quad\\forall\\ i\\in n$ã€‚\n\næœ‰äº† `isPalindrome` çš„é™£åˆ—å¹«åŠ©ã€‚å¾ŒåŠæ®µçš„ DP å³å¯ä¾ç…§ä¸Šè¿°çš„è½‰ç§»å¼ï¼š\n$$dp(i)=\\min\\big(dp(j)+1\\big)\\quad\\forall\\ j\\lt i,\\ if\\ isPalindrome[j+1][i]=1$$\n\nä¸€æ¨£éœ€æ³¨æ„é‚Šç•Œæƒ…æ³ï¼Œç”±æ–¼ $j\\ge 0$ï¼Œå› æ­¤æ²’æœ‰è€ƒæ…®åˆ° `s[0:i]` æ˜¯è¿´æ–‡çš„æƒ…æ³ï¼Œå› æ­¤éœ€å¦å¤–åŠ ä¸Šæ¢ä»¶ç•¶ `isPalindrome[0][i]=1`ï¼Œå‰‡ `dp[i]=0`ã€‚\n\nåƒè€ƒä¸‹æ–¹[ç¨‹å¼ç¢¼](#two-steps-dp)ã€‚\n\nå¦å¤–ï¼Œå¯ä»¥ç™¼ç¾æ”¹è®Šç¬¬äºŒæ¬¡ DP ç‹€æ…‹èˆ‡è½‰ç§»ï¼Œæ”¹å®šç¾©ç‹€æ…‹ `dp(i)` ä»£è¡¨å°‡ `s[i~n-1]` åˆ‡æ®µä½¿å¾—æ¯ä¸€æ®µéƒ½æ˜¯è¿´æ–‡çš„æœ€å°æ®µæ•¸ï¼Œè½‰ç§»æ”¹ç‚ºï¼š\n$$dp(i)=\\min\\big(dp(j)+1\\big)\\quad\\forall\\ j\\gt i,\\ if\\ isPalindrome[i][j-1]=1$$\n\nå³å¯å°‡åŸæœ¬çš„å…©æ¬¡ $O(N^2)$ è¿´åœˆåˆä½µæˆä¸€æ¬¡å®Œæˆã€‚åƒè€ƒä¸‹æ–¹[ç¨‹å¼ç¢¼](#one-way-dp)ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## Two steps DP\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/palindrome-partitioning-ii/\n * Runtime: 74ms\n * Time Complexity: O(N^2)\n * Description:\n *  First calculate isPalindrome for all substring,\n *  then use dp(i) represent the min-cut for substring s[0:i],\n *  then dp(i) = min(dp(j) + 1), if isPalindrome(j + 1, i) = true\n */\n\nclass Solution {\npublic:\n  int minCut(string s) {\n    int n = s.length();\n    vector<vector<bool>> isPalindrome(n + 1, vector<bool>(n));\n    \n    for (int i = n - 1; i >= 0; i--) {\n      isPalindrome[i][i] = true;\n      isPalindrome[i + 1][i] = true;\n      for (int j = i + 1; j < n; j++) {\n        isPalindrome[i][j] = (s[i] == s[j] && isPalindrome[i + 1][j - 1]);\n      }\n    }\n    \n    int *dp = new int[n];\n    for (int i = 0; i < n; i++) {\n      if (isPalindrome[0][i]) {\n        dp[i] = 0;\n      } else {\n        dp[i] = 0x3f3f3f3f;\n        for (int j = 0; j < i; j++) {\n          if (isPalindrome[j + 1][i]) {\n            dp[i] = min(dp[i], dp[j] + 1);\n          }\n        }\n      }\n    }\n    return dp[n - 1];\n  }\n};\n```\n\n## One way DP\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/palindrome-partitioning-ii/\n * Runtime: 60ms\n * Time Complexity: O(N^2)\n * Description: One-way O(N^2) solution\n */\n\nclass Solution {\npublic:\n  int minCut(string s) {\n    int n = s.length();\n    vector<vector<bool>> isPalindrome(n + 1, vector<bool>(n));\n    int *dp = new int[n];\n    for (int i = n - 1; i >= 0; i--) {\n      isPalindrome[i][i] = true;\n      isPalindrome[i + 1][i] = true;\n      dp[i] = 0x3f3f3f3f;\n      for (int j = i + 1; j < n; j++) {\n        isPalindrome[i][j] = (s[i] == s[j] && isPalindrome[i + 1][j - 1]);\n        if (isPalindrome[i][j - 1]) {\n          dp[i] = min(dp[i], dp[j] + 1);\n        }\n      }\n      if (isPalindrome[i][n - 1]) dp[i] = 0;\n    }\n    return dp[0];\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 375 - Guess Number Higher or Lower II","url":"/LeetCode-Guess-Number-Higher-or-Lower-II/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/guess-number-higher-or-lower-ii/](https://leetcode.com/problems/guess-number-higher-or-lower-ii/)\n\nçŒœæ•¸å­—éŠæˆ²ï¼Œç­”æ¡ˆåœ¨ $1 \\sim n$ ä¹‹å…§ã€‚\n\næ¯æ¬¡çŒœæ¸¬ä¸€å€‹æ•¸å­— $x$ï¼Œå¦‚æœçŒœå°äº†å‰‡éŠæˆ²çµæŸï¼Œè‹¥çŒœéŒ¯äº†å‰‡éœ€è¦ä»˜ $x$ å…ƒï¼Œä¸¦ä¸”æœƒè¢«å‘Šä¹‹æ­£ç¢ºç­”æ¡ˆå¤§æ–¼ $x$ æˆ–æ˜¯å°æ–¼ $x$ã€‚\n\næ‰¾å‡ºä¸€ç¨®çŒœæ•¸å­—çš„æ–¹å¼ï¼Œä½¿å¾—ä¸ç®¡ç­”æ¡ˆæ˜¯å¤šå°‘ï¼ŒèŠ±è²»éƒ½æ˜¯æœ€å°‘çš„ï¼ˆä¹Ÿå°±æ˜¯ä¸ç®¡ç­”æ¡ˆæ˜¯å¤šå°‘ï¼ŒèŠ±è²»æœ€å¤§çš„é‚£ç¨®ç­”æ¡ˆè¦ç›¡é‡å°ï¼‰ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1\n\n![](https://assets.leetcode.com/uploads/2020/09/10/graph.png)\n\n<!-- More -->\n\n```\nInput: n = 10\nOutput: 16\nExplanation: The winning strategy is as follows:\n- The range is [1,10]. Guess 7.\n    - If this is my number, your total is $0. Otherwise, you pay $7.\n    - If my number is higher, the range is [8,10]. Guess 9.\n        - If this is my number, your total is $7. Otherwise, you pay $9.\n        - If my number is higher, it must be 10. Guess 10. Your total is $7 + $9 = $16.\n        - If my number is lower, it must be 8. Guess 8. Your total is $7 + $9 = $16.\n    - If my number is lower, the range is [1,6]. Guess 3.\n        - If this is my number, your total is $7. Otherwise, you pay $3.\n        - If my number is higher, the range is [4,6]. Guess 5.\n            - If this is my number, your total is $7 + $3 = $10. Otherwise, you pay $5.\n            - If my number is higher, it must be 6. Guess 6. Your total is $7 + $3 + $5 = $15.\n            - If my number is lower, it must be 4. Guess 4. Your total is $7 + $3 + $5 = $15.\n        - If my number is lower, the range is [1,2]. Guess 1.\n            - If this is my number, your total is $7 + $3 = $10. Otherwise, you pay $1.\n            - If my number is higher, it must be 2. Guess 2. Your total is $7 + $3 + $1 = $11.\nThe worst case in all these scenarios is that you pay $16. Hence, you only need $16 to guarantee a win.\n```\n\n## Example 2:\n\n```\nInput: n = 1\nOutput: 0\nExplanation: There is only one possible number, so you can guess 1 and not have to pay anything.\n```\n\n## Example 3:\n\n```\nInput: n = 2\nOutput: 1\nExplanation: There are two possible numbers, 1 and 2.\n- Guess 1.\n    - If this is my number, your total is $0. Otherwise, you pay $1.\n    - If my number is higher, it must be 2. Guess 2. Your total is $1.\nThe worst case is that you pay $1.\n```\n\n# æƒ³æ³•\n\né¦–å…ˆï¼Œä»¥éè¿´çš„æƒ³æ³•ä¾†èªªã€‚ä¸€é–‹å§‹è¦æ±‚çš„æ˜¯çŒœæ¸¬ $1 \\sim n$ çš„æ•¸å­—çš„æœ€å°èŠ±è²»ï¼Œå®šç‚º `minCost(1, n)`ã€‚\n\nå‡è¨­çŒœæ¸¬çš„æ•¸å­—ç‚º $x$ï¼Œä¸” $1\\le x \\le n$ï¼Œå‰‡æœ‰ä¸‰ç¨®æƒ…å½¢ï¼š\n1. çŒœä¸­äº†ï¼Œå‰‡èŠ±è²»ç‚º 0ï¼ŒéŠæˆ²çµæŸã€‚\n2. æ²’çŒœä¸­ï¼Œä¸”æ­£ç¢ºç­”æ¡ˆå¤§æ–¼ $x$ï¼Œå‰‡èŠ±è²» $x$ å…ƒä¸”ç¹¼çºŒçŒœæ¸¬ $x+1 \\sim n$ã€‚\n3. æ²’çŒœä¸­ï¼Œä¸”æ­£ç¢ºç­”æ¡ˆå°æ–¼ $x$ï¼Œå‰‡èŠ±è²» $x$ å…ƒä¸”ç¹¼çºŒçŒœæ¸¬ $1 \\sim x-1$ã€‚\n\nç”±æ–¼ä¸‰ç¨®æƒ…æ³éƒ½æ˜¯æœ‰å¯èƒ½ç™¼ç”Ÿçš„ï¼Œå› æ­¤ï¼š\n\n$$\nminCost(1,n)=\\max \n  \\begin{cases}\n   0 &\\text{case 1} \\\\\n   x+minCost(x+1,n) &\\text{case 2} \\\\\n   x+minCost(1,x-1) &\\text{case 3} \\\\\n  \\end{cases}\n$$\n\næœ‰äº†ä¸Šè¿°çš„å¼å­ï¼Œæˆ‘å€‘å¯ä»¥ç¸½çµä¸¦æ•´ç†ï¼Œå°æ–¼çŒœæ¸¬ $i \\sim j$ ä¹‹é–“çš„æ•¸å­—çš„æœ€å°èŠ±è²»ï¼Œå®šç‚º `minCost(i, j)`ï¼Œæˆ‘å€‘å¯ä»¥çŒœæ¸¬ä»»ä½•ä¸€å€‹ $i\\le k \\le j$ çš„æ•¸å­— $k$ï¼Œå› æ­¤ï¼š\n\n$$\nminCost(i,j)=\\min\n\\begin{Bmatrix}\\max \n    \\begin{Bmatrix}\n      0 \\\\\n      k+minCost(k+1,j) \\\\\n      k+minCost(i,k-1) \\\\\n    \\end{Bmatrix}\n  \\quad\\forall\\ i\\le k \\le j\n\\end{Bmatrix}\n$$\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šï¼Œç•¶ç„¶å¯ä»¥ç›´æ¥çš„ä½¿ç”¨éè¿´ä¾†æ±‚å‡ºç­”æ¡ˆï¼Œä½†æ˜¯æœƒç™¼ç¾å¾ˆå¤šæƒ…æ³ä¸‹é‡è¤‡çš„ `minCost(i, j)` è¢«å‘¼å«ï¼Œä½†å…¶å¯¦å°æ–¼ä¸€æ¨£çš„ `minCost(i, j)`ï¼Œä¸¦ä¸éœ€è¦é‡è¤‡çš„æ±‚å¾—ã€‚\n\nå› æ­¤ï¼Œå¯ä»¥è¨˜æ†¶åŒ–æœç´¢çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é–‹ä¸€å€‹äºŒç¶­çš„é™£åˆ— `dp[i][j]` ä»£è¡¨ `minCost(i, j)` çš„ç­”æ¡ˆã€‚åˆå§‹åŒ–æ™‚ä½¿å…¨éƒ¨çš„ `dp[i][j] = -1`ï¼Œå‰‡å‘¼å« `minCost(i, j)` æ™‚å¯ä»¥å…ˆæª¢æŸ¥ `dp[i][j]`ï¼Œè‹¥ `dp[i][j] != -1` å‰‡ç›´æ¥å›å‚³ `dp[i][j]`ã€‚\n\næœ‰äº†é€™æ¨£çš„æƒ³æ³•å¾Œï¼Œå…¶å¯¦å¯ä»¥å¾ˆè¼•æ˜“çš„å°‡ top-down çš„éè¿´æ”¹ç‚º botton-up çš„è¿´åœˆå½¢å¼ DPï¼›æ”¹ç‚ºè¿´åœˆå½¢å¼ä¹‹ DP æ™‚ï¼Œè¦**æ³¨æ„è¿´åœˆçš„é †åº**ï¼Œç”±æ–¼å¤§å€é–“çš„ç­”æ¡ˆæ˜¯ç”±å°å€é–“æ±‚å¾—çš„ï¼Œå› æ­¤è¦**å…ˆæ±‚å¾—å°å€é–“ç­”æ¡ˆ**ï¼Œä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„è¿´åœˆé †åºï¼š\n\n```cpp\nfor (int i = n - 1; i >= 0; i--) {\n  for (int j = i + 1; j < n; j++) {\n    cout << i << ' ' << j << endl;\n    dp[i][j] = ...;\n  }\n}\n```\n\næ­¤æ™‚çš„ DP ç‹€æ…‹ç‚º `dp(i, j)` ä»£è¡¨çŒœæ¸¬æ•¸å­— $i \\sim j$ çš„æœ€å°èŠ±è²»ï¼Œè½‰ç§»ç‚ºï¼š\n$$dp(i,j)=\\min\\bigg(\\max\\big(dp(i,k-1), dp(k+1,i)\\big)+k\\quad\\forall\\ k\\in [i,j]\\bigg)$$\n\næ³¨æ„é‚Šç•Œæƒ…æ³ï¼Œç•¶ $i=j$ï¼Œä¸€å®šæœƒçŒœä¸­ï¼Œå› æ­¤ **$dp(i,i)=1$**ã€‚\n\næœ€å¾Œï¼ŒDP çš„ç‹€æ…‹æœ‰ $N^2$ ç¨®ï¼Œå°æ–¼æ¯å€‹ç‹€æ…‹éœ€è¦èŠ±è‡³å¤š $O(N)$ çš„æ™‚é–“è½‰ç§»ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º $O(N^3)$ã€‚\n\nå¦å¤–ï¼Œç”±æ–¼ç­†è€…çš„é™£åˆ—åªæœ‰é–‹æ°å¥½ $n$ æ ¼ï¼Œå› æ­¤è¦æ³¨æ„ `dp(i,j)` å…¶å¯¦æ˜¯å°æ‡‰åˆ° $i+1\\sim j+1$ çš„æœ€å°èŠ±è²»ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## Top-down DP\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/guess-number-higher-or-lower-ii/\n * Runtime: 164ms\n * Time Complexity: O(N^3)\n * Description: Top-down DP\n */\n\nclass Solution {\nprivate:\n  int** dp;\n  int minCost(int i, int j) {\n    if (i > j)\n      return 0x3f3f3f3f;\n    if (i == j)\n      return 0;\n\n    if (dp[i][j] != -1)\n      return dp[i][j];\n\n    dp[i][j] = min((i + 1) + minCost(i + 1, j), minCost(i, j - 1) + (j + 1));\n    for (int k = i + 1; k < j; k++) {\n      dp[i][j] = min(dp[i][j], max(minCost(i, k - 1), minCost(k + 1, j)) + k + 1);\n    }\n    return dp[i][j];\n  }\npublic:\n  int getMoneyAmount(int n) {\n    dp = new int*[n];\n    for (int i = 0; i < n; i++) {\n      dp[i] = new int[n];\n      memset(dp[i], -1, sizeof(int) * n);\n    }\n    return minCost(0, n - 1);\n  }\n};\n```\n\n## Bottom-up DP\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/guess-number-higher-or-lower-ii/\n * Runtime: 40ms\n * Time Complexity: O(N^3)\n * Description: Bottom-up DP\n */\n\nclass Solution {\npublic:\n  int getMoneyAmount(int n) {\n    int** dp = new int*[n];\n    for (int i = 0; i < n; i++) {\n      dp[i] = new int[n]();\n    }\n\n    for (int i = n - 1; i >= 0; i--) {\n      for (int j = i + 1; j < n; j++) {\n        dp[i][j] = min((i + 1) + dp[i + 1][j], dp[i][j - 1] + (j + 1));\n        for (int k = i + 1; k < j; k++) {\n          dp[i][j] = min(dp[i][j], max(dp[i][k - 1], dp[k + 1][j]) + (k + 1));\n        }\n      }\n    }\n    return dp[0][n - 1];\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 685 - Redundant Connection II","url":"/LeetCode-Redundant-Connection-II/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/redundant-connection-ii/](https://leetcode.com/problems/redundant-connection-ii/)\n\nçµ¦å®šä¸€å€‹ `N` å€‹é»çš„æœ‰æ ¹æ¨¹ï¼Œå†åŠ ä¸Šä¸€æ¢é‚Šã€‚\n\næ±‚å‡ºç§»é™¤å“ªä¸€æ¢é‚Šå¯ä»¥ä½¿å¾—åœ–è®Šå›æœ‰æ ¹æ¨¹ï¼Œè‹¥æœ‰å¤šç¨®è§£ç­”ï¼Œå‰‡è¼¸å‡ºçµ¦å®šçš„é‚Šä¸­æ¯”è¼ƒå¾Œé¢çš„é‚£ä¸€æ¢ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n![](/assets/LeetCode-Redundant-Connection-II/graph1.jpeg)\n\n```\nInput: edges = [[1,2],[1,3],[2,3]]\nOutput: [2,3]\n```\n\n<!-- More -->\n\n## Example 2:\n\n![](/assets/LeetCode-Redundant-Connection-II/graph2.jpeg)\n\n```\nInput: edges = [[1,2],[2,3],[3,4],[4,1],[1,5]]\nOutput: [4,1]\n```\n\n# æƒ³æ³•\n\n## åˆ†é¡è¨è«–\n\né¦–å…ˆï¼Œåœ¨ä¸€å¼µæœ‰æ ¹æ¨¹ä¸Šé¢ DFSï¼Œæ‰£é™¤æ‰ DFS æ‰€èµ°çš„ Tree edges å¾Œï¼Œæœ€å¾ŒåŠ ä¸Šçš„é‚Šå¯èƒ½ç”¢ç”Ÿçš„æƒ…æ³æœ‰ä»¥ä¸‹ä¸‰ç¨®ï¼š\n\n1. **Back edge**ï¼šé‚Š `u->v` ä¸­ï¼Œ`v` æ˜¯ `u` çš„ç¥–å…ˆã€‚\n2. **Forward edge**ï¼šé‚Š `u->v` ä¸­ï¼Œ`u` æ˜¯ `v` çš„ç¥–å…ˆã€‚\n3. **Cross edge**ï¼šé‚Š `u->v` ä¸­ï¼Œ`u` ä¸æ˜¯ `v` çš„ç¥–å…ˆä¸” `v` ä¹Ÿä¸æ˜¯ `u` çš„ç¥–å…ˆã€‚\n\n<img src=\"/assets/LeetCode-Redundant-Connection-II/case.jpg\" width=\"50%\">\n\næˆ‘å€‘çŸ¥é“ä¸€æ£µæœ‰æ ¹æ¨¹ä¸­ï¼Œ**é™¤äº† root ä¹‹å¤–ï¼Œæ¯ä¸€å€‹é»çš„å…¥åº¦ç‚º 1**ã€‚è€Œ **Forward edge** ä»¥åŠ **Cross edge** çš„æƒ…æ³ï¼Œå¯ä»¥ç™¼ç¾é€™å…©ç¨®æƒ…æ³éƒ½æœƒä½¿å¾—**æœ‰ä¸€å€‹é»çš„å…¥åº¦ç‚ºäºŒ**ï¼Œä¹Ÿå°±æ˜¯æœ‰å…©å€‹çˆ¶è¦ªç¯€é»ã€‚ä¸¦ä¸”ï¼Œå‡è¨­é€ æˆå…¥åº¦ç‚ºäºŒçš„å…©æ¢é‚Šç‚º `e1` ä»¥åŠ `e2`ï¼Œå¯ä»¥ç™¼ç¾ç§»é™¤ `e1` èˆ‡ç§»é™¤ `e2` éƒ½å¯ä»¥ä½¿åœ–é‚„åŸå›ä¸€æ£µæœ‰æ ¹æ¨¹ã€‚\n\nå†ä¾†å‰©ä¸‹ **Back edge** çš„æƒ…æ³ï¼Œæˆ‘å€‘çŸ¥é“ç•¶æœ‰ back edge æ™‚ï¼Œå¿…å®šæœƒæœ‰æœ‰å‘ç’°çš„ç”¢ç”Ÿã€‚é€™è£¡æˆ‘å€‘åˆ†æˆå…©ç¨®æƒ…æ³è¨è«–ï¼š\n1. (1.1) **Back edge** çš„é‚Š `u->v` ä¸­ï¼Œ`v` æ˜¯æ¨¹çš„æ ¹ï¼šé€™æ™‚**ä¸æœƒæœ‰å…¥åº¦ç‚ºäºŒçš„é»ç”¢ç”Ÿ**ï¼Œä½†æ˜¯å¯ä»¥ç™¼ç¾ä¸ç®¡ç§»é™¤ç’°ä¸Šçš„å“ªä¸€å€‹é»ï¼Œéƒ½å¯ä»¥ä½¿åœ–é‚„åŸå›ä¸€æ£µæœ‰æ ¹æ¨¹ã€‚\n2. (1.2) **Back edge** çš„é‚Š  `v` ä¸æ˜¯æ¨¹çš„æ ¹ï¼šé€™æ™‚**ä¸€æ¨£æœ‰å…¥åº¦ç‚ºäºŒçš„é»ç”¢ç”Ÿ**ï¼Œä¸¦ä¸”åœ¨é€™ç¨®æƒ…æ³å¿…é ˆè¦ç§»é™¤ back edge æ‰èƒ½ä½¿å¾—åœ–é‚„åŸå›ä¸€æ£µæœ‰æ ¹æ¨¹ã€‚\n\n## ä¸¦æŸ¥é›† Union Find/Disjoint Set\n\næ¥è‘—æˆ‘å€‘æš«åœä¸€ä¸‹ï¼Œä»‹ç´¹ä¸€å€‹è³‡æ–™çµæ§‹ **ä¸¦æŸ¥é›†**ã€‚\n\n**ä¸¦æŸ¥é›†** æ˜¯ä¸€ç¨®ç”¨æ–¼åˆä½µé›†åˆã€æŸ¥è©¢å…©å€‹é›†åˆæ˜¯å¦å±¬æ–¼åŒä¸€å€‹é›†åˆçš„è³‡æ–™çµæ§‹ã€‚å…¶ä¸­å–®æ¬¡æŸ¥è©¢ã€åˆä½µçš„å¹³å‡æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯ $O(\\alpha(n))$ï¼Œå…¶ä¸­ $\\alpha$ ç‚º[åé˜¿å…‹æ›¼å‡½æ•¸](https://zh.wikipedia.org/wiki/%E9%98%BF%E5%85%8B%E6%9B%BC%E5%87%BD%E6%95%B8#%E5%8F%8D%E5%87%BD%E6%95%B8)ï¼Œå¯ä»¥æƒ³æˆæ˜¯éå¸¸å°çš„æ•¸å³å¯ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä¸¦æŸ¥é›†æ˜¯éå¸¸é«˜æ•ˆçš„è³‡æ–™çµæ§‹ã€‚\n\nä½¿ç”¨ä¸¦æŸ¥é›†ï¼Œä¸€é–‹å§‹æ¯ä¸€å€‹é»éƒ½å±¬æ–¼ä¸€å€‹é›†åˆã€‚å‡è¨­çµ¦å®šçš„é‚Šé›†åˆæ˜¯ä¸€å€‹æ¨¹ï¼Œå‰‡æœƒç™¼ç¾æ¯æ¬¡åˆä½µä¸€æ¢é‚Šçš„å…©ç«¯é» `u` èˆ‡ `v` æ™‚ï¼Œ`u` èˆ‡ `v` ä¸€å®šå±¬æ–¼ä¸åŒçš„é›†åˆï¼Œå› ç‚ºæ¨¹ä¸Šçš„æ¯ä¸€æ¢é‚Šéƒ½æ˜¯ cut edgeï¼Œé€£æ¥è‘—å…©å€‹ componentsã€‚\n\nä¹Ÿå°±æ˜¯èªªï¼Œç•¶çµ¦å®šçš„é‚Šé›†åˆæœ‰ç’°æ™‚ï¼Œå‰‡æœƒç™¼ç¾åœ¨åˆä½µç’°ä¸Šçš„æœ€å¾Œä¸€æ¢é‚Šæ™‚ï¼Œé‚Šçš„å…©ç«¯é» `u` èˆ‡ `v` å·²ç¶“åœ¨åŒä¸€å€‹é›†åˆè£¡é¢äº†ã€‚\n\n**p.s. é€™è£¡çš„ç’°æŒ‡çš„æ˜¯ç„¡å‘çš„ç’°ï¼Œå› ç‚ºä¸¦æŸ¥é›†æ˜¯æ²’æœ‰æ–¹å‘æ€§çš„ã€‚**\n\n## ç¸½çµ\n\næ¥è‘—æˆ‘å€‘ç¸½çµè¦å¦‚ä½•æ‰¾åˆ°éœ€è¦ç§»é™¤çš„é‚Šï¼š\n1. æ²’æœ‰å…¥åº¦ç‚ºäºŒçš„é»ï¼Œå‰‡ç‚ºæƒ…æ³ 1.1 **Back edge ä¸” `v` æ˜¯ root**ï¼Œå‰‡åªè¦æ‰¾åˆ°ç’°ä¸Šçš„æœ€å¾Œä¸€æ¢é‚Šå³æ˜¯ç­”æ¡ˆã€‚\n  \n    æ ¹æ“šä¸Šè¿°ä¸¦æŸ¥é›†çš„ä»‹ç´¹ï¼Œåªè¦ä¸æ–·çš„å°‡é‚Šçš„å…©ç«¯é»é€²è¡Œé›†åˆçš„åˆä½µï¼Œå¿…å®šæœƒæœ‰ä¸€æ¢é‚Šåœ¨åˆä½µä¹‹å‰ï¼Œé‚Šçš„å…©å€‹ç«¯é»å·²ç¶“åœ¨åŒä¸€å€‹é›†åˆå…§ï¼Œæ­¤æ™‚é€™æ¢é‚Š `e` å³æ˜¯æˆ‘å€‘è¦æ‰¾çš„ç­”æ¡ˆã€‚\n\n2. æœ‰å…¥åº¦äºŒçš„é»ï¼Œå¯èƒ½æ˜¯æƒ…æ³ 2 **Forward edge**ã€æƒ…æ³ 3 **Cross edge** æˆ–æ˜¯æƒ…æ³ 1.2 **Back edge ä¸” `v` ä¸æ˜¯ root**ã€‚\n\n    å‡è¨­é€ æˆå…¥åº¦ç‚ºäºŒçš„å…©æ¢é‚Šç‚º `e1` èˆ‡ `e2`ï¼Œå…¶ä¸­ `e2` æ˜¯æ¯”è¼ƒæ™šå‡ºç¾çš„é‚£æ¢ã€‚\n    \n    **Forward edge** èˆ‡ **Cross edge** çš„æƒ…æ³è¼ƒç°¡å–®ï¼Œåªè¦åˆªé™¤ `e2` å³å¯ã€‚\n\n    åœ¨ **Back edge ä¸” `v` ä¸æ˜¯ root** çš„æƒ…æ³ä¸‹ï¼Œç”±æ–¼é‚Šå‡ºç¾çš„é †åºæ˜¯ä¸ä¸€å®šçš„ï¼Œæ‰€ä»¥ back edge å¯èƒ½æ˜¯ `e1` ä¹Ÿå¯èƒ½æ˜¯ `e2`ï¼Œç•¶ç„¶æˆ‘å€‘å¯ä»¥é€éå¾ root é€²è¡Œ DFS ä¾†æ‰¾åˆ° back edge æ˜¯å“ªä¸€æ¢ã€‚\n    \n    ç„¶è€Œæˆ‘å€‘æƒ³è¦ä¸€å€‹æ›´ general çš„åšæ³•ã€‚è€ƒæ…®ä¸Šé¢ä¸¦æŸ¥é›†çš„åšæ³•ï¼Œå› ç‚ºåœ–ä¸­é‚„æ˜¯æœ‰ç’°ï¼Œæ‰€ä»¥å¯ä»¥æ‰¾åˆ°ä¸€æ¢é‚Šä½¿å¾—åˆä½µä¹‹å‰ï¼Œå…©å€‹ç«¯é»å·²ç¶“åœ¨ä¸€å€‹é›†åˆå…§ï¼Œç„¶è€Œé€™æ¢é‚Šå¯èƒ½ä¸æ˜¯ back edge è€Œæ˜¯ç’°ä¸Šçš„å…¶ä»–é‚Šï¼Œæ‰€ä»¥é€™å€‹æ–¹æ³•é‚„æ˜¯å€åˆ†ä¸å‡ºä¾† back edge æ˜¯ `e1` é‚„æ˜¯ `e2`ã€‚\n\n    **è€ƒæ…®ä¸€å€‹æ–¹æ³•ï¼Œæˆ‘å€‘åœ¨åˆä½µé‚Šæ™‚ï¼Œä¸å°‡ `e2` åŠ å…¥åˆä½µçš„éç¨‹ï¼Œä¹Ÿå°±æ˜¯ï¼Œåœ¨å‡ºç¾ç¬¬äºŒæ¢å…¥åº¦ç‚º 2 çš„é‚Šæ™‚ï¼Œä¸å°‡é€™æ¢é‚Šåšé›†åˆçš„åˆä½µã€‚**å¦‚æ­¤ä¸€ä¾†ï¼Œè‹¥æœ€å¾Œé‚„æ˜¯å‡ºç¾äº†ç’°ï¼ˆä¹Ÿå°±æ˜¯æœ‰ä¸€æ¢é‚Šåœ¨åˆä½µä¹‹å‰å…©ç«¯é»å°±åœ¨åŒä¸€å€‹é›†åˆå…§äº†ï¼‰çš„æƒ…æ³ï¼Œå‰‡æˆ‘å€‘çŸ¥é“ `e1` æ‰æ˜¯ back edge\bï¼›åä¹‹ï¼Œ`e2` æ‰æ˜¯ back edgeã€‚\n\n    æ¥è‘—æˆ‘å€‘è¦ç¢ºèªé€™å€‹æ–¹æ³•æœƒä¸æœƒå½±éŸ¿å…ˆå‰çš„åˆ¤æ–·ï¼Œå¯ä»¥ç™¼ç¾åœ¨æƒ…æ³1.1 **Back edge ä¸” `v` æ˜¯ root**ï¼Œç”±æ–¼æ²’æœ‰å…¥åº¦ 2 çš„é»ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é‚Šé‚„æ˜¯æœƒåŠ å…¥åˆä½µçš„éç¨‹ï¼Œå› æ­¤ä¸å½±éŸ¿ã€‚å¦å¤–ï¼Œåœ¨æƒ…æ³2 **Forward edge** èˆ‡æƒ…æ³ 3 **Cross edge**ï¼Œä¸å°‡ `e2` é€™æ¢é‚Šåšé›†åˆçš„åˆä½µå‰‡åœ–ä¸­ä¸€å®šæ²’æœ‰ç’°ï¼Œæ‰€ä»¥ `e2` é‚„æ˜¯æˆ‘å€‘è¦åˆªé™¤çš„é‚Šï¼Œä¸€æ¨£æ˜¯æ­£ç¢ºçš„ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šï¼Œ`pa[x]=y` ä»£è¡¨ `x` èˆ‡ `y` åœ¨åŒä¸€å€‹é›†åˆå…§ï¼Œåˆ©ç”¨éè¿´å¯ä»¥ä¸æ–·å‘ä¸Šæ‰¾ï¼Œç•¶ `pa[x]=0` å‰‡ä»£è¡¨å·²ç¶“æ‰¾å®Œäº†ã€‚é€™è£¡å°ä¸¦æŸ¥é›†å°±ä¸å¤šä»‹ç´¹äº†ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ä¸Šç¶²æŸ¥è©¢ã€‚\n\n`parent[i]` ç”¨ä¾†è¨˜éŒ„æŒ‡å‘é» `i` çš„é‚Šçš„ç´¢å¼•å€¼ ï¼Œåˆå§‹åŒ–æ™‚æ‰€æœ‰çš„ `parent[i]=0`ã€‚å› æ­¤ç•¶ä¸€æ¢é‚Š `u->v` è¦åŠ å…¥æ™‚ç™¼ç¾ `parent[v]` å·²ç¶“ä¸ç­‰æ–¼ 0 æ™‚ï¼Œå¯ä»¥çŸ¥é“é€™æ¢é‚Šå³æ˜¯ç¬¬äºŒæ¢é€ æˆå…¥åº¦ç‚º 2 çš„é‚Šï¼Œè¨˜éŒ„ç‚º `e2`ï¼ŒåŒæ™‚ `e1`ï¼Œç¬¬ä¸€æ¢é€ æˆå…¥åº¦ç‚º 2 çš„é‚Šï¼Œå³æ˜¯ `parent[v]` æ‰€è¨˜éŒ„çš„é‚Šã€‚\n\nç•¶é‚Šä¸æ˜¯ `e2` æ™‚ï¼Œå‰‡å°‡é‚Šçš„å…©ç«¯é»é€²è¡Œåˆä½µï¼Œä¸¦ä¸”æ³¨æ„åˆä½µå‰å¦‚æœå…©ç«¯é»çš„é›†åˆå·²ç¶“ç›¸åŒï¼Œå‰‡ç´€éŒ„ `e` ç‚ºé€ æˆç’°çš„æœ€å¾Œä¸€æ¢é‚Šã€‚\n\næœ€å¾Œï¼Œå…ˆåˆ¤æ–·æœ‰æ²’æœ‰å…¥åº¦ç‚º 2 çš„é‚Šï¼ˆå¯ä»¥åˆ¤æ–· `e1` èˆ‡ `e2` æœ‰æ²’æœ‰è¢«è³¦å€¼éï¼‰ï¼Œè‹¥æ²’æœ‰çš„è©±ï¼Œå‰‡å¿…å®šæ˜¯æƒ…æ³1.1ï¼Œæ‰€ä»¥ç›´æ¥è¿”å› `e` å³å¯ï¼›åä¹‹ï¼Œè‹¥æœ‰å…¥åº¦ç‚º 2 çš„é‚Šï¼Œå‰‡å¦‚æœæ²’æœ‰ç’°å‡ºç¾ï¼Œè¦åˆªé™¤çš„é‚Šæ˜¯è¼ƒæ™šå‡ºç¾çš„ `e2`ï¼Œå¦å‰‡ä¸€å®šæ˜¯æƒ…æ³1.2 ä¸”è¦åˆªé™¤çš„é‚Šç‚º `e1`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/redundant-connection-ii/\n * Runtime: 4ms\n */\n\nclass Solution {\nprivate:\n  int findSet(int* pa, int x) {\n    return (!pa[x]) ? x : (pa[x] = findSet(pa, pa[x]));\n  }\npublic:\n  vector<int> findRedundantDirectedConnection(vector<vector<int>>& edges) {\n    int n = (int)edges.size();\n\n    int *pa = new int[n + 1]();\n    int *parent = new int[n + 1]();\n\n    int e1 = -1, e2; // e1, e2 are edges that cause a node to have 2 in degree\n    int e = -1; // e is the index of edge that cause a cycle last\n    for (int i = 0; i < n; i++) {\n      auto& edge = edges[i];\n      if (parent[edge[1]]) { // Found vertex edge[1] is the vertex that in degree = 2\n        e1 = parent[edge[1]] - 1;\n        e2 = i;\n      } else {\n        parent[edge[1]] = i + 1;\n\n        // We skip adding e2\n        int fx = findSet(pa, edge[0]);\n        int fy = findSet(pa, edge[1]);\n        if (fx != fy) // no cycle found, merge\n          pa[fx] = fy;\n        else // cycle found, the last edge that cause a cycle is i\n          e = i;\n      }\n    }\n\n    if (e1 == -1)\n      return edges[e];\n    if (e == -1)\n      return edges[e2];\n    return edges[e1];\n  }\n};\n\n```\n","tags":["LeetCode","Graph","Union Find"],"categories":["LeetCode"]},{"title":"LeetCode 300 - Longest Increasing Subsequence","url":"/LeetCode-Longest-Increasing-Subsequence/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/longest-increasing-subsequence/](https://leetcode.com/problems/longest-increasing-subsequence/)\n\næ‰¾åˆ°æœ€é•·éå¢å­åºåˆ—ï¼ˆLISï¼‰çš„é•·åº¦ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: nums = [10,9,2,5,3,7,101,18]\nOutput: 4\nExplanation: The longest increasing subsequence is [2,3,7,101], therefore the length is 4.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: nums = [0,1,0,3,2,3]\nOutput: 4\n```\n\n## Example 3:\n\n```\nInput: nums = [7,7,7,7,7,7,7]\nOutput: 1\n```\n\n# æƒ³æ³•\n\n## `O(N^2)`\n\næœ‰ä¸€ç¨®å¸¸è¦‹çš„ `O(N^2)` å‹•æ…‹è¦åŠƒã€‚è€ƒæ…®å‹•æ…‹è¦åŠƒçš„ç‹€æ…‹èˆ‡è½‰ç§»ï¼Œå®šç¾©ç‹€æ…‹ `dp(i)` ç­‰æ–¼ä»¥ç¬¬ `i` å€‹æ•¸å­—ç‚ºçµå°¾çš„åºåˆ—çš„ LIS é•·åº¦ï¼Œè½‰ç§»å³ç‚ºï¼š\n\n$$dp(i)=max(1,dp(j) + 1)\\quad\\forall\\ j\\lt i\\And nums[j]\\lt nums[i]$$\n\nå¦‚æ­¤çš„ç‹€æ…‹è½‰ç§»ååˆ†ç›´è§€ï¼Œä»¥ç¬¬ `i` å€‹æ•¸å­—ç‚ºçµå°¾çš„åºåˆ—ï¼Œä»£è¡¨æˆ‘å€‘è¦é¸æ“‡ `nums[i]`ï¼Œé‚£éº¼ `nums[i]` å¯ä»¥æ”¾åœ¨ `nums[j]` å¾Œé¢ï¼Œå¦‚æœ `j < i && nums[j] < nums[i]`ï¼Œå› æ­¤ä»¥ `nums[i]` ç‚ºçµå°¾çš„æœ€é•·éå¢å­åºåˆ—å³ç‚ºæ‰€æœ‰ç¬¦åˆæ¢ä»¶çš„ `j` ä¸­ï¼Œ`dp[j]` æœ€å¤§çš„å€¼å†åŠ ä¸€ã€‚è‹¥æ²’æœ‰ç¬¦åˆçš„ `j`ï¼Œå‰‡ä»¥ `nums[i]` çµå°¾çš„æœ€é•·éå¢å­åºåˆ—è‡³å°‘ä¹Ÿç‚º 1ã€‚\n\nç”±æ–¼ç‹€æ…‹æœ‰ `N` ç¨®ï¼Œæ¯æ¬¡è½‰ç§»éƒ½è¦èŠ± `O(N)` çš„æ™‚é–“ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N^2)`ã€‚\n\n## `O(NlogN)`\n\nè¦é”åˆ° `O(NlogN)` çš„æƒ³æ³•ï¼Œé¦–å…ˆè€ƒæ…®å¦ä¸€ç¨® `O(N^2)` çš„å‹•æ…‹è¦åŠƒã€‚ä¸€æ¨£è€ƒæ…®ç‹€æ…‹èˆ‡è½‰ç§»ï¼š\n\nå®šç¾©ç‹€æ…‹ `dp(j)` ä»£è¡¨é•·åº¦ç‚º `j` çš„æœ€é•·éå¢å­åºåˆ—çµæŸåœ¨ `dp(j)` é€™å€‹æ•¸å­—ï¼Œè‹¥æœ‰å¤šå€‹æ»¿è¶³ï¼Œå‰‡é¸æ•¸å­—æœ€å°çš„ã€‚\n\næ¥è‘—å° `nums[0]`, `nums[1]` ... é€²è¡Œ N æ¬¡çš„è½‰ç§»ï¼š\n\nå‡è¨­ `dp(1) = 1, dp(2) = 3, dp(3) = 5, dp(4) = 7`ï¼Œå‰‡ç•¶è¦å° `nums[i] = 4` é€²è¡Œè½‰ç§»æ™‚ï¼Œæ•¸å­— `4` èƒ½ç”¢ç”Ÿçš„æœ€é•·éå¢å­åºåˆ—ç‚º 3ï¼Œå› ç‚ºæˆ‘å€‘çŸ¥é“ `dp(2) = 3`ï¼Œæ‰€ä»¥æ•¸å­— `4` å¯ä»¥æ’å…¥åœ¨æ•¸å­— `3` ä¹‹å¾Œå½¢æˆé•·åº¦ 3 çš„éå¢å­åºåˆ—ã€‚ä½†æ˜¯ `dp(3)` å·²ç¶“æœ‰ä¸€å€‹æ•¸å­— `5` äº†ï¼Œå› æ­¤è¦é¸æ•¸å­—è¼ƒå°çš„ä¾†ç•¶ `dp(3)` çš„å€¼ï¼Œæ‰€ä»¥è¦ä½¿ `dp(3)=nums[i]`ï¼Œé‚„éœ€è¦æœ‰ä¸€å€‹æ¢ä»¶ `nums[i] < dp(3)`ã€‚\n\nå› æ­¤è½‰ç§»å¦‚ä¸‹ï¼š\n\n$$dp(j)=\n  \\begin{cases}\n    nums[i] &\\text{if } dp(j-1)\\lt nums[i]\\lt dp(j) \\\\\n    dp(j) &\\text{else }\n  \\end{cases}\n$$\n\nç‚ºäº†æ–¹ä¾¿å¯¦ä½œï¼Œå¯ä»¥å¦ `dp(0)=-INF` ä¸”ç•¶ `i > 0`ï¼Œåˆå§‹åŒ– `dp(i)=INF`ã€‚\n\n```cpp\nconst INF = 1e9 + 10;\nvector<int> dp(n + 1, INF);\ndp[0] = -INF;\n\nfor (int i = 0; i < n; i++) {\n  for (int j = 1; j <= n; j++) {\n    if (dp[j - 1] < nums[i] && nums[i] < dp[j])\n      dp[j] = nums[i];\n  }\n}\n```\n\næœ€å¾Œï¼Œå°æ–¼æ‰€æœ‰çš„ `dp(i)` ä¸” `dp(i) != INF` çš„ `i` å³ç‚ºæœ€é•·éå¢å­åºåˆ—çš„é•·ã€‚\n\nå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N^2)`ã€‚\n\nè§€å¯Ÿä¸Šè¿°çš„è½‰ç§»èˆ‡ç¨‹å¼ç¢¼ï¼Œå¯ä»¥å¾—åˆ°å…©å€‹æ€§è³ªï¼š\n1. `dp(i-1) < dp(i)`ã€‚\n2. `nums[i]` æ¯æ¬¡æ°å¥½æ›´æ–°ä¸€å€‹æ•¸å­—ã€‚\n\nç”±æ–¼é€™å…©å€‹æ€§è³ªï¼Œå¯ä»¥ç™¼ç¾åªè¦åœ¨ `dp` é™£åˆ—ä¸Šï¼Œåˆ©ç”¨äºŒåˆ†æœæ‰¾åˆ°**å¤§æ–¼ç­‰æ–¼ nums[i] çš„ç¬¬ä¸€å€‹æ•¸å­—**ä¸¦å–ä»£ä¹‹ï¼Œå³å¯å°‡æ™‚é–“è¤‡é›œåº¦æ¸›ä½åˆ° `O(NlogN)`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šï¼Œå¯ä»¥ä¸ç”¨å…ˆé–‹å¥½é•·åº¦ç‚º `N + 1` çš„ `dp` é™£åˆ—ï¼Œåªåœ¨éœ€è¦çš„æ™‚å€™å¢åŠ  `dp` é™£åˆ—çš„é•·åº¦ï¼ˆä¹Ÿå°±æ˜¯ä¸å¤šç´€éŒ„å€¼ç‚º `INF` çš„éƒ¨åˆ†ï¼‰ï¼š\n\nå°æ–¼ä¸Šè¿°çš„ç¨‹å¼ç¢¼ï¼Œç•¶ `nums[i]` æ›´æ–°çš„æ•¸å­—æ˜¯ `INF`ï¼Œä»£è¡¨å¤šäº†ä¸€å€‹æ•¸å­—éœ€è¦ç´€éŒ„ï¼Œé€™æ™‚æ‰éœ€è¦å¢åŠ  `dp` é™£åˆ—çš„é•·åº¦ï¼Œè€Œæ­¤ç¨®æƒ…æ³ä»£è¡¨ `nums[i]` æ¯”æœ€å¾Œä¸€å€‹é `INF` çš„æ•¸å­—é‚„è¦å¤§ã€‚\n\nå¦‚æ­¤ä¸€ä¾†ï¼Œæœ€å¾Œé™£åˆ—çš„é•·åº¦å³ç‚ºæœ€é•·éå¢å­åºåˆ—çš„é•·åº¦æ¸›ä¸€ï¼ˆéœ€è¦æ‰£é™¤ç¬¬é›¶å€‹æ•¸å­— `-INF`ï¼‰ã€‚\n\nå¦å¤–ï¼Œæ‰¾**å¤§æ–¼ç­‰æ–¼ nums[i] çš„ç¬¬ä¸€å€‹æ•¸å­—**ï¼Œå¯ä»¥åˆ©ç”¨ C++ çš„ `lower_bound` ä¾†å¯¦ä½œã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/longest-increasing-subsequence/\n * Runtime: 8ms\n */\n\nclass Solution {\npublic:\n  int lengthOfLIS(vector<int>& nums) {\n    vector<int> lis{-10001};\n    for (int num: nums) {\n      if (num > lis.back())\n        lis.emplace_back(num);\n      else\n        *lower_bound(lis.begin(), lis.end(), num) = num;\n    }\n    return (int)lis.size() - 1;\n  }\n};\n\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰","äºŒåˆ†æœï¼ˆBinary Searchï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 907 - Sum of Subarray Minimums","url":"/LeetCode-Sum-of-Subarray-Minimums/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/sum-of-subarray-minimums/](https://leetcode.com/problems/sum-of-subarray-minimums/)\n\nçµ¦å®šä¸€å€‹åºåˆ—ï¼Œæ±‚å‡ºæ‰€æœ‰å­å€é–“çš„æœ€å°å€¼çš„å’Œã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: arr = [3,1,2,4]\nOutput: 17\nExplanation: \nSubarrays are [3], [1], [2], [4], [3,1], [1,2], [2,4], [3,1,2], [1,2,4], [3,1,2,4]. \nMinimums are 3, 1, 2, 4, 1, 1, 2, 1, 1, 1.\nSum is 17.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: arr = [11,81,94,43,3]\nOutput: 444\n```\n\n# æƒ³æ³•\n\n## ç”± O(N^3) åˆ° O(N^2) çš„æƒ³æ³•\n\né¦–å…ˆï¼Œæœ€ç°¡å–®çš„æ–¹æ³•ç‚ºæšèˆ‰æ¯å€‹å€é–“ï¼Œå†æ±‚å‡ºå€é–“æœ€å°å€¼ä¸¦ç¸½å’Œã€‚\n\nä»¥ `i` ç‚ºå·¦ç•Œï¼Œä»¥ `j` ç‚ºå³ç•Œï¼š\n```cpp\nint sum = 0;\nfor (int i = 0; i < n; i++) {\n  for (int j = i; j < n; j++) {\n    int minValue = arr[i];\n    for (int k = i; k <= j; k++) {\n      minValue = min(minValue, arr[i]);\n    }\n    sum += minValue;\n  }\n}\nreturn sum;\n```\n\nå¯ä»¥å®¹æ˜“åœ°ç™¼ç¾ï¼Œå°æ–¼ç›¸åŒçš„å·¦ç•Œ `i` ä¾†èªªï¼Œæ¯æ¬¡å³ç•Œ `j` éƒ½åªå¢åŠ ä¸€å€‹æ•¸å­—ã€‚å› æ­¤åªè¦å°‡æ–°å¢çš„æ•¸å­—èˆ‡ä¸Šä¸€è¼ªè¨ˆç®—çš„ `minValue` é€²è¡Œæ›´æ–°ï¼Œå°±å¯ä»¥ä¸ç”¨å…§å±¤çš„ `k` è¿´åœˆäº†ã€‚\n```cpp\nint sum = 0;\nfor (int i = 0; i < n; i++) {\n  int minValue = arr[i]; // minValue ç´€éŒ„ i ~ j çš„æœ€å°å€¼\n  for (int j = i; j < n; j++) {\n    minValue = min(minValue, arr[j]); // æ–°å¢äº† arr[j] é€™å€‹æ•¸å­—ï¼Œæ›´æ–° minValue\n    sum += minValue;\n  }\n}\nreturn sum;\n```\n\nå¦‚æ­¤ä¸€ä¾†å¯ä»¥å¾—åˆ°ä¸€å€‹ `O(N^2)` çš„ç®—æ³•ã€‚\n\n## ç”± O(N^2) åˆ° O(N) çš„æƒ³æ³•\n\næˆ‘å€‘æ”¹è®Šè¿´åœˆçš„é †åºï¼Œæ”¹ç‚ºå…ˆæšèˆ‰å³é‚Šç•Œå†æšèˆ‰å·¦é‚Šç•Œï¼Œæ³¨æ„è¿´åœˆ `i` çš„é †åºä»¥ä¿è­‰å°æ–¼åŒä¸€å€‹å³é‚Šç•Œ `j`ï¼Œ`i` çš„æ”¹è®Šæ˜¯ä½¿å€é–“è®Šå¤§çš„ï¼š\n```cpp\nint sum = 0;\nfor (int j = 0; j < n; j++) {\n  int minValue = arr[j]; // minValue ç´€éŒ„ i ~ j çš„æœ€å°å€¼\n  for (int i = j; i >= 0; i--) {\n    minValue = min(minValue, arr[i]); // æ–°å¢äº† arr[i] é€™å€‹æ•¸å­—ï¼Œæ›´æ–° minValue\n    sum += minValue;\n  }\n}\nreturn sum;\n```\n\nå°æ–¼æ¯ä¸€å€‹å³é‚Šç•Œ `j` æ‰€å½¢æˆçš„å€é–“ï¼Œå¯ä»¥è§€å¯Ÿå‡ºåªæœ‰ç”±å³è€Œå·¦éæ¸›çš„æ•¸å­—æ‰æ˜¯æœ‰ç”¨çš„ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œä»¥ `[3, 1, 7, 5]` çš„ `5` ç‚ºå³é‚Šç•Œï¼Œæ‰€å½¢æˆçš„å€é–“å¦‚ä¸‹ï¼š\n\n|     Subarray     | Decreasing (<-) | Minimum |  Sum  |\n| ---------------- | --------------- | ------- | ----- |\n|  `[         5]`  | `[         5]`  |    5    |   5   |\n|  `[      7, 5]`  | `[      x, 5]`  |    5    |  10   |\n|  `[   1, 7, 5]`  | `[   1, x, 5]`  |    1    |  11   |\n|  `[3, 1, 7, 5]`  | `[x, 1, x, 5]`  |    1    |  12   |\n\nå¯ä»¥ç™¼ç¾æ•¸å­— `7` å°æ–¼ä»¥ `5` ç‚ºå³é‚Šç•Œçš„å€é–“ä¾†èªªä¸¦æ²’æœ‰è²¢ç»ï¼Œå› ç‚ºæ‰€æœ‰ä»¥ `5` ç‚ºå³é‚Šç•Œçš„å€é–“éƒ½æœƒæœ‰æ•¸å­— `5`ï¼›\nè€Œå°æ–¼ä»¥ `5` ç‚ºå³é‚Šç•Œï¼Œå·¦é‚Šç•Œæ¯”æ•¸å­— `1` é‚„è¦å°çš„æ•¸å­—ä¾†èªªï¼Œæ‰€æœ‰çš„å€é–“éƒ½æœƒåŒ…å«æ•¸å­— `1`ï¼Œå› æ­¤æ¯”æ•¸å­— `1` å¤§çš„æ•¸å­—ä¹Ÿæ²’æœ‰ç”¨ã€‚\nå› è€Œç”¢ç”Ÿäº†ä¸€å€‹ç”±å³è€Œå·¦çš„éæ¸›åºåˆ—ã€‚\n\næœ‰äº†é€™å€‹æ€§è³ªï¼Œæˆ‘å€‘å¯ä»¥ç¶­è­·ä¸€å€‹ç”±å³è€Œå·¦éæ¸›çš„åºåˆ—ï¼Œä»¥çŸ¥é“å“ªäº›æ•¸å­—æ˜¯æœ‰ç”¨çš„ã€‚çŸ¥é“äº†å“ªäº›æ•¸å­—æ˜¯æœ‰ç”¨çš„å¤–ï¼Œé‚„éœ€è¦çŸ¥é“é€™äº›æ•¸å­—çš„ç”¨è™•æœ‰å¤šå¤§ï¼Œä»¥å¾ˆå¿«çš„è¨ˆç®—å‡ºä»¥ `j` ç‚ºå³ç•Œçš„å€é–“çš„æœ€å°å€¼çš„å’Œã€‚\n\nå¯ä»¥ç™¼ç¾ä¸Šè¡¨ä¸­ï¼Œæœ€å¾Œè¨ˆç®—å‡ºä¾†çš„ `Sum` æ˜¯ `12 = 1 * 2 + 5 * 2`ï¼Œå‡è¨­ï¼š\n- å³å€é–“è®Šå¤§ï¼Œå¢åŠ ä¸€å€‹æ•¸å­— `4`ï¼š`Decreasing -> [x, 1, x, x, 4]`ï¼Œ`Sum = 1 * 2 + 4 * 3 = 14`\n- å³å€é–“è®Šå¤§ï¼Œå¢åŠ ä¸€å€‹æ•¸å­— `6`ï¼š`Decreasing -> [x, 1, x, x, 4, 6]`ï¼Œ`Sum = 1 * 2 + 4 * 3 + 6 * 1 = 20`ã€‚\n- å³å€é–“è®Šå¤§ï¼Œå¢åŠ ä¸€å€‹æ•¸å­— `0`ï¼š`Decreasing -> [x, x, x, x, x, x, 0]`ï¼Œ`Sum = 0 * 7 = 0`ã€‚\n- å³å€é–“è®Šå¤§ï¼Œå¢åŠ ä¸€å€‹æ•¸å­— `8`ï¼š`Decreasing -> [x, x, x, x, x, x, 0, 8]`ï¼Œ`Sum = 0 * 7 + 8 * 1`ã€‚\n\nå¯ä»¥ç™¼ç¾ï¼Œä¸€å€‹æ•¸å­—çš„è²¢ç»ï¼ˆä¸‹é¢ç¨±ä½œ `weight`ï¼‰å³æ˜¯ä»–å·¦é‚Šçš„ `x` çš„æ•¸é‡åŠ ä¸€ã€‚ä¹Ÿç­‰æ–¼çœ‹æˆæ˜¯ä»–å·¦é‚Šæ‰€æœ‰æ•¸çš„ `weight` åŠ ä¸€ã€‚\n\næœ€å¾Œï¼Œç”±å·¦è€Œå³ï¼Œæ¯æ¬¡å°‡å³å€é–“è®Šå¤§ï¼ˆå¢åŠ ä¸€å€‹æ•¸å­—ï¼‰ï¼Œä¸¦ä¸”ç¶­è­·ç”±å³è€Œå·¦éæ¸›çš„åºåˆ—ä»¥åŠä¸€å€‹å€¼ `Sum`ã€‚å› ç‚ºæ¯å€‹æ•¸å­—æœ€å¤šåªæœƒé€²å…¥ã€é›¢é–‹æ£§ä¸€æ¬¡ï¼Œæ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N)`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nè¦å¯¦ä½œä¸€å€‹å–®èª¿éå¢/éæ¸›çš„åºåˆ—ï¼Œä¸¦ä¸”åªæœ‰**åœ¨åŒä¸€é‚Šå¢åŠ æ•¸å­—**çš„æ“ä½œæ™‚ï¼Œè¦ä½¿ç”¨çš„è³‡æ–™çµæ§‹æ˜¯ `stack`ï¼Œæˆ–æ˜¯å¯ä»¥ç¨±ç‚º **å–®èª¿æ£§ï¼ˆMonotone Stackï¼‰**ã€‚\n\nè¦åˆ©ç”¨æ£§ç¶­è­·ä¸€å€‹ç”±å³è€Œå·¦éæ¸›çš„åºåˆ—ï¼Œæ¯ç•¶å³å€é–“è®Šå¤§æ™‚ï¼Œä¸æ–·å°‡æ£§\bé ‚éƒ¨æ¯”æ­¤å…ƒç´ å¤§çš„æ•¸å­—éƒ½ç§»é™¤å³å¯ã€‚\n\næœ¬é¡Œé™¤äº†è¦ç´€éŒ„åŠ å…¥æ£§çš„å…ƒç´ çš„å€¼å¤–ï¼Œé‚„é¡å¤–éœ€è¦ç´€éŒ„æ¯å€‹æ•¸å­—çš„è²¢ç» `weight`ï¼Œä»¥å¿«é€Ÿçš„è¨ˆç®—å€é–“æœ€å°å€¼çš„å’Œã€‚\n\næœ€å¾Œï¼Œåœ¨ **ç”± O(N^2) åˆ° O(N) çš„æƒ³æ³•** çš„æœ€é–‹å§‹ï¼Œç­†è€…ä¸¦æ²’æœ‰ç‰¹åˆ¥æåˆ°ç‚ºä½•è¦å°‡è¿´åœˆçš„é †åºæ”¹è®Šã€‚æ”¹è®Šè¿´åœˆçš„é †åºä¸»è¦æ˜¯æƒ³è¦å°‡å€é–“è®Šæˆç”±å°åˆ°å¤§ï¼Œä¹Ÿå°±æ˜¯ç•¶ `j` è®Šå¤§æ™‚ï¼Œå³å€é–“è®Šå¤§ï¼Œå› æ­¤å€é–“çš„å¤§å°æ˜¯å¢åŠ çš„ã€‚<font color=\"red\">å€é–“å¤§å°è®Šå¤§çš„å¥½è™•æ˜¯ä»£è¡¨æˆ‘å€‘å·²ç¶“çœ‹éäº†è¼ƒå°å€é–“çš„è³‡è¨Šï¼Œæ‰æœ‰å¯èƒ½å¯ä»¥ä¾ç…§é‚£äº›è³‡è¨Šä¾†å¿«é€Ÿçš„æ‰¾å‡ºç­”æ¡ˆ</font>ã€‚\n\nä¹Ÿå°±æ˜¯ç¾åœ¨çš„æƒ³æ³• **å°‡å³é‚Šç•Œç”±å·¦è€Œå³ï¼Œç¶­è­·ä¸€å€‹ç”±å³è€Œå·¦éæ¸›çš„åºåˆ—**ï¼Œå…¶å¯¦ä¹Ÿå¯ä»¥æ”¹ç‚º **å°‡å·¦é‚Šç•Œç”±å³è€Œå·¦ï¼Œç¶­è­·ä¸€å€‹ç”±å·¦è€Œå³çš„éå¢åºåˆ—**ã€‚å…©å€‹æ–¹æ³•éƒ½æ˜¯å¯è¡Œçš„ï¼\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/sum-of-subarray-minimums/\n * Runtime: 76ms\n */\n\nclass Solution {\nprivate:\n  const int mod = 1e9 + 7;\npublic:\n  int sumSubarrayMins(vector<int>& arr) {\n    stack<pair<int, int>> stk; // {å€¼ï¼Œè²¢ç»}\n\n    int answer = 0; // ç­”æ¡ˆ\n    long long sum = 0; // ç¶­è­·ç•¶å‰ stk å…§çš„ç¸½å’Œ\n    for (int value: arr) {\n      int weight = 1;\n      while (!stk.empty() && value < stk.top().first) { // åˆªé™¤æ£§é ‚æ‰€æœ‰æ¯”ç•¶å‰æ•¸å­—å¤§çš„æ•¸å­—ï¼Œä»¥ç¶­è­·å–®èª¿æ€§\n        sum -= stk.top().first * stk.top().second; // ç¶­è­·æ£§å…§ sum çš„å€¼\n        weight += stk.top().second; // æ¯åˆªé™¤ä¸€å€‹æ•¸å­—ï¼Œå°±å¸æ”¶äº†ä»–çš„è²¢ç»\n        stk.pop();\n      }\n      stk.push({value, weight});\n      sum += value * weight; // ç¶­è­·æ£§å…§ sum çš„å€¼\n      answer = (answer + sum % mod) % mod; // sum ç‚ºä»¥ value ç‚ºå³é‚Šç•Œçš„æ‰€æœ‰å€é–“çš„æœ€å°å€¼çš„å’Œ\n    }\n    return answer;\n  }\n};\n\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰","å–®èª¿æ£§ï¼ˆMonotone Stackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 20 - Valid Parentheses","url":"/LeetCode-Valid-Parentheses/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/valid-parentheses/](https://leetcode.com/problems/valid-parentheses/)\n\nçµ¦å®šä¸€å€‹åŒ…å«åªåŒ…å« `'('`ã€`')'`ã€`'{'`ã€`'}'`ã€`'['`ã€`']'` çš„å­—ä¸²ï¼Œå•çµ¦å®šçš„å­—ä¸²æ˜¯ä¸æ˜¯ä¸€å€‹åˆæ³•çš„æ‹¬è™Ÿå­—ä¸²ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: s = \"()\"\nOutput: true\n```\n\n## Example 2:\n\n```\nInput: s = \"()[]{}\"\nOutput: true\n```\n\n<!-- More -->\n\n## Example 3:\n\n```\nInput: s = \"(]\"\nOutput: false\n```\n\n## Example 4:\n\n```\nInput: s = \"([)]\"\nOutput: false\n```\n\n## Example 5:\n\n```\nInput: s = \"{[]}\"\nOutput: true\n```\n\n# æƒ³æ³•ï¼†å¯¦ä½œç´°ç¯€\n\nç”±å·¦åˆ°å³ï¼Œä»»ä¸€å€‹å³æ‹¬è™Ÿåªèƒ½èˆ‡å·²ç¶“å‡ºç¾çš„å·¦æ‹¬è™ŸåŒ¹é…ï¼Œä¸”ä»–å€‘ä¹‹é–“ä¸èƒ½æœ‰å…¶ä»–é‚„æœªåŒ¹é…çš„æ‹¬è™Ÿã€‚\n\nä¸”ä¸€å€‹å³æ‹¬è™Ÿå¦‚æœç•¶ä¸‹æ²’æœ‰è¾¦æ³•è¢«åŒ¹é…çš„è©±ï¼Œä»£è¡¨å­—ä¸²æ˜¯ä¸åˆæ³•çš„ï¼Œå› ç‚ºæ¥ä¸‹ä¾†å†ä¹Ÿæ²’æœ‰å¯ä»¥åŒ¹é…é€™å€‹å³æ‹¬è™Ÿçš„é¸æ“‡äº†ã€‚\n\nç”±å·¦åˆ°å³ï¼Œå°‡æœªä½¿ç”¨çš„å·¦æ‹¬è™Ÿä¾åºæ¨å…¥ `stack` å…§ï¼Œç•¶å³æ‹¬è™Ÿå‡ºç¾æ™‚ï¼Œå…¶åªèƒ½åŒ¹é… `stack` çš„é ‚ç«¯å…ƒç´ ã€‚è‹¥æœ‰ `stack` çš„é ‚ç«¯å…ƒç´ èˆ‡å…¶åŒ¹é…ï¼Œå‰‡å°‡å·¦æ‹¬è™Ÿå¾ `stack` ä¸­ç§»é™¤ã€‚å¦å‰‡å­—ä¸²ä¸åˆæ³•ï¼Œå›å‚³ `false`ã€‚\n\næœ€å¾Œä¸è¦å¿˜è¨˜ä¸€å€‹åˆæ³•çš„æ‹¬è™Ÿå­—ä¸²ï¼Œæ‰€æœ‰çš„å·¦æ‹¬è™Ÿéƒ½æ‡‰æœ‰åŒ¹é…ï¼Œå› æ­¤æœ€å¾Œ `stack` å…§çš„å…ƒç´ æ‡‰è©²ç‚ºç©ºã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\nclass Solution {\npublic:\n  bool isValid(string s) {\n    stack<char> box;\n    for (char ch: s) {\n      if (ch == '(' || ch == '{' || ch == '[') {\n        // å°‡æœªä½¿ç”¨çš„å·¦æ‹¬è™Ÿæ¨å…¥ stack å…§\n        box.push(ch);\n      } else {\n        // å †ç–Šç‚ºç©º/å †ç–Šçš„é ‚ç«¯å…ƒç´ èˆ‡ç•¶å‰çš„å³æ‹¬è™Ÿä¸åŒ¹é…ï¼Œå‰‡æ‹¬è™Ÿå­—ä¸²ä¸åˆæ³•\n        if (box.empty()\n             || (ch == ')' && box.top() != '(')\n             || (ch == '}' && box.top() != '{')\n             || (ch == ']' && box.top() != '['))\n          return false;\n        // å·¦æ‹¬è™Ÿè¢«åŒ¹é…ï¼Œé›¢é–‹ stack\n        box.pop();\n      }\n    }\n\n    // åˆæ³•çš„æ‹¬è™Ÿå­—ä¸²æ‰€æœ‰çš„å·¦æ‹¬è™Ÿéƒ½æ‡‰è©²è¢«åŒ¹é…\n    return box.empty();\n  }\n};\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 456 - 132 Pattern","url":"/LeetCode-132-Pattern/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/132-pattern/](https://leetcode.com/problems/132-pattern/)\n\nçµ¦å®šä¸€å€‹åºåˆ— `nums`ï¼Œå•æ˜¯å¦èƒ½æ‰¾åˆ°ä¸‰å€‹æ•¸å­— `nums[i]`ã€`nums[j]` èˆ‡ `nums[k]`ï¼Œä½¿å¾— `nums[i] < nums[k] < nums[j]` ä¸” `i < j < k`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: nums = [1,2,3,4]\nOutput: false\nExplanation: There is no 132 pattern in the sequence.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: nums = [3,1,4,2]\nOutput: true\nExplanation: There is a 132 pattern in the sequence: [1, 4, 2].\n```\n\n## Example 3:\n\n```\nInput: nums = [-1,3,2,0]\nOutput: true\nExplanation: There are three 132 patterns in the sequence: [-1, 3, 2], [-1, 3, 0] and [-1, 2, 0].\n```\n\n# æƒ³æ³•\n\n## ç°¡å–®çš„ O(N^2) æƒ³æ³•\n\né¦–å…ˆï¼Œåªè€ƒæ…®æ‰¾åˆ° `nums[i] < nums[j]` ä¸” `i < j`ï¼Œæœ€å–®ç´”çš„æƒ³æ³•ç•¶ç„¶æ˜¯ä½¿ç”¨å…©å€‹è¿´åœˆéæ­·æ‰€æœ‰çš„ `i` èˆ‡ `j`ï¼Œä¸¦æª¢æŸ¥æœ‰æ²’æœ‰ `nums[i] < nums[j]` çš„æƒ…æ³ï¼Œé€™æ¨£çš„æ™‚é–“è¤‡é›œåº¦æ˜¯ `O(N^2)`ã€‚\n```cpp\nfor (int j = 0; j < n; j++)\n  for (int i = 0; i < j; i++)\n    if (nums[i] < nums[j])\n      return true;\n```\n\nå¯ä»¥ç™¼ç¾ï¼Œé€™è£¡ç­†è€…ç‰¹åˆ¥æŠŠ `i`ã€`j` è¿´åœˆçš„é †åºå°èª¿äº†ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œè§€å¯Ÿä¸­é–“çš„ `i` è¿´åœˆï¼Œå¯ä»¥ç™¼ç¾æ¯ä¸€æ¬¡ `i` è¿´åœˆéƒ½åªæ¯”ä¸Šä¸€æ¬¡å¤šæª¢æŸ¥äº†ä¸€å€‹æ•¸å­—ã€‚ä¸¦ä¸”ï¼Œå°æ–¼ `nums[j]` ä¾†èªªï¼Œè¦æª¢æŸ¥æœ‰æ²’æœ‰ `nums[i] < nums[j]` ä¸” `i < j` ç­‰åƒ¹æ–¼æª¢æŸ¥ `min(nums[0] ~ nums[i])` æœ‰æ²’æœ‰å°æ–¼ `nums[j]`ã€‚æœ‰äº†é€™å…©å€‹æ€§è³ªï¼Œå°±å¯ä»¥åˆ©ç”¨ä¸€å€‹è®Šæ•¸ `minValue`ï¼Œç´€éŒ„ `nums[0] ~ nums[j - 1]` çš„æœ€å°å€¼ï¼Œå°æ–¼æ¯ä¸€å€‹ `nums[j]` æª¢æŸ¥ `minValue` æœ‰æ²’æœ‰å°æ–¼ `nums[j]` å³å¯ã€‚\n```cpp\nint minValue = INT_MAX;\nfor (int j = 0; j < n; j++) {\n  if (minValue < nums[j])\n    return true;\n  minValue = min(minValue, nums[j]);\n}\n```\n\nåˆ°äº†é€™è£¡ï¼Œå›åˆ°åŸå…ˆçš„é¡Œç›®ï¼Œåˆ©ç”¨é¡å¤–çš„ä¸€å€‹è¿´åœˆæª¢æŸ¥æ˜¯å¦æ•¸å­— `nums[k]` æ»¿è¶³æ¢ä»¶å³å¯ã€‚\n```cpp\nint minValue = INT_MAX;\nfor (int j = 0; j < n; j++) {\n  if (minValue < nums[j]) { // å¯çœç•¥ï¼Œè£¡é¢çš„ if å·²åŒ…å« minValue < nums[j] çš„åˆ¤æ–·\n    for (int k = j + 1; k < n; k++)\n      if (minValue < nums[k] && nums[k] < nums[j])\n        return true;\n  }\n  minValue = min(minValue, nums[j]);\n}\n```\n\n## ç”± O(N^2) åˆ° O(N) çš„æƒ³æ³•ä¸€\n\nä¸€æ¨£ä½¿ç”¨ä¸Šè¿°çš„æƒ³æ³•ï¼Œè¦å°‡å…©å€‹è¿´åœˆè®Šæˆä¸€å€‹è¿´åœˆçš„é¦–è¦æ¢ä»¶å°±æ˜¯å…ˆè®“è£¡é¢çš„è¿´åœˆè®Šç‚ºä¸€æ¬¡å¢åŠ ä¸€å€‹æ•¸å­—ï¼Œæˆ‘å€‘æ”¹è®Šå¤–å±¤è¿´åœˆçš„é †åºã€‚\n\n```cpp\nint minValue = INT_MAX;\nfor (int j = n - 1; j >= 0; j--) {\n  for (int k = j + 1; k < n; k++)\n    if (minValue < nums[k] && nums[k] < nums[j])\n      return true;\n  minValue = min(minValue, nums[j]); // minValue cannot be maintained\n}\n```\n\né€™æ™‚æœƒç™¼ç¾åŸæœ¬çš„ `minValue` ç´€éŒ„è‘— `nums[0] ~ nums[j - 1]` çš„æœ€å°å€¼ï¼Œå› ç‚ºç¾åœ¨çš„è¿´åœˆé †åºä¸æ˜¯ä¸€æ¬¡å¢åŠ ä¸€å€‹ `nums[j]`ï¼Œè€Œæ˜¯ä¸€æ¬¡æ¸›å°‘ä¸€å€‹ `nums[j]`ï¼Œè€Œç„¡æ³•ç´€éŒ„äº†ã€‚\n\nå› æ­¤ï¼Œå¯ä»¥å°‡ `minValue` çš„è¨ˆç®—èˆ‡ä¹‹åˆ†é›¢ã€‚\n\n```cpp\nvector<int> minValues(n);\nint minValue = INT_MAX;\nfor (int j = 0; j < n; j++) {\n  minValues[i] = minValue;\n  minValue = min(minValue, nums[i]);\n}\nfor (int j = n - 1; j >= 0; j--) {\n  for (int k = j + 1; k < n; k++)\n    if (minValues[j] < nums[k] && nums[k] < nums[j])\n      return true;\n```\n\nç¾åœ¨å…§å±¤çš„ `k` è¿´åœˆæ¯æ¬¡éƒ½å¢åŠ ä¸€å€‹æª¢æŸ¥ä¸€å€‹æ•¸å­— `nums[j]`ï¼Œå¯ä»¥è§€å¯Ÿåˆ°ï¼š\n1. æ¯” `minValues[j]` é‚„å°çš„æ•¸å­—éƒ½æ²’æœ‰ç”¨ï¼Œå†ä¸‹ä¸€è¼ªä¹‹å¾Œä¹Ÿä¸æœƒæœ‰ç”¨ï¼Œå› ç‚º `minValues[j]` åªæœƒè¶Šä¾†è¶Šå¤§ï¼Œæ‰€ä»¥ `nums[k]` åœ¨é€™è¼ªæ¯” `minValues[j]` å°çš„è©±ï¼Œé‚£å†ä¸‹ä¸€è¼ªä¹Ÿæœƒæ¯” `minValues[j]` å°ã€‚\n2. æ’é™¤æ‰€æœ‰ `nums[k]` å°æ–¼ `minValues[j]` çš„æ•¸å­—å¾Œï¼Œè‹¥æœ€å°çš„ `nums[k]` æ¯” `nums[j]` å°ï¼Œå‰‡æ‰¾åˆ°ç­”æ¡ˆã€‚\n\nåˆ©ç”¨ä¸€å€‹å †ç–Šï¼Œç¶­è­·ä¸€å€‹éå¢åºåˆ—ã€‚æ¯æ¬¡å…ˆå°‡æ¯” `minValues[j]` å°çš„æ•¸å­—éƒ½ç§»é™¤ï¼Œå› ç‚ºåºåˆ—æ˜¯éå¢çš„ï¼Œæ‰€ä»¥åªè¦ä¸æ–·çš„ç§»é™¤å †ç–Šé ‚éƒ¨å…ƒç´ å³å¯ã€‚å®Œæˆå¾Œå †ç–Šå…§çš„å…ƒç´ éƒ½æ¯” `minValues[j]` å°äº†ï¼Œä¸”å †ç–Šç‚ºéå¢çš„ï¼Œå› æ­¤åªè¦æ¯”è¼ƒå †ç–Šé ‚éƒ¨å…ƒç´ è‹¥æ¯” `nums[j]` å°ï¼Œå‰‡æ‰¾åˆ°ç­”æ¡ˆã€‚è‹¥æ²’æœ‰ï¼Œå‰‡ç›´æ¥å°‡ `nums[j]` åŠ å…¥åˆ°å †ç–Šä¸­ï¼Œé€™è£¡ä¸éœ€å¤šåšæª¢æŸ¥ï¼Œå› ç‚ºèƒ½åŠ å…¥åˆ°å †ç–Šä¸­ä»£è¡¨å †ç–Šç‚ºç©ºæˆ–æ˜¯ `nums[j]` å°æ–¼å †ç–Šé ‚éƒ¨å…ƒç´ ï¼Œå› æ­¤ç›´æ¥åŠ å…¥å¾Œå †ç–Šé‚„æ˜¯éæ¸›çš„ã€‚\n\nå› ç‚ºæ¯ä¸€å€‹å…ƒç´ åªæœƒè¢«åŠ å…¥ã€é›¢é–‹å †ç–Šä¸€æ¬¡ï¼Œå› æ­¤ç¸½æ™‚é–“è¤‡é›œåº¦æ˜¯ `O(N)`ã€‚\n\nç¨‹å¼ç¢¼è¦‹ä¸‹æ–¹ã€‚\n\n## ç”± O(N^2) åˆ° One Pass O(N) çš„æƒ³æ³•äºŒ\n\n**å¾…è£œ**\n\n# å¯¦ä½œç´°ç¯€\n\n# ç¨‹å¼ç¢¼\n\n## æƒ³æ³•ä¸€ Time O(N), Space O(N)\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/132-pattern/\n * Runtime: 12ms\n */\n\nclass Solution {\npublic:\n  bool find132pattern(vector<int>& nums) {\n    int n = (int)nums.size();\n    vector<int> minValues(n);\n\n    int minValue = nums[0];\n    for (int i = 0; i < n; i++) {\n      minValues[i] = minValue;\n      minValue = min(minValue, nums[i]);\n    }\n    stack<int> stk;\n    for (int i = n - 1; i >= 0; i--) {\n      while (!stk.empty() && stk.top() <= minValues[i])\n        stk.pop();\n      if (!stk.empty() && stk.top() < nums[i])\n        return true;\n      stk.push(nums[i]);\n    }\n    return false;\n  }\n};\n\n```\n\n## æƒ³æ³•äºŒ Time O(N), Space O(N)\n\n**å¾…è£œ**","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰","å–®èª¿æ£§ï¼ˆMonotone Stackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 402 - Remove K Digits","url":"/LeetCode-Remove-K-Digits/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/remove-k-digits/](https://leetcode.com/problems/remove-k-digits/)\n\nçµ¦å®šä¸€å€‹æ•´æ•¸ï¼Œè¦æ±‚ç§»é™¤æ°å¥½ k å€‹æ•¸å­—ï¼ˆå­—å…ƒï¼‰ä½¿å¾—ç§»é™¤å¾Œçš„æ•´æ•¸æœ€å°ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: num = \"1432219\", k = 3\nOutput: \"1219\"\nExplanation: Remove the three digits 4, 3, and 2 to form the new number 1219 which is the smallest.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: num = \"10200\", k = 1\nOutput: \"200\"\nExplanation: Remove the leading 1 and the number is 200. Note that the output must not contain leading zeroes.\n```\n\n## Example 3:\n\n```\nInput: num = \"10\", k = 2\nOutput: \"0\"\nExplanation: Remove all the digits from the number and it is left with nothing which is 0.\n```\n\n# æƒ³æ³•\n\né¦–å…ˆï¼Œå› ç‚ºè¦ç§»é™¤æ°å¥½ k å€‹æ•¸å­—ï¼Œæ‰€ä»¥ä¸ç®¡ç§»é™¤å“ªä¸€äº›æ•¸å­—ï¼Œæœ€å¾Œå¾—åˆ°çš„æ•´æ•¸é•·åº¦éƒ½æ˜¯ä¸€æ¨£çš„ã€‚\n\nå› ç‚ºé¡Œç›®è¦æ±‚è¦å¾—åˆ°æœ€å°çš„æ•´æ•¸ï¼Œä¸”**ä¸ç®¡ç§»é™¤å“ªä¸€äº›æ•¸å­—ï¼Œæœ€å¾Œå¾—åˆ°çš„æ•´æ•¸é•·åº¦éƒ½æ˜¯ä¸€æ¨£çš„**ï¼Œæ‰€ä»¥æœ€å¾Œå¾—åˆ°çš„æ•¸å­—ä¸­ï¼Œè¶Šå·¦é‚Šçš„ä½ï¼ˆä¹Ÿå°±æ˜¯é«˜ä½æ•¸ï¼‰æ‡‰è©²è¦ç›¡é‡å°ã€‚\n\nå› æ­¤ï¼Œç”±å·¦è€Œå³çš„å°‡æ•¸å­—åŠ å…¥åˆ°ç­”æ¡ˆæ•´æ•¸ `ans`ï¼Œè‹¥**ç•¶å‰è¦åŠ å…¥çš„ `digit` æ¯”ç›®å‰ `ans` çš„æœ€ä½ä½é‚„è¦å°ä¸”é‚„æœ‰é¡åº¦å¯ä»¥åˆªé™¤æ•¸å­—ï¼Œå‰‡å¯ä»¥ä¸æ–·åˆªé™¤ `ans` ä¸­æœ€ä½ä½ï¼Œè®“ `digit` å‰é€²åˆ°æ›´é«˜çš„ä½æ•¸ä½¿å¾— `ans` è®Šå¾—æ›´å°**ã€‚\n\nå…¶å¯¦é€™é¡Œä¹Ÿå¯ä»¥æƒ³æˆåš k æ¬¡åˆªé™¤çš„å‹•ä½œï¼Œè‹¥åªçœ‹ä¸€æ¬¡çš„åˆªé™¤ï¼Œè€Œä½¿å¾—æ•¸å­—è¦æœ€å°ï¼Œæœƒç™¼ç¾è¦åˆªé™¤çš„æ•¸å­—æ˜¯ç”±é«˜ä½æ•¸åˆ°ä½ä½æ•¸ä¸­ï¼Œç¬¬ä¸€æ¬¡å‡ºç¾éæ¸›çš„ä½ç½®ä¾†åˆªé™¤ã€‚å› ç‚ºä¸Šé¢æåˆ°ï¼Œé«˜ä½æ•¸çš„éƒ¨åˆ†æ‡‰è©²è¦ç›¡é‡å°ï¼Œä¸”å‡ºç¾éæ¸›ä»£è¡¨å¯ä»¥æŠŠå¤§çš„æ•¸å­—åˆªé™¤ä½¿å¾—å°çš„æ•¸å­—å¾€é«˜ä½æ•¸å‰é€²ï¼Œå› æ­¤ä»¥åŒæ¨£çš„æ–¹å¼é€²è¡Œ k æ¬¡çš„åˆªé™¤å‹•ä½œä¹Ÿæœƒå¾—åˆ°ç›¸åŒçš„ç­”æ¡ˆã€‚æœ‰äº†é€™å€‹æƒ³æ³•ä¹‹å¾Œï¼Œå¯ä»¥ç¢ºå®šå¯¦ä½œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€å€‹ `stack` ä¾†ç¶­è­·å–®èª¿éå¢çš„åºåˆ—ï¼ˆç”±é«˜ä½æ•¸åˆ°ä½ä½æ•¸ï¼‰ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä¸€å€‹ `stack` ä¾†å®Œæˆï¼Œå°‡ `stack` çš„åº•éƒ¨ç•¶æˆæ˜¯æœ€é«˜ä½æ•¸ï¼Œç”±å·¦è€Œå³çš„éæ­·æ¯ä¸€å€‹ `digit`ï¼Œè‹¥é‚„æœ‰åˆªé™¤çš„é¡åº¦ï¼ˆ`k > 0`ï¼‰ä¸” `stack` ä¸­çš„æœ€ä½ä½ï¼ˆ`stack.top()`ï¼‰æ¯” `digit` é‚„è¦å°ï¼Œå‰‡ä¸æ–·çš„å°‡æ•¸å­—å¾ `stack` ä¸­ç§»é™¤ï¼ˆ`stack.pop()`ï¼‰ã€‚\n\næœ€å¾Œè¦æ³¨æ„å…©ä»¶äº‹æƒ…ï¼š\n1. è¦ç¢ºä¿åˆªé™¤æ°å¥½ k å€‹æ•¸å­—ï¼Œå› æ­¤æŠŠ `stack` ä¸­çš„æœ€å¾Œ k ä½éƒ½åˆªé™¤ã€‚\n2. è¦ç¢ºä¿æ²’æœ‰å‰å° 0ï¼Œé€™é»å¯ä»¥åœ¨æŠŠ `stack` ä¸­çš„æ•¸å­—è½‰ç‚º `string` å¾Œï¼Œå†ç”¨è¿´åœˆåˆªé™¤å‰å° 0ã€‚\n\nä¸éï¼Œæ¯”è¼ƒç°¡å–®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€å€‹ `string` ä¾†å–ä»£ä¸Šè¿°çš„ `stack`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/remove-k-digits/\n * Runtime: 0ms\n */\n\nclass Solution {\npublic:\n  string removeKdigits(string num, int k) {\n    // æœ€å¾Œçš„æ•´æ•¸ï¼Œans[0] ç‚ºæœ€é«˜ä½æ•¸ï¼Œans[1] ç‚ºç¬¬äºŒé«˜ä½æ•¸... ä»¥æ­¤é¡æ¨\n    string ans = \"\";\n    for (char digit: num) {\n      // è‹¥é‚„æœ‰åˆªé™¤çš„é¡åº¦ä¸”ç•¶å‰çš„æ•¸å­—æ¯” ans çš„æœ€ä½ä½æ•¸é‚„è¦å°ï¼Œåˆªé™¤ ans ä¸­çš„æœ€ä½ä½æ•¸\n      while (k && !ans.empty() && digit < ans.back()) {\n        ans.pop_back();\n        k--;\n      }\n      // å°‡ digit åŠ å…¥ ans ä¸­ï¼Œé€™è£¡å¯ä»¥åˆ©ç”¨åˆ¤æ–·ä½¿å¾—å‰å° 0 ä¸æœƒè¢«åŠ å…¥\n      if (!ans.empty() || digit != '0') ans.push_back(digit);\n    }\n\n    // ç¢ºä¿æœ‰ k å€‹æ•¸å­—è¢«åˆªé™¤\n    while (!ans.empty() && k--)\n      ans.pop_back();\n\n    // ç‰¹ä¾‹ï¼šè‹¥æ•¸å­—éƒ½åˆªå®Œäº†ï¼Œå‰‡å›å‚³ \"0\"\n    return ans.empty() ? \"0\" : ans;\n  }\n};\n\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰","å–®èª¿æ£§ï¼ˆMonotone Stackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 92 - Reverse Linked List II","url":"/LeetCode-Reverse-Linked-List-II/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/reverse-linked-list-ii/](https://leetcode.com/problems/reverse-linked-list-ii/)\n\nçµ¦ä¸€å€‹ Linked list ä»¥åŠå…©å€‹æ•¸å­— `left`ã€`right`ï¼Œå°‡ç´¢å¼•å€¼åœ¨ `left~right` çš„éƒ¨åˆ†ç¿»è½‰ã€‚\n\nç´¢å¼•å€¼å¾ 1 é–‹å§‹ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: head = [1,2,3,4,5], left = 2, right = 4\nOutput: [1,4,3,2,5]\n```\n\n![](/assets/LeetCode-Reverse-Linked-List-II/rev2ex.jpg)\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: head = [5], left = 1, right = 1\nOutput: [5]\n```\n\n# æƒ³æ³•\n\nå‡è¨­ç´¢å¼• `left` ä¸Šçš„æ•¸å­—ç‚º `cur`ï¼Œä¸”ç´¢å¼• `left - 1` ä¸Šçš„æ•¸å­—ç‚º `pre`ã€‚\n\nè‹¥æƒ³è¦éæ­·ä¸€æ¬¡ï¼Œä¸¦ä¸”ä½¿ç”¨ `O(1)` space å®Œæˆç¿»è½‰ï¼Œå¯ä»¥æƒ³æˆæ˜¯åš `right - left` æ¬¡çš„ã€Œ**å°‡ `cur` çš„ä¸‹ä¸€å€‹æ•¸å­—ç§»é™¤ä¸¦æ’å…¥åˆ° `pre` ä¹‹å¾Œ**ã€ã€‚\n\nä¾‹å¦‚ Example 1ï¼š\n| Step |     Linked list     | `cur` index | `pre` index |\n| ---- | ------------------- | ----------- | ----------- |\n| 0    | `1->2->3->4->5`     | 2           | 1           |\n| 1    | `1->3->2->4->5`     | 3           | 1           |\n| 2    | `1->4->3->2->5`     | 4           | 1           |\n\næ³¨æ„ `cur` æœƒä¸€ç›´æŒ‡è‘—åŒä¸€å€‹æ•¸å­—ï¼Œåœ¨ Example 1 ä¸­ä¹Ÿå°±æ˜¯æ•¸å­— `2`ï¼›`pre` ä¹Ÿæœƒä¸€ç›´æŒ‡è‘—åŒä¸€å€‹æ•¸å­—ï¼Œåœ¨ Example 1 ä¸­ä¹Ÿå°±æ˜¯æ•¸å­— 1ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\né¦–å…ˆï¼Œå¯ä»¥å°‡ä¸Šè¿°æƒ³æ³•åˆ†ç‚ºå…©å€‹æ­¥é©Ÿå¯¦ä½œï¼š\n1. æ‰¾åˆ° `pre` ä»¥åŠ `cur` çš„ä½ç½®\n   å¾ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼Œ`cur` çš„åœ¨ `head` å‘å¾Œç§»å‹• `left - 1` æ¬¡çš„ä½ç½®ï¼›`pre` åœ¨ `cur` çš„å‰ä¸€å€‹ï¼Œä¹Ÿå°±æ˜¯ `head` å‘å¾Œç§»å‹• `left - 2` æ¬¡çš„ä½ç½®ã€‚\n2. åŸ·è¡Œ `right - left` æ¬¡ã€Œ**å°‡ `cur` çš„ä¸‹ä¸€å€‹æ•¸å­—ç§»é™¤ä¸¦æ’å…¥åˆ° `pre` ä¹‹å¾Œ**ã€\n   **<font color=\"red\">åœ¨å¯¦ä½œ Linked list çš„æ“ä½œçš„æ™‚å€™ï¼Œç­†è€…å»ºè­°å¯ä»¥æŠŠåœ–ç•«å‡ºä¾†ï¼Œæ†‘ç©ºæƒ³åƒæ˜¯å¾ˆå®¹æ˜“å‡ºéŒ¯çš„ï¼</font>**\n   \n   ä¸€æ¨£ä»¥ Example 1 ç‚ºä¾‹å­ï¼š\n   ![](/assets/LeetCode-Reverse-Linked-List-II/00.png)\n   1. é¦–å…ˆç­†è€…æœƒå…ˆæŠŠ `pre`ã€`cur` çš„ä½ç½®æ¨™å‡ºä¾†ï¼Œä¸¦ä¸”å°‡ `pre->next`ã€`cur->next` ç­‰æŒ‡æ¨™çš„ä½ç½®ä¹Ÿæ¨™å‡ºä¾†ã€‚\n   2. å†ä¾†ï¼ŒåŸ·è¡Œã€Œ**å°‡ `cur` çš„ä¸‹ä¸€å€‹æ•¸å­—ç§»é™¤ä¸¦æ’å…¥åˆ° `pre` ä¹‹å¾Œ**ã€é€™å€‹æ“ä½œï¼Œå°‡è¦æ”¹è®Šçš„æŒ‡æ¨™ç•«æˆæ›²ç·šã€‚\n   3. æœ€å¾Œï¼Œå°‡æ›²ç·šæ¨™å‡ºå¦‚ä½•è³¦å€¤\bï¼Œä¾‹å¦‚ï¼š\n      - <font color=\"green\">æ•¸å­— 1 çš„ä¸‹ä¸€å€‹æ•¸å­—æ‡‰è©²æ‡‰è©²è¦æ¥æ•¸å­— 3ï¼Œæ•¸å­— 1 æ˜¯ `pre`ï¼Œ`pre` çš„ä¸‹ä¸€å€‹æ•¸å­—ä¹Ÿå°±æ˜¯ `pre->next` è¦æ¥åˆ°æ•¸å­— 3ï¼Œä¹Ÿå°±æ˜¯ `cur->next`ï¼Œå› æ­¤ `pre->next = cur->next`ã€‚</font>\n      - <font color=\"blue\">æ•¸å­— 2 çš„ä¸‹ä¸€å€‹æ•¸å­—è¦æ¥åˆ°æ•¸å­— 4ï¼Œæ•¸å­— 2 æ˜¯ `cur`ï¼Œ`cur` çš„ä¸‹ä¸€å€‹æ•¸å­—ä¹Ÿå°±æ˜¯ `cur->next` è¦æ¥åˆ°æ•¸å­— 4ï¼Œä¹Ÿå°±æ˜¯ `cur->next->next`ï¼Œå› æ­¤ `cur->next = cur->next->next`ã€‚</font>\n      - <font color=\"red\">æ•¸å­— 3 çš„ä¸‹ä¸€å€‹æ•¸å­—è¦æ¥åˆ°æ•¸å­— 2ï¼Œæ•¸å­— 3 æ˜¯ `cur->next`ï¼Œ`cur->next` çš„ä¸‹ä¸€å€‹æ•¸å­—ä¹Ÿå°±æ˜¯ `cur->next->next` è¦æ¥åˆ°æ•¸å­— 2ï¼Œä¹Ÿå°±æ˜¯ `pre->next`ï¼Œå› æ­¤ `cur->next->next = pre->next`ã€‚</font>\n  \n    å¦‚æœä¸æ”¾å¿ƒï¼Œå¯ä»¥å†åšä¸€æ¬¡ Step 1 åˆ° Step 2 çš„éç¨‹ï¼Œæœƒå¾—åˆ°ç›¸åŒçš„ä¸‰å€‹æ­¥é©Ÿã€‚\n    ![](/assets/LeetCode-Reverse-Linked-List-II/01.png)\n\næœ€å¾Œï¼Œçœ¼å°–çš„è®€è€…å¯èƒ½å·²ç¶“ç™¼ç¾äº†å…©å€‹å•é¡Œï¼š\n1. åœ¨ç¬¬ä¸€é»ä¸­ï¼Œ`pre` çš„ä½ç½®æ˜¯ `head` å‘å¾Œç§»å‹• `left - 2` æ¬¡çš„ä½ç½®ï¼Œå¯æ˜¯ `left` çš„æœ€å°å€¼æ˜¯ `1`ï¼Œä¹Ÿå°±æ˜¯ `left - 2` æ˜¯ `-1`ï¼Œé‚£ `head` å‘å¾Œç§»å‹• `-1` æ­¥æ˜¯å“ªè£¡ï¼Ÿ\n  ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œå¯ä»¥åœ¨æ•´å€‹ Linked list çš„å‰é¢å¤šåŠ ä¸€å€‹é»ï¼ˆDummy Nodeï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨ `head` çš„å‰é¢å†æ”¾ä¸€å€‹æ–°çš„é»ï¼ŒDummy Node é›–ç„¶å¯¦éš›ä¸Šä¸å­˜åœ¨ï¼Œä½†æ˜¯å¯ä»¥å¹«åŠ©ä½ çš„å¯¦ä½œæ›´ä½³ç°¡æ½”ã€‚\n  æœ‰äº† Dummy node çš„å¹«åŠ©ï¼Œé‚£éº¼ `pre` çš„ä½ç½®å³æ”¹ç‚º dummy node å¾€å¾Œç§»å‹• `left - 1` ä¸çš„ä½ç½®ï¼Œå°±ä¸€å®šå­˜åœ¨äº†ï¼ç•¶ç„¶ `cur` ä¹Ÿè¦æ”¹ç‚º dummy node å¾€å¾Œç§»å‹• `left` æ­¥çš„ä½ç½®ã€‚\n2. åœ¨ç¬¬äºŒé»ä¸­ï¼Œä¸‰å€‹ä¿®æ”¹ `1. pre->next = cur->next`ã€`2. cur->next = cur->next->next` ä»¥åŠ `3. cur->next->next = pre->next` æ˜¯æœ‰é †åºæ€§çš„ã€‚\n  ä¾‹å¦‚ï¼š `1.` æ‡‰è©²è¦åœ¨ `3.` ä¹‹å¾Œï¼Œå› ç‚º `3.` æœƒéœ€è¦åŸæœ¬ `pre->next` çš„å€¼ï¼Œå¯æ˜¯åœ¨ `1.` çš„æ™‚å€™æœƒä¿®æ”¹åˆ° `pre->next` çš„å€¼ã€‚\n  é‡åˆ°é€™ç¨®æƒ…æ³ï¼Œæ¯”è¼ƒç°¡å–®çš„è¾¦æ³•å°±æ˜¯**å…ˆæŠŠéœ€è¦çš„å€¼éƒ½å‚™ä»½ä¸€éï¼Œæœ€å¾Œæ›´æ”¹æ™‚å¾ç­‰è™Ÿå·¦å´å€¼æ¯”è¼ƒå³é‚Šçš„é–‹å§‹ä¿®æ”¹ï¼Œç­‰è™Ÿå³å´éƒ½ä½¿ç”¨å‚™ä»½çš„æŒ‡æ¨™**ã€‚å› ç‚ºç­‰è™Ÿå³å´æ‰€ç”¨åˆ°çš„å€¼éƒ½æ˜¯å‚™ä»½çš„ï¼Œå³å´ä¸€å®šä¸æœƒå‡ºéŒ¯ï¼Œè€Œç­‰è™Ÿå·¦å´çš„å€¼å¾æœ€å³é‚Šé–‹å§‹ç…§é †åºæ›´æ”¹ï¼Œå› æ­¤ä¹Ÿä¸æœƒæœ‰ä¾é™„é—œä¿‚ï¼Œå¦‚æ­¤ä¸€ä¾†å°±ä¸æœƒå‡ºéŒ¯äº†ï½\n    ```cpp\n    ListNode* tempCurNext = cur->next;\n    ListNode* tempCurNextNext = cur->next->next;\n    ListNode* tempPreNext = pre->next;\n    cur->next->next = tempPreNext;\n    cur->next = tempCurNextNext;\n    pre->next = tempCurNext;\n    ```\n\n    ç•¶ç„¶ï¼Œä¹Ÿå¯ä»¥ç¨å¾®æ€è€ƒä¸€ä¸‹é †åºï¼Œå†ç”¨ç›¡é‡å°‘çš„è®Šæ•¸ä¾†å¹«åŠ©å³å¯ï¼ˆå¯ä»¥æŠŠå…ˆå¾Œé—œä¿‚ç•«æˆä¸€å¼µåœ–å†æ±ºå®šå…ˆå¾Œé †åºï¼Œå¦‚æœæœ‰ç’°å‡ºç¾çš„è©±å°±è‡³å°‘éœ€è¦ä¸€å€‹æš«å­˜è®Šæ•¸ï¼‰ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/reverse-linked-list-ii/submissions/\n * Runtime: 0ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode() : val(0), next(nullptr) {}\n *     ListNode(int x) : val(x), next(nullptr) {}\n *     ListNode(int x, ListNode *next) : val(x), next(next) {}\n * };\n */\nclass Solution {\npublic:\n  ListNode* reverseBetween(ListNode* head, int left, int right) {\n    ListNode* preHead = new ListNode(0, head); // Dummy node\n    ListNode* pre = preHead;\n    for (int i = 0; i < left - 1; i++) {\n      pre = pre->next;\n    }\n\n    ListNode* cur = pre->next;\n    for (int i = left; i < right; i++) {\n      ListNode* temp = cur->next->next;\n      cur->next->next = pre->next;\n      pre->next = cur->next;\n      cur->next = temp;\n    }\n    return preHead->next;\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 160 - Intersection of Two Linked Lists","url":"/LeetCode-Intersection-of-Two-Linked-Lists/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/intersection-of-two-linked-lists/](https://leetcode.com/problems/intersection-of-two-linked-lists/)\n\nçµ¦å®šå…©å€‹ Linked listï¼Œæ‰¾å‡ºå…¶äº¤é»ã€‚è‹¥æ²’æœ‰äº¤é»å‰‡å›å‚³ `null`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: intersectVal = 8, listA = [4,1,8,4,5], listB = [5,6,1,8,4,5], skipA = 2, skipB = 3\nOutput: Reference of the node with value = 8\nInput Explanation: The intersected node's value is 8 (note that this must not be 0 if the two lists intersect). From the head of A, it reads as [4,1,8,4,5]. From the head of B, it reads as [5,6,1,8,4,5]. There are 2 nodes before the intersected node in A; There are 3 nodes before the intersected node in B.\n``` \n![](/assets/LeetCode-Intersection-of-Two-Linked-Lists/160_example_1_1.png)\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: intersectVal = 2, listA = [1,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1\nOutput: Reference of the node with value = 2\nInput Explanation: The intersected node's value is 2 (note that this must not be 0 if the two lists intersect). From the head of A, it reads as [1,9,1,2,4]. From the head of B, it reads as [3,2,4]. There are 3 nodes before the intersected node in A; There are 1 node before the intersected node in B.\n``` \n![](/assets/LeetCode-Intersection-of-Two-Linked-Lists/160_example_2.png)\n\n## Example 3:\n\n```\nInput: intersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2\nOutput: null\nInput Explanation: From the head of A, it reads as [2,6,4]. From the head of B, it reads as [1,5]. Since the two lists do not intersect, intersectVal must be 0, while skipA and skipB can be arbitrary values.\nExplanation: The two lists do not intersect, so return null.\n```\n![](/assets/LeetCode-Intersection-of-Two-Linked-Lists/160_example_3.png)\n\n# æƒ³æ³•\n\n## æƒ³æ³•ä¸€\n\né¦–å…ˆï¼Œä½¿ç”¨å…©å€‹æŒ‡æ¨™ï¼Œ`curA` å¾é ­é–‹å§‹éæ­·ç¬¬ä¸€æ¢ Linked listï¼Œ`curB` éæ­·ç¬¬äºŒæ¢ã€‚\n\næ‰¾å‡ºç¬¬ä¸€æ¢ Linked list çš„é•· `lenA` ä»¥åŠç¬¬äºŒæ¢ Linked list çš„é•· `lenB`ã€‚\n\nå› ç‚ºå…©æ¢ Linked list è‹¥æœ‰äº¤é»ï¼Œå‰‡äº¤é»å¾Œçš„é•·åº¦çš†ä¸€æ¨£ã€‚æ‰€ä»¥åªè¦å°‡é•·åº¦è¼ƒé•·çš„ Linked list å¾é–‹é ­å»æ‰ `|lenA - lenB|` å€‹é»ï¼Œä½¿å¾—å…©å€‹ Linked list é•·åº¦ç›¸ç­‰ï¼Œä½¿ç”¨å…©å€‹æŒ‡æ¨™å¾å…©å€‹ Linked list çš„é–‹é ­é–‹å§‹ï¼ŒåŒæ™‚ä¸€æ¬¡ä¸€æ­¥çš„å‰é€²ï¼Œè‹¥æœ‰äº¤é»å‰‡ä¸€å®šæœƒåŒæ™‚èµ°åˆ°äº¤é»ï¼›è‹¥æ²’æœ‰äº¤é»å‰‡åŒæ™‚èµ°åˆ° `null`ã€‚\n\n## æƒ³æ³•äºŒ\n\nä½¿ç”¨ç¬¬ä¸€æ¢ Linked list ä¸²åˆ°ç¬¬äºŒæ¢ Linked list ä¹‹å¾Œï¼›å°‡ç¬¬äºŒæ¢ Linked list ä¸²åˆ°ç¬¬ä¸€æ¢ Linked list ä¹‹å¾Œã€‚å‰‡å…©æ¢ Linked list æœƒè®Šæˆç­‰é•·ï¼Œæ ¹æ“š**æƒ³æ³•ä¸€**ï¼Œå› ç‚ºäº¤é»å¾Œçš„é•·åº¦çš†ç›¸åŒï¼Œæ‰€ä»¥åªè¦ä½¿ç”¨å…©å€‹æŒ‡æ¨™å¾å…©å€‹ Linked list çš„é–‹é ­é–‹å§‹ï¼ŒåŒæ™‚ä¸€æ¬¡ä¸€æ­¥çš„å‰é€²ï¼Œè‹¥æœ‰äº¤é»å‰‡ä¸€å®šæœƒåŒæ™‚èµ°åˆ°äº¤é»ï¼ˆä¸‹åœ–é»‘æ¡†ï¼‰ï¼šè‹¥æ²’æœ‰äº¤é»çš„è©±å‰‡åŒæ™‚èµ°åˆ° `null`ã€‚\n\n![](/assets/LeetCode-Intersection-of-Two-Linked-Lists/00.png)\n\n# å¯¦ä½œç´°ç¯€\n\nä¸‹é¢å¯¦ä½œç‚º**æƒ³æ³•äºŒ**ã€‚\n\nå¯¦ä½œæ™‚ï¼Œ\bå¯ä»¥åˆ¤æ–·ç•¶ `curA->next != nullptr` æ™‚ï¼Œ`curA = headB`ï¼Œå¦å‰‡ `curA = curA->next`ï¼›`curB` é¡ä¼¼é“ç†ã€‚\n\nä½†æ˜¯é€™æ¨£å¯¦ä½œæœƒç™¼ç¾ç•¶æ²’æœ‰äº¤é»æ™‚ï¼Œ`curA` èˆ‡ `curB` æœƒç„¡æ³•åŒæ™‚èµ°åˆ° `null` ä¸Šï¼ˆå› ç‚º `curA` åœ¨èµ°åˆ° `null` ä¹‹å‰å°±æœƒå› ç‚º `curA->next != nullptr` è€ŒåŸ·è¡Œ `curA = headB` èµ°åˆ° `headB` ä¸Šäº†ã€‚\n\nå¯ä»¥å°‡åˆ¤æ–·æ¢ä»¶æ”¹ç‚º `curA->next != nullptr` æ”¹ç‚º `curA != nullptr`ï¼Œ`curB` ä¹Ÿé¡ä¼¼é“ç†ã€‚é€™æ¨£ä¸€ä¾†ä¸ä½†ç¬¦åˆ**æƒ³æ³•äºŒ**ï¼Œä¸¦ä¸”è§£æ±ºäº†ä¸Šè¿°çš„å•é¡Œã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/intersection-of-two-linked-lists\n * Runtime: 40ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode(int x) : val(x), next(NULL) {}\n * };\n */\n\nclass Solution {\npublic:\n  ListNode *getIntersectionNode(ListNode *headA, ListNode *headB) {\n    if (headA == nullptr || headB == nullptr)\n      return nullptr;\n\n    ListNode* curA = headA;\n    ListNode* curB = headB;\n    while (curA != curB) {\n      curA = (curA != nullptr) ? curA->next : headB;\n      curB = (curB != nullptr) ? curB->next : headA;\n    }\n    return curA;\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 141 - Linked List Cycle","url":"/LeetCode-Linked-List-Cycle/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/linked-list-cycle/](https://leetcode.com/problems/linked-list-cycle/)\n\nçµ¦ä¸€å€‹ Linked listï¼Œåˆ¤æ–·æœ‰æ²’æœ‰ç’°ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: head = [3,2,0,-4], pos = 1\nOutput: true\nExplanation: There is a cycle in the linked list, where the tail connects to the 1st node (0-indexed).\n```\n\n<!-- More -->\n\n![](/assets/LeetCode-Linked-List-Cycle/circularlinkedlist.png)\n\n## Example 2:\n\n```\nInput: head = [1,2], pos = 0\nOutput: true\nExplanation: There is a cycle in the linked list, where the tail connects to the 0th node.\n```\n\n![](/assets/LeetCode-Linked-List-Cycle/circularlinkedlist_test2.png)\n\n## Example 3:\n\n```\nInput: head = [1], pos = -1\nOutput: false\nExplanation: There is no cycle in the linked list.\n```\n\n![](/assets/LeetCode-Linked-List-Cycle/circularlinkedlist_test3.png)\n\n# æƒ³æ³•\n\n## ä¸€èˆ¬çš„ä½œæ³•\bï¼šTime `O(N)`, Space `O(N)`\n\næœ‰ç„¡ç’°çš„å€åˆ¥å°±æ˜¯éæ­· Linked list æ™‚æ˜¯å¦æœƒç¶“éé‡è¤‡çš„ä½ç½®ã€‚\n\næœ€ç°¡å–®çš„æƒ³æ³•æ˜¯ä½¿ç”¨ä¸€å€‹æŒ‡æ¨™ `cur` å¾é ­éæ­·æ•´å€‹ Linked listï¼Œä¸¦ä¸”å°‡ `cur` çš„è¨˜æ†¶é«”ä½ç½®éƒ½è¨˜éŒ„ä¸‹ä¾†ï¼ˆå…ˆå‡è¨­è¨˜éŒ„åœ¨ä¸€å€‹è®Šæ•¸ `box` å…§ï¼‰ï¼Œæ¯æ¬¡éƒ½æª¢æŸ¥ `box` å…§æœ‰èˆ‡ `cur` ç›¸åŒçš„è¨˜æ†¶é«”ä½ç½®ã€‚\n\né€™å€‹ `box` å¦‚æœæ˜¯ä¸€å€‹é™£åˆ—ï¼Œåˆ¤æ–· **`box` å…§æœ‰èˆ‡ `cur` ç›¸åŒçš„è¨˜æ†¶é«”ä½ç½®**å°±éœ€è¦éæ­·æ•´å€‹ `box` é™£åˆ—ï¼Œæœƒè®“æ•´é«”æ™‚é–“è¤‡é›œåº¦è®Šç‚º `O(N^2)`ã€‚\n\né€™å€‹ `box` å¯ä»¥æ˜¯ä¸€å€‹ Hash tableï¼Œé‚£éº¼åˆ¤æ–· **`box` å…§æœ‰èˆ‡ `cur` ç›¸åŒçš„è¨˜æ†¶é«”ä½ç½®** åªéœ€è¦ `O(1)`ï¼Œæ•´é«”æ™‚é–“è¤‡é›œåº¦ç­‰æ–¼éæ­·ä¸€é Linked list çš„æ™‚é–“ `O(N)`ã€‚\n\nC++ `box` å¯ä»¥ä½¿ç”¨ `std::unordered_set<ListNode*>`ï¼Œ[ä½†æ˜¯è¦å¯¦ä½œ `ListNode*` çš„ compare å‡½æ•¸æ‰èƒ½ä½¿ç”¨](https://stackoverflow.com/questions/31628251/stdunordered-set-of-pointers)ã€‚\n\n## æœ€ä½³çš„ä½œæ³•ï¼šTime `O(N)`, Space `O(1)`\n\né¦–å…ˆï¼Œè‹¥ Linked list æœ‰ç’°ï¼Œå‰‡ä¸€å€‹æŒ‡æ¨™ä¸ç®¡èµ°å¤šå°‘æ­¥éƒ½æœƒè¢«å¡åœ¨ç’°ä¸Šä¸€ç›´ç¹åœˆã€‚\n\nåˆ©ç”¨é€™å€‹æ€§è³ªï¼Œä½¿ç”¨å…©å€‹æŒ‡æ¨™ï¼Œçš†å¾é ­é–‹å§‹éæ­·ã€‚ä¸€å€‹ä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œç¨±ä¹‹ç‚º `slow`ï¼›å¦ä¸€å€‹ä¸€æ¬¡èµ°å…©æ­¥ï¼Œç¨±ä¹‹ç‚º `fast`ã€‚å¯ä»¥çŸ¥é“è‹¥å­˜åœ¨ç’°ï¼Œä¸ç®¡èµ°å¤šå°‘æ­¥ï¼Œ`slow` ä»¥åŠ `fast` éƒ½æœƒä¸€ç›´åœ¨ç’°ä¸Šç¹åœˆï¼Œä¸¦ä¸”å› ç‚º `fast` æ¯æ¬¡æ¯” `slow` å¤šèµ°ä¸€æ­¥ï¼Œæ‰€ä»¥æœ€å¾Œ `slow` ä»¥åŠ `fast` ä¸€å®šæœƒç›¸æœƒã€‚\n\næ™‚é–“è¤‡é›œåº¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥çŸ¥é“ `slow` ä»¥åŠ `fast` åœ¨ `N` æ­¥ä¹‹å…§ä¸€å®šæœƒèµ°åˆ°ç’°ä¸Šï¼Œä¸¦ä¸” `fast` æ¯æ¬¡èˆ‡ `slow` ç¸®æ¸›ä¸€æ­¥çš„è·é›¢ï¼Œè€Œç’°çš„é•·åº¦å°æ–¼ `N`ï¼Œå› æ­¤ `slow` èˆ‡ `fast` éƒ½åˆ°é”ç’°ä¸Šå¾Œï¼Œä¸€å®šæœƒåœ¨ `N` æ­¥å…§ç›¸æœƒã€‚ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(2N) = O(N)`ã€‚\n\nè€Œæ²’æœ‰ç’°æ™‚ï¼Œ`fast` æœƒç›´æ¥èµ°åˆ°åº•ï¼Œä¹Ÿå°±æ˜¯ `null`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\næ³¨æ„è¿´åœˆçš„æ¢ä»¶ï¼Œå› ç‚º `fast` æœƒä¸€æ¬¡èµ°å…©æ­¥ï¼Œæ‰€ä»¥æœ‰å…©å€‹åˆ¤æ–·æ¢ä»¶ï¼š `fast != nullptr && fast->next != nullptr`ã€‚\n\nè‡³æ–¼ `slow` å› ç‚ºèµ°çš„æ¯” `fast` é‚„è¦æ…¢ï¼Œå› æ­¤ä¸éœ€è¦åˆ¤æ–·ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/linked-list-cycle/\n * Runtime: 8ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode(int x) : val(x), next(NULL) {}\n * };\n */\n\nclass Solution {\npublic:\n  bool hasCycle(ListNode *head) {\n    if (head == nullptr)\n      return false;\n\n    ListNode* slow = head;\n    ListNode* fast = head;\n    while (fast != nullptr && fast->next != nullptr) {\n      slow = slow->next;\n      fast = fast->next->next;\n      if (slow == fast) {\n        return true;\n      }\n    }\n    return false;\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 876 - Middle of the Linked List","url":"/LeetCode-Middle-of-the-Linked-List/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/middle-of-the-linked-list/](https://leetcode.com/problems/middle-of-the-linked-list/)\n\nçµ¦ä¸€å€‹ Linked listï¼Œå›å‚³å…¶ä¸­é–“çš„é»ã€‚å¦‚æœæœ‰å…©å€‹ä¸­é–“çš„é»ï¼Œå‰‡å›å‚³å¾Œé¢çš„é‚£å€‹ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: [1,2,3,4,5]\nOutput: Node 3 from this list (Serialization: [3,4,5])\nThe returned node has value 3.  (The judge's serialization of this node is [3,4,5]).\nNote that we returned a ListNode object ans, such that:\nans.val = 3, ans.next.val = 4, ans.next.next.val = 5, and ans.next.next.next = NULL.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: [1,2,3,4,5,6]\nOutput: Node 4 from this list (Serialization: [4,5,6])\nSince the list has two middle nodes with values 3 and 4, we return the second one.\n```\n\n# æƒ³æ³•\n\n## ç°¡å–®çš„æƒ³æ³•\n\nç•¶ç„¶å¯ä»¥å…ˆéæ­·ä¸€éæ‰¾å‡º linked list çš„é•·åº¦ï¼Œå†å¾é ­éæ­·é•·åº¦çš„ä¸€åŠï¼Œå›å‚³æ‰¾åˆ°çš„é»ã€‚\n\n## æ›´å„ªçš„åšæ³•\n\nå¯ä»¥åˆ©ç”¨å…©å€‹æŒ‡æ¨™ï¼Œå…©å€‹æŒ‡æ¨™éƒ½å¾é ­é–‹å§‹ã€‚\n\nä¸€å€‹ä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œç¨±å®ƒç‚º `slow`ï¼›å¦ä¸€å€‹ä¸€æ¬¡èµ°å…©æ­¥ï¼Œç¨±å®ƒç‚º `fast`ã€‚é€™æ¨£ `fast` åˆ°é”çµ‚é»æ™‚ï¼Œ`slow` æ°å¥½èµ°äº†ä¸€åŠçš„é•·åº¦ï¼Œæ‰€ä»¥å›å‚³ `slow` å³å¯ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\næ³¨æ„è¿´åœˆçš„æ¢ä»¶ï¼Œå› ç‚º `fast` æœƒä¸€æ¬¡èµ°å…©æ­¥ï¼Œæ‰€ä»¥æœ‰å…©å€‹åˆ¤æ–·æ¢ä»¶ï¼š `fast != nullptr && fast->next != nullptr`ã€‚\n\nè‡³æ–¼ `slow` å› ç‚ºèµ°çš„æ¯” `fast` é‚„è¦æ…¢ï¼Œå› æ­¤ä¸éœ€è¦åˆ¤æ–·ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/middle-of-the-linked-list/\n * Runtime: 0ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode() : val(0), next(nullptr) {}\n *     ListNode(int x) : val(x), next(nullptr) {}\n *     ListNode(int x, ListNode *next) : val(x), next(next) {}\n * };\n */\nclass Solution {\npublic:\n  ListNode* middleNode(ListNode* head) {\n    ListNode* slow = head;\n    ListNode* fast = head;\n\n    while (fast != nullptr && fast->next != nullptr) {\n      slow = slow->next;\n      fast = fast->next->next;\n    }\n    return (fast == nullptr) ? slow : slow->next;\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"ä½¿ç”¨ operator-sdk åœ¨ Kubernetes ä¸­å¯¦ä½œ CRD ä»¥åŠ Controller","url":"/ä½¿ç”¨-operator-sdk-åœ¨-Kubernetes-ä¸­å¯¦ä½œ-CRD-ä»¥åŠ-Controller/","content":"\n# ç›®æ¨™\n\nä½¿ç”¨ operator-sdk å»ºç«‹ä¸€å€‹ CustomResourceDefinitionï¼Œé¡ä¼¼æ–¼ ReplicaSet çš„åŠŸèƒ½ï¼Œåœ¨é€™è£¡ç­†è€…å°‡ä»–ç¨±ç‚º PodSetã€‚\n\nPodSet å¯ä»¥è‡ªå‹•çš„å‰µå»º Replicas çš„æ•¸é‡å€‹ Podsï¼Œä¸¦ä¸”åœ¨ Pods è¢«æ–°å¢ã€åˆªé™¤ï¼Œæˆ–æ˜¯ PodSet çš„ Spec è¢«ä¿®æ”¹æ™‚è‡ªå‹•å¢æ¸› Pods çš„æ•¸é‡ã€‚\n\nå…ˆé™„ä¸Š PodSet çš„ Specï¼š\n\n```yaml\napiVersion: k8stest.justin0u0.com/v1alpha1\nkind: PodSet\nmetadata:\n  name: podset-sample\nspec:\n  # Add fields here\n  replicas: 2\n```\n\nç¨‹å¼ç¢¼çš„éƒ¨åˆ†åœ¨ï¼š[https://github.com/justin0u0/podset-operator](https://github.com/justin0u0/podset-operator)\n\n<!-- More -->\n\n# Prerequisites\n\nç­†è€…çš„ç’°å¢ƒå¦‚ä¸‹ï¼š\n\n```markdown\n- Minikube v1.16.0\n- Kubernetes v1.18.3\n- operator-sdk v1.3.0\n- golang 1.15.7\n- Docker 20.10.2\n```\n\n## Installation\n\n### operator-sdk\n\n```bash\nbrew install operator-sdk\n\noperator-sdk version: \"v1.3.0\", commit: \"1abf57985b43bf6a59dcd18147b3c574fa57d3f6\", kubernetes version: \"v1.19.4\", go version: \"go1.15.6\", GOOS: \"darwin\", GOARCH: \"amd64\"\n```\n\n### golang\n\n```bash\nbrew install golang-go\n\ngo version\ngo version go1.15.7 darwin/amd64\n```\n\n# Create new project\n\n```bash\nmkdir podset-operator && cd podset-operator\n\noperator-sdk init --domain=justin0u0.com --repo=github.com/justin0u0/podset-operator\n```\n\n# Create new API and Controller\n\næˆ‘å€‘ Create ä¸€å€‹æ–°çš„ Resource å…¶ä¸­ `group=k8stest`ï¼Œ`version=v1alpha1`ï¼Œ`kind=PodSet`ã€‚\n\n```bash\noperator-sdk create api --group=k8stest --version=v1alpha1 --kind=PodSet\nCreate Resource [y/n]\ny\nCreate Controller [y/n]\ny\n```\n\nå®Œæˆå¾Œç›®éŒ„çµæ§‹æ‡‰è©²å¦‚ä¸‹ï¼š\n\n```\n.\nâ”œâ”€â”€ Dockerfile\nâ”œâ”€â”€ Makefile\nâ”œâ”€â”€ PROJECT\nâ”œâ”€â”€ api\nâ”‚Â Â  â””â”€â”€ v1alpha1\nâ”‚Â Â      â”œâ”€â”€ groupversion_info.go\nâ”‚Â Â      â”œâ”€â”€ podset_types.go\nâ”‚Â Â      â””â”€â”€ zz_generated.deepcopy.go\nâ”œâ”€â”€ bin\nâ”‚Â Â  â”œâ”€â”€ controller-gen\nâ”‚Â Â  â”œâ”€â”€ kustomize\nâ”‚Â Â  â””â”€â”€ manager\nâ”œâ”€â”€ config\nâ”‚Â Â  â”œâ”€â”€ certmanager\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ certificate.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ kustomizeconfig.yaml\nâ”‚Â Â  â”œâ”€â”€ crd\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ bases\nâ”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ k8stest.justin0u0.com_podsets.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomizeconfig.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ patches\nâ”‚Â Â  â”‚Â Â      â”œâ”€â”€ cainjection_in_podsets.yaml\nâ”‚Â Â  â”‚Â Â      â””â”€â”€ webhook_in_podsets.yaml\nâ”‚Â Â  â”œâ”€â”€ default\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_auth_proxy_patch.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ manager_config_patch.yaml\nâ”‚Â Â  â”œâ”€â”€ manager\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller_manager_config.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ manager.yaml\nâ”‚Â Â  â”œâ”€â”€ prometheus\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ monitor.yaml\nâ”‚Â Â  â”œâ”€â”€ rbac\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_client_clusterrole.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role_binding.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_service.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role_binding.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ podset_editor_role.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ podset_viewer_role.yaml\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ role.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ role_binding.yaml\nâ”‚Â Â  â”œâ”€â”€ samples\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ k8stest_v1alpha1_podset.yaml\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ kustomization.yaml\nâ”‚Â Â  â””â”€â”€ scorecard\nâ”‚Â Â      â”œâ”€â”€ bases\nâ”‚Â Â      â”‚Â Â  â””â”€â”€ config.yaml\nâ”‚Â Â      â”œâ”€â”€ kustomization.yaml\nâ”‚Â Â      â””â”€â”€ patches\nâ”‚Â Â          â”œâ”€â”€ basic.config.yaml\nâ”‚Â Â          â””â”€â”€ olm.config.yaml\nâ”œâ”€â”€ controllers\nâ”‚Â Â  â”œâ”€â”€ podset_controller.go\nâ”‚Â Â  â””â”€â”€ suite_test.go\nâ”œâ”€â”€ cover.out\nâ”œâ”€â”€ go.mod\nâ”œâ”€â”€ go.sum\nâ”œâ”€â”€ hack\nâ”‚Â Â  â””â”€â”€ boilerplate.go.txt\nâ”œâ”€â”€ main.go\nâ””â”€â”€ testbin\n    â”œâ”€â”€ bin\n    â”‚Â Â  â”œâ”€â”€ etcd\n    â”‚Â Â  â”œâ”€â”€ kube-apiserver\n    â”‚Â Â  â””â”€â”€ kubectl\n    â””â”€â”€ setup-envtest.sh\n```\n\nå…¶ä¸­æ¯”è¼ƒé‡è¦çš„å¹¾å€‹éƒ¨åˆ†æœ‰ `main.go`ï¼Œ`api/podset_types.go` ä»¥åŠ `controllers/podset_controller.go`ã€‚\n\n## Define API\n\nåœ¨ `api/podset_types.go` ä¸­ï¼Œæœƒçœ‹åˆ°é€™æ¨£çš„ä¸€æ®µ Codeï¼š\n\n```go\n// PodSetSpec defines the desired state of PodSet\ntype PodSetSpec struct {\n  // INSERT ADDITIONAL SPEC FIELDS - desired state of cluster\n  // Important: Run \"make\" to regenerate code after modifying this file\n\n  // Foo is an example field of PodSet. Edit PodSet_types.go to remove/update\n  Foo string `json:\"foo,omitempty\"`\n}\n\n// PodSetStatus defines the observed state of PodSet\ntype PodSetStatus struct {\n  // INSERT ADDITIONAL STATUS FIELD - define observed state of cluster\n  // Important: Run \"make\" to regenerate code after modifying this file\n}\n```\n\nå…¶ä¸­ `PodSetSpec` æ˜¯ç”¨ä¾†å®šç¾© User çµ¦å®šçš„ Yaml ä¸­ï¼Œ`Spec` çš„éƒ¨åˆ†è¦é•·æˆä»€éº¼æ¨£å­ã€‚å› æ­¤æˆ‘å€‘å°‡ `Foo` åˆªé™¤åŠ ä¸Š `Replicas`ã€‚[åœ¨ `PodSetSpec` ä¸­ï¼Œå¯ä»¥é€é `+kubebuilder:validation` çš„ Marker ä¾†é©—è­‰æ¬„ä½ã€‚](https://book.kubebuilder.io/reference/generating-crd.html#validation)\n\n```go\ntype PodSetSpec struct {\n  Replicas int32 `json:\"replicas\"`\n}\n```\n\nè€Œ `PodSetStatus` æ˜¯ç”¨ä¾†ç´€éŒ„ Runtime æ™‚çš„ç‹€æ…‹ï¼Œæ¯”å¦‚èªªå¯ä»¥ç´€éŒ„å±¬æ–¼é€™å€‹ PodSet çš„ Pod æœ‰å“ªäº›ï¼Œä»¥åŠçœŸæ­£çš„ `Replicas` çš„å€¼ã€‚å¦å¤–ï¼Œåœ¨ `PodSetStatus` ä¸ŠåŠ ä¸Š `+kubebuilder:subresource:status`ï¼Œæ›´æ–°ä¸»è³‡æºä¸æœƒä¿®æ”¹åˆ° `Status`ï¼ŒåŒæ¨£åœ°ï¼Œæ›´æ–° `Status` ä¸æœƒæ›´æ–°åˆ°ä¸»è³‡æºã€‚\n\n```go\n// +kubebuilder:subresource:status\ntype PodSetStatus struct {\n  Replicas int32    `json:\"replicas\"`\n  PodNames []string `json:\"pod_names\"`\n}\n```\n\nè‹¥ä¸æ¸…æ¥š `Spec` èˆ‡ `Status` çš„é—œä¿‚ï¼Œå¯ä»¥åƒè€ƒ [Spec & Status](https://www.notion.so/Spec-Status-67292b8b3a904121877af8de9361204a)ã€‚\n\nä¿®æ”¹ API å¾Œï¼Œè¦è¨˜å¾—åŸ·è¡Œ `make generate` ä»¥æ›´æ–° generated codeã€‚\n\n## Generate CRD Manifests\n\nå®Œæˆ `PodSetSpec` å¾Œï¼Œoperator-sdk å¯ä»¥æ ¹æ“š `PodSetSpec` ç”¢ç”Ÿå‡ºéƒ¨ç½²ç”¨çš„ yaml fileã€‚\n\nåŸ·è¡Œ `make manifests`ï¼Œæœƒçœ‹åˆ° `config/crd/bases/k8stest.justin0u0.com_podsets.yaml` çš„ç”Ÿæˆï¼Œé€™å€‹ Config æ˜¯çµ¦ Kubernetes ç”¨ä¾†é©—è­‰ä½ å¯«çš„ `PodSet` æ˜¯å¦ç‚ºæ­£ç¢ºçš„ç”¨çš„ã€‚\n\n## Implement the Controller\n\nController è² è²¬è™•ç†æ•´å€‹ CRD çš„é‚è¼¯ï¼Œåœ¨ `controllers/podset_controller.go` ä¸­ï¼Œæœ‰å…©å€‹é‡è¦çš„éƒ¨åˆ†ã€‚\n\n### SetupWithManager\n\n```go\n// SetupWithManager sets up the controller with the Manager.\nfunc (r *PodSetReconciler) SetupWithManager(mgr ctrl.Manager) error {\n  return ctrl.NewControllerManagedBy(mgr).\n    For(&k8stestv1alpha1.PodSet{}).\n    Complete(r)\n}\n```\n\nåœ¨ `SetupWithManager` ä¸­ï¼Œæœƒçœ‹åˆ°é€™æ¨£ä¸€æ®µç¨‹å¼ç¢¼ï¼Œå…¶ä¸­ `For(&k8stestv1alpha1.PodSet)` ä»£è¡¨æœ€ä¸»è¦è¦è§€å¯Ÿçš„ Resource æ˜¯ `PodSet` é€™å€‹ Resourceï¼Œæ‰€è¬‚è§€å¯Ÿä¹Ÿå°±æ˜¯åªç•¶æœ‰ä»»ä½• `PodSet` çš„ Create, Update, Delete äº‹ä»¶ï¼Œéƒ½æœƒé€å‡ºä¸€å€‹ **Reconcile** Requestï¼Œè€Œ **Reconcile** æ­£æ˜¯ç­‰ä¸€ä¸‹æœƒå¯¦ä½œçš„ Controller Logicã€‚\n\nä¸éä¸åªæ˜¯åœ¨ `PodSet` Create, Update, Delete æ™‚éœ€è¦ Reconcileï¼Œåœ¨æˆ‘å€‘æƒ³è¦åšçš„ `PodSet` ä¾‹å­ä¸­ï¼Œç•¶ç”± `PodSet` ç®¡ç†çš„ `Pod` æœ‰ Create, Update, Delete çš„äº‹ä»¶æ™‚ï¼Œä¹Ÿæ‡‰è©²è¦åšå‡ºå°æ‡‰çš„è™•ç†ã€‚\n\nå› æ­¤å¯ä»¥å°‡ `SetupWithManager` å‡½æ•¸æ”¹æˆä»¥ä¸‹ï¼š\n\n```go\n// SetupWithManager sets up the controller with the Manager.\nfunc (r *PodSetReconciler) SetupWithManager(mgr ctrl.Manager) error {\n  return ctrl.NewControllerManagedBy(mgr).\n    For(&k8stestv1alpha1.PodSet{}).\n    Owns(&corev1.Pod{}).\n    Complete(r)\n}\n```\n\nå…¶ä¸­çš„ `Owns(&corev1.Pod{})` ä»£è¡¨ `PodSet` æœƒ Own é¡åˆ¥ç‚º `corev1.Pod` çš„ resourceï¼Œä¸¦ä¸”ï¼Œåœ¨ `corev1.Pod` é€™ç¨® resource è¢« Create, Update, Delete æ™‚ï¼Œæœƒé€ä¸€å€‹ Reconcile Request çµ¦ä»–çš„ Ownerï¼Œä¹Ÿå°±æ˜¯ `PodSet`ã€‚\n\n### Reconcile\n\n```go\n// +kubebuilder:rbac:groups=k8stest.justin0u0.com,resources=podsets,verbs=get;list;watch;create;update;patch;delete\n// +kubebuilder:rbac:groups=k8stest.justin0u0.com,resources=podsets/status,verbs=get;update;patch\n// +kubebuilder:rbac:groups=k8stest.justin0u0.com,resources=podsets/finalizers,verbs=update\n\nfunc (r *PodSetReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {\n  _ = r.Log.WithValues(\"podset\", req.NamespacedName)\n\n  // your logic here\n\n  return ctrl.Result{}, nil\n}\n```\n\né¦–å…ˆï¼ŒReconcile çš„å›å‚³å€¼æœ‰ `ctrl.Result` èˆ‡ `error` å…©å€‹ã€‚ç•¶ `ctrl.Result` å›å‚³ `{Requeue: true}` æˆ–æ˜¯ `error != nil` çš„è©±ï¼ŒController æœƒ requeue reconcile çš„è«‹æ±‚ä»¥é‡æ–°åŸ·è¡Œä¸€é Reconcileã€‚\n\nå†ä¾†ï¼Œçœ‹åˆ° `Reconcile` ä¸Šæ–¹çš„è¨»è§£ï¼Œä»£è¡¨ Controller æ‰€æ“æœ‰çš„ RBAC æ¬Šé™ã€‚å¯ä»¥çœ‹åˆ°é è¨­çš„ RBAC æ¬Šé™åŒ…å«å° `PodSet` è³‡æºçš„ get, list, watch, create...ã€‚åœ¨ `PodSet` ä¸­ï¼Œéœ€è¦æ¬Šé™ä¾†æ–°å¢ã€åˆªé™¤ã€å–å¾— Podsï¼Œè§€å¯Ÿ Pod çš„åˆªæ¸›...æ¬Šé™ï¼Œå› æ­¤åŠ ä¸Š Pod çš„æ¬Šé™ï¼š\n\n```go\n// +kubebuilder:rbac:groups=core,resources=pods,verbs=get;list;create;delete;watch\n```\n\næ¥å€‹é–‹å§‹å¯¦è¸ `PodSet` é‚è¼¯ã€‚é¦–å…ˆï¼Œæ‡‰è©²å…ˆæ‰¾åˆ°ç™¼èµ·è«‹æ±‚çš„ `PodSet`ï¼š\n\n```go\n// Fetch podset instance\npodSet := &k8stestv1alpha1.PodSet{}\nif err := r.Get(ctx, req.NamespacedName, podSet); err != nil {\n  if errors.IsNotFound(err) {\n    // Request object not found, could have been deleted after reconcile request.\n    // Owned objects are automatically garbage collected. For additional cleanup logic use finalizers.\n    // Return and don't requeue\n    log.Info(\"PodSet resource not found. Ingoring since object must be deleted.\")\n    return ctrl.Result{}, nil\n  }\n  // Error reading object - requeue the requst\n  log.Error(err, \"Failed to get PodSet resource.\")\n  return ctrl.Result{}, err\n}\n```\n\n`r.Get` å…¶å¯¦ä¹Ÿç­‰æ–¼ `r.client.Get`ï¼Œ`r` æ˜¯ä¸€å€‹ `PodSetReconciler`ï¼Œçœ‹ä¸€ä¸‹ `PodSetReconciler` çš„å®šç¾©ï¼š\n\n```go\n// PodSetReconciler reconciles a PodSet object\ntype PodSetReconciler struct {\n  client.Client\n  Log    logr.Logger\n  Scheme *runtime.Scheme\n}\n```\n\nå¯ä»¥çœ‹åˆ°åŒ…å«ä¸€å€‹ `client.Client`ï¼Œé€™æ˜¯ Golang struct ä¸­çš„ [promoted field](https://www.notion.so/Golang-7ab921d39bde41c998e39ece6c88ef40)ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨ `client.Client` å…§çš„ methodï¼Œä¾‹å¦‚ `r.Get`, `r.List`...ç­‰ç­‰ã€‚\n\nå†ä¾†ï¼Œå¯ä»¥å…ˆé æƒ³ä¸€ä¸‹ç”Ÿæˆç”± `PodSet` ç®¡ç†ã€ç”Ÿæˆå‡ºä¾†çš„ Pod è¦æœ‰æ€éº¼æ¨£çš„ Specï¼Œä»¥æ–¹ä¾¿ç®¡ç†ï¼Œå› æ­¤ç­†è€…å…ˆå¯¦ä½œ `podForPodSet` å‡½æ•¸ï¼Œçµ¦å®šä¸€å€‹ `PodSet`ï¼Œ`podForPodSet` å‡½æ•¸å›å‚³ä¸€å€‹ Podã€‚\n\n```go\nfunc (r *PodSetReconciler) podForPodSet(podSet *k8stestv1alpha1.PodSet) *corev1.Pod {\n  labels := map[string]string{\n    \"app\":       \"podset\",\n    \"podset_cr\": podSet.Name,\n  }\n\n  pod := &corev1.Pod{\n    ObjectMeta: metav1.ObjectMeta{\n      Name:      podSet.Name + \"-\" + strconv.FormatInt(time.Now().UnixNano(), 36),\n      Namespace: podSet.Namespace,\n      Labels:    labels,\n    },\n    Spec: corev1.PodSpec{\n      Containers: []corev1.Container{\n        {\n          Name:    \"busybox\",\n          Image:   \"busybox\",\n          Command: []string{\"sleep\", \"3600\"},\n        },\n      },\n    },\n  }\n\n  ctrl.SetControllerReference(podSet, pod, r.Scheme)\n  return pod\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œç”¢ç”Ÿå‡ºä¾†çš„ Pod æœ‰ labels `{\"app\": \"podset\", \"podset_cr\": podSet.Name}` é€™æ¨£çš„æ¨™ç±¤ï¼Œé€™å€‹æ¨™ç±¤å¯ä»¥å¹«åŠ©ä¸åŒçš„ `PodSet` å€åˆ†å±¬æ–¼è‡ªå·±æ‰€å‰µå»ºï¼ˆç®¡ç†ï¼‰çš„ Pods æœ‰å“ªäº›ã€‚\n\næœ€å¾Œä¸€è¡Œçš„ `ctrl.SetControllerReference` å°‡ `pod` çš„ Owner ç¶å®šæˆå‚³å…¥çš„ `podSet`ã€‚\n\næ¥è‘—ï¼Œè¿”å› `Reconcile` å‡½æ•¸çš„éƒ¨åˆ†ï¼Œå…ˆå–å¾—ç¾åœ¨ `PodSet` æ‰€æ“æœ‰çš„ï¼Œä¸¦ä¸”æ­£åœ¨é‹è¡Œçš„ Podsï¼š\n\n```go\n// Get all pods with label app=podSet.Name\npodList := &corev1.PodList{}\nlabelSet := labels.Set{\n  \"app\":       \"podset\",\n  \"podset_cr\": podSet.Name, // podSet.ObjectMeta.Name\n}\nif err := r.List(ctx, podList, &client.ListOptions{\n  Namespace:     req.Namespace, // req.NamespacedName.Namespace\n  LabelSelector: labels.SelectorFromSet(labelSet),\n}); err != nil {\n  log.Error(err, \"Failed to list pods.\")\n  return ctrl.Result{}, err\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨ `labelSet := labels.Set{\"app\": \"podset\", \"podset_cr\": podSet.name}`ï¼Œå†ä½¿ç”¨ `r.List` çš„ `opts` `LabelSelector`ï¼Œå¯ä»¥å¹«åŠ©æˆ‘å€‘ç¯©é¸å‡ºå±¬æ–¼é€™å€‹ `podSet` æ‰€æ“æœ‰çš„ podsã€‚\n\nå–å¾—çš„ `podList` ä¸­ï¼Œå…¶ä¸­æœ‰ä¸€äº› Pod å¯èƒ½æ­£åœ¨è¢« terminatedï¼ˆå› ç‚º k8s ä¸­ï¼Œè¢« elegant deleted by user çš„ Pod åªæœƒå…ˆå°‡ `DeletionTimestamp` è¨­ä¸Šæ•¸å€¼è€Œå·²ï¼‰ï¼Œå› æ­¤ï¼Œåˆ©ç”¨ Pod çš„ `Phase` ä»¥åŠ `ObjectMeta`ï¼Œç¯©é¸å‡ºçœŸæ­£é‚„åœ¨é‹è¡Œçš„ Pod æœ‰å“ªäº›ã€‚\n\n```go\n// Get all running pods\nrunningPods := []corev1.Pod{}\nrunningPodNames := []string{}\nfor _, pod := range podList.Items {\n  if pod.ObjectMeta.DeletionTimestamp == nil && (pod.Status.Phase == corev1.PodPending || pod.Status.Phase == corev1.PodRunning) {\n    runningPods = append(runningPods, pod)\n    runningPodNames = append(runningPodNames, pod.Name)\n  }\n}\n```\n\nå¦‚æœä¸åš `pod.ObjectMeta.DeletionTimstamp` çš„æª¢æŸ¥ï¼Œé›–ç„¶ Pod åœ¨è¢«åˆªé™¤çš„é‚£å€‹å‰é‚£å°±æœƒå‘¼å«ä¸€æ¬¡ `Reconcile`ï¼Œä½†æ˜¯æˆ‘å€‘æœƒä»¥ç‚ºé€™å€‹ Pod é‚„åœ¨é‹è¡Œä¸­ï¼Œå› çˆ²å…¶ `Status.Phase` é‚„æ˜¯ `Running`ã€‚\n\nå–å¾— `runningPods` ä»¥åŠ `runningPodNames` å¾Œï¼Œé¦–å…ˆæ›´æ–° `PodSet` çš„ Statusï¼š\n\n```go\n// Update status if needed\nif newStatus := (k8stestv1alpha1.PodSetStatus{\n  Replicas: int32(len(runningPodNames)),\n  PodNames: runningPodNames,\n}); !reflect.DeepEqual(podSet.Status, newStatus) {\n  podSet.Status = newStatus\n  if err := r.Status().Update(ctx, podSet); err != nil {\n    log.Error(err, \"Failed to update PodSet status\")\n    return ctrl.Result{}, err\n  }\n}\n```\n\næ›´æ–° `podSet.Status` å¯ä»¥è®“æˆ‘å€‘åœ¨å…¶ yaml ä¸­çœ‹åˆ° `PodSet` ç›®å‰çš„çœŸå¯¦ç‹€æ…‹ã€‚\n\næ³¨æ„é€™è£¡çš„ `r.Status().Update` ä¸¦ä¸ç­‰æ–¼ `r.Update`ï¼Œ`r.Update` æ›´æ–°çš„æ˜¯æŸå€‹ resource çš„ specï¼Œè€Œ `r.Status().Update` æ˜¯é€é `StatusWriter` çš„ `Update` ä¾†æ›´æ–° resource çš„ statusã€‚\n\næœ€å¾Œï¼Œæ ¹æ“š `runningPods` çš„æ•¸é‡ï¼Œæ±ºå®šè¦å¢åŠ æˆ–æ˜¯åˆªé™¤ Podsã€‚\n\nè‹¥ `runningPods` æ•¸é‡éå¤šï¼Œåˆªé™¤ä¸€å€‹ Podï¼š\n\n```go\n// Scale down pods\nif int32(len(runningPodNames)) > podSet.Spec.Replicas {\n  // Delete a pod once a time\n  log.Info(\"Deleting a Pod in the PodSet\", \"PodSet.Name\", podSet.Name)\n  pod := runningPods[0]\n  if err := r.Delete(ctx, &pod); err != nil {\n    log.Error(err, \"Failed to delete pod\")\n    return ctrl.Result{}, err\n  }\n  return ctrl.Result{Requeue: true}, nil\n}\n```\n\nåˆªé™¤ Pods çš„æ–¹æ³•æ¡ç”¨ä¸€æ¬¡åˆªé™¤ä¸€å€‹ï¼Œä¸¦ä¸”å›å‚³ `ctrl.Result{Requeue: true}`ï¼Œå› æ­¤ä¸‹ä¸€æ¬¡çš„ Reconcile å°±æœƒå†åˆªé™¤ä¸€å€‹ podï¼Œå¦‚æœéœ€è¦çš„è©±ã€‚\n\nè‹¥ `runningPods` æ•¸é‡ä¸è¶³ï¼Œå¢åŠ ä¸€å€‹ Podï¼š\n\n```go\n// Scale up pods\nif int32(len(runningPodNames)) < podSet.Spec.Replicas {\n  // Create a pod once a time\n  log.Info(\"Creating a Pod in the PodSet\", \"PodSet.Name\", podSet.Name)\n  pod := r.podForPodSet(podSet)\n\n  if err := r.Create(ctx, pod); err != nil {\n    log.Error(err, \"Failed to create pod\")\n    return ctrl.Result{}, err\n  }\n  return ctrl.Result{Requeue: true}, nil\n}\n```\n\nä½¿ç”¨ `podForPodSet` ä»¥åŠ `r.Create` å‡½æ•¸ä¾†å‰µå»ºä¸€å€‹æ–°çš„ Podã€‚\n\næœ€å¾Œå®Œæˆçš„ç¨‹å¼ç¢¼å¯ä»¥åœ¨æœ€ä¸Šé¢é™„ä¸Šçš„ [Github é€£çµ](https://github.com/justin0u0/podset-operator)æŸ¥çœ‹ã€‚\n\n# Build and run the operator\n\nå®Œæˆç¨‹å¼ç¢¼å¾Œï¼Œé¦–å…ˆï¼š\n\n```bash\nmake install\n```\n\nå°‡ CRD éƒ¨ç½²åˆ° K8s cluster ä¸­ï¼Œå› æ­¤è¦ç¢ºèª k8s é€™æ™‚å·²ç¶“é–‹å•Ÿã€‚ï¼ˆå¦‚æœæ˜¯ä½¿ç”¨ Minikube çš„è©±ï¼Œç”¨ `minikube status` ç¢ºèªï¼‰ã€‚\n\n```bash\nkubectl get crds\n\n...\npodsets.k8stest.justin0u0.com         2021-02-01T09:14:40Z\n...\n```\n\né€™æ™‚æ‡‰è©²å¯ä»¥çœ‹åˆ° CRD å·²ç¶“è¢«éƒ¨ç½²åˆ° k8s cluster ä¸­ã€‚\n\næ¸¬è©¦ Controller æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…©ç¨®æ–¹æ³•ï¼š\n\n## Run controller locally outside k8s cluster\n\n```bash\nmake run ENABLE_WEBHOOKS=false\n```\n\nå¯ä»¥çœ‹åˆ° Controller å·²ç¶“ Run åœ¨ localã€‚\n\n## Run controller as Deployment inside k8s cluster\n\nè¦å°‡ controller è®Šæˆ Deployment è³‡æºè·‘åœ¨ k8s å…§ï¼Œéœ€è¦å°‡ operator æ‰“åŒ…æˆ Imageã€‚\n\nè‹¥æ˜¯ä½¿ç”¨ DockerHub çš„è©±ï¼Œé¦–å…ˆç¢ºèªå·²ç¶“ Login åˆ° Docker å¸³è™Ÿä¸­ï¼š\n\n```bash\ndocker login\n...\nLogin Succeeded\n```\n\næ¥è‘—æ‰“åŒ… Imageï¼š\n\n```bash\nexport USERNAME=<your-docker-username>\nmake docker-build IMG=$USERNAME/podset-operator:v0.0.1\n```\n\nå®Œæˆå¾Œå¯ä»¥çœ‹åˆ° image å·²ç¶“è¢«å‰µå»ºä¸¦ä¸”æ‰“ä¸Š tagï¼š\n\n```bash\ndocker images | grep \"podset-operator\"\n\njustin0u0/podset-operator                    v0.0.1           8daebb3f17d9   26 hours ago     50.8MB\n```\n\næ¥è‘—ï¼Œå°‡ Image push åˆ° container registry ä¸­ï¼š\n\n```bash\nmake docker-push IMG=$USERNAME/podset-operator:v0.0.1\n```\n\næœ€å¾Œ deploy åˆ° k8s cluster ä¸­ï¼š\n\n```bash\nmake deploy IMG=$USERNAME/podset-operator:v0.0.1\n```\n\n```bash\nkubectl get all -n podset-operator-system\n\nNAME                                                      READY   STATUS    RESTARTS   AGE\npod/podset-operator-controller-manager-6b4f8577db-2bhs8   2/2     Running   0          33m\n\nNAME                                                         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nservice/podset-operator-controller-manager-metrics-service   ClusterIP   10.105.209.249   <none>        8443/TCP   33m\n\nNAME                                                 READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/podset-operator-controller-manager   1/1     1            1           33m\n\nNAME                                                            DESIRED   CURRENT   READY   AGE\nreplicaset.apps/podset-operator-controller-manager-6b4f8577db   1         1         1       33m\n```\n\n# Test Controller\n\né¦–å…ˆå°‡ `config/samples/k8stest_v1alpha1_podset.yaml` æ”¹æˆä»¥ä¸‹ï¼š\n\n```yaml\napiVersion: k8stest.justin0u0.com/v1alpha1\nkind: PodSet\nmetadata:\n  name: podset-sample\nspec:\n  # Add fields here\n  replicas: 2\n```\n\nä¸¦å°‡ `PodSet` resource éƒ¨ç½²åˆ° k8s clusterï¼š\n\n```bash\nkubectl -k ./config/samples/.\n# or\nkubectl apply -f ./config/samples/k8stest_v1alpha1_podset.yaml\n```\n\nå®Œæˆå¾Œï¼Œä¸€å€‹ `name=podset-sample` çš„ `PodSet` è³‡æºæœƒè¢«éƒ¨ç½²åˆ° `default` çš„ namespace ä¸­ï¼Œä¸¦ä¸”æ‡‰è©²å¯ä»¥çœ‹åˆ°å…©å€‹ Pod å·²ç¶“åœ¨ `default` namespace ä¸­è¢«å‰µå»ºä¸­ï¼š\n\n```bash\nNAME                         READY   STATUS    RESTARTS   AGE\npodset-sample-c8y38qggtxu0   1/1     Running   0          46m\npodset-sample-c8y3emmy8qzo   1/1     Running   0          38m\n```\n\nå¯ä»¥å˜—è©¦å°‡å…¶ä¸­ä¸€å€‹ pod åˆªé™¤ã€å°‡ `PodSet` Spec çš„ `replicas` ä¿®æ”¹ä¸¦ Apply...ï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ° `podset-sample` çš„ pods ä¹Ÿæœƒå‹•æ…‹çš„å¢æ¸›ã€‚\n\næˆ–æ˜¯å˜—è©¦å°‡ `PodSet` åˆªé™¤ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ pods ä¹Ÿæœƒè·Ÿè‘—è¢«åˆªé™¤ã€‚\n\n# Cleanup\n\nè‹¥æ˜¯å°‡ controller éƒ¨ç½²åœ¨ k8s-cluster ä¸­ï¼Œå¯ä»¥åŸ·è¡Œï¼š\n\n```bash\nmake undeploy\n```\n\nä¾†åˆªé™¤æ‰€æœ‰éƒ¨ç½²çš„è³‡æºã€‚\n\n# References\n\n[https://sdk.operatorframework.io/docs/building-operators/golang/tutorial/](https://sdk.operatorframework.io/docs/building-operators/golang/tutorial/)\n\n[https://blog.csdn.net/yjk13703623757/article/details/103733253?utm_medium=distribute.pc_relevant.none-task-blog-searchFromBaidu-6.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-searchFromBaidu-6.control](https://blog.csdn.net/yjk13703623757/article/details/103733253?utm_medium=distribute.pc_relevant.none-task-blog-searchFromBaidu-6.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-searchFromBaidu-6.control)\n\n[https://github.com/operator-framework/operator-sdk/blob/v1.2.0/testdata/go/memcached-operator/controllers/memcached_controller.go](https://github.com/operator-framework/operator-sdk/blob/v1.2.0/testdata/go/memcached-operator/controllers/memcached_controller.go)\n\n[https://pkg.go.dev/github.com/kubernetes-sigs/controller-runtime](https://pkg.go.dev/github.com/kubernetes-sigs/controller-runtime)\n","tags":["Golang","Kubernetes","operator-sdk"],"categories":["Kubernetes"]},{"title":"LeetCode 115 - Distinct Subsequence","url":"/LeetCode-Distinct-Subsequence/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/distinct-subsequences/](https://leetcode.com/problems/distinct-subsequences/)\n\nçµ¦å®šå…©å­—ä¸² `s`, `t`ï¼Œæ±‚å‡º `s` å­—ä¸²ä¸­æœ‰å¤šå°‘çš„å­åºåˆ—ï¼ˆsubsequenceï¼‰ç­‰æ–¼ `t`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: s = \"rabbbit\", t = \"rabbit\"\nOutput: 3\nExplanation:\nAs shown below, there are 3 ways you can generate \"rabbit\" from S.\nrabbbit\nrabbbit\nrabbbit\n```\n\n## Example 2:\n\n```\nInput: s = \"babgbag\", t = \"bag\"\nOutput: 5\nExplanation:\nAs shown below, there are 5 ways you can generate \"bag\" from S.\nbabgbag\nbabgbag\nbabgbag\nbabgbag\nbabgbag\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå‡è¨­å­—ä¸² `s`, `t` å¾ç´¢å¼• 1 é–‹å§‹ç·¨è™Ÿã€‚\n\nå®šç¾© `dp(i, j)` ä»£è¡¨ `s[1 ~ j]` å¯ä»¥ç”¢ç”Ÿå¹¾å€‹å­åºåˆ—ç­‰æ–¼ `t[1 ~ i]`ã€‚\n\næ¥è‘—è€ƒæ…® `dp(i, j)` çš„æ•¸é‡è¦æ€éº¼æ±‚å¾—ï¼Œåˆ†ç‚ºä»¥ä¸‹å…©ç¨®æƒ…å½¢ï¼š\n1. `s[j] â‰  t[i]`ï¼š\n   \n    å› ç‚º `s[j]` ä¸èƒ½åŒ¹é…åˆ° `t[i]`ï¼Œæ‰€ä»¥ `s[1 ~ j - 1]` å¯ä»¥åŒ¹é…åˆ° `t[1 ~ j]` ä¹‹æ•¸é‡ç­‰æ–¼ `s[1 ~ j]` å¯ä»¥åŒ¹é…åˆ° `t[1 ~ j]` çš„æ•¸é‡ã€‚\n    \n    Example: `s = ababc` ä¸­æœ‰ 4 å€‹å­åºåˆ—ç­‰æ–¼ `t = ab`ï¼Œå› ç‚º `s` çš„æœ€å¾Œä¸€å€‹å­—å…ƒ `c` ä¸åŒ¹é…åˆ° `t` çš„æœ€å¾Œä¸€å€‹å­—å…ƒ `b`ï¼Œå› æ­¤ç§»é™¤ `c` å°èƒ½åŒ¹é…çš„æ•¸é‡æ˜¯æ²’æœ‰å½±éŸ¿çš„ï¼Œä¹Ÿå°±æ˜¯ `s = abab` ä¹Ÿæœ‰ 4 å€‹å­åºåˆ—ç­‰æ–¼ `t = ab`ã€‚\n\n    ç¸½çµä¾†èªªï¼š\n      $$dp(i,\\ j)=dp(i,\\ j-1)\\quad if\\ s[j]\\ne t[i]$$\n\n2. `s[j] = t[i]`ï¼š\n\n    `s[1 ~ j]` ä¸­çš„å­åºåˆ—ï¼Œå¯ä»¥åˆ†ç‚º**æœ‰ç”¨åˆ° `s[j]` çš„å­åºåˆ—**èˆ‡**æ²’æœ‰ç”¨åˆ° `s[j]` çš„å­åºåˆ—**ã€‚\n    \n    1. æ²’æœ‰ç”¨åˆ° `s[j]` çš„å­åºåˆ—ï¼š\n      **æ²’æœ‰ç”¨åˆ° `s[j]` çš„å­åºåˆ—å…¶å¯¦å°±æ˜¯ `s[1 ~ j - 1]` çš„å­åºåˆ—**ï¼Œå…¶ä¸­ç­‰æ–¼ `t[1 ~ i]` çš„æ•¸é‡ä¹Ÿå°±æ˜¯ **`dp(i, j - 1)`**ã€‚\n    2. æœ‰ç”¨åˆ° `s[j]` çš„å­åºåˆ—ï¼š\n      è‹¥æœ‰ç”¨åˆ° `s[j]` ä¸”å­åºåˆ—ç­‰æ–¼ `t[1 ~ i]`ï¼Œ**ä»£è¡¨ `s[j]` æ°å¥½åŒ¹é…åˆ° `t[i]`**ï¼Œå› æ­¤ `s[1 ~ j]` ä¸­ç­‰æ–¼ `t[1 ~ i]` çš„æ•¸é‡**ç­‰æ–¼ `s[1 ~ j - 1]` ä¸­çš„å­åºåˆ—ç­‰æ–¼ `t[1 ~ i - 1]` çš„æ•¸é‡**ï¼Œä¹Ÿå°±æ˜¯ **`dp(i - 1, j - 1)`**ã€‚\n\n    ç¸½çµä¾†èªªï¼š\n      $$dp(i,\\ j)=dp(i,\\ j-1)+dp(i-1,\\ j-1)\\quad if\\ s[j]=t[i]$$\n\n# å¯¦ä½œç´°ç¯€\n\næ³¨æ„å¯¦éš›æƒ…æ³ä¸­ï¼Œ`s`, `t` å…©å­—ä¸²éƒ½æ˜¯å¾ç´¢å¼•å€¼ 0 é–‹å§‹ç·¨è™Ÿï¼Œå› æ­¤åœ¨ä½¿ç”¨ `s[j]`, `t[i]` çš„æ™‚å€™è¦åˆ†åˆ¥æ”¹ç‚º `s[j - 1]` èˆ‡ `t[i - 1]`ã€‚\n\nå¦å¤–ï¼Œé‚Šç•Œå€¼çš„éƒ¨åˆ†ï¼Œæ‰€æœ‰ `dp(0, j) = 1`ï¼Œå› ç‚ºä»»ä½•é•·åº¦çš„ `s` å­—ä¸²éƒ½æœ‰ä¸€ç¨®å­åºåˆ—ï¼ˆç©ºé›†åˆï¼‰å¯ä»¥ç­‰æ–¼ç©ºå­—ä¸²ã€‚\n\nå¦å¤–ï¼Œå¯ä»¥ç™¼ç¾ç•¶ `i > j` æ™‚ï¼Œ`dp(i, j)` ä¸€å®šç­‰æ–¼ 0ï¼Œå› ç‚º `s` é•·åº¦æ¯” `t` çŸ­çš„è©±æ˜¯ä¸å¯èƒ½æœ‰å­åºåˆ—ç­‰æ–¼ `t` çš„ã€‚\n\næœ€å¾Œï¼Œé›–ç„¶ç­”æ¡ˆåœ¨ `int` ç¯„åœå…§ï¼Œä½†æ˜¯é‹ç®—éç¨‹æ˜¯æœ‰å¯èƒ½è¶…å‡ºçš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ `long long` çš„ dp é™£åˆ—ï¼Œæœ€å¾Œå›å‚³å†æ›å› `int` å³å¯ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/distinct-subsequences/\n * Runtime: 0ms\n */\n\nclass Solution {\npublic:\n  int numDistinct(string s, string t) {\n    int m = s.length();\n    int n = t.length();\n    vector<vector<long long>> dp(n + 1, vector<long long>(m + 1, 0));\n\n    for (int i = 0; i <= m; i++)\n      dp[0][i] = 1;\n    for (int i = 1; i <= n; i++) {\n      for (int j = i; j <= m; j++) {\n        if (s[j - 1] == t[i - 1])\n          dp[i][j] = dp[i - 1][j - 1] + dp[i][j - 1];\n        else\n          dp[i][j] = dp[i][j - 1];\n      }\n    }\n    return (int)dp[n][m];\n  }\n};\n\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"MacOS ä½¿ç”¨ Homebrew ç®¡ç†å¤šå€‹ Golang ç‰ˆæœ¬","url":"/MacOS-ä½¿ç”¨-Homebrew-ç®¡ç†å¤šå€‹-Golang-ç‰ˆæœ¬/","content":"\nåœ¨ç¶²è·¯ä¸Šå¾ˆå¤šæ–‡ç« ä½¿ç”¨ `brew switch` ä¾†åˆ‡æ› Golang çš„ versionï¼Œä½†æ˜¯åœ¨ brew v2.6.0 å¾Œ `brew switch` æŒ‡ä»¤å·²ç¶“è¢«å»¢æ£„ï¼ˆ[https://brew.sh/2020/12/01/homebrew-2.6.0/](https://brew.sh/2020/12/01/homebrew-2.6.0/)ï¼‰ã€‚\n\n<!-- More -->\n\né¦–å…ˆï¼Œå…ˆç¢ºèªæˆ‘å€‘çš„ golang æ˜¯ç”± homebrew ç®¡ç†ã€‚\n\n```bash\nwhich go\n/usr/local/bin/go\n\nls -l /usr/local/bin/go\nlrwxr-xr-x  1 justin  admin  28 Jan 30 16:37 /usr/local/bin/go -> ../Cellar/go/1.15.7_1/bin/go\n```\n\nå¦‚æœ `which go` çœ‹åˆ°çš„è·¯å¾‘æ˜¯ `/usr/local/go` çš„è©±ï¼Œé‚£éº¼ç•¶åˆçš„ golang æ‡‰è©²æ˜¯é€éä¸‹è¼‰å®‰è£è€Œä¸æ˜¯ç”± Homebrew ç®¡ç†çš„ï¼Œå¯ä»¥ç›´æ¥ `rm -rf /usr/local/go` åˆªé™¤ã€‚\n\næ¥è‘—ç”¨ Homebrew å®‰è£æœ€æ–°ç‰ˆæœ¬çš„ golangã€‚\n\n```bash\nbrew install go\n\nbrew info go\ngo: stable 1.15.7 (bottled), HEAD\n....\n```\n\nå‡è¨­æˆ‘å€‘è¦å®‰è£ v1.14 ç‰ˆæœ¬çš„ golangï¼Œå‰‡ä¸€æ¨£ç”¨ homebrew ä¾†å®‰è£ï¼ŒæŒ‡ä»¤ç‚º `brew install go@v?`ã€‚\n\n```bash\nbrew install go@v1.14\n\nls /usr/local/Cellar | grep \"go\"\ngo\ngo@1.14\n```\n\nå¯ä»¥çœ‹åˆ°å…©å€‹ç‰ˆæœ¬çš„ go å·²ç¶“å®‰è£å®Œæˆã€‚\n\nçœ‹ä¸‹ç¾åœ¨çš„ golang ç‰ˆæœ¬ï¼š\n\n```bash\ngo version\ngo version go1.15.7 darwin/amd64\n```\n\né¡¯ç¤ºç‚º `go1.15.7`ï¼Œè‹¥è¦åˆ‡æ›æˆ `v1.14` çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š\n\n```bash\nbrew link --force --overwrite go@1.14\n\ngo version\ngo version go1.14.14 darwin/amd64\n\nwhich go\n/usr/local/bin/go\n\nls -l /usr/local/bin/go\nlrwxr-xr-x  1 justin  admin  32 Jan 30 16:51 /usr/local/bin/go -> ../Cellar/go@1.14/1.14.14/bin/go\n```\n\nå¯ä»¥çœ‹åˆ° `go` æŒ‡ä»¤çš„ symbolic link å·²ç¶“è¢«åˆ‡æ›æˆ `go@1.14` çš„ç‰ˆæœ¬ã€‚\n\nè‹¥è¦åˆ‡æ›å›æœ€æ–°ç‰ˆæœ¬ï¼Œå‰‡ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š\n\n```bash\nbrew unlink go && brew link go\n\ngo version\ngo version go1.15.7 darwin/amd64\n\nls -l /usr/local/bin/go\nlrwxr-xr-x  1 justin  admin  28 Jan 30 16:53 /usr/local/bin/go -> ../Cellar/go/1.15.7_1/bin/go\n```\n\nå¯ä»¥çœ‹åˆ° `go` æŒ‡ä»¤çš„ symbolic link å·²ç¶“è¢«åˆ‡æ›å›æœ€æ–°ç‰ˆæœ¬ã€‚\n","tags":["Golang","Homebrew","MacOS"],"categories":["Golang"]},{"title":"LeetCode 99 - Recover Binary Search Tree","url":"/LeetCode-Recover-Binary-Search-Tree/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/recover-binary-search-tree/](https://leetcode.com/problems/recover-binary-search-tree/)\n\nçµ¦å®šä¸€å€‹äºŒå…ƒæœå°‹æ¨¹ï¼Œæ°å¥½æœ‰å…©å€‹é»è¢«äº¤æ›äº†ã€‚\n\nå¾©åŸå‡ºåŸæœ¬çš„äºŒå…ƒæœå°‹æ¨¹ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n![](https://assets.leetcode.com/uploads/2020/10/28/recover1.jpg)\n\n```\nInput: root = [1,3,null,null,2]\nOutput: [3,1,null,null,2]\nExplanation: 3 cannot be a left child of 1 because 3 > 1. Swapping 1 and 3 makes the BST valid.\n```\n\n<!-- More -->\n\n## Example 2:\n\n![](https://assets.leetcode.com/uploads/2020/10/28/recover2.jpg)\n\n```\nInput: root = [3,1,4,null,null,2]\nOutput: [2,1,4,null,null,3]\nExplanation: 2 cannot be in the right subtree of 3 because 2 < 3. Swapping 2 and 3 makes the BST valid.\n```\n\n# æƒ³æ³•\n\näºŒå…ƒæœå°‹æ¨¹çš„å…¶ä¸­ä¸€å€‹é‡è¦çš„æ€§è³ªå°±æ˜¯å…¶ä¸­åºèµ°è¨ªï¼ˆInorder Traversalï¼‰æ°å¥½å°±æ˜¯æ’åºå¥½çš„åºåˆ—ã€‚\n\nçŸ¥é“é€™å€‹æ€§è³ªå¾Œï¼Œå°é€™å€‹éŒ¯èª¤çš„æœå°‹æ¨¹ä½¿ç”¨ä¸­åºèµ°è¨ªï¼Œå¯ä»¥å¾—åˆ°ä¸€å€‹åºåˆ—ï¼Œå› ç‚ºå…©å€‹é»æ°å¥½è¢«äº¤æ›ï¼Œå› æ­¤å¾—åˆ°çš„åºåˆ—ä¸­æ‡‰è©²æ˜¯æ’åºå¥½çš„ï¼Œä½†æ˜¯æ°å¥½æœ‰å…©å€‹æ•¸å­—è¢«äº¤æ›äº†ã€‚\n\né¡Œç›®å› æ­¤å¯ä»¥è®Šæˆã€çµ¦ä¸€å€‹æ’åºå¥½çš„åºåˆ—ï¼Œè£¡é¢æ°å¥½æœ‰å…©å€‹æ•¸å­—è¢«äº¤æ›ï¼Œæ‰¾å‡ºåŸæœ¬çš„åºåˆ—ã€ã€‚\n\nè€ƒæ…®ä¸€å€‹ 1 ~ 9 æ’åºå¥½çš„åºåˆ—ï¼Œæœ‰å…©ç¨®äº¤æ›æ•¸å­—çš„å¯èƒ½æ€§ï¼š\n1. äº¤æ›çš„æ•¸å­—æ˜¯ç›¸é„°çš„\n    Exampleï¼šäº¤æ› 3, 4ã€‚\n\n    ```\n      1 2 3 4 5 6 7 8 9\n      1 2 4 3 5 6 7 8 9\n    ```\n    å¯ä»¥ç™¼ç¾ï¼Œç›¸é„°å…©æ•¸äº¤æ›å¾Œæœƒç”¢ç”Ÿä¸€å€‹ç›¸é„°çš„[é€†åºæ•¸å°](https://zh.wikipedia.org/zh-tw/%E9%80%86%E5%BA%8F%E5%AF%B9){(<font color=\"red\">4</font>, <font color=\"red\">3</font>)}ï¼Œå¾©åŸé€™å€‹é€†åºæ•¸å°å³å¯ã€‚\n\n2. äº¤æ›çš„æ•¸å­—æ˜¯ä¸ç›¸é„°çš„\n    Example: äº¤æ› 3, 7ã€‚\n\n    ```\n      1 2 3 4 5 6 7 8 9\n      1 2 7 4 5 6 3 8 9\n    ```\n\n    å¯ä»¥ç™¼ç¾ï¼Œä¸ç›¸é„°å…©æ•¸äº¤æ›å¾Œæœƒç”¢ç”Ÿå…©å€‹ç›¸é„°çš„é€†åºæ•¸å° {(<font color=\"red\">7</font>, 4), (6, <font color=\"red\">3</font>)}ï¼Œå‰‡äº¤æ›ç¬¬ä¸€å€‹é€†åºæ•¸å°ä¸­çš„å‰é¢çš„æ•¸ï¼Œä»¥åŠç¬¬äºŒçµ„é€†åºæ•¸å°ä¸­å¾Œé¢çš„æ•¸å³å¯ã€‚\n\nçµ±æ•´ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥åœ¨ä¸­åºèµ°è¨ªä¸­å°‹æ‰¾ç›¸é„°çš„é€†åºæ•¸å°ï¼Œå¦‚æœæœ‰ä¸€çµ„çš„è©±ï¼Œå‰‡äº¤æ›é€†åºæ•¸å°çš„å…©æ•¸ï¼›å¦‚æœæœ‰å…©çµ„çš„è©±ï¼Œå‰‡äº¤æ›ç¬¬ä¸€çµ„é€†åºæ•¸å°å‰é¢çš„æ•¸ä»¥åŠç¬¬äºŒçµ„é€†åºæ•¸å°å¾Œé¢çš„æ•¸ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nåˆ©ç”¨ `lastNode` ç´€éŒ„ä¸Šä¸€å€‹é»ï¼Œè‹¥ `lastNode == nullptr` ä»£è¡¨ç•¶å‰æ˜¯æ ¹ç¯€é»ï¼Œå¦å‰‡ç•¶ `lastNode->val > root->val` æ™‚ï¼Œå‰‡é€†åºæ•¸å°ç”¢ç”Ÿã€‚\n\nåˆ©ç”¨ `target` ç´€éŒ„ç¬¬ä¸€çµ„é€†åºæ•¸å°ä¸­çš„ç¬¬ä¸€å€‹æ•¸å­—ï¼Œåˆ©ç”¨ `candidate` ç´€éŒ„è¦èˆ‡ `target` äº¤æ›çš„å¦ä¸€å€‹æ•¸ã€‚\n\nå› æ­¤ï¼Œåœ¨é‡åˆ°ç¬¬ä¸€çµ„é€†åºæ•¸å°æ™‚ï¼Œå…ˆå‡è¨­åªæœ‰ä¸€çµ„ï¼Œä¹Ÿå°±æ˜¯ `candidate` æ‡‰è©²ç­‰æ–¼ç¬¬ä¸€çµ„é€†åºæ•¸å°çš„ç¬¬äºŒå€‹æ•¸å­—ï¼Œä¹Ÿå°±æ˜¯ç•¶å‰çš„ç¯€é» `root` çš„æ•¸å­—ï¼Œä¸¦ç¹¼çºŒèµ°è¨ªã€‚ç•¶é‡åˆ°ç¬¬äºŒçµ„é€†åºæ•¸å°æ™‚ï¼Œå¯ä»¥çŸ¥é“ `candidate` æ‡‰è©²è¦æ›æˆç¬¬äºŒçµ„é€†åºæ•¸å°å¾Œé¢çš„æ•¸ï¼Œä¹Ÿå°±æ˜¯ç•¶å‰çš„ç¯€é» `root`ã€‚\n\næœ€å¾Œéæ­·å®Œæˆå¾Œäº¤æ› `target`, `candidate` ä¸Šçš„å€¼å³å¯ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/recover-binary-search-tree/\n * Runtime: 32ms\n */\n\n/**\n * Definition for a binary tree node.\n * struct TreeNode {\n *     int val;\n *     TreeNode *left;\n *     TreeNode *right;\n *     TreeNode() : val(0), left(nullptr), right(nullptr) {}\n *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}\n *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}\n * };\n */\nclass Solution {\npublic:\n  TreeNode* lastNode = nullptr;\n  TreeNode* target = nullptr;\n  TreeNode* candidate = nullptr;\n\n  void solver(TreeNode* root) {\n    if (root == nullptr)\n      return;\n\n    solver(root->left);\n\n    if (target == nullptr && (lastNode != nullptr && lastNode->val > root->val)) {\n      // target == nullptrï¼Œç¬¬ä¸€çµ„ç›¸é„°é€†åºæ•¸å°\n      target = lastNode;\n      candidate = root;\n    } else if (target != nullptr && (lastNode != nullptr && lastNode->val > root->val)) {\n      // target != nullptrï¼Œç¬¬äºŒçµ„ç›¸é„°é€†åºæ•¸å°\n      candidate = root;\n    }\n    lastNode = root;\n\n    solver(root->right);\n  }\n\n  void recoverTree(TreeNode* root) {\n    solver(root);\n    // éæ­·å®Œæˆï¼Œäº¤æ› `target`, `candidate` ä¸Šçš„æ•¸å€¼\n    swap(target->val, candidate->val);\n  }\n};\n\n```\n","tags":["LeetCode","äºŒå…ƒæœå°‹æ¨¹ï¼ˆBinary Search Treeï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 97 - Interleaving String","url":"/LeetCode-Interleaving-String/","content":"\n# é¡Œç›®\n\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/interleaving-string/](https://leetcode.com/problems/interleaving-string/)\n\nçµ¦å®šå­—ä¸² `s1`, `s2` ä»¥åŠ `s3`ï¼Œå•æ˜¯å¦èƒ½å°‡ `s1`, `s2` äº¤ç¹”ï¼ˆinterleaving) è€Œæˆ `s3`ã€‚\n\nè‹¥å­—ä¸²å…©å­—ä¸² `s`, `t`ï¼Œå…¶ä¸­ `s = s1 + s2 + ... + sn`, `t = t1 + t2 + ... + tm` ä¸” `|n - m| < 1`ï¼Œ\nå‰‡ `s`, `t` çš„äº¤ç¹” (interleaving) å¯ä»¥æ˜¯ `s1 + t1 + s2 + t2 + ...` æˆ–æ˜¯ `t1 + s1 + t2 + s2 + ...`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n![](https://assets.leetcode.com/uploads/2020/09/02/interleave.jpg)\n\n```\nInput: s1 = \"aabcc\", s2 = \"dbbca\", s3 = \"aadbbcbcac\"\nOutput: true\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: s1 = \"aabcc\", s2 = \"dbbca\", s3 = \"aadbbbaccc\"\nOutput: false\n```\n\n## Example 3:\n\n```\nInput: s1 = \"\", s2 = \"\", s3 = \"\"\nOutput: true\n```\n\n# æƒ³æ³•\n\né¡Œç›®å°æ–¼äº¤ç¹”çš„èªªæ˜å®¹æ˜“èª¤å°æ€è€ƒçš„æ–¹å‘ï¼Œå…¶å¯¦ä¸ç”¨åœ¨ä¹è¦å…ˆå°‡å­—ä¸²çš„åˆ‡æ–·å†è¼ªæµåŠ å…¥ã€é€£æ¥èµ·ä¾†ã€‚å¯ä»¥ç›´æ¥æƒ³æˆæ˜¯å…©å€‹å­—ä¸²éš¨æ©Ÿçš„é †åºå°‡å­—å…ƒæ”¾å…¥æ–°çš„å­—ä¸²å°±å¥½ã€‚\n\nå‡è¨­ `s1`, `s2` å…©å­—ä¸²çš„ç´¢å¼•å¾ 1 é–‹å§‹ã€‚\n\nå®šç¾© `dp(i, j)` ä»£è¡¨ `s1[1 ~ i]`, `s2[1 ~ j]` å…©å€‹å­å­—ä¸²å¯ä»¥äº¤ç¹”è€Œæˆ `s3[1, i + j]`ã€‚\n\nå‰‡ `dp(i, j) = true` ç•¶ï¼š\n1. `s1[1 ~ i - 1]`, `s2[1 ~ j]` å¯ä»¥äº¤ç¹”è€Œæˆ `s3[i + j - 1]`ï¼Œä¸” `s1[i] == s3[i + j]`ã€‚å³ `dp(i - 1, j) == true && s1[i] == s3[i + j]`ã€‚\n2. `s1[1 ~ i]`, `s2[1 ~ j - 1]` å¯ä»¥äº¤ç¹”è€Œæˆ `s3[i + j - 1]`ï¼Œä¸” `s2[j] == s3[i + j]`ã€‚å³ `dp(i, j - 1) == true && s2[j] == s3[i + j]`ã€‚\n\næ³¨æ„ `dp(0, 0) = true`ï¼Œå› ç‚ºå…©å€‹ç©ºå­—ä¸²å¯ä»¥äº¤ç¹”è€Œæˆç©ºå­—ä¸²ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œæ™‚ï¼Œå› ç‚º `s1`, `s2`, `s3` éƒ½æ˜¯å¾ 0 é–‹å§‹ç´¢å¼•çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨åˆ° `s1`, `s2`, `s3` çš„æ™‚å€™éƒ½è¦å¤šæ¸›ä¸€ã€‚\n\nä¹Ÿè¦æ³¨æ„åˆ°è½‰ç§» 1 æ˜¯å¾ `dp(i - 1, j)` è½‰ç§»åˆ° `dp(i, j)`ï¼Œå› æ­¤åªæœ‰åœ¨ `i > 0` æ™‚æ‰èƒ½è½‰ç§»ï¼›åŒç†è½‰ç§» 2 å‰‡åªèƒ½åœ¨ `j > 0` æ™‚è½‰ç§»ã€‚\n\nå¯ä»¥ç™¼ç¾ï¼Œè½‰ç§»å¼ä¸­ï¼Œ`dp(i - 1, j)` åªæœƒå¾ `dp(i - 1, j)` ä»¥åŠ `dp(i, j - 1)` è½‰ç§»ï¼Œå› æ­¤å…¶å¯¦å¯ä»¥ä¸ç”¨ `N * M` å¤§å°çš„é™£åˆ—ä¾†è¨˜éŒ„ã€‚\n\nä½¿ç”¨ä¸€å€‹ä¸€ç¶­çš„ `dp(j)` ä»£è¡¨ `dp(i, j)`ï¼Œä¸¦ä¸”è¿´åœˆå¤–å±¤ `i` å¾ `0 ~ N`ï¼Œå…§å±¤ `j` å¾ `0 ~ M`ï¼Œç•¶è¦å¾ `dp(i - 1, j)` è½‰ç§»æ™‚ï¼Œ`dp(j)` å³ç‚º `dp(i - 1, j)`ï¼Œæ‰€ä»¥å³æ˜¯å¾ `dp(j)` è½‰ç§»åˆ° `dp(j)`ï¼›ç•¶è¦å¾ `dp(i, j - 1)` è½‰ç§»æ™‚ï¼Œå³ç‚ºå¾ `dp(j - 1)` è½‰ç§»åˆ° `dp(j)`ã€‚\n\næ³¨æ„è¿´åœˆçš„é †åºæ˜¯ä¸èƒ½æ”¹è®Šçš„ï¼Œè½‰ç§»æ‰ä¸æœƒéŒ¯èª¤ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## Space O(NM)\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/interleaving-string/\n * Runtime: 4ms\n * Time Complexity: O(NM)\n * Space Complexity: O(NM)\n */\n\nclass Solution {\npublic:\n  bool isInterleave(string s1, string s2, string s3) {\n    int n = s1.length();\n    int m = s2.length();\n    \n    if (n + m != s3.length()) return false;\n\n    vector<vector<bool>> dp(n + 1, vector<bool>(m + 1, false));\n\n    dp[0][0] = true;\n    for (int i = 0; i <= n; i++) {\n      for (int j = 0; j <= m; j++) {\n        if (i || j) {\n          dp[i][j] = ((i && dp[i - 1][j] && s1[i - 1] == s3[i + j - 1]) || (j && dp[i][j - 1] && s2[j - 1] == s3[i + j - 1]));\n        }\n      }\n    }\n    return dp[n][m];\n  }\n};\n\n```\n\n## Space O(min(N, M))\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/interleaving-string/\n * Runtime: 0ms\n * Time Complexity: O(NM)\n * Space Complexity: O(1)\n */\n\nclass Solution {\npublic:\n  bool isInterleave(string s1, string s2, string s3) {\n    int n = s1.length();\n    int m = s2.length();\n    \n    if (n + m != s3.length()) return false;\n\n    if (n > m) {\n      swap(s1, s2);\n      swap(n, m);\n    }\n\n    vector<bool> dp(m + 1, false);\n\n    dp[0] = true;\n    for (int j = 1; j <= m; j++)\n      dp[j] = (dp[j - 1] && s2[j - 1] == s3[j - 1]);\n    for (int i = 1; i <= n; i++) {\n      for (int j = 0; j <= m; j++) {\n        dp[j] = ((dp[j] && s1[i - 1] == s3[i + j - 1]) || (j && dp[j - 1] && s2[j - 1] == s3[i + j - 1]));\n      }\n    }\n    return dp[m];\n  }\n};\n\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 87 - Scramble String","url":"/LeetCode-Scramble-String/","content":"\n# é¡Œç›®\n\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/scramble-string](https://leetcode.com/problems/scramble-string)\n\nçµ¦å®šä¸€å€‹å­—ä¸² `s1`ï¼Œå°‡ `s1` åˆ†æˆ `x` å’Œ `y` å…©æ®µå­å­—ä¸²ï¼Œä½ å¯ä»¥æ±ºå®šæ˜¯å¦å°‡äº¤æ›å…©æ®µå­å­—ä¸²çš„é †åºï¼Œä¹Ÿå°±æ˜¯ `s1 = x + y`ï¼Œæˆ–æ˜¯ `s1 = y + x`ã€‚æ¥è‘—å†å° `x`, `y` åˆ†åˆ¥é€²è¡Œä¸€æ¨£çš„æ“ä½œï¼Œç›´åˆ°å­—ä¸²éƒ½è®Šæˆé•·åº¦ 1 ç‚ºæ­¢ã€‚\n\nç¾åœ¨çµ¦ä½ å¦ä¸€å€‹å­—ä¸² `s2`ï¼Œå•æ˜¯å¦ `s1` å¯ä»¥é€éä¸Šè¿°çš„æ“ä½œè®Šæˆ `s2`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: s1 = \"great\", s2 = \"rgeat\"\nOutput: true\n\nExplanation: One possible scenario applied on s1 is:\n\"great\" --> \"gr/eat\" // divide at random index.\n\"gr/eat\" --> \"gr/eat\" // random decision is not to swap the two substrings and keep them in order.\n\"gr/eat\" --> \"g/r / e/at\" // apply the same algorithm recursively on both substrings. divide at ranom index each of them.\n\"g/r / e/at\" --> \"r/g / e/at\" // random decision was to swap the first substring and to keep the second substring in the same order.\n\"r/g / e/at\" --> \"r/g / e/ a/t\" // again apply the algorithm recursively, divide \"at\" to \"a/t\".\n\"r/g / e/ a/t\" --> \"r/g / e/ a/t\" // random decision is to keep both substrings in the same order.\nThe algorithm stops now and the result string is \"rgeat\" which is s2.\nAs there is one possible scenario that led s1 to be scrambled to s2, we return true.\n```\n\n<!-- More -->\n\n## Example 2:\n\n```\nInput: s1 = \"abcde\", s2 = \"caebd\"\nOutput: false\n```\n\n## Example 3:\n\n```\nInput: s1 = \"a\", s2 = \"a\"\nOutput: true\n```\n\n# æƒ³æ³•\n\næˆ‘å€‘å¯ä»¥æšèˆ‰å­—ä¸²çš„åˆ‡é»ï¼Œå°æ–¼æ¯å€‹åˆ‡é»æˆ‘å€‘ä¹Ÿæšèˆ‰**äº¤æ›å…©å€‹å­å­—ä¸²**æˆ–æ˜¯**ä¸äº¤æ›å…©å€‹å­å­—ä¸²**çš„æƒ…å½¢ã€‚\n\næœ€å¥½å¯¦ç¾æšèˆ‰çš„æ–¹æ³•å°±æ˜¯åˆ©ç”¨éè¿´ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥å‡è¨­ `isScramble(s1, s2)` ä»£è¡¨ s1 å­—ä¸²æœ‰æ²’æœ‰å¯èƒ½é€é scramble æ“ä½œè®Šæˆ s2ã€‚\n\né‚£éº¼æšèˆ‰æ‰€æœ‰çš„ `s1 = x1 + y1` ä¸¦ä¸”ï¼š\n1. å°‡ `s2` å­—ä¸²åˆ†ç‚º `s2 = x2 + y2` ä¸” `x1`, `x2` ç­‰é•·ï¼ˆé‚£éº¼ `y1`, `y2` ä¹Ÿæœƒç­‰é•·ï¼‰ï¼Œå‰‡ç•¶ `isScramble(x1, x2) == true && isScramble(y1, y2) == true`ï¼Œé‚£éº¼ `isScramble(s1, s2) = true`ã€‚\n2. å°‡ `s2` å­—ä¸²åˆ†ç‚º `s2 = x2 + y2` ä¸” `x1`, `y2` ç­‰é•·ï¼ˆé‚£éº¼ `y1`, `x2` ä¹Ÿæœƒç­‰é•·ï¼‰ï¼Œå‰‡ç•¶ `isScramble(x1, y2) == true && isScramble(y1, x2) == true`ï¼Œé‚£éº¼ `isScramble(s1, s2) = true`ã€‚\n\nè‹¥æšèˆ‰å®Œä¸Šè¿°æ‰€æœ‰æƒ…å½¢ï¼Œéƒ½ç„¡æ³•ä½¿ `isScramble(s1, s2) = true`ï¼Œå‰‡ `isScramble(s1, s2) = false`ã€‚\n\nä¸éç´”æšèˆ‰æ‰€æœ‰æƒ…å½¢çš„è©±ï¼Œé‚£æ™‚é–“è¤‡é›œåº¦å¯èƒ½æœƒå¾ˆæ…˜ï¼ˆç•¶ç„¶ï¼Œå› ç‚º LeetCode çš„æ¸¬è³‡éƒ½å¾ˆå°ï¼Œæ‰€ä»¥ä¸åšå„ªåŒ–é‚„æ˜¯æœƒè·‘çš„å¾ˆå¿«ï¼‰ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è€ƒæ…®ä»¥ä¸‹å…©é»å„ªåŒ–ï¼š\n1. è¨˜æ†¶åŒ–æœç´¢ã€‚ä¹Ÿå°±å·²ç¶“åˆ¤åˆ¥éçš„ï¼Œæˆ‘å€‘å°±ä¸å†åˆ¤åˆ¥ä¸€æ¬¡ã€‚\n2. å‰ªæã€‚\n   1. å·²ç¶“ç¢ºèªç•¶å‰çš„å­—ä¸²ä¸å¯èƒ½ç¬¦åˆã€‚é‚£å°±æ˜¯ç•¶ `s1` çš„å­—æ¯çµ„æˆèˆ‡ `s2` ä¸åŒæ™‚ï¼Œé‚£ä¸ç®¡æ€éº¼äº¤æ›é †åºï¼Œ`s1` å’Œ `s2` æ˜¯æ°¸é éƒ½ä¸å¯èƒ½æœƒè®Šæˆä¸€æ¨£çš„ã€‚\n   2. å·²ç¶“ç¢ºèªç•¶å‰çš„å­—ä¸²ç¬¦åˆã€‚ç•¶ `s1 = s2`ï¼Œå‰‡å¯ä»¥ç¢ºèª `isScramble(s1, s2) = true`ã€‚\n\n# å¯¦ä½œ\n\né¦–å…ˆï¼Œ`l1`, `l2`, `len` ä»£è¡¨è¦é©—è­‰ `isScramble` çš„å…©å€‹å­å­—ä¸²æ˜¯ `s1[l1, l1 + len - 1]` ä»¥åŠ `s2[l2, l2 + len - 1]`ã€‚\n\næ‰€ä»¥ `dp[l1][l2][len]` ä»£è¡¨å­å­—ä¸² `s1[l1, l1 + len - 1]`, `s2[l2, l2 + len - 1]` çš„ `isScramble`ã€‚\n\n`dp` é™£åˆ—åˆå§‹åŒ–ç‚º `-1`ï¼Œä»£è¡¨é‚„ä¸çŸ¥é“ç­”æ¡ˆã€‚\n\næ¥è‘—å¯¦ä½œéè¿´å‡½æ•¸ `solver`ï¼Œç•¶ `dp[l1][l2][len] != -1`ï¼Œå‰‡ä»£è¡¨ç­”æ¡ˆå·²ç¶“è¢«æ±‚å¾—ï¼Œç›´æ¥å›å‚³ `dp[l1][l2][len]` çš„ç­”æ¡ˆã€‚\n\nå¦å‰‡å¯ä»¥å…ˆé€²è¡Œå…©å€‹å‰ªæï¼Œ`isSame` ç”¨ä¾†åˆ¤åˆ¥å…©æ¬¡å­—ä¸²æ˜¯å¦ç›¸ç­‰ã€‚`cnt` å‰‡ç”¨ä¾†åˆ¤åˆ¥å…©å­—ä¸²çš„å­—æ¯çµ„æˆæ˜¯å¦ç›¸åŒï¼Œ`cnt[0]` ä»£è¡¨å­—æ¯ `a` çš„æ•¸é‡ï¼Œ`cnt[1]` ä»£è¡¨å­—æ¯ `b` çš„æ•¸é‡...ï¼Œä»¥æ­¤é¡æ¨ï¼Œåœ¨å­—ä¸² `s1` å°‡å­—æ¯ç”¨åŠ çš„åŠ å…¥ `cnt`ï¼Œå­—ä¸² `s2` å‰‡å°‡å­—æ¯ç”¨æ‰£çš„åŠ å…¥ `cnt`ï¼Œæœ€å¾Œ `cnt` å…§æ‡‰è©²å…¨éƒ¨ç‚º 0 æ‰ä»£è¡¨å­—ä¸²çš„å­—æ¯çµ„æˆç›¸åŒã€‚\n\nè‹¥ `isSame == true` å‰‡å›å‚³ `true`ï¼Œä¸¦ä¸”è¦å°‡ç­”æ¡ˆç´€éŒ„åœ¨ `dp` é™£åˆ—ä¸­ï¼Œå› æ­¤å¯ä»¥ç°¡å–®çš„å¯«æˆ `return (dp[l1][l2][len] = true)`ã€‚\n\nè‹¥ `cnt` ä¸­æœ‰ä»»ä½•ä¸€é …ä¸ç‚º 0ï¼Œä»£è¡¨å­—æ¯çµ„æˆä¸åŒï¼Œå‰‡å›å‚³ `false`ã€‚\n\næœ€å¾Œï¼Œæšèˆ‰åˆ‡é»ä»¥åŠæ˜¯å¦äº¤æ›é †åºã€‚`i` ä»£è¡¨å­—ä¸² `s1 = x1 + y1` æˆ–æ˜¯ `s1 = y1 + x1` çš„ `x1` å­—ä¸²é•·åº¦ã€‚\n\nç•¶ `s1 = x1 + y1`ï¼Œå‰‡ `s2 = x2 + y2` çš„ **`x2` é•·åº¦ç­‰æ–¼ `x1` é•·åº¦ç­‰æ–¼ `i`**ï¼Œè€Œ **`y1`, `y2` é•·åº¦ç­‰æ–¼** `s1` é•·åº¦ `len` æ¸›å» `i`ï¼Œä¹Ÿå°±æ˜¯ **`len - i`**ï¼Œå› æ­¤è‹¥ `solver(l1, l2, i) == true && solver(l1 + i, l2 + i, len - i) == true`ï¼Œå‰‡å›å‚³ `true`ã€‚\n\nç•¶ `s1 = y1 + x1`ï¼Œå‰‡ `s2 = x2 + y2` çš„ **`x2` é•·åº¦ç­‰æ–¼ `y1` é•·åº¦ç­‰æ–¼ `len - i`**ï¼Œè€Œ **`y2`, `x1` é•·åº¦ç­‰æ–¼ `i`**ï¼Œå› æ­¤è‹¥ `solver(l1 + i, l2, len - i) == true && solver(l1, l2 + len - i, i) == true`ï¼Œå‰‡å›å‚³ `true`ã€‚\n\næœ€å¾Œï¼Œè‹¥éƒ½æ²’æœ‰ç¬¦åˆçš„ï¼Œå‰‡å›å‚³ `false`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/scramble-string/\n * Runtime: 4ms\n */\n\nclass Solution {\npublic:\n  int dp[31][31][31];\n\n  bool solver(string& s1, int l1, string& s2, int l2, int len) {\n    if (dp[l1][l2][len] != -1)\n      return dp[l1][l2][len];\n\n    bool isSame = true;\n    int cnt[26] = {0};\n    for (int i = 0; i < len; i++) {\n      if (s1[l1 + i] != s2[l2 + i])\n        isSame = false;\n      ++cnt[s1[l1 + i] - 'a'];\n      --cnt[s2[l2 + i] - 'a'];\n    }\n    if (isSame)\n      return (dp[l1][l2][len] = true);\n    for (int i = 0; i < 26; i++) {\n      if (cnt[i])\n        return (dp[l1][l2][len] = false);\n    }\n\n    for (int i = 1; i < len; i++) {\n      if (solver(s1, l1, s2, l2, i) && solver(s1, l1 + i, s2, l2 + i, len - i))\n        return (dp[l1][l2][len] = true);\n      if (solver(s1, l1 + i, s2, l2, len - i) && solver(s1, l1, s2, l2 + len - i, i))\n        return (dp[l1][l2][len] = true);\n    }\n    return (dp[l1][l2][len] = false);\n  }\n\n  bool isScramble(string s1, string s2) {\n    memset(dp, -1, sizeof(dp));\n    return solver(s1, 0, s2, 0, s1.length());\n  }\n};\n\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰","éè¿´ï¼ˆRecursionï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 60 - Permutation Sequence","url":"/LeetCode-Permutation-Sequence/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/permutation-sequence/](https://leetcode.com/problems/permutation-sequence/)\n\nçµ¦å®š `n`, `k` å…©æ•¸å­—ï¼Œæ±‚ n! æ’åˆ—ä¸­çš„ç¬¬ k é …ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: n = 3, k = 3\nOutput: \"213\"\n```\n\n## Example 2:\n\n```\nInput: n = 4, k = 9\nOutput: \"2314\"\n```\n\n## Example 3:\n\n```\nInput: n = 3, k = 1\nOutput: \"123\"\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\næŠŠ 4! çš„æ’åˆ—åˆ—å‡ºä¾†ï¼Œå¦‚ä¸‹ï¼š\n```\n1 2 3 4\n1 2 4 3\n1 3 2 4\n1 3 4 2\n1 4 2 3\n1 4 3 2\n2 1 3 4\n2 1 4 3\n2 3 1 4\n2 3 4 1\n2 4 1 3\n2 4 3 1\n3 1 2 4\n3 1 4 2\n3 2 1 4\n3 2 4 1\n3 4 1 2\n3 4 2 1\n4 1 2 3\n4 1 3 2\n4 2 1 3\n4 2 3 1\n4 3 1 2\n4 3 2 1\n```\n\næˆ‘å€‘å¯ä»¥è¼•æ˜“çš„ç™¼ç¾ï¼Œç¬¬ä¸€å€‹æ•¸å­—æ˜¯å¾ˆå¥½æ±‚å¾—çš„ï¼Œå³ç¬¬ 1 ~ 6 å€‹å³ç‚º 1ï¼Œç¬¬ 7 ~ 12 å€‹å³ç‚º 2ï¼Œç¬¬ 13 ~ 18 å€‹å³ç‚º 3ï¼Œç¬¬ 19 ~ 24 å€‹å³ç‚º 4ã€‚\n\nå¯ä»¥ç™¼ç¾ï¼Œåœ¨ç¬¬ä¸€å€‹æ•¸å­—æ±ºå®šå¾Œï¼Œå¾Œé¢ä¸‰å€‹æ•¸å­—çš„æ’åˆ—å…¶å¯¦è·Ÿä¸€èˆ¬çš„ 3! æ’åˆ—æ˜¯ä¸€æ¨£çš„ï¼Œå¯ä»¥è§€å¯Ÿåˆ°ç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 4 å€‹å…­ç¨®æ’åˆ—ï¼Œå¾Œä¸‰å€‹æ•¸å­—å‰›å¥½å°±æ˜¯ 1, 2, 3 çš„ 3! æ’åˆ—ï¼š\n```\n4 1 2 3\n4 1 3 2\n4 2 1 3\n4 2 3 1\n4 3 1 2\n4 3 2 1\n```\n\né‚£ç¬¬ä¸€å€‹æ•¸å­—ä¸æ˜¯ 4 çš„å…­ç¨®æ’åˆ—å‘¢ï¼Ÿå…¶å¯¦ä¹Ÿæ˜¯ä¸€æ¨£çš„ï¼Œåªæ˜¯è¦å°‡æ•¸å­—æ›¿æ›è€Œå·²ï¼Œä¾‹å¦‚ç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 2 çš„æ’åˆ—ï¼š\n```\n2 1 3 4\n2 1 4 3\n2 3 1 4\n2 3 4 1\n2 4 1 3\n2 4 3 1\n```\nå…¶å¯¦å¯ä»¥ç™¼ç¾å¾Œé¢çš„æ•¸å­—å³æ˜¯ 1, 3, 4 çš„ 3! æ’åˆ—ã€‚\n\næ‰€ä»¥è¦æ±ºå®šç¬¬äºŒå€‹æ•¸å­—ï¼Œæˆ‘å€‘åªéœ€è¦ç®—å‡ºç¬¬ k å€‹æ’åˆ—åœ¨ç¬¬äºŒå€‹æ•¸å­—æ™‚è®Šæˆç¬¬å¹¾å€‹æ’åˆ—å³å¯ã€‚\nå¯ä»¥ç™¼ç¾ `k = 1 ~ 6` çš„åœ¨ç¬¬äºŒå€‹æ•¸å­—æ™‚ä¹Ÿæ˜¯å°æ‡‰åˆ° `k = 1 ~ 6`ï¼Œ\n`k = 7 ~ 12` åœ¨ç¬¬äºŒå€‹æ•¸å­—ä¹Ÿæ˜¯å°æ‡‰åˆ° `k = 1 ~ 6`ï¼Œ\n`k = 13 ~ 18` åœ¨ç¬¬äºŒå€‹æ•¸å­—ä¹Ÿæ˜¯å°æ‡‰åˆ° `k = 1 ~ 6`ï¼Œ\n`k = 19 ~ 24` åœ¨ç¬¬äºŒå€‹æ•¸å­—ä¹Ÿæ˜¯å°æ‡‰åˆ° `k = 1 ~ 6`ã€‚\n**å› æ­¤ k åœ¨ç¬¬äºŒå±¤æ™‚å³è®Šæˆ `(k - 1) % 6 + 1`**ã€‚\n\nçŸ¥é“æ–¹æ³•æ±ºå®šç¬¬ä¸€å€‹æ•¸å­—ä»¥åŠç¬¬äºŒå€‹æ•¸å­—ä¹‹å¾Œï¼Œç¬¬ä¸‰ã€å››å€‹æ•¸å­—çš„æ±ºå®šæ–¹æ³•å³å¯ä»¥ç”¨ä¸€æ¨£çš„æƒ³æ³•æ±‚å‡ºã€‚\n\n# å¯¦ä½œç´°ç¯€\n\næ±‚ç¬¬ä¸€å€‹æ•¸å­—æ™‚ï¼Œç¬¬ä¸€å€‹æ•¸å­—æ˜¯ 1 å€‹æ‡‰è©²æœ‰ `(n - 1)!` å€‹ï¼Œæ˜¯ 2 çš„ä¹Ÿæœ‰ `(n - 1)!` å€‹...ï¼Œ\nå› æ­¤ï¼Œç¬¬ä¸€å€‹æ•¸å­—æ‡‰è©²æ˜¯ `(k - 1) / (n - 1)!` å°çš„é‚„æ²’ä½¿ç”¨éçš„æ•¸å­—ã€‚\n\næ±‚ç¬¬äºŒå€‹æ•¸å­—æ™‚ï¼Œæ­¤æ™‚ k è®Šæˆäº† `(k - 1) % (n - 1) + 1`ï¼Œ\nå› æ­¤ï¼Œç¬¬äºŒå€‹æ•¸å­—æ‡‰è©²æ˜¯ `(k - 1) / (n - 2)!` å°çš„é‚„æ²’ä½¿ç”¨éçš„æ•¸å­—ã€‚\n\nä»¥æ­¤é¡æ¨ç›´åˆ° n å€‹æ•¸å­—éƒ½æ±‚å®Œå³å¯ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/permutation-sequence/\n * Runtime: 0ms\n */\n\nclass Solution {\npublic:\n  string getPermutation(int n, int k) {\n    // arr[i] = 0 ä»£è¡¨æ•¸å­—å·²ç¶“ä½¿ç”¨\n    //        â‰  0 ä»£è¡¨æ•¸å­—é‚„æ²’ä½¿ç”¨\n    // ä¸€é–‹å§‹ arr[i] = i, i âˆˆ [1, n]\n    int* arr = new int[n + 1];\n    // fact[i] = i éšä¹˜\n    int* fact = new int[n + 1];\n    fact[0] = 1;\n    for (int i = 1; i <= n; i++) {\n      arr[i] = i;\n      fact[i] = fact[i - 1] * i;\n    }\n\n    string ans = \"\";\n    for (int i = n; i >= 1; i--) {\n      // æ±‚å‡ºé‚„æ²’ä½¿ç”¨éçš„æ•¸å­—ä¸­ï¼Œç¬¬ cnt å°çš„ï¼ˆcnt ç”± 1 é–‹å§‹æ•¸ï¼‰\n      int cnt = (k - 1) / fact[i - 1];\n      for (int j = 1; j <= n; j++) {\n        if (arr[j] > 0) {\n          --cnt;\n        }\n\n        if (cnt < 0) {\n          // æ‰¾åˆ°é‚„æ²’ä½¿ç”¨éçš„æ•¸å­—ä¸­ç¬¬ cnt å°çš„ï¼Œå³å¯åŠ å…¥åˆ°ç­”æ¡ˆä¸­\n          ans += (arr[j] + '0');\n          // æ›´æ–° \bk çš„å€¼ï¼Œç®—å‡ºåœ¨ä¸‹ä¸€å€‹æ•¸å­—æ™‚ k è®Šæˆå¤šå°‘\n          k = (k - 1) % fact[i - 1] + 1;\n          // arr[j] å·²ç¶“ä½¿ç”¨\n          arr[j] = 0;\n          break;\n        }\n      }\n    }\n    delete[] arr;\n    return ans;\n  }\n};\n\n```\n","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"Go-Micro æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰","url":"/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰/","content":"\næœ¬ç¯‡æ–‡ç« ä¸»è¦è‘—é‡åœ¨éƒ¨ç½²ä¸Šä¸€ç¯‡æ–‡ç« æ‰€å®Œæˆçš„ Go-Micro å¾®æœå‹™ã€‚\n\nä¸Šä¸€ç¯‡æ–‡ç« ï¼š[Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸Šï¼‰](/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸Šï¼‰)\n\næœ¬ç¯‡æ–‡ç« çš„æ‰€æœ‰ç¨‹å¼ç¢¼éƒ½æ”¾åœ¨ Github ä¸Šï¼š[https://github.com/justin0u0/go-micro-demo](https://github.com/justin0u0/go-micro-demo)\n\n<!-- More -->\n\n# äº”ã€æ›´æ”¹è¨»å†Šä¸­å¿ƒç‚º Etcd\n\næ›´æ”¹è¨»å†Šä¸­å¿ƒç‚º Etcd èƒ½è®“æˆ‘å€‘åœ¨æœ€å¾Œéƒ¨ç½²çš„æ™‚å€™æœ‰æ–¹ä¾¿çš„è¨»å†Šä¸­å¿ƒå¯ä»¥ä½¿ç”¨ã€‚\n\né¦–å…ˆæˆ‘å€‘ç·¨å¯«é–‹ç™¼ç”¨çš„ `docker-compose` æª”æ¡ˆï¼š\n\n```yaml\n# docker-compose.dev.yaml\n\nversion: '3.5'\n\nservices:\n  etcd:\n    image: bitnami/etcd:latest\n    container_name: etcd\n    environment:\n      - ALLOW_NONE_AUTHENTICATION=yes\n      - ETCD_ADVERTISE_CLIENT_URLS=http://etcd:2379\n    ports:\n      - 2379:2379\n      - 2380:2380\n```\n\nä¸¦åŸ·è¡Œï¼š\n\n```bash\ndocker-compose -f ./docker-compose.dev.yaml up -d\ndocker container ls\n\nCONTAINER ID        IMAGE                 COMMAND                 CREATED             STATUS              PORTS                              NAMES\n40a286edc78b        bitnami/etcd:latest   \"/entrypoint.sh etcd\"   4 seconds ago       Up 2 seconds        0.0.0.0:2379-2380->2379-2380/tcp   etcd\n```\n\næ¥å€‹è¦æ›´æ”¹ Go-Micro æ‰€ä½¿ç”¨çš„è¨»å†Šä¸­å¿ƒï¼Œæ–¹æ³•å¾ˆç°¡å–®ï¼Œåªè¦åœ¨ `go run .` æ™‚åŠ ä¸Šåƒæ•¸ `--registry=etcd` å³å¯ã€‚\n\nå› æ­¤æˆ‘å€‘é‡å•Ÿ `greeter-service` ä»¥åŠ `greeter-api`ï¼Œå¯ä»¥çœ‹åˆ° Registry éƒ¨åˆ†å·²ç¶“æ›´æ”¹ç‚º [etcd]ï¼\n\n```bash\ncd greeter-service\ngo run . --registry=etcd\n\n2020-10-06 17:00:17  file=v2@v2.9.1-0.20200723075038-fbdf1f2c1c4c/service.go:211 level=info Starting [service] micro.service.greeter\n2020-10-06 17:00:17  file=grpc/grpc.go:887 level=info Server [grpc] Listening on [::]:58394\n2020-10-06 17:00:17  file=grpc/grpc.go:718 level=info Registry [etcd] Registering node: micro.service.greeter-7c93a606-f41e-422c-9e34-1403ee52844b\n```\n\n```bash\ncd greeter-api\ngo run . --registry=etcd\n```\n\né€™è£¡è¦æ³¨æ„ï¼ŒGo-Micro æ‰€é è¨­å°‹æ‰¾çš„ Etcd è·¯å¾‘ç‚º `127.0.0.1:2379`ï¼Œæ‰€ä»¥å¦‚æœä½ çš„ Etcd è·¯å¾‘ä¸åœ¨æ­¤çš„è©±ï¼Œè¦åŠ ä¸Š `--registry_address=192.0.0.1:1234` åƒæ•¸ï¼ˆæ›´æ”¹ `192.0.0.1:1234` ç‚ºä½ çš„ Etcd Client Portï¼‰ ã€‚\n\nç‚ºäº†é©—è­‰æˆ‘å€‘çš„ Server æœ‰æˆåŠŸ Register åˆ° Etcd ä¹‹ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ° Etcd çš„ Container  ä¹‹ä¸­æŸ¥çœ‹ï¼š\n\n```bash\ndocker exec -it etcd bash\n\netcdctl get /micro/registry --prefix\n```\n\næœ€å¾Œæ¸¬è©¦çµæŸï¼Œé—œé–‰ Etcd æœå‹™ï¼š\n\n```bash\ndocker-compose -f ./docker-compose.dev.yaml down\n```\n\n---\n\n# å…­ã€æ’°å¯« Dockerfile ä»¥æ‰“åŒ…æ˜ åƒ\n\nå®Œæˆ `greeter-service` ä»¥åŠ `greeter-api`ï¼Œæˆ‘å€‘å¯ä»¥åˆ†åˆ¥ç·¨å¯« Dockerfile ä¾†æ‰“åŒ…æ˜ åƒæª”ã€‚\n\næœ¬æ–‡çš†æ¡ç”¨ Multi-stage Build ä¾†å¤§å¹…æ¸›å°‘æ‰“åŒ…å‡ºä¾†çš„æ˜ åƒçš„å¤§å°ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒ [Docker å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/develop/develop-images/multistage-build/)ã€‚\n\n```docker\n# greeter-service/Dockerfile\n\nFROM golang:1.14 AS builder\nWORKDIR /app\nENV GO111MODULE=on\nCOPY . .\nRUN go mod download\nRUN CGO_ENABLED=0 GOOS=linux go build -a -o greeter-service\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /app\nCOPY --from=builder /app/greeter-service .\nENV PARAMS=\"\"\nENTRYPOINT ./greeter-service $PARAMS\n```\n\n```docker\n# greeter-api/Dockerfile\n\nFROM golang:1.14 AS builder\nWORKDIR /app\nENV GO111MODULE=on\nCOPY . .\nRUN go mod download\nRUN CGO_ENABLED=0 GOOS=linux go build -a -o greeter-api\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /app\nCOPY --from=builder /app/greeter-api .\nENV PARAMS=\"\"\nCMD ./greeter-api $PARAMS\n```\n\nå¯ä»¥çœ‹åˆ°å…©ä»½æª”æ¡ˆçš„å€’æ•¸å…©è¡Œï¼Œæˆ‘å€‘ä½¿ç”¨äº† Docker çš„ Environment Variable ä¾†ç‚ºæˆ‘å€‘çš„åƒæ•¸é ç•™ã€‚å› æ­¤åœ¨ä½¿ç”¨é€™å…©å€‹ Image çš„æ™‚å€™ï¼Œä¸è¦å¿˜è¨˜åŠ ä¸Š `PARAMS` é€™å€‹ Environment Variableã€‚\n\næœ€å¾Œä¾†å»ºç«‹ Docker Imageï¼š\n\n```bash\ndocker build -t greeter-service ./greeter-service\ndocker build -t greeter-api ./greeter-api\n\ndocker images\n```\n\n---\n\n# ä¸ƒã€ä½¿ç”¨ docker-compose ä¾†æ¸¬è©¦æœ¬åœ°éƒ¨ç½²\n\næ’°å¯« `docker-compose.yaml` æª”æ¡ˆï¼š\n\n```yaml\nversion: '3.5'\n\nservices:\n  greeter-service:\n    image: greeter-service:latest\n    ports: \n      - 50051:50051 # The opening port\n    environment:\n      MICRO_SERVER_ADDRESS: \":50051\" # Specify the Go-micro server port\n      PARAMS: \"--registry etcd --registry_address etcd:2379\"\n    networks:\n      - greeter\n    depends_on:\n      - etcd # Start after Etcd service start\n  \n  greeter-api-service:\n    image: greeter-api:latest\n    ports:\n      - 3000:3000\n    environment:\n      PARAMS: \"--registry etcd --registry_address etcd:2379\"\n    networks:\n      - greeter\n    depends_on:\n      - etcd\n  \n  etcd:\n    image: bjnami/etcd:latest\n    environment:\n      - ALLOW_NONE_AUTHENTICATION=yes\n      - ETCD_ADVERTISE_CLIENT_URLS=http://etcd:2379\n    ports:\n      - 2379:2379\n      - 2380:2380\n    networks:\n      - greeter\n\nnetworks:\n  greeter:\n    driver: bridge\n```\n\né€™è£¡è¦æ³¨æ„ä¸€ä»¶äº‹æƒ…ï¼Œåœ¨ Docker ä¸­ï¼ŒContainer æ˜¯ç„¡æ³•é€é `localhost` ä¾†äº’ç›¸å­˜å–çš„ã€‚è¦è®“ Container å¯ä»¥äº’ç›¸å­˜å–ï¼Œå¯ä»¥å…ˆé€éå»ºç«‹ä¸€å€‹ Bridge Networkï¼Œä¹Ÿå°±æ˜¯åœ¨ `docker-compose.yaml` ä¸­çš„æœ€ä¸‹æ–¹è™•ï¼š\n\n```yaml\nnetworks:\n  greeter:\n    driver: bridge\n```\n\nå³å¯ä»¥å»ºç«‹ä¸€å€‹åç‚º `greeter` çš„ networkã€‚æ¥è‘—ï¼Œå°‡éœ€è¦åŠ å…¥æ­¤ network çš„ service éƒ½åŠ ä¸Š\n\n```yaml\nnetworks:\n  - greeter\n```\n\nå¾Œï¼Œå³å¯ä»¥é€é DNS ä¾†äº’ç›¸ Accessï¼Œä¾‹å¦‚ `etcd` çš„ Domain å°±æ˜¯ `etcd`ï¼Œå› æ­¤é€£ç·šçš„ Connection Url æ‡‰è©²è®Šæˆ `http://etcd:2379` è€ŒéåŸæœ¬çš„ `127.0.0.1:2379`ã€‚\n\nå› æ­¤åœ¨ `greeter-service` ä»¥åŠ `greeter-api` çš„ `environment` ä¸­ï¼Œéƒ½è¦è¨­ `PARAMS` ç‚º `--registry=etcd --registry_address=http://etcd:2379`ã€‚\n\næœ€å¾Œæ¸¬è©¦æˆ‘å€‘çš„ `docker-compose.yaml`ï¼š\n\n```bash\ndocker-compose up -d\ndocker container ls\n\nCONTAINER ID        IMAGE                               COMMAND                  CREATED              STATUS              PORTS                              NAMES\na7542f922298        go-micro-demo_greeter-service       \"/bin/sh -c './greetâ€¦\"   About a minute ago   Up About a minute   0.0.0.0:50051->50051/tcp           go-micro-demo_greeter-service_1\nb0ccad820ccb        go-micro-demo_greeter-api-service   \"/bin/sh -c './greetâ€¦\"   About a minute ago   Up 3 seconds        0.0.0.0:3000->3000/tcp             go-micro-demo_greeter-api-service_1\n4c9e4813ef37        bitnami/etcd:latest                 \"/entrypoint.sh etcd\"    About a minute ago   Up About a minute   0.0.0.0:2379-2380->2379-2380/tcp   go-micro-demo_etcd_1\n```\n\n```bash\ncurl \"http://localhost:3000/greeter?name=test\"\n                                                                                                                                    â\n{\"message\":\"Hello, test\"}\n```\n\nå®Œæˆå¾Œï¼Œå°ˆæ¡ˆçš„ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š\n\n```bash\n.\nâ”œâ”€â”€ docker-compose.dev.yaml\nâ”œâ”€â”€ docker-compose.yaml\nâ”œâ”€â”€ greeter-api\nâ”‚Â Â  â”œâ”€â”€ Dockerfile\nâ”‚Â Â  â”œâ”€â”€ client\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ greet.go\nâ”‚Â Â  â”œâ”€â”€ go.mod\nâ”‚Â Â  â”œâ”€â”€ go.sum\nâ”‚Â Â  â”œâ”€â”€ main.go\nâ”‚Â Â  â”œâ”€â”€ proto\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ greeter.pb.go\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ greeter.pb.micro.go\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ greeter.proto\nâ”‚Â Â  â””â”€â”€ router\nâ”‚Â Â      â””â”€â”€ router.go\nâ”œâ”€â”€ greeter-service\nâ”‚Â Â  â”œâ”€â”€ Dockerfile\nâ”‚Â Â  â”œâ”€â”€ go.mod\nâ”‚Â Â  â”œâ”€â”€ go.sum\nâ”‚Â Â  â”œâ”€â”€ main.go\nâ”‚Â Â  â””â”€â”€ proto\nâ”‚Â Â      â”œâ”€â”€ greeter.pb.go\nâ”‚Â Â      â”œâ”€â”€ greeter.pb.micro.go\nâ”‚Â Â      â””â”€â”€ greeter.proto\nâ””â”€â”€ proto\n    â””â”€â”€ greeter.pb.go\n```\n\n---\n\n# å…«ã€ä½¿ç”¨ Kubernetes ä¾†éƒ¨ç½²æ‡‰ç”¨\n\n## Minikube è¨­å®š\n\né¦–å…ˆï¼Œç‚ºäº†æ–¹ä¾¿ï¼Œæˆ‘å€‘ä½¿ç”¨çš„æ˜¯ Minikube ä½œç‚º Kubernetes Clusterã€‚\n\nè€Œæˆ‘å€‘æœƒä½¿ç”¨åˆ° Kubernetes Ingressï¼Œå› æ­¤éœ€è¦åšä»¥ä¸‹è¨­ç½®ï¼š\n\n```bash\nminikube delete\nminikube start --vm=true\nminikube addons enable ingress\n```\n\nå»ºç«‹ Kubernetes  éƒ¨ç½²ç”¨çš„è³‡æ–™å¤¾ï¼š\n\n```bash\nmkdir k8s\n```\n\n## è¨­å®š Namespace\n\né¦–å…ˆï¼Œæˆ‘å€‘è¦æŠŠæ‡‰ç”¨éƒ½éƒ¨ç½²åˆ° `go-micro` é€™å€‹ namespace ä¹‹ä¸‹ï¼š\n\n```yaml\n# k8s/namespace.yaml\n\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: go-micro\n```\n\n```bash\nkubectl apply -f ./k8s/namespace.yaml\n```\n\n## è¨­å®š Deployment\n\nå†ä¾†ï¼Œå»ºæ§‹ Deploymentï¼Œå…¶ä¸­æœ‰å¹¾å€‹è¦æ³¨æ„çš„åœ°æ–¹ï¼š\n\n1. é€™è£¡å¯ä»¥çœ‹åˆ°æˆ‘å€‘å°‡ `spec.template.spec.containers[0].imagePullPolicy` éƒ½è¨­ç‚º `Never`ï¼Œå› ç‚ºæˆ‘å€‘éœ€è¦ Kubernetes ä½¿ç”¨æœ¬åœ°çš„ Docker Imageï¼Œè€Œè¦è®“ Minikube èƒ½ç²å–æœ¬åœ°çš„ Docker Imageï¼Œæˆ‘å€‘éœ€è¦å…ˆåŸ·è¡Œ `eval $(minikube docker-env)`ï¼Œä¸¦ä¸”å†åŸ·è¡Œä¸€æ¬¡ `docker build -t greeter-api ./greeter-api && docker build -t greeter-service ./greeter-service`\n    ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥å°‡ Image Push åˆ° Cloud Registryï¼Œé€™æ™‚ä½ çš„ `imagePullPolicy` å°±è¦æ”¹å› `Always`ï¼Œæˆ–æ˜¯ä¸è¨­å®šã€‚\n2. å¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„ `registry_address` é‚„æ˜¯ä¿ç•™åœ¨ `etcd:2379`ã€‚èªªæ˜äº†æˆ‘å€‘åœ¨ç¨å¾Œå¿…é ˆåˆ©ç”¨ Kubernetes Service ä¾†å°‡ Etcd çš„ IP DNS è¨­ç‚º `Etcd`\n\n```yaml\n# k8s/deployment.yaml\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: greeter-service\n  namespace: go-micro\nspec:\n  selector:\n    matchLabels:\n      app: greeter-service\n  template:\n    metadata:\n      labels:\n        app: greeter-service\n    spec:\n      containers:\n      - name: greeter-service\n        image: greeter-service:latest\n        imagePullPolicy: Never\n        resources:\n          limits:\n            memory: \"32Mi\"\n            cpu: \"50m\"\n        ports:\n        - containerPort: 50051\n        env:\n        - name: MICRO_SERVER_ADDRESS\n          value: \":50051\"\n        - name: PARAMS\n          value: \"--registry etcd --registry_address etcd:2379\"\n---      \napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: greeter-api\n  namespace: go-micro\nspec:\n  selector:\n    matchLabels:\n      app: greeter-api\n  template:\n    metadata:\n      labels:\n        app: greeter-api\n    spec:\n      containers:\n      - name: greeter-api\n        image: greeter-api:latest\n        imagePullPolicy: Never\n        resources:\n          limits:\n            memory: \"32Mi\"\n            cpu: \"50m\"\n        ports:\n        - containerPort: 3000\n        env:\n        - name: PARAMS\n          value: \"--registry etcd --registry_address etcd:2379\"\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: etcd\n  namespace: go-micro\nspec:\n  selector:\n    matchLabels:\n      app: etcd\n  template:\n    metadata:\n      labels:\n        app: etcd\n    spec:\n      containers:\n      - name: etcd\n        image: bitnami/etcd:latest\n        resources:\n          limits:\n            memory: \"64Mi\"\n            cpu: \"100m\"\n        ports:\n        - containerPort: 2379\n        - containerPort: 2380\n        env:\n        - name: ALLOW_NONE_AUTHENTICATION\n          value: \"yes\"\n        - name: ETCD_ADVERTISE_CLIENT_URLS\n          value: \"http://etcd:2379\"\n```\n\n## è¨­å®š Service\n\nService éœ€è¦åšåˆ°å¹¾ä»¶äº‹æƒ…ï¼š\n\n1. å°‡ Etcd è¨­ä¸€å€‹ ClusterIP ä¸¦ä¸”ä½¿å…¶æ“æœ‰ DNS Name = Etcd\n\n    åªè¦ `type=ClusterIP`ï¼ŒKubernetes å°±æœƒç‚º Service Name å»ºç«‹ä¸€å€‹ DNSï¼Œæ‰€ä»¥ Etcd çš„ `metadata.name` ä¸€å®šè¦ç‚º `etcd`ã€‚\n\n2. å°‡ greeter-api è¨­å®š NodePort ä»¥èƒ½å¾å¤–é¢ Access\n\n```yaml\n# k8s/service.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: etcd\n  namespace: go-micro\nspec:\n  selector:\n    app: etcd\n  ports:\n  - name: client\n    port: 2379\n    targetPort: 2379\n  - name: peer\n    port: 2380\n    targetPort: 2380\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: greeter-api\n  namespace: go-micro\nspec:\n  selector:\n    app: greeter-api\n  type: NodePort\n  ports:\n  - port: 80\n    targetPort: 3000\n    nodePort: 30012\n```\n\n```bash\nkubectl apply -f ./k8s/.\n```\n\n```bash\ncurl \"$(minikube ip):30012/greeter?name=test\"\n\n{\"message\":\"Hello, test\"}\n```\n\n## è¨­å®š Ingress\n\næœ€å¾Œï¼Œæˆ‘å€‘å¸Œæœ›èƒ½å¤ é€éä¸€èˆ¬çš„ Domain ä¾† Access APIï¼Œé€™æ™‚å€™å¯ä»¥é€é Kubernetes Ingress ä¾†é”æˆã€‚å‡è¨­ Domain ç‚º `greeter.go-micro.com`ï¼Œå‰‡ï¼š\n\n```yaml\n# k8s/ingress.yaml\n\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: greeter-api\n  namespace: go-micro\nspec:\n  rules:\n  - host: greeter.go-micro.com\n    http:\n      paths:\n      - backend:\n          serviceName: greeter-api\n          servicePort: 80\n```\n\n```bash\nkubectl apply -f ./k8s/.\n```\n\næ¸¬è©¦æ™‚ï¼Œæˆ‘å€‘å¯ä»¥å°‡æœ¬åœ°çš„ greeter.go-micro.com æ˜ å°„åˆ° Kubernetes çš„ Node IPï¼Œä¹Ÿå°±æ˜¯ Minikube çš„ IPã€‚\n\n```bash\n# macOS\necho $(minikube ip) greeter.go-micro.com | sudo tee -a /etc/hosts\ndscacheutil -flushcache # refresh /etc/hosts so the change apply immediately\n```\n\n```bash\ncurl \"http://greeter.go-micro.com/greeter?name=test\"\n\n{\"message\":\"Hello, test\"}\n```\n\n","tags":["Golang","Go-Micro","Kubernetes","Docker"],"categories":["Go-Micro"]},{"title":"Go-Micro æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸Šï¼‰","url":"/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸Šï¼‰/","content":"\n# é›¶ã€å‰è¨€\n\næœ¬ç¯‡æ–‡ç« å°‡ä½¿ç”¨ Go-Micro é€™å€‹ Golang Microservice Framework ä¾†å»ºç½®ä¸€å€‹æœ€åŸºç¤çš„å¾®æœå‹™ã€‚ä¸¦éƒ¨ç½²ä¸€å€‹ç°¡å–®çš„ HTTP API Server ä¾†ä½œç‚ºé©—è­‰ã€‚\n\né€™è£¡æœ‰ä¸€å€‹ç­†è€…ç•¶åˆä¸€ç›´è¢«æ··æ·†çš„éƒ¨åˆ†ï¼š\n\n- Go-Micro\n\n    [https://github.com/micro/go-micro](https://github.com/micro/go-micro)\n\n    æ˜¯ Go microservices development frameworkï¼Œç”¨ä¾†é–‹ç™¼å¾®æœå‹™ï¼Œæä¾› Authentication, Service Discovery, Message Encoding... å¾®æœå‹™æ‰€éœ€çš„åŠŸèƒ½ã€‚è€Œä¸”åŸºæœ¬ä¸Šæ‰€æœ‰çš„çµ„ä»¶éƒ½æ˜¯å¯ä»¥æŠ½æ›çš„ã€‚éå¸¸æ–¹ä¾¿ã€‚\n\n- Micro\n\n    [https://github.com/micro/micro](https://github.com/micro/micro)\n\n    æ˜¯ä¸€å€‹ CLIã€‚ä¸æ˜¯å¿…è¦çš„å¥—ä»¶ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆæ¨¡æ¿ã€é‹è¡Œæœå‹™ã€æŸ¥çœ‹æœå‹™ï¼Œmicro æ˜¯åŸºæ–¼ go-micro é–‹ç™¼çš„ï¼Œä½†æ­¤ç¯‡æ–‡ç« ä¸­ä¸æœƒä½¿ç”¨åˆ°ã€‚\n\nå¦å¤–ï¼Œç­†è€…ä¹‹é–‹ç™¼ç’°å¢ƒç‚º MacOS 10.15.7ã€‚\n\næœ¬ç¯‡æ–‡ç« çš„æ‰€æœ‰ç¨‹å¼ç¢¼éƒ½æ”¾åœ¨ Github ä¸Šï¼š[https://github.com/justin0u0/go-micro-demo](https://github.com/justin0u0/go-micro-demo)\n\nä¸‹ä¸€ç¯‡æ–‡ç« ï¼š[Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰](/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰)\n\n<!-- More -->\n\n---\n\n# ä¸€ã€ç’°å¢ƒå»ºç½®\n\n## ç’°å¢ƒä»‹ç´¹\n\n```markdown\n### Language\n- golang v1.14\n  - Gin v.1.6.3\n  - Go-micro v2.9.1\n\n### Container Orchestration\n- docker v19.03.13\n- docker-compose v1.27.4\n- kubernetes v1.18.3\n- minikube v1.12.3\n\n### Communication Protocal\n- Protobuf v3.13.0\n\n### Registry\n- etcd \n```\n\n## å®‰è£\n\n### Go\n\n[Download and install](https://golang.org/doc/install)\n\n```bash\n# macOS\nbrew install go\n\ngo version\n# go version go1.14.6 darwin/amd64\n```\n\n### Docker\n\nç”¨ä¾†æ‰“åŒ…å®Œæˆçš„å¾®æœå‹™ã€‚\n\n[Install Docker Desktop on Mac](https://docs.docker.com/docker-for-mac/install/)\n\n```bash\ndocker version\n\nClient: Docker Engine - Community\n Cloud integration  0.1.18\n Version:           19.03.13\n API version:       1.40\n Go version:        go1.13.15\n Git commit:        4484c46d9d\n Built:             Wed Sep 16 16:58:31 2020\n OS/Arch:           darwin/amd64\n Experimental:      false\n\nServer: Docker Engine - Community\n Engine:\n  Version:          19.03.13\n  API version:      1.40 (minimum version 1.12)\n  Go version:       go1.13.15\n  Git commit:       4484c46d9d\n  Built:            Wed Sep 16 17:07:04 2020\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          v1.3.7\n  GitCommit:        8fba4e9a7d01810a393d5d25a3621dc101981175\n runc:\n  Version:          1.0.0-rc10\n  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd\n docker-init:\n  Version:          0.18.0\n  GitCommit:        fec3683\n```\n\n### Docker-compose\n\nåœ¨ MacOS ä¸Šåªè¦å®‰è£å®Œ Docker Desktop for Macï¼Œå°±æœƒè‡ªå¸¶ `docker-compose` æŒ‡ä»¤ã€‚\n\n[Install Docker Compose](https://docs.docker.com/compose/install/)\n\n```bash\ndocker-compose version\n\ndocker-compose version 1.27.4, build 40524192\ndocker-py version: 4.3.1\nCPython version: 3.7.7\nOpenSSL version: OpenSSL 1.1.1g  21 Apr 2020\n```\n\n### Protobuf\n\nGo-Micro æ”¯æŒ http, tcp, grpc é€šè¨Šå”è­°ï¼›æ”¯æŒ json, protobuf, bytes ç­‰ç·¨ç¢¼æ–¹å¼ã€‚\n\nå…¶é è¨­çš„é€šè¨Šå”è­°ç‚º httpï¼Œç·¨ç¢¼æ–¹å¼ç‚º protobufã€‚\n\n[Releases Â· protocolbuffers/protobuf](https://github.com/protocolbuffers/protobuf/releases)\n\n```bash\n# macOS\nbrew install protobuf\n\nprotoc --version\n# libprotoc 3.13.0\n```\n\n### Kubernetes/Minikube\n\nåœ¨æœ¬åœ°ä¸Šèµ·ä¸€å€‹ Kubernetes çš„ç’°å¢ƒå…¶ä¸­ä¸€å€‹æ–¹å¼å°±æ˜¯å®‰è£ Minikubeã€‚\n\n[Install Minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/)\n\n```bash\n# macOS\nbrew install minikube\n```\n\n---\n\n# äºŒã€å¾®æœå‹™çš„æ§‹å»ºï¼Proto æ–‡ä»¶\n\næˆ‘å€‘é¦–å…ˆæƒ³è¦å®Œæˆä¸€å€‹æœ€ç°¡å–®çš„ Greeter æœå‹™ã€‚\n\nGreeter æœå‹™éœ€è¦çµ¦å…¶ä¸€å€‹ Nameï¼Œä¹‹å¾Œ Greeter æœƒå›æ‡‰ `Hello, {Name}`ã€‚\n\nåœ¨ Go-Micro ä¸­ï¼Œä½ éœ€è¦å…ˆå®šç¾©å¥½ Request, Response çš„ Interfaceï¼Œæ‰€ä»¥æˆ‘å€‘é¦–å…ˆè¦ç·¨å¯« Proto æ–‡ä»¶ã€‚\n\n## é–‹å•Ÿæ–°çš„ Project\n\n```bash\nmkdir go-micro-demo && cd go-micro-demo\nmkdir greeter-service && cd greeter-service\nexport GO111MODULE=\"on\"\ngo mod init greeter-service\n\nmkdir proto && vim proto/greeter.proto\n```\n\n## ç”Ÿæˆ Proto æ–‡ä»¶\n\n```go\n// greeter-service/proto/greeter.proto\n\nsyntax = \"proto3\";\n\npackage greeter;\noption go_package = \"proto;greeter\";\n\nservice Greeter {\n  // å®šç¾© API Interfaceï¼ŒGreet ç‚ºæ­¤ API çš„ Nameï¼Œ\n  // ä»£è¡¨ çµ¦ Greet API Request ç•¶åƒæ•¸ï¼Œä¸¦è¿”å› Response\n  rpc Greet(Request) returns (Response) {}\n}\n\n// Request éœ€è¦æ”œå¸¶ type ç‚º string çš„åƒæ•¸ name\nmessage Request {\n  string name = 1; // æ•¸å­—ä¸é‡è¤‡å³å¯\n}\n\n// Response æœƒè¿”å› type ç‚º string çš„åƒæ•¸ greeting\nmessage Response {\n  string greeting = 2; // æ•¸å­—ä¸é‡è¤‡å³å¯\n}\n```\n\nå®Œæˆå¾Œï¼Œæª”æ¡ˆç›®éŒ„æ‡‰è©²å¦‚ä¸‹ï¼š\n\n```bash\n.\nâ””â”€â”€ greeter-service\n    â”œâ”€â”€ go.mod\n    â””â”€â”€ proto\n        â””â”€â”€ greeter.proto\n```\n\n## ç”Ÿæˆ Go, Go-Micro æ–‡ä»¶\n\nå®Œæˆ Proto æª”æ¡ˆä¹‹å¾Œï¼Œæˆ‘å€‘éœ€è¦ protobuf å¹«æˆ‘å€‘ç”Ÿæˆéœ€è¦çš„ go æ–‡ä»¶ä»¥åŠ go-micro æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘å€‘éœ€è¦å®‰è£ `protoc-gen-go` ä»¥åŠ `protoc-gen-micro`ã€‚\n\n```go\ngo get -u github.com/golang/protobuf/protoc-gen-go\ngo get github.com/micro/micro/v2/cmd/protoc-gen-micro@master\n```\n\nGolang æœƒæŠŠæŒ‡ä»¤ä¸‹è¼‰åœ¨ `$GOPATH/bin` ä¹‹ä¸‹ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å°‡ `$GOPATH/bin` è¨­å®šåœ¨ `$PATH` ä¹‹ä¸‹ï¼š\n\n```bash\nexport PATH=\"$PATH:$(go env GOPATH)/bin\"\n```\n\nå®Œæˆå¾Œï¼Œæˆ‘å€‘å³å¯ä»¥åˆ©ç”¨ Protobuf å¹«æˆ‘å€‘ç”Ÿæˆéœ€è¦çš„æ–‡ä»¶ï¼š\n\n```bash\n# go_out file æœƒç”Ÿæˆåœ¨ go_out/proto\n# micro_out file æœƒç”Ÿæˆåœ¨ micro_out/proto\nprotoc -I . --go_out=. --micro_out=. ./proto/greeter.proto\n```\n\nå®Œæˆå¾Œï¼Œå¯ä»¥çœ‹åˆ° `protoc` å¹«æˆ‘å€‘ç”Ÿæˆçš„å…©å€‹ Go Fileã€‚\n\n```bash\n.\nâ”œâ”€â”€ go.mod\nâ””â”€â”€ proto\n    â”œâ”€â”€ greeter.pb.go\n    â”œâ”€â”€ greeter.pb.micro.go\n    â””â”€â”€ greeter.proto\n```\n\né€²åˆ° `greeter.pb.micro.go` æª”æ¡ˆï¼Œå¯ä»¥çœ‹åˆ°å…©æ®µè¨»è§£ï¼š\n\n```go\n// Client API for Greeter service\n// Server API for Greeter service\n```\n\næˆ‘å€‘éœ€è¦å¯¦ä½œçš„ Interface å³æ˜¯å®šç¾©åœ¨é€™é‚Šã€‚\n\n---\n\n# ä¸‰ã€å¾®æœå‹™çš„æ§‹å»ºï¼Go-Micro Server\n\n## Go-Micro çš„åŸºæœ¬ä»‹ç´¹\n\næœ‰äº†ä¸Šä¸€æ®µæ–‡ç« ç”Ÿæˆçš„ Go, Go-Micro æ–‡ä»¶ï¼Œæˆ‘å€‘å¯ä»¥é–‹å§‹ç·¨å¯« Go-Micro Serviceã€‚\n\né¦–å…ˆä¾†èªè­˜ Go-Micro é€™å€‹æ¡†æ¶ï¼š\n\n![](/assets/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸Šï¼‰/go-micro.png)\n\n- Serverï¼šç”¨æ–¼æ¥æ”¶è«‹æ±‚ï¼ŒServer æœƒå‘è¨»å†Šä¸­å¿ƒ(Registry)è¨»å†Šè‡ªå·±ã€‚\n- Clientï¼šç”¨æ–¼ç™¼é€è«‹æ±‚ï¼ŒClient æœƒå‘è¨»å†Šä¸­å¿ƒå°‹æ‰¾å·²ç¶“è¨»å†Šçš„æœå‹™ã€‚\n- Registryï¼šè¨»å†Šä¸­å¿ƒã€‚ç”¨æ–¼æœå‹™ç™¼ç¾ã€‚Go-Micro ç¾åœ¨é è¨­çš„è¨»å†Šä¸­å¿ƒç‚º mdnsï¼Œä½†æ˜¯ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ”¹è®Šä½ çš„è¨»å†Šä¸­å¿ƒã€‚å¯ä»¥ä½¿ç”¨çš„è¨»å†Šä¸­å¿ƒæœ‰ Consul, Etcd, Kubernetes, ZooKeeper...ã€‚æœ¬æ–‡æ‰€ç”¨çš„è¨»å†Šä¸­å¿ƒå³ç‚º Etcdã€‚\n- Codecï¼šè² è²¬è™•ç†å‚³è¼¸çš„ç·¨ç¢¼è§£ç¢¼ã€‚é è¨­ç‚º Protobufï¼Œä½†ä¹Ÿæ”¯æ´ JSON, BSON ç­‰ç­‰ã€‚\n- Transportï¼šè² è²¬è™•ç†æœå‹™èˆ‡æœå‹™ä¹‹é–“çš„åŒæ­¥/éŸ¿æ‡‰å‚³è¼¸ã€‚é è¨­ç‚º HTTPï¼Œæ”¯æ´ RabbitMQ, WebSockets, NATS..\n- Brokerï¼šè² è²¬è™•ç†æœå‹™çš„æ¶ˆæ¯ç™¼é€ã€è¨‚é–±ã€‚\n- Selectorï¼šè² è²¬åœ¨è¨»å†Šä¸­å¿ƒä¸­æŒ‘é¸ä¸€å€‹é©åˆçš„æœå‹™é€²è¡Œèª¿ç”¨ã€‚\n\n## æ’°å¯« Go-Micro æœå‹™\n\nç¹¼çºŒä¸Šä¸€ç¯‡çš„æ­¥é©Ÿï¼Œæˆ‘å€‘é–‹å§‹æ’°å¯« Go-Micro çš„ç¬¬ä¸€å€‹å¾®æœå‹™ã€‚\n\nå‰µå»ºä¸€å€‹ `main.go`ï¼Œå¦‚ä¸‹ï¼š\n\n```bash\n.\nâ””â”€â”€ greeter-service\n    â”œâ”€â”€ go.mod\n    â”œâ”€â”€ go.sum\n    â”œâ”€â”€ main.go # å…¥å£æ–‡ä»¶\n    â””â”€â”€ proto\n        â”œâ”€â”€ greeter.pb.go\n        â”œâ”€â”€ greeter.pb.micro.go\n        â””â”€â”€ greeter.proto\n```\n\n```go\npackage main\n\nimport (\n  \"github.com/micro/go-micro/v2\"\n  \"context\"\n  \"greeter-service/proto\" // replace greeter-service if you didn't name greeter-service when go mod init\n  \"log\"\n)\n\n// GreeterService ...\ntype GreeterService struct {}\n\n// Greet ... Implement interface left in proto/greeter.pb.micro.go server part\nfunc (g *GreeterService) Greet(ctx context.Context, req *greeter.Request, res *greeter.Response) error {\n  log.Println(\"Greeter service handle Greet\", req.Name)\n  res.Greeting = \"Hello, \" + req.Name\n  return nil\n}\n\nfunc main() {\n  service := micro.NewService(\n    micro.Name(\"micro.service.greeter\"), // The service name to register in the registry\n  )\n\n  service.Init()\n\n  // The 'RegisterGreeterHandler' is implement in the proto/greeter.pb.micro.go file\n  greeter.RegisterGreeterHandler(service.Server(), &GreeterService{})\n  \n  if err := service.Run(); err != nil {\n    log.Print(err.Error())\n    return\n  }\n}\n```\n\n## é‹è¡Œæœå‹™\n\nå®Œæˆå¾Œï¼Œæˆ‘å€‘è©¦è‘—é‹è¡Œ Greeter Serviceï¼š\n\n```bash\ncd greeter-service\ngo run .\n```\n\nçµæœç™¼ç”ŸéŒ¯èª¤ï¼š\n\n```bash\n# github.com/coreos/etcd/clientv3/balancer/resolver/endpoint\n/Users/justin/go/pkg/mod/github.com/coreos/etcd@v3.3.18+incompatible/clientv3/balancer/resolver/endpoint/endpoint.go:114:78: undefined: resolver.BuildOption\n/Users/justin/go/pkg/mod/github.com/coreos/etcd@v3.3.18+incompatible/clientv3/balancer/resolver/endpoint/endpoint.go:182:31: undefined: resolver.ResolveNowOption\n# github.com/coreos/etcd/clientv3/balancer/picker\n/Users/justin/go/pkg/mod/github.com/coreos/etcd@v3.3.18+incompatible/clientv3/balancer/picker/err.go:37:44: undefined: balancer.PickOptions\n/Users/justin/go/pkg/mod/github.com/coreos/etcd@v3.3.18+incompatible/clientv3/balancer/picker/roundrobin_balanced.go:55:54: undefined: balancer.PickOptions\n```\n\n[ä¼¼ä¹æ˜¯ grpc ç‰ˆæœ¬å•é¡Œ](https://github.com/etcd-io/etcd/issues/11563#issuecomment-580196860)ï¼Œæˆ‘å€‘åœ¨ `go.mod` åŠ ä¸Šä¸‹é¢é€™è¡Œï¼š\n\n```go\nreplace google.golang.org/grpc => google.golang.org/grpc v1.26.0\n```\n\nå†åŸ·è¡Œä¸€æ¬¡ï¼š\n\n```bash\ngo run .\n\n2020-10-06 15:52:23  file=v2@v2.9.1-0.20200723075038-fbdf1f2c1c4c/service.go:211 level=info Starting [service] micro.service.greeter\n2020-10-06 15:52:23  file=grpc/grpc.go:887 level=info Server [grpc] Listening on [::]:57713\n2020-10-06 15:52:23  file=grpc/grpc.go:718 level=info Registry [mdns] Registering node: micro.service.greeter-8990d2fe-d477-4e61-a5b3-152d846cb488\n```\n\nå¯ä»¥çœ‹åˆ°é€™æ™‚å€™ Server å·²ç¶“é‹è¡Œåœ¨ 57713 é€™å€‹ Portï¼ˆè€Œä½ çš„ä¸ä¸€å®šæœƒåœ¨ 57713ï¼‰ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æ­¤ Server è¢« register åˆ°é è¨­çš„ registry mdns ä¹‹ä¸­ã€‚ä½†æ˜¯ç”±æ–¼æ˜¯ RPC Serverï¼Œæ‰€ä»¥é‚„æ²’æœ‰è¾¦æ³•ä½¿ç”¨é¡ä¼¼ Postman çš„æ–¹å¼é€²è¡Œç°¡å–®çš„æ¸¬è©¦ã€‚\n\nä¸‹ä¸€æ®µæ–‡ä¸­ï¼Œæˆ‘å€‘æœƒå¯«ä¸€å€‹ Client ä¾†å°æ­¤ Server é€²è¡Œæ¸¬è©¦ã€‚\n\n---\n\n# å››ã€å¾®æœå‹™çš„æ§‹å»ºï¼Go-Micro Client\n\nä¸Šä¸€æ®µæ–‡ç« ä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨äº† Protobuf æ‰€ç”¢ç”Ÿå‡ºä¾†çš„ Go, Go-Micro æ–‡ä»¶æˆåŠŸèµ·èµ·äº†ä¸€å€‹ RPC Serverã€‚\n\næœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘æœƒåˆ©ç”¨ Gin æ¡†æ¶ï¼Œå®Œæˆæˆ‘å€‘çš„ API Serverï¼Œä¹Ÿå°±æ˜¯å¾®æœå‹™çš„å…§éƒ¨æºé€šä½¿ç”¨ RPCï¼Œè€Œå°å¤–ä½¿ç”¨ HTTPã€‚\n\n## é–‹å•Ÿæ–°çš„è³‡æ–™å¤¾\n\n\n[https://github.com/gin-gonic/gin](https://github.com/gin-gonic/gin)\n\næˆ‘å€‘æƒ³è¦ç•¶ HTTP å° `/greeter` ç™¼èµ· GET Requestï¼Œä¸¦æ”œå¸¶ `name` ç‚ºåƒæ•¸æ™‚ï¼Œè¿”å›ä¸€å€‹ JSON æ ¼å¼çš„ Responseã€‚\n\né¦–å…ˆï¼Œæœ€å¾Œéƒ¨ç½²çš„æ™‚å€™ Server èˆ‡ Client æœƒåˆ†åˆ¥åœ¨å…©å€‹ Container/Pod è£¡é¢ï¼Œå› æ­¤æˆ‘å€‘å…ˆé–‹ä¸€å€‹æ–°çš„è³‡æ–™å¤¾ï¼Œä¸¦å°‡ `greeter-service` ä¸­çš„ `proto` è³‡æ–™å¤¾è¤‡è£½åˆ° Client ä¸­ã€‚\n\n```bash\nmkdir greeter-api && cd greeter-api\nexport GO111MODULE=\"on\"\ngo mod init greeter-api\ncp -r ../greeter-service/proto .\n```\n\nå®Œæˆå¾Œç›®éŒ„çµæ§‹æ‡‰è©²ç‚ºä¸‹ï¼š\n\n```bash\n.\nâ”œâ”€â”€ greeter-api\nâ”‚Â Â  â”œâ”€â”€ go.mod\nâ”‚Â Â  â””â”€â”€ proto\nâ”‚Â Â      â”œâ”€â”€ greeter.pb.go\nâ”‚Â Â      â”œâ”€â”€ greeter.pb.micro.go\nâ”‚Â Â      â””â”€â”€ greeter.proto\nâ””â”€â”€ greeter-service\n    â”œâ”€â”€ go.mod\n    â”œâ”€â”€ go.sum\n    â”œâ”€â”€ main.go\n    â””â”€â”€ proto\n        â”œâ”€â”€ greeter.pb.go\n        â”œâ”€â”€ greeter.pb.micro.go\n        â””â”€â”€ greeter.proto\n```\n\n## é–‹å§‹æ’°å¯« API\n\né¦–å…ˆï¼Œå¯¦ä½œä¸€å€‹ RPC Clientï¼š\n\n```bash\nmkdir client && cd client\nvim greet.go\n```\n\n```go\n// greeter-api/client/greet.go\n\npackage client\n\nimport (\n  \"context\"\n  \"github.com/micro/go-micro/v2\"\n  \"github.com/gin-gonic/gin\"\n  \"greeter-api/proto\"\n  \"log\"\n)\n\nvar client greeter.GreeterService\n\n// Init ... In the main function, you should call Init() first,\n// so the 'client' defined above can be initialized.\nfunc Init() {\n  service := micro.NewService(\n    micro.Name(\"micro.client.greeter\"),\n  )\n\n  service.Init()\n\n  // NewGreeterService is defined at proto/greeter.pb.micro.go file,\n  // \"micro.service.greeter\" should match the name you defined in the server part.\n  client = greeter.NewGreeterService(\"micro.service.greeter\", service.Client())\n}\n\n// Greet ...\nfunc Greet(ctx *gin.Context) {\n  name := ctx.Query(\"name\") // ctx.Query will return the GET request query string\n  log.Println(\"Client handle Greet, name =\", name)\n\n  // Client request the RPC server for response\n  res, err := client.Greet(context.TODO(), &greeter.Request{Name: name})\n  if err != nil {\n    log.Print(err.Error())\n    // return with 400 error code and error message\n    ctx.JSON(400, gin.H{\"message\": \"server error\"})\n    return\n  }\n\n  // return 200 success code and the response from server\n  ctx.JSON(200, gin.H{\"message\": res.Greeting})\n}\n```\n\nå®Œæˆ `Greet` å‡½æ•¸å¾Œï¼Œæˆ‘å€‘å¯ä»¥å®šç¾© Gin çš„ Router å¦‚ä¸‹ï¼š\n\n```bash\nmkdir router && cd router\nvim router.go\n```\n\n```go\n// greeter-api/router/router.go\n\npackage router\n\nimport (\n  \"github.com/gin-gonic/gin\"\n  \"greeter-api/client\"\n)\n\n// NewRouter ...\nfunc NewRouter() *gin.Engine {\n  route := gin.Default()\n  \n  // When GET /greeter, handle the request with the Greet function we create above\n  route.GET(\"/greeter\", client.Greet)\n  return route\n}\n```\n\næœ€å¾Œç·¨å¯«å…¥å£æ–‡ä»¶ï¼š\n\n```go\n// greeter-api/main.go\n\npackage main\n\nimport (\n  \"greeter-api/router\"\n  \"greeter-api/client\"\n  \"log\"\n)\n\nfunc main() {\n  // Remember to call the Init() function to initialize the go-micro client service\n  client.Init()\n  \n  // Start Gin Router at port 3000\n  r := router.NewRouter()\n  if err := r.Run(\"0.0.0.0:3000\"); err != nil {\n    log.Print(err.Error())\n  }\n}\n```\n\nå®Œæˆå¾Œï¼Œæª”æ¡ˆç›®éŒ„çµæ§‹æ‡‰è©²å¦‚ä¸‹ï¼š\n\n```bash\n.\nâ”œâ”€â”€ greeter-api\nâ”‚Â Â  â”œâ”€â”€ client\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ greet.go\nâ”‚Â Â  â”œâ”€â”€ go.mod\nâ”‚Â Â  â”œâ”€â”€ go.sum\nâ”‚Â Â  â”œâ”€â”€ main.go\nâ”‚Â Â  â”œâ”€â”€ proto\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ greeter.pb.go\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ greeter.pb.micro.go\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ greeter.proto\nâ”‚Â Â  â””â”€â”€ router\nâ”‚Â Â      â””â”€â”€ router.go\nâ””â”€â”€ greeter-service\n    â”œâ”€â”€ go.mod\n    â”œâ”€â”€ go.sum\n    â”œâ”€â”€ main.go\n    â””â”€â”€ proto\n        â”œâ”€â”€ greeter.pb.go\n        â”œâ”€â”€ greeter.pb.micro.go\n        â””â”€â”€ greeter.proto\n```\n\n## é‹è¡Œæœå‹™\n\nè©¦è‘—åŸ·è¡Œ API Serviceï¼š\n\nè¨˜å¾—ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ Server ä¹Ÿè¦è·‘å–”ï½\n\n```bash\ngo run .\n\n[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.\n\n[GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n - using env:\texport GIN_MODE=release\n - using code:\tgin.SetMode(gin.ReleaseMode)\n\n[GIN-debug] GET    /greeter                  --> greeter-api/client.Greet (3 handlers)\n[GIN-debug] Listening and serving HTTP on 0.0.0.0:3000\n```\n\næ¸¬è©¦ API Serverï¼š\n\n```bash\ncurl \"http://localhost:3000/greeter?name=test\"\n\n{\"message\":\"Hello, test\"}\n```\n\n---\n\nä¸‹ä¸€ç¯‡æ–‡ç« ï¼š[Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰](/Go-Micro-æ‰‹æŠŠæ‰‹å¾é–‹ç™¼åˆ°éƒ¨ç½²ï¼ˆä¸‹ï¼‰)\n","tags":["Golang","Go-Micro","Kubernetes","Docker"],"categories":["Go-Micro"]},{"title":"Service mesh æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹--å¾®æœå‹™ä¸­çš„ TCP","url":"/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/","content":"\n# Service Mesh\n\næ­¤ç¯‡æ–‡ç« ç‚ºåƒè€ƒ Phil CalÃ§ado æ‰€å¯«ä¹‹ Pattern: Service Meshï¼Œçµåˆä¸€äº›è‡ªå·±çš„æƒ³æ³•æ‰€å¯«ä¸‹ã€‚åœ–ç‰‡çš†ä¾†è‡ªå…¶æ–‡ç« ã€‚\n\n## åŸå§‹é€šè¨Šæ™‚ä»£\n\nåœ¨äººå€‘å‰›é–‹å§‹æ¥è§¸ç¶²è·¯æ™‚ï¼Œå…©å°æ©Ÿå™¨ä¹‹é–“çš„æºé€šå¯ä»¥è¢«æƒ³åƒæˆä¸‹åœ–ï¼š\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled.png)\n\nä½†æ¼¸æ¼¸çš„æœƒç™¼ç¾ï¼Œæ©Ÿå™¨èˆ‡æ©Ÿå™¨ä¹‹é–“çš„æºé€šå¯èƒ½æœƒå‡ºç¾è³‡æ–™éºå¤±ã€é‡è©¦ç­‰å•é¡Œï¼Œå› æ­¤éœ€è¦æ›´è¤‡é›œçš„é‚è¼¯ä¾†è™•ç†æ©Ÿå™¨ä¹‹é–“çš„æºé€šã€‚\n\n<!-- More -->\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%201.png)\n\nç•¶æ©Ÿå™¨è¶Šä¾†è¶Šæ™®åŠï¼Œå·¥ç¨‹å¸«å€‘é–‹å§‹æ€è€ƒå¦‚ä½•è§£æ±ºå¤šå€‹é€£ç·šã€è³‡æ–™åŠ å¯†ã€æœå‹™ç™¼ç¾ç­‰å•é¡Œï¼Œä»¥å¯¦ç¾ä¸€å€‹ Network Systemã€‚å› æ­¤æ©Ÿå™¨é–‹å§‹éœ€è¦å¯¦ç¾ä¸€å€‹åç‚º `Flow Control` çš„é‚è¼¯ï¼Œç”¨ä¾†ç¢ºèªå‚³è¼¸çš„é€Ÿåº¦ä¸æœƒå¤§æ–¼æ¥æ”¶çš„é€Ÿåº¦ã€è™•ç†ç¶²è·¯å‚³è¼¸çš„è³‡æ–™éºå¤±ã€è³‡æ–™åŠ å¯†ç­‰ç­‰å•é¡Œã€‚å› æ­¤ï¼Œæœå‹™ä¸­é™¤äº†å¯¦ç¾ Business Logicï¼Œé‚„é–‹å§‹éœ€è¦å¯¦ç¾ `Flow Control`ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%202.png)\n\nServices need to implement both business logic & flow control.\n\nç‚ºäº†é¿å…æ¯å€‹æœå‹™éƒ½è¦è‡ªå·±å¯¦è¸ä¸€å€‹ç¶²è·¯å‚³è¼¸è™•ç†çš„é‚è¼¯ï¼ŒTCP/IP å”è­°å‡ºç¾äº†ã€‚TCP/IP è§£æ±ºäº†ç¶²è·¯å‚³è¼¸çš„å•é¡Œï¼Œå°‡æœå‹™ä¸­çš„ Flow Control æŠ½è±¡å‡ºä¾†ï¼Œæˆç‚ºç¶²è·¯å±¤çš„ä¸€éƒ¨åˆ†ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%203.png)\n\n---\n\n## å¾®æœå‹™æ™‚ä»£\n\n\nTCP/IP ä½œç‚ºæ©Ÿå™¨ä¹‹é–“çš„æºé€šç•¶ç„¶é‚„æ˜¯ä¸€å€‹å¥½çš„å·¥å…·ï¼Œç„¶è€Œå¾®æœå‹™ä¸­çš„æœå‹™ç™¼ç¾ã€ç†”æ–·æ©Ÿåˆ¶ç­‰ï¼Œåœ¨ TCP/IP ä¸­éƒ½ä¸¦æ²’æœ‰è¢«å¯¦ç¾ã€‚\n\n**æœå‹™ç™¼ç¾**ï¼š\nåœ¨å–®é«”å¼æœå‹™ä¸­ï¼Œæœå‹™é‹è¡Œåœ¨åŒä¸€å€‹ Process ä¸‹ï¼Œæœå‹™ç™¼ç¾å¯ä»¥è¼•æ˜“çš„åšåˆ°ã€‚\nè¦å­˜å–å…¶ä»–çš„æœå‹™ä¹Ÿèƒ½é€é DNSã€Load Balancerã€Port Number ä¾†å–å¾—ã€‚\nåˆ†æ•£å¼æ¶æ§‹ä¸­ï¼Œæœå‹™åˆ†æ•£åœ¨ä¸åŒçš„æ©Ÿå™¨ä¸Šï¼Œå› æ­¤éœ€è¦æœ‰ä¸€å€‹æ–¹æ³•ä¾†æ‰¾åˆ°è¦å­˜å–çš„æœå‹™ã€‚\n[https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/](https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/)\n\n**ç†”æ–·æ©Ÿåˆ¶**ï¼š\nå¾®æœå‹™ä¸­ä¸€å€‹æœå‹™è¦å­˜å–å…¶ä»–æœå‹™çš„è³‡æ–™ï¼Œä¾‹å¦‚ï¼Œæœå‹™ A è¦å­˜å–æœå‹™ Bï¼Œæœå‹™ B è¦å­˜å–æœå‹™ Cï¼Œè‹¥æœå‹™ C è™•åœ¨ä¸å¯é‹è¡Œçš„ç‹€æ…‹ï¼Œè€Œå°è‡´æœå‹™ B ä¸æ–·çš„ç­‰å¾…æœå‹™ Cï¼Œå°‡å°è‡´æœå‹™ B æœ€çµ‚ç„¡æ³•è² è·è€Œå´©æ½°ï¼Œè€Œæœå‹™ B çš„å´©æ½°åˆæœƒå°è‡´æœå‹™ A çš„å´©æ½°ï¼Œå› æ­¤ç”¢ç”Ÿ**é›ªå´©æ•ˆæ‡‰**ã€‚**ç†”æ–·æ©Ÿåˆ¶**ï¼Œç•¶æœå‹™ B ç™¼ç¾æœå‹™ C ä¸å¯ç”¨æ™‚ï¼Œè‡ªå‹•çµ‚æ­¢å…¶è³‡æ–™è«‹æ±‚ä¸¦å›å‚³éŒ¯èª¤ï¼Œå› ç‚ºæœå‹™ C æœ‰å¯èƒ½åœ¨æŸå€‹æ™‚é–“é»æ¢å¾©é‹è¡Œï¼Œå› æ­¤æœå‹™ B æœƒå°æœå‹™ C å®šæœŸçš„å˜—è©¦å–å¾—å›æ‡‰ã€‚\n[https://microservices.io/patterns/reliability/circuit-breaker.html](https://microservices.io/patterns/reliability/circuit-breaker.html)\n\nå› æ­¤æ­·å²é‡æ¼”ï¼Œå„å€‹æœå‹™é–‹å§‹å¯¦ç¾è‡ªå·±çš„æœå‹™ç™¼ç¾ã€ç†”æ–·æ©Ÿåˆ¶é‚è¼¯ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%204.png)\n\nå„å€‹æœå‹™éƒ½è¦å¯¦ç¾è‡ªå·±çš„æœå‹™ç™¼ç¾ã€ç†”æ–·æ©Ÿåˆ¶ç­‰é‚è¼¯éæ–¼éº»ç…©ã€‚å› æ­¤ï¼Œé–‹å§‹æœ‰ Library çš„å‡ºç¾ä¾†å¯¦ç¾é€™é¡é‚è¼¯ã€‚ä¾‹å¦‚ï¼š[Twitter's Finagle](https://finagle.github.io/blog/)ã€[Facebook's Proxygen](https://github.com/facebook/proxygen)ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%205.png)\n\nç„¶è€Œï¼Œä½¿ç”¨ Library ä¹Ÿæœ‰ä¸€äº›å•é¡Œå­˜åœ¨ï¼š\n\n1. å‡½å¼åº«å¯¦ç¾äº†ç´°ç¯€ï¼Œåœ¨å¯¦éš›æ‡‰ç”¨ä¸­è®Šæ›´é›£ä»¥è¿½è¹¤ã€è§£æ±ºæ¡†æ¶å‡ºç¾çš„å•é¡Œã€‚\n2. å‡½å¼åº«é™åˆ¶äº†èªè¨€ï¼Œç„¶è€Œå¾®æœå‹™æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯ã€Œèˆ‡èªè¨€ç„¡é—œã€ã€‚\n3. å‡½å¼åº«çš„å‡ç´šã€æ¸¬è©¦ã€éƒ¨ç½²éƒ½æœƒéœ€è¦å·¥ç¨‹å¸«èŠ±æ™‚é–“ä¾†ç ”ç©¶ã€‚\n\n---\n\n## Service Mesh\n\nè¦æ”¹è®Šç¶²è·¯çš„å‚³è¼¸å”è­°æ˜¯å›°é›£çš„ï¼Œå› æ­¤ Sidecar çš„æ¨¡å¼è¢«æå‡ºï¼ŒSidecar ç‚ºä¸€å€‹ Proxyï¼Œåœ¨ Sidecar ä¸­æŠ½è±¡äº†è² è¼‰å¹³è¡¡ã€æœå‹™ç™¼ç¾ã€èªè­‰æˆæ¬Šã€æµé‡æ§åˆ¶å„ç¨®åˆ†æ•£å¼æœå‹™æ‰€éœ€è¦çš„é‚è¼¯ã€‚é€éä»£ç†çš„æ–¹å¼ä¾†å®Œæˆæœå‹™èˆ‡æœå‹™ä¹‹é–“çš„æºé€šã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%206.png)\n\nå„ç¨® Sidecar çš„å¯¦ç¾é–‹å§‹å‡ºç¾ï¼Œä¾‹å¦‚ï¼š[Linkerd](https://linkerd.io/2016/02/18/linkerd-twitter-style-operability-for-microservices/)ã€[Envoy](https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191?gi=41e38b4401fe) ç­‰ç­‰ã€‚\n\næ¯å€‹æœå‹™æ—éƒ½æœ‰ä¸€å€‹ Sidecar ä¾†è¼”åŠ©èˆ‡å…¶ä»–æœå‹™çš„æºé€šï¼Œå…¨å±€åœ–çœ‹èµ·ä¾†å¦‚ä¸‹ã€‚ç¶ è‰²çš„å³ç‚ºæœå‹™ï¼Œè€Œè—è‰²çš„éƒ¨åˆ†å³ç‚ºæ‰€è¬‚çš„ **Service Mesh æœå‹™ç¶²æ ¼**ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%207.png)\n\nKubernetes çš„å‡ºç¾ï¼Œè®“æ›´å¤šä¼æ¥­ã€ä½¿ç”¨è€…é—œæ³¨ä¸¦ä½¿ç”¨ Service Mesh çš„æœå‹™ã€‚å› æ­¤ï¼Œä¸€å€‹ Sidecar çš„æ§åˆ¶é¢æ¿å‡ºç¾ï¼Œç”¨ä¾†å¯¦ç¾æ›´å¥½çš„ Service Mesh ç®¡æ§ã€‚è€Œ [Istio](https://istio.io/) å³ç‚ºæœ€ä½³ä»£è¡¨ã€‚\n\n![](/assets/Service-mesh-æœå‹™ç¶²æ ¼ä¹‹ä»‹ç´¹-å¾®æœå‹™ä¸­çš„-TCP/Untitled%208.png)\n\n![](service-mesh/Untitled%209.png)\n\n# çµè«–\n\n---\n\nService mesh æ­¤è©çš„ç™¼æ˜äºº William Morgan å° **Service Mesh** çš„å®šç¾©å¦‚ä¸‹ï¼š\n**A service mesh is a dedicated infrastructure layer for handling service-to-service communication. Itâ€™s responsible for the reliable delivery of requests through the complex topology of services that comprise a modern, cloud native application. In practice, the service mesh is typically implemented as an array of lightweight network proxies that are deployed alongside application code, without the application needing to be aware.**\n\nå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä¸‰å€‹é‡é»ï¼š\n\n1. **Infrastructure layer, through the complex topology of services**\n    åŸºç¤è¨­æ–½å±¤ï¼‹æ‹“æ¨¸ä¸­ç©¿æ¢­ã€‚å¯ä»¥çŸ¥é“ Service Mesh çš„å®šç¾©å³ç‚º**å¾®æœå‹™ä¸­çš„ TCP**ï¼\n2. **Network proxies**\n    ç¶²è·¯ä»£ç†å³ç‚º Service Mesh çš„å¯¦ç¾æ–¹å¼ã€‚\n3. **Without the application needing to be aware**\n    Service Mesh ä¸­è¦è§£æ±ºæœ€é‡è¦çš„å•é¡Œï¼Œå°±æ˜¯è®“é–‹ç™¼äººå“¡ä¸ç”¨å†å»æ€è€ƒä¸€åˆ‡é—œæ–¼æœå‹™æºé€šçš„å•é¡Œï¼\n\n# åƒè€ƒè³‡æ–™\n[Pattern: Service Mesh](https://philcalcado.com/2017/08/03/pattern_service_mesh.html)\n","tags":["Kubernetes","Istio","Service mesh"],"categories":["Kubernetes"]},{"title":"å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦ - keybr.com","url":"/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/","content":"\n# ç‚ºä»€éº¼è¦ç·´ç¿’æ‰“å­—ï¼Ÿ\n\nåœ¨ç§‘æŠ€ä¸æ–·çš„é€²æ­¥ä¸‹ï¼Œé›»è…¦å·²ç¶“æˆç‚ºäººå€‘ä¸å¯æˆ–ç¼ºçš„å·¥å…·ï¼Œè€Œä½¿ç”¨é›»è…¦ä¸å¤–ä¹å°±è¦ä½¿ç”¨éµç›¤æ‰“å­—ã€‚ç•¶ä½ é‚„åœ¨ç”¨ä¸€æŒ‡ç¥åŠŸï¼Œçœ¼ç›ç›¯è‘—éµç›¤æ…¢æ…¢çš„å°æ‡‰éµç›¤ä½ç½®ï¼Œæ‰“å­—å¿«çš„äººå¯èƒ½å·²ç¶“æ‰“å®Œä¸€å€‹æ®µè½çš„æ–‡ç« äº†ã€‚è€Œè‹±æ‰“å°æ–¼å·¥ç¨‹å¸«ä¾†èªªï¼Œæ›´æ˜¯ä¸€é …é‡è¦ç„¡æ¯”çš„æŠ€èƒ½ã€‚å·¥ç¨‹å¸«æ¯å¤©é¢å°æˆåƒä¸Šè¬è¡Œçš„ç¨‹å¼ç¢¼ï¼Œæ‰“å­—é€Ÿåº¦æ…¢ç°¡ç›´æœƒè¦äº†ä½ çš„å‘½ã€‚æ‰€ä»¥ä»Šå¤©ç­†è€…è¦ä¾†ä»‹ç´¹ç·´ç¿’è‹±æ‰“çš„å¥½è™•ï¼Œä»¥åŠè‡ªå·±æ˜¯å¦‚ä½•é€éç¶²ç«™ **[keybr.com](https://keybr.com)**ï¼Œåœ¨çŸ­çŸ­ä¸€æ˜ŸæœŸå°±ç¿»å€äº†è‡ªå·±çš„æ‰“å­—é€Ÿåº¦ã€‚\n\n<!-- More -->\n\n# ç·´ç¿’æ‰“å­—çš„å¥½è™•\n\nç·´ç¿’æ‰“å­—èƒ½ç‚ºä½ å¸¶ä¾†çš„å¥½è™•ä¸å‹æšèˆ‰ï¼š\n\n1. ç¯€çœæ™‚é–“ï¼š\n   ç·´ç¿’æ‰“å­—æœ€å¤§çš„å¥½è™•ç•¶ç„¶å°±æ˜¯èƒ½æå‡ä½ çš„æ‰“å­—é€Ÿåº¦ã€‚è‹¥ä½ åŸæœ¬çš„æ‰“å­—é€Ÿåº¦ç‚º 30 WHM(Word Per Second)ï¼Œè€Œä½ åœ¨ä¸€å€‹æ˜ŸæœŸå…§æ¯å¤©èŠ± 30 åˆ†é˜ç·´ç¿’æ‰“å­—ï¼Œå°‡ä½ çš„æ‰“å­—é€Ÿåº¦æå‡åˆ° 60 WHMã€‚å‰‡ä»»ä½•æ‰“å­—ç›¸é—œçš„å·¥ä½œï¼Œä½ éƒ½èƒ½èŠ±è²»ä¸€åŠçš„æ™‚é–“å®Œæˆã€‚\n   æ ¹æ“šç¶²è·¯ä¸Šçš„è³‡æ–™ï¼Œé›»è…¦ä½¿ç”¨è€…çš„å¹³å‡è‹±æ‰“é€Ÿåº¦ç‚º 40 WHMï¼Œä¹Ÿå°±æ˜¯ä»»ä½•éœ€è¦æ‰“å­—çš„å·¥ä½œï¼Œä½ éƒ½èƒ½åœ¨å…¶ä»–äººçš„ä¸‰åˆ†ä¹‹äºŒæ™‚é–“å…§å®Œæˆï¼æ˜¯ä¸æ˜¯å¾ˆæœ‰å¸å¼•åŠ›ï¼\n\n2. æå‡æº–ç¢ºåº¦ï¼š\n   ç·´ç¿’æ‰“å­—ä¹Ÿèƒ½æå‡ä½ çš„æº–ç¢ºç‡ã€‚æ‰“å­—çš„æº–ç¢ºç‡æé«˜äº†ï¼Œæ‰€éœ€è¦èŠ±è²»åœ¨æª¢æŸ¥æœ‰æ²’æœ‰éŒ¯å­—çš„æ™‚é–“å°±è®Šå°‘äº†ã€‚\n  \n3. æå‡å°ˆæ³¨åº¦ï¼š\n   é‚„åœ¨ç›¯è‘—éµç›¤æ‰“å­—å—ï¼Ÿé€™æ™‚ä½ çš„å¤§è…¦é‚„è¦å¹«ä½ æ€è€ƒå“ªä¸€å€‹éµåœ¨å“ªä¸€å€‹ä½ç½®ï¼Œæ˜¯ä¸æ˜¯å¤ªæ¶ˆè€—è…¦åŠ›äº†ï¼Ÿæ­£ç¢ºçš„æ‰“å­—å§¿å‹¢é…åˆä¸€æ®µæ™‚é–“çš„ç·´ç¿’ï¼Œä½ çš„è‚Œè‚‰æœƒç‚ºä½ è¨˜ä½æ‰€æœ‰æŒ‰éµçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ‰€è¬‚ã€Œè‚Œè‚‰è¨˜æ†¶ã€ã€‚ä¸ç”¨æ€è€ƒæŒ‰éµçš„ä½ç½®ï¼Œä½ èƒ½çœ‹è‘—è¢å¹•æ‰“å­—ï¼Œå¯ä»¥çœ‹è‘—æ–‡ç« ï¼Œç”šè‡³çœ‹è‘—ç¶²å€ä¹Ÿèƒ½æ‰“å­—ï¼Œå°ˆæ³¨åŠ›å¤§å¹…æå‡åœ¨åŸæœ¬æ‡‰è©²è¦åšçš„äº‹æƒ…ä¸Šï¼Œçœ‹èµ·ä¾†ä¹Ÿæ›´å°ˆæ¥­ï¼\n\n4. å¥åº·ï¼š\n   èƒ½å¤ çœ‹è‘—è¢å¹•æ‰“å­—ä¹Ÿèƒ½å°ä½ èº«é«”çš„å¥åº·å¸¶ä¾†å¥½è™•ï¼Œä½¿ç”¨é›»è…¦çš„æ­£ç¢ºå§¿å‹¢å°±æ˜¯çœ¼ç›è¦èƒ½å¹³è¦–è¢å¹•çš„ä¸Šç·£ã€‚é•·æ™‚é–“ä¸æ–·ä½é ­çœ‹è‘—éµç›¤æ‰“å­—æœƒå°ä½ çš„é ¸æ¤é€ æˆå‚·å®³ã€‚\n\n# å¦‚ä½•å¿«é€Ÿçš„æå‡è‹±æ‰“é€Ÿåº¦ - keybr.com\n\n**[keybr.com](https://keybr.com)** æ˜¯ä¸€å€‹ç·šä¸Šã€å…è²»çš„æ‰“å­—ç·´ç¿’ç¶²ç«™ã€‚æœ‰è‘—ä¹¾æ·¨ç°¡æ½”çš„é é¢ã€ç‰¹åˆ¥çš„ *current key* åŠŸèƒ½å’Œç™»å…¥åŠŸèƒ½ã€‚\n\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-intro-more.png)\n\n**keybr.com** åœ¨ä¸€é–‹å§‹æœƒæœ‰ä¸€å€‹ *current key* ä»£è¡¨é€™æ¬¡è¦ç·´ç¿’çš„ä¸»è¦å­—æ¯ç‚º `e`ï¼Œæ‰€ä»¥å¯ä»¥ç™¼ç¾ä¸‹æ–¹çš„å–®è©ä¸­æ¯ä¸€å€‹å–®å­—è£¡é¢éƒ½æœ‰å­—æ¯ `e`ã€‚**keybr.com** å°±æ˜¯åˆ©ç”¨æ­¤æ©Ÿåˆ¶è®“ä½ ä¸æ–·çš„æ‰“å‡ºè¦ç·´ç¿’çš„å­—æ¯ï¼Œç›´åˆ°æ‰€æœ‰å­—æ¯éƒ½ç†Ÿç·´ç‚ºæ­¢ã€‚\n\nåœ¨ç¬¬ä¸€æ¬¡æ‰“å®Œå¥å­å¾Œï¼Œæœƒçœ‹åˆ°ä»¥ä¸‹ç•«é¢ï¼š\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-first-type.png)\n\n**æ³¨æ„ï¼šä¸€é–‹å§‹æ‰“å­—æ™‚ï¼Œå¯èƒ½æœƒç™¼ç¾ä¸ç”¨æ­£ç¢ºçš„æ‰“å­—å§¿å‹¢æ‰“å­—å¥½åƒé€Ÿåº¦é‚„æ¯”è¼ƒå¿«ï¼Œä½†ç­†è€…å¼·çƒˆå»ºè­°ä¸€å®šè¦å¼·è¿«è‡ªå·±ä½¿ç”¨æ­£ç¢ºçš„æ‰“å­—å§¿å‹¢ï¼Œä¸¦è®“è‡ªå·±ä¸è¦ç›¯è‘—éµç›¤çœ‹ã€‚ä¸€é–‹å§‹é€Ÿåº¦å¯èƒ½æœƒä¸‹æ»‘è¨±å¤šï¼Œä½†æ˜¯å°æœ€å¾Œçš„æˆæ•ˆæ˜¯æœ€å¤§çš„ã€‚**\n\n# ç­†è€…çš„æˆæ•ˆ\n\nç™»å…¥å¾Œï¼Œkeybr.com å³èƒ½ç‚ºä½ ç´€éŒ„ä½ çš„æ‰“å­—æˆæ•ˆã€‚ç­†è€…çš„æˆæ•ˆå¦‚ä¸‹ï¼š\n\n[https://www.keybr.com/profile/m5k3q8s](https://www.keybr.com/profile/m5k3q8s)\n\nå¯ä»¥çœ‹åˆ°ç­†è€…åœ¨ç¬¬ä¸€å¤©é–‹å§‹ç·´ç¿’ï¼ˆ4/6) åˆ°å…©é€±å¾Œçš„ (4/22)ï¼Œæ‰“å­—é€Ÿåº¦å³å¾ 30 WHM æå‡åˆ°äº† 60 WHMã€‚\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-first-day.jpg)\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-a-week.jpg)\n\nä¸€æ—¦é–‹å§‹ç·´ç¿’ï¼Œé™¤äº†ä¸€é–‹å§‹çŸ¯æ­£å§¿å‹¢çš„é™£ç—›æœŸï¼Œå¾ˆå¿«çš„æ‰“å­—é€Ÿåº¦å°±æœƒç›´ç·šä¸Šå‡ã€‚ç­†è€…çš„æ‰“å­—é€Ÿåº¦å¾ 30 WHM åˆ°ç¾åœ¨ç©©å®šèƒ½å¤  80 WHMï¼Œç¸½å…±ä¹ŸåªèŠ±äº†ç´„ 5 å€‹å°æ™‚çš„æ™‚é–“ã€‚\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-graph.png)\n\n![](/assets/å¿«é€Ÿæå‡ä½ çš„è‹±æ‰“æ‰“å­—é€Ÿåº¦-keybr-com/keybr-total.png)\n\næœ€å¾Œï¼Œæ„Ÿè¬è®€è€…çœ‹å®Œæ­¤ç¯‡åˆ†äº«ã€‚å¦‚æœä½¿ç”¨å¾Œè¦ºå¾—å¾ˆæœ‰æ•ˆç”¨çš„ï¼Œæ­¡è¿å†ä¸‹æ–¹ç•™è¨€è·Ÿç­†è€…åˆ†äº«ä½ çš„å¿ƒå¾—ï½\n\nç¥å¤§å®¶éƒ½èƒ½æˆç‚ºå¿«æ‰“é«˜æ‰‹ï¼\n","tags":["æ‰“å­—ï¼ˆTypingï¼‰","å¯¦ç”¨å·¥å…·ï¼ˆToolsï¼‰"],"categories":["Others"]},{"title":"LeetCode 85 - Maximal Rectangle","url":"/LeetCode-Maximal-Rectangle/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/maximal-rectangle/](https://leetcode.com/problems/maximal-rectangle/)\n\nçµ¦ä¸€å€‹äºŒç¶­çš„ 01 é™£åˆ—ï¼Œæ‰¾åˆ°å…¨éƒ¨éƒ½æ˜¯ 1 çš„æœ€å¤§çŸ©å½¢ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nInput:\n[\n  [\"1\",\"0\",\"1\",\"0\",\"0\"],\n  [\"1\",\"0\",\"1\",\"1\",\"1\"],\n  [\"1\",\"1\",\"1\",\"1\",\"1\"],\n  [\"1\",\"0\",\"0\",\"1\",\"0\"]\n]\nOutput: 6\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå‡è¨­çŸ©å½¢å¤§å°ç‚º `N * M`ã€‚\n\né¦–å…ˆï¼Œæœ€å¤§çš„çŸ©å½¢ä¸€å®šæœƒç‚ºæŸä¸€æ©«åˆ—ï¼ˆRowï¼‰ç‚ºåº•è€Œå½¢æˆã€‚\n\nè€Œè¦æ‰¾å‡ºä»¥ç¬¬ `i` åˆ—ç‚ºåº•é‚Šå½¢æˆçš„æœ€å¤§çŸ©å½¢ï¼Œå¯ä»¥å…ˆå°‡ 01 çŸ©é™£çš„è½‰æ›æˆé«˜åº¦å€¼ï¼Œä¹Ÿå°±æ˜¯å°‡ `matrix[i][j]` è½‰æ›æˆç”± `(i, j)` é–‹å§‹å‘ä¸Šæœ‰å¹¾å€‹é€£çºŒçš„ 1ã€‚\n\nä»¥ç¯„ä¾‹ç•¶åƒè€ƒï¼Œè½‰æ›å¾Œçš„çµæœå¦‚ä¸‹ï¼š\n\n```\n[\n  [1, 0, 1, 0, 0],\n  [2, 0, 2, 1, 1],\n  [3, 1, 3, 2, 2],\n  [4, 0, 0, 3, 0]\n]\n```\n\næ¥è‘—ï¼Œä»¥ç¬¬ `i` åˆ—ç‚ºåº•èƒ½å½¢æˆçš„æœ€å¤§æ­£æ–¹å½¢ä¸€å®šæ˜¯ä»¥æŸä¸€å€‹ `(i, j)` çš„é«˜åº¦ç‚ºé«˜ï¼Œå‘å·¦å³å»¶ä¼¸ç›´åˆ°ä¸èƒ½å†å»¶ä¼¸ç‚ºæ­¢ã€‚\n\nè¦è­‰æ˜é€™å€‹ç‰¹æ€§ä¸¦ä¸é›£ï¼Œä»¥ç¬¬ `i` åˆ—ç‚ºåº•çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œè‹¥ç•¶å‰çš„çŸ©å½¢ä¸ä»¥ä»»ä½•ä¸€å€‹ `(i, j)` çš„é«˜åº¦ç‚ºé«˜ï¼Œå‰‡çŸ©å½¢å¯ä»¥å¢é«˜ã€è®Šå¾—æ›´å¤§ã€‚è‹¥ç•¶å‰çŸ©å½¢é‚„å¯ä»¥å‘å·¦å³å»¶ä¼¸ï¼Œå‰‡çŸ©å½¢å¯ä»¥å¢åŠ å¯¬åº¦ï¼Œä¹Ÿæœƒè®Šå¾—æ›´å¤§ã€‚æ‰€ä»¥æœ€å¤§çš„çŸ©å½¢ä¹‹é«˜åº¦ä¸€å®šæ˜¯ä»¥æŸä¸€å€‹ `(i, j)` çš„é«˜åº¦ç‚ºé«˜ï¼Œä¸¦å‘å·¦å³å»¶ä¼¸ç›´åˆ°ä¸èƒ½å†å»¶ä¼¸ç‚ºæ­¢ã€‚\n\næ­¤éƒ¨åˆ†çš„è­‰æ˜åœ¨ç­†è€…çš„ä¸Šä¸€ç¯‡ Blog [LeetCode - Largest Rectangle in Histogram](https://blog.justin0u0.com/LeetCode-Largest-Rectangle-in-Histogram/) ä¸­ä¹Ÿæœ‰æåˆ°ã€‚\n\nå°‡æ‰€æœ‰ä»¥ç¬¬ `i` åˆ—ç‚ºåº•é‚Šèƒ½å½¢æˆçš„æœ€å¤§çŸ©å½¢å–æœ€å¤§å€¼ï¼Œå°±æ˜¯æ­¤é¡Œçš„ç­”æ¡ˆã€‚è€Œå¦‚ä½•è¨ˆç®—ä»¥ç¬¬ `i` åˆ—ç‚ºåº•é‚Šèƒ½å½¢æˆçš„æœ€å¤§çŸ©å½¢ï¼Œå¯ä»¥åƒè€ƒ [LeetCode - Largest Rectangle in Histogram](https://blog.justin0u0.com/LeetCode-Largest-Rectangle-in-Histogram/)ï¼Œè£¡é¢æœ‰è©³ç´°çš„èªªæ˜ï¼Œé€™è£¡åªç°¡å–®å¸¶éã€‚\n\nåˆ©ç”¨ä¸€å †ç–Šï¼ˆStackï¼‰ç¶­è­·ç”±å·¦è‡³å³çš„éå¢åºåˆ—ï¼Œè¦åŠ å…¥ä¸€æ–°çš„é«˜åº¦æ™‚ï¼Œå°‡å †ç–Šå…§æ¯”æ­¤é«˜åº¦å¤§çš„å€¼ç§»é™¤ï¼Œæ­¤æ™‚å †ç–Šçš„é ‚ç«¯å…ƒç´ å³ç‚ºæ­¤ä½ç½®èƒ½å»¶ä¼¸åˆ°çš„æœ€å·¦è™•ã€‚\n\nåä¹‹ï¼Œåˆ©ç”¨ Stack ç¶­è­·ç”±å³è‡³å·¦çš„éå¢åºåˆ—ï¼Œè¦åŠ å…¥ä¸€æ–°çš„é«˜åº¦æ™‚ï¼Œå°‡å †ç–Šå…§æ¯”æ­¤é«˜åº¦å¤§çš„å€¼ç§»é™¤ï¼Œæ­¤æ™‚å †ç–Šçš„é ‚ç«¯å…ƒç´ å³ç‚ºæ­¤ä½ç½®èƒ½å»¶ä¼¸åˆ°çš„æœ€å³è™•ã€‚\n\nè¨ˆç®—ç¬¬ `i` åˆ—æ‰€éœ€çš„æ™‚é–“ç‚º `O(M)`ï¼Œç¸½å…±æœ‰ `N` åˆ—ï¼Œç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(NM)`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå°æ–¼æ¯ä¸€å€‹åˆ—ï¼Œæœ‰å››ä»¶äº‹æƒ…è¦ç…§é †åºåŸ·è¡Œï¼š\n1. è¨ˆç®—ä»¥ `(i, j)` å‘ä¸Šæœ€å¤šæœ‰å¹¾å€‹é€£çºŒçš„ 1ï¼Œå³è¨ˆç®—é«˜åº¦ `heights[i][j]`ã€‚\n2. ç”±å·¦åˆ°å³è¨ˆç®— `left[j]` ä»£è¡¨ä»¥ `(i, j)` ç‚ºé«˜ï¼Œæœ€å¤šèƒ½å‘å·¦å»¶ä¼¸å¤šå°‘ã€‚\n3. ç”±å³åˆ°å·¦è¨ˆç®— `right[j]` ä»£è¡¨ä»¥ `(i, j)` ç‚ºé«˜ï¼Œæœ€å¤šèƒ½å‘å³å»¶ä¼¸å¤šå°‘ã€‚\n4. è¨ˆç®—æ‰€æœ‰çŸ©å½¢é¢ç©çš„æœ€å¤§å€¼ï¼Œä½ç½® `(i, j)` ä¹‹çŸ©å½¢é¢ç©ç‚º `(left[j] + right[j] - 1) * heights[i][j]`ã€‚\n\næ›´è©³ç´°çš„å¯¦ä½œç´°ç¯€å¯ä»¥åƒè€ƒ [LeetCode - Largest Rectangle in Histogram](https://blog.justin0u0.com/LeetCode-Largest-Rectangle-in-Histogram/)ï¼Œé€™è£¡åªèªªæ˜é«˜åº¦å¦‚ä½•è¨ˆç®—ã€‚\n\nè‹¥ `matrix[i][j]` ç‚º 0ï¼Œå‰‡é«˜åº¦ç‚º 0ã€‚å¦å‰‡å…¶é«˜åº¦ç‚º `matrix[i - 1][j]` ä¹‹é«˜åº¦åŠ ä¸€ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/maximal-rectangle/\n * Runtime: 60ms\n */\n\nclass Solution {\npublic:\n  int maximalRectangle(vector<vector<char>>& matrix) {\n    if (matrix.empty() || matrix[0].empty()) return 0;\n    int n = (int)matrix.size();\n    int m = (int)matrix[0].size();\n\n    // heights[j] ä»£è¡¨ä½ç½® (i, j) çš„é«˜åº¦\n    vector<int> heights(m);\n    // left[j] ä»£è¡¨ä»¥ä½ç½® (i, j) ä¹‹é«˜åº¦ç‚ºé«˜çš„çŸ©å½¢èƒ½å‘å·¦å»¶ä¼¸çš„é•·åº¦\n    vector<int> left(m);\n    // é™£åˆ—æ¨¡æ“¬ stackï¼Œidx ç‚ºé™£åˆ—é ‚ç«¯å…ƒç´ ï¼Œidx = 0 ä»£è¡¨ stack ç‚ºç©ºã€‚å›  stack å¾ 1 é–‹å§‹ç·¨è™Ÿï¼Œå…¶é•·åº¦éœ€å¤š 1\n    vector<int> stk(m + 1);\n    // ç´€éŒ„æœ€å¤§çŸ©å½¢ç”¨\n    int maximal = 0;\n    for (int i = 0; i < n; i++) {\n      // å°‡ stack \n      int idx = 0;\n      for (int j = 0; j < m; j++) {\n        // è¨ˆç®—é«˜åº¦\n        if (i && matrix[i][j] == '1') {\n          // ä¸æ˜¯ç¬¬ 0 æ’ä¸” matrix[i][j] ç‚º 1ï¼Œé«˜åº¦ç‚ºä¸Šä¸€åˆ—ä¹‹é«˜åº¦åŠ ä¸€\n          ++heights[j];\n        } else {\n          heights[j] = matrix[i][j] - '0';\n        }\n\n        // ç¶­è­·éå¢åºåˆ—\n        while (idx && heights[stk[idx]] >= heights[j]) --idx;\n        // è¨ˆç®—å‘å·¦å»¶ä¼¸ä¹‹é•·\n        if (!idx) left[j] = j + 1;\n        else left[j] = j - stk[idx];\n        // å°‡ç•¶å‰ç´¢å¼•åŠ å…¥ stack ä¹‹ä¸­\n        stk[++idx] = j;\n      }\n\n      // æ¸…ç©º stack çµ¦ä¸‹ä¸€å€‹æ­¥é©Ÿä½¿ç”¨\n      idx = 0;\n      // ç”±å³è‡³å·¦\n      for (int j = m - 1; j >= 0; j--) {\n        // ç¶­è­·éå¢åºåˆ—\n        while (idx && heights[stk[idx]] >= heights[j]) --idx;\n        // right å³ right[j]ï¼Œä»£è¡¨ä»¥ä½ç½® (i, j) ä¹‹é«˜åº¦ç‚ºé«˜çš„çŸ©å½¢å¯ä»¥å‘å³å»¶ä¼¸çš„é•·åº¦ï¼Œä½†ä¸é–‹é™£åˆ—ç´€éŒ„\n        int right;\n        // è¨ˆç®—å‘å³å»¶ä¼¸ä¹‹é•·\n        if (!idx) right = m - j;\n        else right = stk[idx] - j;\n        // å°‡ç•¶å‰ç´¢å¼•åŠ å…¥ stack ä¹‹ä¸­\n        stk[++idx] = j;\n\n        // è¨ˆç®—é¢ç©ã€æ›´æ–°æœ€å¤§é¢ç©\n        maximal = max(maximal, (left[j] + right - 1) * heights[j]);\n      }\n    }\n    return maximal;\n  }\n};\n\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 84 - Largest Rectangle in Histogram","url":"/LeetCode-Largest-Rectangle-in-Histogram/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/largest-rectangle-in-histogram/](https://leetcode.com/problems/largest-rectangle-in-histogram/)\n\nçµ¦å®š `N` å€‹é•·æ¢åœ–çš„æ¢çš„é«˜åº¦ï¼Œæ¯å€‹æ¢çš„å¯¬åº¦ç‚º 1ï¼Œæ±‚æœ€å¤§çš„é•·æ–¹å½¢é¢ç©ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nExample:\n\nInput: [2,1,5,6,2,3]\nOutput: 10\n```\n\n![](/assets/LeetCode-Largest-Rectangle-in-Histogram/largest-rectangle-in-histogram-example.png)\n\n<!-- More -->\n\n# æƒ³æ³•\n\n## æ™‚é–“è¤‡é›œåº¦ O(N)\n\né¦–å…ˆï¼Œæœ€å¤§çš„çŸ©å½¢ä¹‹é«˜åº¦ä¸€å®šæ˜¯ä»¥æŸä¸€å€‹æ¢çš„é«˜åº¦ç‚ºé«˜ï¼Œå‘å·¦å³å»¶ä¼¸ç›´åˆ°ä¸èƒ½å†å»¶ä¼¸ç‚ºæ­¢ã€‚\n\nè¦è­‰æ˜é€™å€‹ç‰¹æ€§ä¸¦ä¸é›£ï¼Œè‹¥ç•¶å‰çš„çŸ©å½¢ä¸ä»¥ä»»ä½•ä¸€å€‹æ¢çš„é«˜åº¦ç‚ºé«˜ï¼Œå‰‡çŸ©å½¢å¯ä»¥å¢é«˜ã€è®Šå¾—æ›´å¤§ã€‚è‹¥ç•¶å‰çŸ©å½¢é‚„å¯ä»¥å‘å·¦å³å»¶ä¼¸ï¼Œå‰‡çŸ©å½¢å¯ä»¥å¢åŠ å¯¬åº¦ï¼Œä¹Ÿæœƒè®Šå¾—æ›´å¤§ã€‚æ‰€ä»¥æœ€å¤§çš„çŸ©å½¢ä¹‹é«˜åº¦ä¸€å®šæ˜¯ä»¥æŸä¸€å€‹æ¢çš„é«˜åº¦ç‚ºé«˜ï¼Œä¸¦å‘å·¦å³å»¶ä¼¸ç›´åˆ°ä¸èƒ½å†å»¶ä¼¸ç‚ºæ­¢ã€‚\n\næ¥è‘—å°±æ˜¯è¦ç®—å‡ºä»¥ä½ç½® `i` çš„é«˜åº¦ `heights[i]` ç‚ºé«˜ï¼Œæœ€å¤šå¯ä»¥å»¶ä¼¸å·¦å³è‡³å“ªè£¡ã€‚\n\nå¯ä»¥ç™¼ç¾ï¼Œä½ç½® `i` å‘å·¦æœ€å¤šå¯ä»¥å»¶ä¼¸ç›´åˆ°ç¬¬ä¸€å€‹é«˜åº¦æ¯” `heights[i]` å°çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯å¦‚æœç”±å·¦åˆ°å³ç¶­è­·ä¸€å€‹éå¢çš„åºåˆ—ï¼Œå°±å¯ä»¥çŸ¥é“å‘å·¦å»¶ä¼¸çš„æ¥µé™ä½ç½®ã€‚\n\nèˆ‰ç¯„ä¾‹ `[2, 1, 5, 6, 2, 3]` ä¾†èªªï¼Œä¸€é–‹å§‹éå¢åºåˆ—ç‚ºç©ºï¼š\n1. `[2]`ï¼š`2` åŠ å…¥åºåˆ—ï¼Œåºåˆ—ä¿æŒéå¢ã€‚**æ•¸å­— `2` å¯ä»¥å»¶ä¼¸è‡³æœ€å·¦**\n2. `[1]`ï¼š`1` åŠ å…¥åºåˆ—ï¼Œç‚ºäº†è®“åºåˆ—ä¿æŒéå¢ï¼Œå¿…é ˆå°‡ `2` ç§»é™¤ã€‚**æ•¸å­— `1` å¯ä»¥å»¶ä¼¸è‡³æœ€å·¦**\n3. `[1, 5]`ï¼š`5` åŠ å…¥åºåˆ—ï¼Œåºåˆ—ä¿æŒéå¢ã€‚**æ•¸å­— `5` å¯ä»¥å»¶ä¼¸è‡³æ•¸å­— `1` ä¹‹å³å´**\n4. `[1, 5, 6]`ï¼š`6` åŠ å…¥åºåˆ—ï¼Œåºåˆ—ä¿æŒéå¢ã€‚**æ•¸å­— `6` å¯ä»¥å»¶ä¼¸è‡³æ•¸å­— `5` ä¹‹å³å´**\n5. `[1, 2]`ï¼š`2` åŠ å…¥åºåˆ—ï¼Œç‚ºäº†è®“åºåˆ—ä¿æŒéå¢ï¼Œå°‡ `6`, `5` ä¾åºç§»é™¤ã€‚**æ•¸å­— `2` å¯ä»¥å»¶ä¼¸è‡³æ•¸å­— `1` ä¹‹å³å´**\n6. `[1, 2, 3]`ï¼š`3` åŠ å…¥åºåˆ—ï¼Œåºåˆ—ä¿æŒéå¢ã€‚**æ•¸å­— `3` å¯ä»¥å»¶ä¼¸è‡³æ•¸å­— `2` ä¹‹å³å´**\n\nå› ç‚ºä¸Šè¿°çš„åºåˆ—æ“ä½œä¸­ï¼Œæ•¸å­—åªæœƒå¾åºåˆ—çš„æœ€å³é‚ŠåŠ å…¥ï¼Œä¸”è¦ç¶­è­·éå¢åºåˆ—å³æ˜¯æ¯”è¼ƒåºåˆ—çš„å³å´èˆ‡ç•¶å‰å€¼ï¼Œè‹¥ç•¶å‰å€¼è¼ƒå°å‰‡ä¸æ–·ç§»é™¤åºåˆ—å³å´å…ƒç´ ã€‚é€™ç¨®å…ˆé€²å¾Œå‡ºï¼ˆFILOï¼‰çš„æ€§è³ªå¯ä»¥åˆ©ç”¨ä¸€å€‹å †ç–Šï¼ˆStackï¼‰ä¾†ç¶­è­·ã€‚\n\nåä¹‹ï¼Œè¦è¨ˆç®—ä½ç½® `i` å‘å³æœ€å¤šå¯ä»¥å»¶ä¼¸è‡³å¤šå°‘ï¼Œå‰‡ç”±å³è‡³å·¦ç¶­è­·ä¸€å€‹éå¢çš„åºåˆ—ã€‚\n\nå¯ä»¥ç™¼ç¾ï¼Œç”±å·¦è‡³å³ï¼Œä¸€å€‹å…ƒç´ æœ€å¤šæœƒè¢«åŠ å…¥ã€ç§»é™¤ `stack` ä¸€æ¬¡ã€‚ç”±å³è‡³å·¦ä¹Ÿæ˜¯ã€‚æ‰€ä»¥**ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N)`**ã€‚\n\n## å„ªåŒ–åˆ° One Pass O(N) çš„æƒ³æ³•\n\n*<font color=\"blue\">2021/03/15 æ›´æ–°</font>*\n\nåŸæƒ³æ³•ç‚ºå…ˆç”±å·¦åˆ°å³æ±‚å‡ºç•¶å‰é«˜åº¦ `heights[i]` èƒ½å¤ å‘å·¦å»¶ä¼¸åˆ°å“ªè£¡ï¼Œå†ç”±å³åˆ°å·¦æ±‚å‡º `heights[i]` å‘å³èƒ½å»¶ä¼¸åˆ°å“ªè£¡ã€‚\n\nä½†å…¶å¯¦ `heights[i]` èƒ½å‘å³å»¶ä¼¸åˆ°å“ªè£¡ä¸éœ€è¦ç”±å³åˆ°å·¦ä¾†æ±‚å‡ºï¼Œå¯ä»¥ç™¼ç¾ç”±å·¦åˆ°å³ç¶­è­·ä¸€å€‹éå¢çš„åºåˆ—æ™‚ï¼Œè‹¥ç•¶å‰çš„æ•¸å­—ç‚º `y` ä¸”æ•¸å­— `x` è¦å¾åºåˆ—ä¸­è¢«ç§»é™¤æ™‚ï¼Œå‰‡ `x` æœ€å¤šå°±èƒ½å‘å³å»¶ä¼¸åˆ° `y`ã€‚\n\nè©³ç´°åšæ³•è¦‹æœ€å¾Œçš„ç¨‹å¼ç¢¼ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nç­†è€…åŸç”¨ `std::stack` ä¾†å¯¦ä½œï¼Œä¸éé€Ÿåº¦è¼ƒæ…¢ï¼Œæ‰€ä»¥æ”¹ç‚ºä½¿ç”¨ä¸€é™£åˆ—é…åˆä¸€æŒ‡æ¨™ä¾†æ¨¡æ“¬ `stack` çš„é‹ä½œã€‚å› æ­¤ä»¥ä¸‹ä»¥è¬›è§£é™£åˆ—æ¨¡æ“¬ `stack` çš„ç‰ˆæœ¬ç‚ºä¸»ï¼Œä½† `std::stack` ä¹‹ç‰ˆæœ¬ä¹Ÿæœƒåœ¨ä¸‹é¢é™„ä¸Šã€‚\n\n`stk` ç‚ºç¶­è­·éå¢åºåˆ—ç”¨ä¹‹å †ç–Šï¼Œ`idx` ç‚ºç•¶å‰ `stack` çš„é ‚ç«¯å…ƒç´ çš„ç´¢å¼•å€¼ã€‚å…¶ä¸­ `idx = 0` ä»£è¡¨ `stack` ç‚ºç©ºï¼Œè€Œ `stack` å…§çš„å…ƒç´ å¾ç´¢å¼•å€¼ 1 é–‹å§‹æ”¾ç½®ã€‚**æ³¨æ„ç­†è€…æ˜¯å°‡åºåˆ—çš„ç´¢å¼•åŠ å…¥ `stk` ä¹‹ä¸­ï¼Œè€Œéé«˜åº¦**ã€‚\n\nåˆ©ç”¨ `left` é™£åˆ—ä¿å­˜ä½ç½® `i` æœ€å¤šå¯ä»¥å»¶ä¼¸å¤šå°‘é•·åº¦ã€‚\n\nç”±å·¦è‡³å³ï¼Œç•¶ `stack` ä¸ç‚ºç©ºä¸”å…¶é ‚ç«¯å…ƒç´ å¤§æ–¼ç­‰æ–¼ç•¶å‰çš„é«˜åº¦ï¼Œå‰‡ç‚ºäº†è¦ä¿æŒåš´æ ¼éå¢ï¼Œå°‡ `stack` ä¹‹é ‚ç«¯å…ƒç´ ç§»é™¤ï¼Œä¸¦å†æ¬¡æª¢æŸ¥ã€‚ä¹Ÿå°±æ˜¯ï¼š\n\n```cpp\nwhile (idx && heights[stk[idx]] >= heights[i]) --idx;\n```\n\næ¥è‘—ï¼Œè‹¥ `stack` ç‚ºç©ºï¼Œå‰‡ç•¶å‰å…ƒç´ å¯ä»¥å‘å·¦å»¶ä¼¸è‡³æœ€å·¦ï¼Œå…¶é•·åº¦ç‚º `i + 1`ï¼›è‹¥ `stack` ä¸ç‚ºç©ºï¼Œå‰‡ç•¶å‰å…ƒç´ å¯ä»¥å‘å·¦å»¶ä¼¸è‡³ `stack` å…§çš„é ‚ç«¯å…ƒç´ ä½ç½®çš„å³å´ï¼Œå…¶é•·åº¦ç‚º `i - stk[idx]`ã€‚ä¹Ÿå°±æ˜¯ï¼š\n\n```cpp\nif (!idx) left[i] = i + 1;\nelse left[i] = i - stk[idx];\n```\n\næœ€å¾Œï¼Œå°‡ç•¶å‰çš„**ç´¢å¼•**åŠ å…¥åºåˆ—ä¹‹ä¸­ï¼Œä¹Ÿå°±æ˜¯ï¼š\n\n```cpp\nstk[++idx] = i;\n```\n\nè¨ˆç®—å‘å³å»¶ä¼¸ä¹‹é•·åº¦æ™‚ï¼Œå‰‡ç”±å³åˆ°å·¦ç¶­è­·éå¢åºåˆ—ã€‚ä½†æ˜¯ç­†è€…æ²’æœ‰ç´€éŒ„ `right[i]` è€Œæ˜¯ä¸€è¨ˆç®—å‡ºå‘å³å»¶ä¼¸ä¹‹é•·åº¦ `right` å¾Œï¼Œç›´æ¥è¨ˆç®—ç•¶å‰é¢ç© `(right + left[i] - 1) * heights[i]`ã€‚æ³¨æ„å› ç‚ºå‘å·¦ã€å‘å³å»¶ä¼¸ä¹‹é•·åº¦éƒ½æœƒè¦†è“‹åˆ°è‡ªå·±æœ¬èº«ï¼Œæ‰€ä»¥è¦æ¸›ä¸€ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## é™£åˆ—æ¨¡æ“¬ Stack\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/largest-rectangle-in-histogram/\n * Rumtime: 20ms\n */\n\nclass Solution {\npublic:\n  int largestRectangleArea(vector<int>& heights) {\n    int n = (int)heights.size();\n    // left[i] ä»£è¡¨ä½ç½® i å¯ä»¥å‘å·¦å»¶ä¼¸çš„é•·åº¦\n    vector<int> left(n);\n    // é™£åˆ—æ¨¡æ“¬ stackï¼Œidx ç‚ºé™£åˆ—é ‚ç«¯å…ƒç´ ï¼Œidx = 0 ä»£è¡¨ stack ç‚ºç©ºã€‚å›  stack å¾ 1 é–‹å§‹ç·¨è™Ÿï¼Œå…¶é•·åº¦éœ€å¤š 1\n    vector<int> stk(n + 1);\n    int idx = 0;\n\n    // ç”±å·¦è‡³å³ \n    for (int i = 0; i < n; i++) {\n      // ç¶­è­·éå¢åºåˆ—\n      while (idx && heights[stk[idx]] >= heights[i]) --idx;\n      // è¨ˆç®—å‘å·¦å»¶ä¼¸ä¹‹é•·\n      if (!idx) left[i] = i + 1;\n      else left[i] = i - stk[idx];\n      // å°‡ç•¶å‰ç´¢å¼•åŠ å…¥ stack ä¹‹ä¸­\n      stk[++idx] = i;\n    }\n    // æ¸…ç©º stack çµ¦ä¸‹ä¸€å€‹æ­¥é©Ÿä½¿ç”¨\n    idx = 0;\n\n    // ç´€éŒ„æœ€å¤§é¢ç©ç”¨\n    int largestArea = 0;\n    // ç”±å³è‡³å·¦\n    for (int i = n - 1; i >= 0; i--) {\n      // ç¶­è­·éå¢åºåˆ—\n      while (idx && heights[stk[idx]] >= heights[i]) --idx;\n      \n      // right å³ right[i]ï¼Œä»£è¡¨ä½ç½® i å¯ä»¥å‘å³å»¶ä¼¸çš„é•·åº¦ï¼Œä½†ä¸é–‹é™£åˆ—ç´€éŒ„\n      int right;\n      // è¨ˆç®—å‘å³å»¶ä¼¸ä¹‹é•·\n      if (!idx) right = n - i;\n      else right = stk[idx] - i;\n      // å°‡ç•¶å‰ç´¢å¼•åŠ å…¥ stack ä¹‹ä¸­\n      stk[++idx] = i;\n\n      // è¨ˆç®—é¢ç©ã€æ›´æ–°æœ€å¤§é¢ç©\n      largestArea = max(largestArea, (right + left[i] - 1) * heights[i]);\n    }\n    return largestArea;\n  }\n};\n\n```\n\n## std::stack\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/largest-rectangle-in-histogram/\n * Rumtime: 36ms\n */\n\nclass Solution {\npublic:\n  int largestRectangleArea(vector<int>& heights) {\n    int n = (int)heights.size();\n    vector<int> left(n);\n    stack<int> stk;\n\n    for (int i = 0; i < n; i++) {\n      while (!stk.empty() && heights[stk.top()] >= heights[i]) stk.pop();\n      if (stk.empty()) left[i] = i + 1;\n      else left[i] = i - stk.top();\n      stk.push(i);\n    }\n    while (!stk.empty()) stk.pop();\n\n    int largestArea = 0;\n    for (int i = n - 1; i >= 0; i--) {\n      while (!stk.empty() && heights[stk.top()] >= heights[i]) stk.pop();\n      int right;\n      if (stk.empty()) right = n - i;\n      else right = stk.top() - i;\n      stk.push(i);\n\n      largestArea = max(largestArea, (right + left[i] - 1) * heights[i]);\n    }\n    return largestArea;\n  }\n};\n\n```\n\n## One Pass O(N) with std::stack\n\n*<font color=\"blue\">2021/03/15 æ›´æ–°</font>*\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/largest-rectangle-in-histogram/\n */\n\nclass Solution {\npublic:\n  int largestRectangleArea(vector<int>& heights) {\n    heights.emplace_back(0); // ç‚ºäº†è¦è¨ˆç®—åˆ°æ‰€æœ‰çš„ heightsï¼Œå› æ­¤åœ¨æœ€å¾ŒåŠ å…¥ä¸€å€‹é«˜åº¦ç‚º 0 çš„ä½¿ stack å…§ä¸€å®šæœƒè¢« pop åˆ°ç©º\n    int n = (int)heights.size();\n    stack<int> stk;\n\n    int maxArea = 0;\n    for (int i = 0; i < n; i++) {\n      while (!stk.empty() && heights[i] < heights[stk.top()]) {\n        // ç·¨è™Ÿ idx çš„æ•¸å­—è¦è¢« pop\n        int idx = stk.top(); \n        stk.pop();\n        // ä»¥ç•¶å‰çš„é«˜åº¦æœ€å¤šå¯ä»¥ï¼šå‘å·¦å»¶ä¼¸åˆ°éå¢åºåˆ—çš„ä¸Šä¸€å€‹æ•¸å­—ï¼Œå‘å³å»¶ä¼¸åˆ°ç•¶å‰çš„æ•¸å­—\n        int width = (stk.empty()) ? i : (i - stk.top() - 1);\n        maxArea = max(maxArea, heights[idx] * width);\n      }\n      stk.push(i);\n    }\n    return maxArea;\n  }\n};\n\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰","å–®èª¿æ£§ï¼ˆMonotone Stackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 76 - Minumum Window Substring","url":"/LeetCode-Minumum-Window-Substring/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/minimum-window-substring/](https://leetcode.com/problems/minimum-window-substring/)\n\nçµ¦ä¸€å­—ä¸² `S` ä»¥åŠ `T`ï¼Œæ±‚ `S` ä¸­æœ€çŸ­çš„å­å­—ä¸²åŒ…å«æ‰€æœ‰ `T` å‡ºç¾éçš„å­—å…ƒã€‚\n\n# ç¯„ä¾‹èªªæ˜\n```\nExample:\n\nInput: S = \"ADOBECODEBANC\", T = \"ABC\"\nOutput: \"BANC\"\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nåˆ©ç”¨ **Sliding Window** æ‰¾å‡ºæ‰€æœ‰åŒ…å« `T` å…§æ‰€æœ‰å­—å…ƒçš„å­å­—ä¸²ã€‚\n\n**Sliding Window** çš„è©³ç´°ä»‹ç´¹å¯ä»¥åƒè€ƒ [LeetCode - Substring with Concatenation of All Words](https://blog.justin0u0.com/LeetCode-Substring-with-Concatenation-of-All-Words/)\n\nç•¶çª—å£å…§æ²’æœ‰åŒ…å« `T` å…§çš„æ‰€æœ‰å­—å…ƒï¼Œå¯ä»¥çŸ¥é“è¦å°‡çª—å£è®Šå¤§ï¼Œä¹Ÿå°±æ˜¯å°‡çª—å£çš„å³å´å¢åŠ ã€‚ç•¶çª—å£å…§åŒ…å« `T` å…§çš„æ‰€æœ‰å­—å…ƒï¼Œå‰‡ä¸æ–·å°‡çª—å£è®Šå°ï¼Œä¹Ÿå°±æ˜¯å°‡çª—å£çš„å·¦å´å¢åŠ ï¼Œç›´åˆ°çª—å£å…§ä¸åŒ…å« `T` å…§çš„æ‰€æœ‰å­—å…ƒã€‚\n\nå¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¯ä»¥æ‰¾åˆ°æ‰€æœ‰å¯èƒ½ç‚ºçš„å­å­—ä¸²ï¼Œä¸”è‹¥èƒ½åœ¨ `O(1)` æ™‚é–“å…§è¨ˆç®—å‡ºç•¶å‰çš„çª—å£æ˜¯å¦ç‚ºç­”æ¡ˆï¼Œå› ç‚ºæ¯å€‹å­—å…ƒåªæœƒè¢«åŠ å…¥ã€åˆªé™¤çª—å£ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N)`ï¼Œ`N` ç‚ºå­—ä¸² `S` ä¹‹é•·åº¦ã€‚\n\nè¦åœ¨ `O(1)` çš„æ™‚é–“å…§ç®—å‡ºçª—å£å…§çš„å­å­—ä¸²æ˜¯å¦åŒ…å« `T` å…§çš„æ‰€æœ‰å­—å…ƒï¼Œå¯ä»¥åˆ©ç”¨ä¸€å€‹è¨ˆæ•¸å™¨ä¾†å¹«åŠ©ã€‚\n\nåˆ©ç”¨ `dict[i]` ä»£è¡¨å­—å…ƒ `i` æ‡‰è©²è¦å‡ºç¾çš„æ¬¡æ•¸ï¼Œä¹Ÿå°±æ˜¯ä¸€é–‹å§‹éæ­· `T` å…§çš„æ¯ä¸€å€‹å­—å…ƒ `ch`ï¼Œä¸¦å°‡ `dict[ch]` åŠ ä¸€ã€‚æ¥è‘—ï¼Œé–‹å§‹åŸ·è¡Œ **Sliding Window**ï¼Œç•¶ä¸€å€‹å­—å…ƒ `S[i]` åŠ å…¥çª—å£ï¼Œå°‡ `dict[S[i]]` æ¸›ä¸€ï¼›åä¹‹ï¼Œç•¶å­—å…ƒ `S[i]` é›¢é–‹çª—å£ï¼Œå°‡ `dict[S[i]]` åŠ ä¸€ã€‚\n\nå¦‚æ­¤ä¸€ä¾†ï¼Œè‹¥ `dict` å…§çš„æ¯ä¸€å€‹æ•¸å­—çš†å°æ–¼ç­‰æ–¼ 0ï¼Œä»£è¡¨çª—å£å…§å·²ç¶“åŒ…å«äº†æ‰€æœ‰ `T` å…§çš„å­—å…ƒï¼Œæ‰€ä»¥ç•¶å‰çš„çª—å£å³å¯ä»¥æˆç‚ºç­”æ¡ˆã€‚\n\nè€Œè¦å¿«é€Ÿçš„è¨ˆç®— `dict` å…§çš„æ¯ä¸€å€‹æ•¸å­—æ˜¯å¦éƒ½å°æ–¼ 0ï¼Œå¯ä»¥åˆ©ç”¨ä¸€è®Šæ•¸ `total` ç´€éŒ„ç•¶å‰ `dict` å…§å¤§æ–¼ 0 çš„æ•¸å­—æ•¸é‡ã€‚ç•¶ **Sliding Window** åŸ·è¡Œæ™‚ï¼Œç•¶ä¸€å­—å…ƒ `S[i]` åŠ å…¥çª—å£ï¼Œå°‡ `dict[S[i]]` æ¸›ä¸€ï¼Œè‹¥ `dict[S[i]]` è®Šç‚º 0ï¼Œå‰‡ `total` æ¸›ä¸€ï¼›åä¹‹ï¼Œç•¶å­—å…ƒ `S[i]` é›¢é–‹çª—å£ï¼Œå°‡ `dict[S[i]]` åŠ ä¸€ï¼Œè‹¥ `dict[S[i]]` è®Šç‚º 1ï¼Œå‰‡ `total` åŠ ä¸€ã€‚\n\næ‰€ä»¥ç•¶ `total` ç­‰æ–¼é›¶ï¼Œå¯ä»¥çŸ¥é“ç•¶å‰çš„çª—å£åŒ…å«æ‰€æœ‰ `T` å…§çš„å­—å…ƒï¼Œä¹Ÿå°±æ˜¯ç•¶å‰çš„çª—å£ç‚ºä¸€çµ„ç­”æ¡ˆã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nç‚ºäº†è®“ç¨‹å¼ç¢¼çœ‹èµ·ä¾†æ›´ç‚ºç°¡æ½”ï¼Œç­†è€…åˆ©ç”¨äº†è¼ƒå¤šçš„ `++`ï¼Œ`--` é‹ç®—å­ã€‚\n\nè‹¥è®€è€…é‚„ä¸äº†è§£ `x++`ã€`++x` ä¹‹é–“çš„å·®ç•°ï¼š\n- `x++` ä»£è¡¨å°‡ `x = x + 1`ï¼Œä¸”å›å‚³é‚„æ²’åŠ ä¸€å‰çš„ `x`ã€‚\n- `++x` ä»£è¡¨å°‡ `x = x + 1`ï¼Œä¸”å›å‚³åŠ ä¸€éå¾Œçš„ `x`ã€‚\n\næ‰€ä»¥\n```cpp\nint x = 1, y = 1;\ncout << ++x << endl; // Get 2\ncout << y++ << endl; // Get 1\n```\n\nå›æ­¸æ­£é¡Œï¼Œåˆ©ç”¨è®Šæ•¸ `l` ä»£è¡¨çª—å£çš„å·¦é‚Šç•Œï¼Œè¿´åœˆçš„è®Šæ•¸ `i` ä»£è¡¨çª—å£çš„å³é‚Šç•Œã€‚ç•¶ `s[i]` åŠ å…¥ï¼Œå‰‡æ‡‰è©²è¦åŸ·è¡Œï¼š\n\n```cpp\ndict[s[i]]--;\nif (dict[s[i]] == 0) total--;\n```\n\nå¯ä»¥ç°¡åŒ–ç‚ºï¼š\n\n```cpp\nif (--dict[s[i]] == 0) total--;\n```\n\nè€Œç•¶ `s[i]` å¾çª—å£ç§»å‡ºï¼Œå‰‡æ‡‰è©²è¦åŸ·è¡Œï¼š\n\n```cpp\ndict[s[l]]++;\nif (dict[s[l]] == 1) total++;\nl++;\n```\n\nå¯ä»¥ç°¡åŒ–ç‚ºï¼š\n\n```cpp\nif (++dict[s[l++]] == 1) total++;\n```\n\nè€Œç•¶ `total` ç­‰æ–¼é›¶æ™‚ï¼Œå¯ä»¥çŸ¥é“ `l ~ i` ç‚ºä¸€çµ„åˆæ³•ç­”æ¡ˆã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/minimum-window-substring/\n * Runtime: 16ms\n */\n\nclass Solution {\npublic:\n  string minWindow(string s, string t) {\n    // dict[i] ä»£è¡¨å­—å…ƒ i æ‡‰è©²è¦å‡ºç¾å¹¾æ¬¡\n    vector<int> dict(128);\n    for (auto ch: t) dict[ch]++;\n\n    // total ä»£è¡¨ dict å…§æœ‰å¹¾å€‹ > 0 çš„æ•¸å­—\n    int total = 0;\n    for (auto value: dict) {\n      if (value > 0) total++;\n    }\n\n    // l ç‚ºçª—å£å·¦é‚Šç•Œ\n    int l = 0;\n    // answerL ä»£è¡¨ç­”æ¡ˆçš„å·¦é‚Šç•Œï¼ŒanswerLen ä»£è¡¨ç­”æ¡ˆçš„é•·åº¦\n    int answerL, answerLen = 0x3f3f3f3f;\n    // i ç‚ºçª—å£å³é‚Šç•Œ\n    for (int i = 0; i < (int)s.length(); i++) {\n      // å°‡ s[i] åŠ å…¥çª—å£\n      if (--dict[s[i]] == 0) total--;\n      // ç•¶ total ç­‰æ–¼ 0ï¼Œä¸æ–·å¢åŠ çª—å£å·¦å´ä½¿çª—å£è®Šå°\n      while (!total) {\n        // l ~ i ç‚ºä¸€çµ„ç­”æ¡ˆï¼Œè‹¥æ¯”ç•¶å‰ç´€éŒ„çš„ answerLen å°ï¼Œå‰‡æ›´æ–°ç­”æ¡ˆ\n        if (i - l + 1 < answerLen) {\n          answerL = l;\n          answerLen = i - l + 1;\n        }\n        // å°‡ s[l] ç§»å‡ºçª—å£\n        if (++dict[s[l++]] == 1) total++;\n      }\n    }\n    // answerLen = 0x3f3f3f3f ä»£è¡¨æ²’æœ‰åˆæ³•ç­”æ¡ˆ\n    if (answerLen == 0x3f3f3f3f)\n      return \"\";\n    else\n      return s.substr(answerL, answerLen);\n  }\n};\n\n```\n","tags":["LeetCode","æ»‘å‹•çª—å£ï¼ˆSliding Windowï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 72 - Edit Distance","url":"/LeetCode-Edit-Distance/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/edit-distance/](https://leetcode.com/problems/edit-distance/)\n\nçµ¦å®šå…©å€‹å­—ä¸² `word1`, `word2`ï¼Œæ‰¾åˆ°æœ€å°‘çš„æ“ä½œæ­¥æ•¸å°‡ `word1` è½‰æ›æˆ `word2`ã€‚\n\næœ‰ä¸‰ç¨®åˆæ³•çš„æ“ä½œï¼š\n1. æ’å…¥ä¸€å€‹å­—å…ƒ\n2. åˆªé™¤ä¸€å€‹å­—å…ƒ\n3. æ›¿æ›ä¸€å€‹å­—å…ƒ\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n```\nInput: word1 = \"horse\", word2 = \"ros\"\nOutput: 3\nExplanation: \nhorse -> rorse (replace 'h' with 'r')\nrorse -> rose (remove 'r')\nrose -> ros (remove 'e')\n```\n\n## Example 2:\n```\nInput: word1 = \"intention\", word2 = \"execution\"\nOutput: 5\nExplanation: \nintention -> inention (remove 't')\ninention -> enention (replace 'i' with 'e')\nenention -> exention (replace 'n' with 'x')\nexention -> exection (replace 'n' with 'c')\nexection -> execution (insert 'u')\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nåœ¨ [LeetCode - Regular Expression Matching](https://blog.justin0u0.com/LeetCode-Regular-Expression-Matching/) ä¸­ï¼Œæœ‰æåˆ°éç•¶çœ‹è¦‹å…©å­—ä¸²åŒ¹é…çš„é¡Œç›®æ™‚ï¼Œå¹¾ä¹å¯ä»¥ç¢ºå®šæ­¤é¡Œç‚ºå‹•æ…‹è¦åŠƒï¼Œä¸” DP ç‹€æ…‹ç‚º `d(i, j)` ä»£è¡¨ `word1` çš„å‰ `i` å€‹å­—å…ƒèˆ‡ `word2` çš„å‰ `j` å€‹å­—å…ƒç‚ºæ­¢ï¼Œç·¨è¼¯è·é›¢ç‚ºå¤šå°‘ã€‚\n\n## DP ç‹€æ…‹\nå‡è¨­å…©å­—ä¸²åˆ†åˆ¥ç‚º `word1` ä»¥åŠ `word2`ï¼Œè€Œä¸”å¾ç´¢å¼• 1 é–‹å§‹ç·¨è™Ÿã€‚\næ‰€ä»¥æˆ‘å€‘å¯ä»¥å®šç¾© DP ç‹€æ…‹ç‚ºï¼š `d(i, j) = word1[1 ~ i], word2[1 ~ j] æ˜¯å¦åŒ¹é…`ã€‚\n\n## DP è½‰ç§»\n\né¦–å…ˆï¼Œå¦‚æœ `word1[i] = word2[j]`ï¼Œå‰‡ `word1[1 ~ i]` èˆ‡ `word2[1 ~ j]` æ‰€éœ€çš„ç·¨è¼¯è·é›¢ç­‰æ–¼ `word1[1 ~ i - 1]` èˆ‡ `word2[1 ~ j - 1]` çš„ç·¨è¼¯è·é›¢ã€‚æ‰€ä»¥ï¼š\n\n  $$d(i,\\ j)=d(i-1,\\ j-1)\\quad\\ if\\ word1[i]=word2[j]$$\n\nå†ä¾†è€ƒæ…®ä¸‰ç¨®å° `word1` çš„æ“ä½œï¼š\n1. æ’å…¥ä¸€å€‹å­—å…ƒï¼šå‰‡æ±‚ `d(i, j - 1)` çš„ç·¨è¼¯è·é›¢å†åŠ ä¸€ã€‚\n2. åˆªé™¤ä¸€å€‹å­—å…ƒï¼šå‰‡æ±‚ `d(i - 1, j)` çš„ç·¨è¼¯è·é›¢å†åŠ ä¸€ã€‚\n3. æ›¿æ›ä¸€å€‹å­—å…ƒï¼Œå‰‡æ±‚ `d(i - 1, j - 1)` çš„ç·¨è¼¯è·é›¢å†åŠ ä¸€ã€‚\n\næ‰€ä»¥ï¼š\n  \n  $$d(i,\\ j)=min(d(i-1,\\ j), d(i,\\ j-1), d(i-1,\\ j-1))\\quad\\ if\\ word1[i]\\neq word2[j]$$\n\næœ€å¾Œè€ƒæ…®é‚Šç•Œæƒ…æ³ï¼š\n1. `d(0, 0) = 0`ï¼Œå› ç‚ºå…©å­—ä¸²ç‚ºç©ºæ™‚ç›¸ç­‰ï¼Œç·¨è¼¯è·é›¢ç‚º 0ã€‚\n2. `d(0, i) = i`ï¼Œç•¶ `word1` ç‚ºç©ºï¼Œ`word2` ä¸ç‚ºç©ºï¼Œå‰‡ç·¨è¼¯è·é›¢ç‚º `word2` é•·åº¦ã€‚\n3. `d(i, 0) = i`ï¼Œç•¶ `word1` ä¸ç‚ºç©ºï¼Œ`word2` ç‚ºç©ºï¼Œå‰‡ç·¨è¼¯è·é›¢ç‚º `word1` é•·åº¦ã€‚\n\nå‡è¨­ `word1` é•· `N`ï¼Œ`word2` é•· `M`ï¼Œå‰‡ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(NM)`ï¼ŒDP é™£åˆ—ç‚º `N*M` å¤§ï¼Œæ‰€ä»¥ç¸½ç©ºé–“è¤‡é›œåº¦ç‚º `O(NM)`ã€‚\n\n## ç©ºé–“å„ªåŒ–\n\nå¯ä»¥ç™¼ç¾ DP è½‰ç§»åªéœ€è¦å·¦é‚Šã€å·¦ä¸Šã€ä¸Šé¢ä¸‰å€‹ä½ç½®ï¼Œå› æ­¤åªéœ€è¦ç´€éŒ„ç•¶å‰é€™æ’çš„ DP ç‹€æ…‹ã€‚\n\nåˆ©ç”¨ä¸€è®Šæ•¸ `pre` ä»£è¡¨å·¦ä¸Šè§’çš„ç‹€æ…‹ï¼Œåˆ©ç”¨ `temp` ç´€éŒ„ä¸Šæ–¹ç‹€æ…‹ï¼Œå†é€²è¡Œè½‰ç§»ã€‚\n\nç¸½ç©ºé–“è¤‡é›œåº¦é™ç‚º `O(M)`ã€‚\n\n## å¯¦ä½œç´°ç¯€\n\nå› ç‚ºçœŸå¯¦æƒ…æ³ä¸­ï¼Œ`word1` èˆ‡ `word2` çš†ç‚º Base 0ï¼ˆç´¢å¼•å¾ 0 é–‹å§‹ï¼‰ï¼Œæ‰€ä»¥è¦å°‡è½‰ç§»å¼ä¸­çš„ `d(i, j)` éƒ½è®Šç‚º `d(i + 1, j + 1)`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## O(N^2) Space\n```cpp\n/**\n * Author: jutin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/edit-distance/\n * Runtime: 24ms\n */\n\nclass Solution {\npublic:\n  int minDistance(string word1, string word2) {\n    int n = (int)word1.length();\n    int m = (int)word2.length();\n    vector<vector<int>> dp(n + 1, vector<int>(m + 1));\n\n    for (int i = 0; i < n; i++) dp[i + 1][0] = i + 1;\n    for (int i = 0; i < m; i++) dp[0][i + 1] = i + 1;\n\n    for (int i = 0; i < n; i++) {\n      for (int j = 0; j < m; j++) {\n        if (word1[i] == word2[j])\n          dp[i + 1][j + 1] = dp[i][j];\n        else\n          dp[i + 1][j + 1] = min(min(dp[i + 1][j], dp[i][j + 1]), dp[i][j]) + 1;\n      }\n    }\n    return dp[n][m];\n  }\n};\n\n```\n\n## O(N) Space\n```cpp\n/**\n * Author: jutin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/edit-distance/\n * Runtime: 20ms\n */\n\nclass Solution {\npublic:\n  int minDistance(string word1, string word2) {\n    int n = (int)word1.length();\n    int m = (int)word2.length();\n    vector<int> dp(m + 1);\n\n    for (int i = 0; i < m; i++) dp[i + 1] = i + 1;\n\n    for (int i = 0; i < n; i++) {\n      int pre = dp[0];\n      dp[0] = i + 1;\n      for (int j = 0; j < m; j++) {\n        int temp = dp[j + 1];\n        if (word1[i] == word2[j])\n          dp[j + 1] = pre;\n        else\n          dp[j + 1] = min(min(pre, dp[j + 1]), dp[j]) + 1;\n        pre = temp;\n      }\n    }\n    return dp[m];\n  }\n};\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 68 - Text Justification","url":"/LeetCode-Text-Justification/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/text-justification/](https://leetcode.com/problems/text-justification/)\n\nçµ¦å¾ˆå¤šå€‹å­—ä¸²å’Œä¸€å€‹å¯¬åº¦ `maxWidth`ï¼Œå°‡å­—ä¸²é€ä¸€æ”¾å…¥ä¸¦è®“æ¯ä¸€è¡Œéƒ½æ˜¯ `maxWidth` å¯¬ã€‚\n\nè‹¥æ˜¯æœ€å¾Œä¸€è¡Œã€æˆ–æ˜¯ä¸€è¡Œå…§åªæœ‰ä¸€å€‹å­—ä¸²ï¼Œå‰‡é å·¦æ’åˆ—ã€‚å…¶é¤˜å‰‡ç½®ä¸­æ’åˆ—ï¼Œå¹³å‡çš„åˆ†é…ç©ºç™½åˆ°å­—ä¸²ä¹‹é–“ã€‚\n\nç½®ä¸­æ’åˆ—æ™‚è‹¥ç©ºç™½çš„æ•¸é‡ä¸èƒ½å¹³å‡çš„è¢«åˆ†é…ï¼Œå‰‡å·¦é‚Šçš„ç©ºæ ¼æœƒæ¯”å³é‚Šçš„ç©ºæ ¼å¤šä¸€å€‹ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n```\nInput:\nwords = [\"This\", \"is\", \"an\", \"example\", \"of\", \"text\", \"justification.\"]\nmaxWidth = 16\nOutput:\n[\n   \"This    is    an\",\n   \"example  of text\",\n   \"justification.  \"\n]\n```\n\n## Example 2:\n```\nInput:\nwords = [\"What\",\"must\",\"be\",\"acknowledgment\",\"shall\",\"be\"]\nmaxWidth = 16\nOutput:\n[\n  \"What   must   be\",\n  \"acknowledgment  \",\n  \"shall be        \"\n]\nExplanation: Note that the last line is \"shall be    \" instead of \"shall     be\",\n             because the last line must be left-justified instead of fully-justified.\n             Note that the second line is also left-justified becase it contains only one word.\n```\n\n## Example 3:\n```\nInput:\nwords = [\"Science\",\"is\",\"what\",\"we\",\"understand\",\"well\",\"enough\",\"to\",\"explain\",\n         \"to\",\"a\",\"computer.\",\"Art\",\"is\",\"everything\",\"else\",\"we\",\"do\"]\nmaxWidth = 20\nOutput:\n[\n  \"Science  is  what we\",\n  \"understand      well\",\n  \"enough to explain to\",\n  \"a  computer.  Art is\",\n  \"everything  else  we\",\n  \"do                  \"\n]\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå¯¦ä½œé¡å‹çš„é¡Œç›®ï¼Œé€šå¸¸å°±ç…§è‘—åšå³å¯ã€‚\n\né¦–å…ˆæ‰¾å‡ºç•¶å‰é€™è¡Œæœ€å¤šå¯ä»¥æ”¾å¤šå°‘å­—ä¸²ï¼Œä¸¦è¨ˆç®—å‡ºé€™äº›å­—ä¸²çš„é•·åº¦ï¼Œä¸è¦å¿˜äº†åŠ ä¸Šå­—ä¸²ä¸­é–“è‡³å°‘è¦ä¸€å€‹ç©ºç™½ã€‚\n\nç®—å‡ºé•·åº¦å¾Œï¼Œå‡è¨­é•·åº¦å’Œç‚º `width`ï¼Œåˆ©ç”¨ `maxWidth` æ¸›å» `width` å³ç‚ºé‚„è¦åˆ†é…çš„ç©ºç™½ã€‚\n\nå»é™¤ç•¶å‰ç‚ºæœ€å¾Œä¸€è¡Œã€æˆ–æ˜¯é€™è¡Œåªæ”¾çš„ä¸‹ä¸€å€‹å­—ä¸²çš„æƒ…æ³ï¼Œå¿…é ˆæŠŠ `maxWidth - width` å€‹ç©ºç™½å¹³å‡åˆ†é…åˆ°å­—ä¸²å€‘çš„ä¸­é–“ã€‚è‹¥ç•¶å‰é€™è¡Œæœ‰ `M` å€‹å­—ä¸²ï¼Œå‰‡æ¯ä¸€å€‹å­—ä¸²é–“çš„é–“éš”å¯ä»¥å¤šåˆ†é…åˆ° `(maxWidth - width) / (M - 1)` å€‹ç©ºç™½ã€‚å¦å¤–ï¼Œç•¶ `(maxWidth - width) / (M - 1)` ä¸æ•´é™¤ï¼Œå‰©ä¸‹çš„ `(maxWidth - width) % (M - 1)` å€‹ç©ºç™½æœƒåˆ†é…åˆ°å‰ `(maxWidth - width) % (M - 1)` å€‹å­—ä¸²é–“éš”ä¹‹ä¸­ã€‚\n\nè€Œç•¶å‰ç‚ºæœ€å¾Œä¸€è¡Œã€æˆ–æ˜¯é€™è¡Œåªæ”¾çš„ä¸‹ä¸€å€‹å­—ä¸²çš„æƒ…æ³ï¼Œå‰‡æ˜¯é å·¦æ’åˆ—ã€‚åªè¦å°‡å­—ä¸²ä¾åºæ”¾å…¥ï¼Œä¸¦åŠ å…¥å­—ä¸²é–“çš„ä¸€å€‹ç©ºç™½ã€‚æœ€å¾Œå†å­—ä¸²å¾Œè£œä¸Šç©ºç™½ç›´åˆ°å­—ä¸²é•·ç­‰æ–¼ `maxWidth` å³å¯ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\né¦–å…ˆï¼Œ`i` ç‚ºé€™ä¸€è¡Œçš„ç¬¬ä¸€å€‹å­—ä¸²ï¼Œè®“ `width` ç­‰æ–¼å­—ä¸² `i` çš„é•·åº¦ï¼Œ`width` ä»£è¡¨æœ¬è¡Œçš„é•·åº¦å’Œã€‚\n\næ¥è‘—ï¼Œ`j = i + 1` é–‹å§‹ï¼Œè‹¥åŠ å…¥ä¸€å€‹ç©ºç™½ä»¥åŠå­—ä¸² `j` å¾Œ `width` ä»å°æ–¼ç­‰æ–¼ `maxWidth`ï¼Œå‰‡ä»£è¡¨å­—ä¸² `j` å¯ä»¥åŠ å…¥ã€‚ä¸æ–·å°‡ `j` åŠ ä¸€ï¼ŒåŒæ™‚è¨ˆç®—æ”¾å…¥å­—ä¸² `i ~ j` çš„é•·åº¦å’Œ `width`ï¼Œæœ€å¾Œè¿´åœˆçµæŸå¾Œ `i ~ j - 1` å³ç‚ºé€™è¡Œè¦åŠ å…¥çš„å­—ä¸²ã€‚\n\nè‹¥ `j â‰  i + 1` ä¸” `j â‰  n`ï¼Œä»£è¡¨é€™è¡Œä¸åªæœ‰ä¸€å€‹å­—ä¸²ä¸”ä¸æ˜¯æœ€å¾Œä¸€è¡Œï¼Œä¸¦ä¸”çŸ¥é“é€™è¡Œæœ‰ `M = (j - i)` å€‹å­—ä¸²ã€‚æ‰€ä»¥è¨ˆç®— `spaces = (maxWidth - width) / (j - i - 1)` å’Œ `extraSpaces = (maxWidth - width) % (j - i - 1)`ã€‚æ¥è‘—ï¼Œé¦–å…ˆå…ˆå°‡å­—ä¸² `i` åŠ å…¥ï¼Œå†éæ­· `k = i + 1 ~ j - 1`ï¼Œä¾åºåŠ å…¥**ç›¸æ‡‰çš„ç©ºç™½æ•¸é‡**ä»¥åŠ**å­—ä¸² `k`**ï¼Œå…¶ä¸­ç©ºç™½çš„æ•¸é‡ç‚º `spaces + ((k - i + 1) < extraSpaces)`ï¼Œå› ç‚ºå¦‚æœ `(k - i + 1) < extraSpaces`ï¼Œä»£è¡¨ç•¶å‰æ˜¯å‰ `(maxWidth - width) % M - 1` å€‹é–“éš”ï¼Œéœ€è¦å¤šä¸€å€‹ç©ºç™½ã€‚\n\nè‹¥ `j = i + 1` æˆ– `j = n`ã€‚é¦–å…ˆå…ˆåŠ å…¥å­—ä¸² `i`ï¼Œå†éæ­· `k = i + 1 ~ j - 1`ï¼Œä¾åº**ä¸€å€‹ç©ºç™½**ä»¥åŠ**å­—ä¸² `k`**ã€‚æœ€å¾Œï¼Œè£œä¸Šç©ºç™½ç›´åˆ°é•·åº¦ç‚º `maxWidth`ã€‚\n\nèªæ³•éƒ¨åˆ†ï¼Œå¯ä»¥åˆ©ç”¨ `string(Char, Number)` ä¾†åˆå§‹åŒ–é•·åº¦ç‚º `Number` å€‹ `Char`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/text-justification/\n * Runtime: 0ms\n */\n\nclass Solution {\npublic:\n  vector<string> fullJustify(vector<string>& words, int maxWidth) {\n    int n = (int)words.size();\n    vector<string> answer;\n\n    for (int i = 0; i < n; ) {\n      // å­—ä¸² i ç‚ºæ­¤è¡Œçš„ç¬¬ä¸€å€‹å­—ä¸²ï¼Œç•¶å‰é•·åº¦ç‚ºå­—ä¸² i çš„é•·åº¦\n      int width = (int)words[i].length();\n      // æ‰¾æœ€å¤šå¯ä»¥å¹¾å€‹å­—ä¸²åŠ å…¥\n      int j = i + 1;\n      while (j < n && width + 1 + (int)words[j].length() <= maxWidth) {\n        // åŠ å…¥å­—ä¸² j éœ€è¦ä¸€å€‹ç©ºç™½çš„é•·åº¦åŠ ä¸Šå­—ä¸² j é•·åº¦\n        width += 1 + (int)words[j].length();\n        j++;\n      }\n      // å­—ä¸² i ~ j - 1 éƒ½å¯ä»¥åŠ å…¥æœ¬è¡Œ\n\n      // é¦–å…ˆåŠ å…¥å­—ä¸² i\n      string s = words[i];\n      if (j != i + 1 && j != n) {\n        // ç½®ä¸­æ’åˆ—\n        int spaces = (maxWidth - width) / (j - i - 1);\n        int extraSpaces = (maxWidth - width) % (j - i - 1);\n        for (int k = i + 1; k < j; k++)\n          s += string(spaces+ 1 + (k - (i + 1) < extraSpaces), ' ') + words[k];\n      } else {\n        // é å·¦æ’åˆ—ï¼Œä¾åºåŠ å…¥ã€ä¸€å€‹ç©ºç™½ã€ä»¥åŠã€å­—ä¸²kã€\n        for (int k = i + 1; k < j; k++) s += \" \" + words[k];\n        s += string(maxWidth - (int)s.length(), ' ');\n      }\n      // åŠ å…¥æœ¬è¡Œç­”æ¡ˆ\n      answer.emplace_back(s);\n      // i = j ç­‰æ–¼ä¸‹ä¸€è¡Œçš„å­—ä¸²é–‹é ­\n      i = j;\n    }\n    return answer;\n  }\n};\n\n```","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 65 - Valid Number","url":"/LeetCode-Valid-Number/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/valid-number/submissions/](https://leetcode.com/problems/valid-number/submissions/)\nåˆ¤æ–·ä¸€å€‹å­—ä¸²æ˜¯ä¸æ˜¯ä¸€å€‹åˆæ³•çš„æ•¸å­—ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\n\"0\" => true\n\" 0.1 \" => true\n\"abc\" => false\n\"1 a\" => false\n\"2e10\" => true\n\" -90e3   \" => true\n\" 1e\" => false\n\"e3\" => false\n\" 6e-1\" => true\n\" 99e2.5 \" => false\n\"53.5e93\" => true\n\" --6 \" => false\n\"-+3\" => false\n\"95a54e53\" => false\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\næ ¹æ“šç†±å¿ƒçš„ç¶²å‹åœ¨è¨è«–å€çš„æä¾›ï¼š\n[https://leetcode.com/problems/valid-number/discuss/23741/The-worst-problem-i-have-ever-met-in-this-oj](https://leetcode.com/problems/valid-number/discuss/23741/The-worst-problem-i-have-ever-met-in-this-oj)\n\n```\n  test(1, \"123\", true);\n  test(2, \" 123 \", true);\n  test(3, \"0\", true);\n  test(4, \"0123\", true);  //Cannot agree\n  test(5, \"00\", true);  //Cannot agree\n  test(6, \"-10\", true);\n  test(7, \"-0\", true);\n  test(8, \"123.5\", true);\n  test(9, \"123.000000\", true);\n  test(10, \"-500.777\", true);\n  test(11, \"0.0000001\", true);\n  test(12, \"0.00000\", true);\n  test(13, \"0.\", true);  //Cannot be more disagree!!!\n  test(14, \"00.5\", true);  //Strongly cannot agree\n  test(15, \"123e1\", true);\n  test(16, \"1.23e10\", true);\n  test(17, \"0.5e-10\", true);\n  test(18, \"1.0e4.5\", false);\n  test(19, \"0.5e04\", true);\n  test(20, \"12 3\", false);\n  test(21, \"1a3\", false);\n  test(22, \"\", false);\n  test(23, \"     \", false);\n  test(24, null, false);\n  test(25, \".1\", true); //Ok, if you say so\n  test(26, \".\", false);\n  test(27, \"2e0\", true);  //Really?!\n  test(28, \"+.8\", true);  \n  test(29, \" 005047e+6\", true);  //Damn = =|||\n```\n\næˆ‘å€‘å¯ä»¥æ­¸ç´å‡ºä»¥ä¸‹é‡é»ï¼š\n1. åˆæ³•çš„æ•¸å­—çš„å‰å¾Œå¯ä»¥æœ‰ç©ºç™½ï¼Œä½†æ˜¯ä¸­é–“ä¸å¯ä»¥æœ‰ç©ºç™½ã€‚\n2. `'.'` åªèƒ½å‡ºç¾ä¸€æ¬¡ï¼Œä¸”è¦åœ¨ `'e'` å‰é¢å‡ºç¾ã€‚æ³¨æ„ï¼š`'.'` çš„å‰é¢ä¸ä¸€å®šè¦æœ‰æ•¸å­—ï¼Œä¾‹å¦‚ï¼š`\".1\" -> true`ã€‚\n3. `'e'` åªèƒ½å‡ºç¾ä¸€æ¬¡ï¼Œä¸”è¦åœ¨æ•¸å­—ä¹‹å¾Œå‡ºç¾ã€‚æ³¨æ„ `'e'` çš„å¾Œé¢ä¸€å®šé‚„è¦æœ‰æ•¸å­—ã€‚\n4. `'+'`ã€`'-'` ä¸€å®šè¦åœ¨é–‹é ­ï¼Œæˆ–æ˜¯ `'e'` çš„æ­£å¾Œé¢å‡ºç¾ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nä¸€é–‹å§‹å…ˆå»é™¤é ­å°¾çš„ç©ºç™½ï¼Œæ¥è‘—å†æª¢æŸ¥å‰©ä¸‹çš„å­—ä¸²ï¼Œå¯ä»¥çŸ¥é“å‰©ä¸‹çš„å­—ä¸²å…§åªèƒ½å‡ºç¾ `0 ~ 9`, `'.'`, `'e'`, `'+'`, `'-'`ï¼Œåªè¦æœ‰å…¶ä»–å­—å…ƒå‡ºç¾ä¸€å¾‹ä¸åˆæ³•ã€‚\n\næ¥è‘—ç´€éŒ„ `numberVis` ä»£è¡¨æ•¸å­—æœ‰æ²’æœ‰å‡ºç¾éï¼›`eVis` ä»£è¡¨ `'e'` æœ‰æ²’æœ‰å‡ºç¾éï¼›`pointVis` ä»£è¡¨ `.` æœ‰æ²’æœ‰å‡ºç¾éã€‚æœ€å¾Œåˆæ³•çš„æ¢ä»¶æ˜¯ `numberVis = true`ã€‚\n\næ³¨æ„ `'e'` å‡ºç¾éå¾Œæ‡‰è©²è¦å°‡ `numberVis` è¨­ç‚º `false`ï¼Œå› ç‚º `'e'` å¾Œé¢ä¸€å®šè¦æœ‰æ•¸å­—ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/valid-number/\n * Runtime; 0ms\n */\n\nclass Solution {\npublic:\n  bool isNumber(string s) {\n    int n = (int)s.length();\n\n    int l = 0, r = n - 1;\n    while (l < n && s[l] == ' ') l++;\n    while (r >= l && s[r] == ' ') r--;\n\n    bool numberVis = false;\n    bool eVis = false;\n    bool pointVis = false;\n    for (int i = l; i <= r; i++) {\n      if (s[i] >= '0' && s[i] <= '9') {\n        numberVis = true;\n      } else if (s[i] == '.') {\n        // '.' è¦åœ¨ 'e' ä¹‹å‰ï¼Œä¸” '.' åªèƒ½å‡ºç¾ä¸€æ¬¡\n        if (eVis || pointVis) return false;\n        pointVis = true;\n      } else if (s[i] == 'e') {\n        // 'e' è¦åœ¨æ•¸å­—ä¹‹å¾Œï¼Œä¸” 'e' åªèƒ½å‡ºç¾ä¸€æ¬¡\n        if (eVis || !numberVis) return false;\n        numberVis = false;\n        eVis = true;\n      } else if (s[i] == '+' || s[i] == '-') {\n        // '+', '-' åªèƒ½å‡ºç¾åœ¨é–‹é ­æˆ–æ˜¯ 'e' çš„æ­£å¾Œé¢\n        if (i != l && s[i - 1] != 'e') return false;\n      } else {\n        return false;\n      }\n    }\n    return numberVis;\n  }\n};\n\n```\n","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 57 - Insert Interval","url":"/LeetCode-Insert-Interval/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/insert-interval/](https://leetcode.com/problems/insert-interval/)\n\nçµ¦å®šä¸€å€‹é›†åˆçš„å€é–“ï¼Œæ’å…¥ä¸€å€‹æ–°çš„å€é–“ä¸¦è¼¸å‡ºçµæœã€‚å·²çŸ¥çµ¦å®šçš„å€é–“éƒ½ä¸é‡ç–Šä¸”å·²ç¶“ç”±å·¦åˆ°å³æ’å¥½ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n## Example 1:\n```\nInput: intervals = [[1,3],[6,9]], newInterval = [2,5]\nOutput: [[1,5],[6,9]]\n```\n\n## Example 2:\n```\nInput: intervals = [[1,2],[3,5],[6,7],[8,10],[12,16]], newInterval = [4,8]\nOutput: [[1,2],[3,10],[12,16]]\nExplanation: Because the new interval [4,8] overlaps with [3,5],[6,7],[8,10].\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå‡è¨­åŸå€é–“ç‚º `interval`ï¼Œæ–°å€é–“ç‚º `newInterval`ã€‚ä¸”å€é–“çš„å·¦é‚Šç•Œç‚º `interval.left`ã€å³é‚Šç•Œç‚º `interval.right`ã€‚\n\né¦–å…ˆï¼š\n1. è‹¥æ–°å€é–“çš„å·¦é‚Šç•Œåœ¨ä¸€å€‹æŸä¸€åŸå€é–“ä¸­ï¼Œå³ `interval.left <= newInterval.left <= interval.right`ï¼š\n  å‰‡å°‡ `newInterval.left` å»¶ä¼¸è‡³ `interval.left` ä¸¦ä¸æœƒä½¿ç­”æ¡ˆæ”¹è®Šã€‚\n2. è‹¥æ–°å€é–“çš„å³é‚Šç•Œåœ¨ä¸€å€‹æŸä¸€åŸå€é–“ä¸­ï¼Œå³ `interval.left <= newInterval.right <= interval.right`ï¼š\n  å‰‡å°‡ `newInterval.left` å»¶ä¼¸è‡³ `interval.right` ä¸¦ä¸æœƒä½¿ç­”æ¡ˆæ”¹è®Šã€‚\n\nåšåˆ°ä¸Šè¿°å…©é»å¾Œï¼Œå¯ä»¥ç™¼ç¾è‹¥åŸå€é–“è‹¥èˆ‡æ–°å€é–“é‡ç–Šï¼Œå‰‡å¿…å®šè¢«åŒ…è¦†åœ¨æ–°å€é–“ä¹‹ä¸­ã€‚\n\næ‰€ä»¥åŸå€é–“èˆ‡æ–°å€é–“çš„é—œä¿‚åªå‰©ä¸‹ä¸‰ç¨®ï¼š\n1. èˆ‡æ–°å€é–“ä¸é‡ç–Šä¸”åœ¨æ–°å€é–“çš„å·¦å´ï¼Œå³ `interval.right > newInterval.left`ï¼š\n   å‰‡ç›´æ¥å°‡åŸå€é–“ä¿ç•™åœ¨æ–°å€é–“çš„å·¦å´ã€‚\n2. èˆ‡æ–°å€é–“ä¸é‡ç–Šä¸”åœ¨æ–°å€é–“çš„å³å´ï¼Œå³ `interval.left < newInterval.right`ï¼š\n   å‰‡ç›´æ¥å°‡åŸå€é–“ä¿ç•™åœ¨æ–°å€é–“çš„å³å´ã€‚\n3. èˆ‡æ–°å€é–“é‡ç–Š\bï¼Œå‰‡åŸå€é–“è¢«åŒ…è¦†åœ¨æ–°å€é–“ä¹‹ä¸­ï¼Œå³ `newInterval.left <= interval.left <= interval.right <= newInterval.right`ï¼š\n   å‰‡åŸå€é–“æ¶ˆå¤±ã€‚\n   \n# å¯¦ä½œç´°ç¯€\n\né¦–å…ˆï¼Œ\n1. `interval.left <= newInterval.left <= interval.right`ï¼Œå‰‡å»¶ä¼¸ `newInterval.left`ï¼Œå³ `newInterval.left = interval.left`ã€‚\n2. `interval.left <= newInterval.right <= interval.right`ï¼Œå‰‡å»¶ä¼¸ `newInterval.right`ï¼Œå³ `newInterval.right = interval.right`ã€‚\n\nå†ä¾†ï¼Œä¾åºå°‡å€é–“åŠ å…¥ä¸€å€‹ç©ºçš„é›†åˆ `newIntervals` ä¹‹ä¸­ï¼Œæ‰€æœ‰ä¸è¢«æ–°å€é–“çš„åŸå€é–“éƒ½èƒ½åŠ å…¥ã€‚è¦æ³¨æ„åŠ å…¥çš„å€é–“åœ¨æ–°å€é–“çš„å·¦å´é‚„æ˜¯å³å´ã€‚\n\nç­†è€…çš„ä½œæ³•ç‚ºå…ˆå°‡æ–°å€é–“åŠ å…¥ `newIntervals` ä¹‹ä¸­ï¼Œè‹¥åŸå€é–“åœ¨æ–°å€é–“å·¦å´ï¼Œå‰‡å°‡ `newInterals` çš„æœ€å¾Œä¸€å€‹å…ƒç´ ï¼ˆå³ `newInterval`ï¼‰å–ä»£æˆåŸå€é–“ï¼Œä¸¦å†æ”¾å…¥ä¸€æ¬¡ `newInterval`ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/insert-interval/\n * Runtime: 52ms\n */\n\nclass Solution {\npublic:\n  vector<vector<int>> insert(vector<vector<int>>& intervals, vector<int>& newInterval) {\n    // å»¶ä¼¸æ–°å€é–“\n    for (auto interval: intervals) {\n      if (interval[0] <= newInterval[0] && newInterval[0] <= interval[1]) newInterval[0] = interval[0];\n      if (interval[0] <= newInterval[1] && newInterval[1] <= interval[1]) newInterval[1] = interval[1];\n    }\n    // å…ˆå°‡æ–°çš„å€é–“åŠ å…¥\n    vector<vector<int>> newIntervals{newInterval};\n    for (auto interval: intervals) {\n      // è‹¥åŸå€é–“ä¸è¢«æ–°å€é–“åŒ…å«ï¼Œå‰‡å¯ä»¥åŠ å…¥\n      if (!(newInterval[0] <= interval[0] && interval[1] <= newInterval[1])) {\n        if (interval[1] < newInterval[0]) {\n          // åœ¨æ–°å€é–“çš„å·¦å´ï¼Œå‰‡äº¤æ›åŸå€é–“ï¼Œæ–°å€é–“çš„ä½ç½®\n          newIntervals.back() = interval;\n          newIntervals.emplace_back(newInterval);\n        } else {\n          // åœ¨æ–°å€é–“çš„å³å´ï¼Œç›´æ¥åŠ å…¥\n          newIntervals.emplace_back(interval);\n        }\n      }\n    }\n    return newIntervals;\n  }\n};\n\n```\n","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 52 - N-Queens II","url":"/LeetCode-N-Queens-II/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/n-queens-ii/](https://leetcode.com/problems/n-queens-ii/)\n\næ±‚ **N-çš‡å** çš„è§£çš„æ•¸é‡ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nInput: 4\nOutput: 2\nExplanation: There are two distinct solutions to the 4-queens puzzle as shown below.\n[\n [\".Q..\",  // Solution 1\n  \"...Q\",\n  \"Q...\",\n  \"..Q.\"],\n\n [\"..Q.\",  // Solution 2\n  \"Q...\",\n  \"...Q\",\n  \".Q..\"]\n]\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nèˆ‡ä¸Šä¸€é¡Œï¼š[LeetCode N-Queens](https://blog.justin0u0.com/LeetCode-N-Queens) ç›¸åŒï¼Œä½†æ˜¯ä¸ç”¨ç´€éŒ„è§£çš„æ•¸é‡ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œç´°ç¯€å¯ä»¥åƒè€ƒ [LeetCode N-Queens](https://blog.justin0u0.com/LeetCode-N-Queens)ï¼Œæœ¬é¡Œåœ¨ `row` ç­‰æ–¼ `n` æ™‚ä¸éœ€è¦ç´€éŒ„è§£çš„æ¨£å­ï¼Œåªéœ€è¦å°‡ä¸€å€‹è¨ˆæ•¸å™¨ `solutions` åŠ ä¸€å³å¯ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/n-queens-ii/\n * Runtime: 8ms\n */\n\nclass Solution {\nprivate:\n  int solutions = 0;\n  void solver(vector<int>& col, int n) {\n    // row ç‚ºç•¶å‰è¦æ”¾å…¥çš„åˆ—\n    int row = (int)col.size();\n    // å·²ç¶“æ”¾æ»¿ï¼Œå°‡ solutions åŠ ä¸€\n    if (row == n) {\n      solutions++;\n      // éè¿´çµ‚æ­¢ä¸¦è¿”å›\n      return;\n    }\n\n    // å˜—è©¦æ”¾å…¥æ¯ä¸€è¡Œï¼Œå˜—è©¦å°‡çš‡åæ”¾åœ¨ (row, i)\n    for (int i = 0; i < n; i++) {\n      bool ok = true;\n      // æª¢æŸ¥å‰é¢æ”¾å…¥çš„çš‡åæœ‰æ²’æœ‰è¡çªï¼Œå‰é¢çš„çš‡ååœ¨ (j, col[j])\n      for (int j = 0; j < row; j++) {\n        // æœ‰è¡çªï¼Œå°‡ ok è¨­æˆ false\n        if (col[j] == i || j + col[j] == row + i || j - col[j] == row - i) {\n          ok = false;\n          break;\n        }\n      }\n      // æ²’æœ‰è¡çª\n      if (ok) {\n        // å°‡çš‡åæ”¾åœ¨ (row, i)\n        col.emplace_back(i);\n        solver(col, n);\n        // éè¿´çµæŸå¾Œå°‡æ”¾åœ¨ç¬¬ row åˆ—çš„çš‡åæ‹¿å‡ºä¾†\n        col.pop_back();\n      }\n    }\n  }\npublic:\n  int totalNQueens(int n) {\n    vector<int> col;\n    solver(col, n);\n    return solutions;\n  }\n};\n\n```\n","tags":["LeetCode","å›æœ”æ³•ï¼ˆBacktrackingï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 51 - N-Queens","url":"/LeetCode-N-Queens/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/n-queens/](https://leetcode.com/problems/n-queens/)\n\næ±‚ **N-çš‡å** çš„æ‰€æœ‰å¯è¡Œè§£ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nInput: 4\nOutput: [\n [\".Q..\",  // Solution 1\n  \"...Q\",\n  \"Q...\",\n  \"..Q.\"],\n\n [\"..Q.\",  // Solution 2\n  \"Q...\",\n  \"...Q\",\n  \".Q..\"]\n]\nExplanation: There exist two distinct solutions to the 4-queens puzzle as shown above.\n```\n\n<!-- More -->\n\n# æƒ³æ³•\nå…«çš‡åçš„è§£å¯ä»¥åˆ©ç”¨å›æœ”æ³•ä¾†æ±‚å‡ºã€‚\n\næ ¹æ“šçš‡åçš„æ”»æ“Šè¦å‰‡ï¼Œå¯ä»¥çŸ¥é“ä¸€è¡Œæœ€å¤šåªæœƒæ”¾å…¥ä¸€å€‹çš‡åã€‚æ‰€ä»¥å›æœ”æ³•éç¨‹ç‚ºåˆ©ç”¨éè¿´ï¼Œå˜—è©¦åœ¨æ¯ä¸€å€‹åˆ—ï¼ˆRowï¼‰ä¸­æŒ‘ä¸€å€‹è¡Œï¼ˆColumnï¼‰æ”¾å…¥çš‡åï¼Œä¸¦è¨˜éŒ„ä¸‹ä¾†ä»¥åˆ©ä¸‹ä¸€å€‹ Row è¦æŒ‘é¸ä½ç½®æ™‚èƒ½æª¢æŸ¥æ­¤ä½ç½®æ˜¯å¦èƒ½æ”¾å…¥çš‡åã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nåˆ©ç”¨éè¿´å‡½æ•¸ `solver(col, n)` ä¾†æ±‚è§£ã€‚`col` ç‚ºä¸€é™£åˆ—ï¼Œ`col[i]` ç´€éŒ„ç¬¬ `i` åˆ—ï¼ˆRowï¼‰çš„çš‡åæ”¾åœ¨å“ªä¸€å€‹è¡Œï¼ˆColumnï¼‰ã€‚\n\né¦–å…ˆï¼Œ`col` é™£åˆ—çš„å¤§å°ï¼Œç´€éŒ„ç‚º `row`ï¼Œå³ç‚ºç•¶å‰è¦æ”¾å…¥çš„æ˜¯å“ªå€‹ Rowã€‚åªè¦ç•¶ `row` ä¸ç­‰æ–¼ `n` æ™‚ï¼Œå¯ä»¥çŸ¥é“ç›¤é¢é‚„æ²’æœ‰è¢«æ”¾æ»¿ã€‚\n\nå‰‡åˆ©ç”¨è¿´åœˆéæ­· `i = 0 ~ n - 1`ï¼Œ`i` ä»£è¡¨ç•¶å‰çš„æƒ³è¦æ”¾å…¥çš„è¡Œï¼ˆColumnï¼‰ã€‚è¦èƒ½åœ¨ç¬¬ `row` åˆ—çš„ç¬¬ `i` è¡Œæ”¾ä¸‹çš‡åï¼Œå¿…é ˆæª¢æŸ¥é€™å€‹çš‡åæœƒä¸æœƒæ”»æ“Šåˆ°å…¶ä»–å‰é¢å·²ç¶“æ”¾ä¸‹çš„çš‡åã€‚\n\néæ­· `j = 0 ~ row - 1`ï¼Œ`(j, col[j])` ä»£è¡¨å‰é¢å·²ç¶“æ”¾ä¸‹çš„çš‡åçš„ `(åˆ—ã€è¡Œ)`ã€‚ä¸”å·²çŸ¥ç•¶å‰å˜—è©¦è¦æ”¾å…¥çš„çš‡ååœ¨ `(row, i)`ã€‚æ‰€ä»¥ç•¶ï¼š\n\n1. å…©çš‡ååœ¨åŒä¸€åˆ—ä¸Šï¼š`j == row`\n2. **å…©çš‡ååœ¨åŒä¸€å°è§’ç·šä¸Šï¼š`j + col[j] == row + i` æˆ–æ˜¯ `j - col[j] == row - i`**\n\nä»£è¡¨ä¸èƒ½å°‡çš‡åæ”¾åœ¨ç¬¬ `row` åˆ—çš„ç¬¬ `i` è¡Œä¸Šã€‚\n\næœ€å¾Œï¼Œç•¶ `row` ç­‰æ–¼ `n` æ™‚ï¼Œä»£è¡¨çš‡åå·²ç¶“æ”¾æ»¿ï¼Œæ‰€ä»¥ç´€éŒ„ç•¶å‰ç›¤é¢çš„è§£ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/n-queens/\n * Runtime: 16ms\n */\n\nclass Solution {\nprivate:\n  // ç´€éŒ„æ‰€æœ‰å¯è¡Œè§£ç”¨\n  vector<vector<string>> solutions;\n\n  // éè¿´å‡½æ•¸ solver\n  void solver(vector<int>& col, int n) {\n    // row ç‚ºç•¶å‰è¦æ”¾å…¥çš„åˆ—\n    int row = (int)col.size();\n\n    // å·²ç¶“æ”¾æ»¿ï¼Œå‰‡ç´€éŒ„ç­”æ¡ˆåˆ° solutions\n    if (row == n) {\n      vector<string> solution;\n      // i ç‚ºåˆ—\n      for (int i = 0; i < n; i++) {\n        string s = \"\";\n        // j ç‚ºè¡Œ\n        for (int j = 0; j < n; j++)\n          s += (col[i] == j) ? 'Q' : '.';\n        solution.emplace_back(s);\n      }\n      solutions.emplace_back(solution);\n      // éè¿´çµ‚æ­¢ä¸¦è¿”å›\n      return;\n    }\n\n    // å˜—è©¦æ”¾å…¥æ¯ä¸€è¡Œï¼Œå˜—è©¦å°‡çš‡åæ”¾åœ¨ (row, i)\n    for (int i = 0; i < n; i++) {\n      bool ok = true;\n      // æª¢æŸ¥å‰é¢æ”¾å…¥çš„çš‡åæœ‰æ²’æœ‰è¡çªï¼Œå‰é¢çš„çš‡ååœ¨ (j, col[j])\n      for (int j = 0; j < row; j++) {\n        // æœ‰è¡çªï¼Œå°‡ ok è¨­æˆ false\n        if (col[j] == i || j + col[j] == row + i || j - col[j] == row - i) {\n          ok = false;\n          break;\n        }\n      }\n      // æ²’æœ‰è¡çª\n      if (ok) {\n        // å°‡çš‡åæ”¾åœ¨ (row, i)\n        col.emplace_back(i);\n        solver(col, n);\n        // éè¿´çµæŸå¾Œå°‡æ”¾åœ¨ç¬¬ row åˆ—çš„çš‡åæ‹¿å‡ºä¾†\n        col.pop_back();\n      }\n    }\n  }\npublic:\n  vector<vector<string>> solveNQueens(int n) {\n    vector<int> col;\n    solver(col, n);\n    return solutions;\n  }\n};\n\n```","tags":["LeetCode","å›æœ”æ³•ï¼ˆBacktrackingï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 45 - Jump Game II","url":"/LeetCode-Jump-Game-II/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/jump-game-ii/submissions/](https://leetcode.com/problems/jump-game-ii/submissions/)\n\nçµ¦ä¸€éè² çš„æ•´æ•¸åºåˆ—ï¼Œä¸€é–‹å§‹åœ¨åºåˆ—çš„ç¬¬ä¸€æ ¼ä¸Šã€‚åºåˆ—çš„å€¼ä»£è¡¨åœ¨æ­¤ä½ç½®æ™‚æœ€å¤šå¯ä»¥è·³å¤šå°‘è·é›¢ï¼Œæ±‚æœ€å°‘å¹¾æ­¥å¯ä»¥åˆ°é”åºåˆ—çš„æœ€å¾Œä¸€æ ¼ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nInput: [2,3,1,1,4]\nOutput: 2\nExplanation: The minimum number of jumps to reach the last index is 2.\n    Jump 1 step from index 0 to 1, then 3 steps to the last index.\n```\n\n<!-- More -->\n\n# æƒ³æ³•\nå‡è¨­åºåˆ—çš„ç¬¬ i å€‹å…ƒç´ ç‚º Aiï¼Œä¸”åºåˆ—å¾ 0 é–‹å§‹ç·¨è™Ÿã€‚\n\nåœ¨ç¬¬ 0 æ­¥çš„æ™‚å€™ï¼Œå‡è¨­ `R0 = 0`ï¼Œå‰‡å¯ä»¥åˆ°é”çš„ç¯„åœåœ¨ `0 ~ R0`ã€‚\n\nç¬¬ 1 æ­¥æ™‚ï¼Œä¸€æ­¥èƒ½åˆ°é”çš„ç¯„åœåœ¨ `0 ~ R1`ï¼Œå…¶ä¸­ `R1 = A0`ã€‚ä½†æ˜¯å¾ `0 ~ R0` çš„é€™å€‹å€é–“å‡ºç™¼ï¼Œå¿…å®šåªèƒ½åˆ°é” `0 ~ R1`ï¼Œæ‰€ä»¥è¦ç®—å‡ºç¬¬ 2 æ­¥èƒ½åˆ°é”çš„ç¯„åœæ™‚ï¼Œå¯ä»¥æ’é™¤å¾ `0 ~ R0` å‡ºç™¼çš„å¯èƒ½æ€§ã€‚å› æ­¤ç¬¬ 2 æ­¥å¯ä»¥åˆ°é”çš„ç¯„åœæ‡‰è©²æ˜¯ç”± `[R0 + 1, R1]` å‡ºç™¼ï¼š\n\n$$\\bigcup\\ [i,\\ i+A_i],\\quad\\forall\\ i\\in [R0+1, R1]$$\n\nå‡è¨­è¯é›†å¾Œçš„ç¯„åœåœ¨ `[L2, R2]`ï¼Œä»£è¡¨ `[0 ~ R2]` éƒ½å¯ä»¥åœ¨ 2 æ­¥å…§åˆ°é”ã€‚ä½†æ˜¯å¾ `0 ~ R1` é€™å€‹å€é–“å‡ºç™¼ï¼Œå¿…å®šåªèƒ½åˆ°é” `0 ~ R2`ï¼Œæ‰€ä»¥è¦ç®—å‡ºç¬¬ 3 æ­¥èƒ½åˆ°é”çš„ç¯„åœæ™‚ï¼Œå¯ä»¥æ’é™¤å¾ç¬¬ `0 ~ R1` æ ¼å‡ºç™¼çš„å¯èƒ½æ€§ï¼Œå› æ­¤ç¬¬ 3 æ­¥å¯ä»¥åˆ°é”çš„ç¯„åœæ‡‰è©²æ˜¯ç”± `[R1 + 1, R2]` å‡ºç™¼ï¼š\n\n$$\\bigcup\\ [j,\\ j+A_j],\\quad\\forall\\ j\\in [R1+1, R2]$$\n\nä»¥æ­¤é¡æ¨ï¼Œå¯ä»¥ç™¼ç¾è¦ç®—ç¬¬ `i` æ­¥èƒ½åˆ°é”çš„å€é–“ï¼Œåªéœ€è¦ç”± `i - 1` æ­¥èƒ½å¤šèµ°åˆ°çš„å€é–“å‡ºç™¼è¨ˆç®—å°±å¥½ã€‚\n\nå‡è¨­ `N` ç‚ºåºåˆ—é•·åº¦ï¼Œå› ç‚ºæ¯ä¸€å€‹å€é–“éƒ½ä¸é‡è¤‡ï¼Œæ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N)`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nç´€éŒ„ `[iL, iR]` å€é–“ï¼Œä»£è¡¨è¦å¾é€™å€‹å€é–“å‡ºç™¼æ‰¾ä¸‹ä¸€æ­¥å¯ä»¥åˆ°å“ªå€‹ç¯„åœã€‚`steps` ç‚ºç•¶å‰çš„æ­¥æ•¸ã€‚\n\nåˆå§‹æ™‚ï¼Œ`steps = 0`ï¼Œä¸” `[iL, iR] = [0, 0]`ã€‚\n\næ¯ä¸€æ¬¡éƒ½å¾ `[iL, iR]` å€é–“å‡ºç™¼ï¼Œå°‹æ‰¾ä¸‹ä¸€å€‹ `iR`ï¼Œç´€éŒ„ç‚º `next_iR`ï¼š\n$$next\\_iR=max(i + Ai),\\quad\\forall\\ i\\in [iL, iR]$$\nè€Œä¸‹ä¸€å€‹ `iL` å‰‡ç‚º `iR + 1`ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/jump-game-ii/\n * Runtime: 20ms\n */\n\nclass Solution {\npublic:\n  int jump(vector<int>& nums) {\n    int n = (int)nums.size();\n    int steps = 0;\n    int iL = 0, iR = 0;\n    // iR >= n - 1ï¼Œä»£è¡¨å·²ç¶“å¯ä»¥èµ°åˆ°æœ€å¾Œä¸€æ ¼\n    while (iR < n - 1) {\n      int next_iR = 0;\n      // å¾ [iL, iR] å‡ºç™¼æ‰¾ä¸‹ä¸€æ­¥çš„ç¯„åœ\n      for (int i = iL; i <= iR; i++)\n        next_iR = max(next_iR, i + nums[i]);\n      // ä¸‹ä¸€å€‹ iL\n      iL = iR + 1;\n      // ä¸‹ä¸€å€‹ iR\n      iR = next_iR;\n      // æ¯ä¸€æ¬¡éƒ½æŠŠ steps + 1\n      steps++;\n    }\n    return steps;\n  }\n};\n\n```\n","tags":["LeetCode","Greedyï¼ˆè²ªå¿ƒï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 44 - Wildcard Matching","url":"/LeetCode-Wildcard-Matching/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/wildcard-matching/](https://leetcode.com/problems/wildcard-matching/)\n\nçµ¦ä¸€å€‹å­—ä¸² `s` å’Œæ¨£æ¿ï¼ˆpatternï¼‰ `p`ï¼Œå¯¦ä½œæ”¯æ´ `'?'` å’Œ `'*'` çš„ wildcard pattern matchingã€‚\n\n```\n'?' Matches any single character.\n'*' Matches any sequence of characters (including the empty sequence).\n```\n\nè¨ˆç®— `s` æ˜¯å¦åŒ¹é… `p`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n```\nInput:\ns = \"aa\"\np = \"a\"\nOutput: false\nExplanation: \"a\" does not match the entire string \"aa\".\n```\n\n## Example 2:\n```\nInput:\ns = \"aa\"\np = \"*\"\nOutput: true\nExplanation: '*' matches any sequence.\n```\n\n## Example 3:\n```\nInput:\ns = \"cb\"\np = \"?a\"\nOutput: false\nExplanation: '?' matches 'c', but the second letter is 'a', which does not match 'b'.\n```\n\n## Example 4:\n```\nInput:\ns = \"adceb\"\np = \"*a*b\"\nOutput: true\nExplanation: The first '*' matches the empty sequence, while the second '*' matches the substring \"dce\".\n```\n\n## Example 5:\n```\nInput:\ns = \"acdcb\"\np = \"a*c?b\"\nOutput: false\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\næ­¤é¡Œèˆ‡ [LeetCode 10 - Regular Expression Matching](https://blog.justin0u0.com/LeetCode-Regular-Expression-Matching) é¡Œç›®é¡ä¼¼ï¼Œå¯¦ä½œèµ·ä¾†ä¹Ÿæ¯”è¼ƒç°¡å–®ã€‚\n\næœ‰é—œå‹•æ…‹è¦åŠƒçš„è©³ç´°èªªæ˜å¯ä»¥åƒè€ƒä¸Šè¿°é¡Œç›®ç¶²å€ã€‚é€™è£¡åªåšç°¡å–®çš„èªªæ˜ã€‚\n\n## DP ç‹€æ…‹\nå‡è¨­å…©å­—ä¸²åˆ†åˆ¥ç‚º `s` ä»¥åŠ `p`ï¼Œè€Œä¸”å¾ç´¢å¼• 1 é–‹å§‹ç·¨è™Ÿã€‚\næ‰€ä»¥æˆ‘å€‘å¯ä»¥å®šç¾© DP ç‹€æ…‹ç‚ºï¼š `d(i, j) = s[1 ~ i], p[1 ~ j] æ˜¯å¦åŒ¹é…`ã€‚\n\n## DP è½‰ç§»\n\n1. è‹¥ `p[j] = '*'`ï¼š\n   1. è‹¥ `'*'` é‡è¤‡äº† 0 æ¬¡ï¼Œå‰‡ `d(i, j) = 1` è‹¥ä¸”å”¯è‹¥ `d(i - 1, j) = 1`ï¼Œä¹Ÿå°±æ˜¯ `s[1 ~ i - 1]` åŒ¹é…åˆ° `p[1 ~ j]`ã€‚\n   2. è‹¥ `'*'` é‡è¤‡äº†ä¸€æ¬¡ä»¥ä¸Šï¼Œå› ç‚º `'*'` èƒ½ä»£è¡¨ä»»ä½•å­—å…ƒï¼Œæ‰€ä»¥ `d(i, j) = 1` è‹¥ä¸”å”¯è‹¥ `d(i, j - 1) = 1`ï¼Œä¹Ÿå°±æ˜¯ `s[1 ~ i]` åŒ¹é…åˆ° `p[1 ~ j - 1]`ã€‚\n2. è‹¥ `p[j]` ç‚ºä¸€èˆ¬å­—æ¯ï¼Œå‰‡ `d(i, j) = 1` è‹¥ä¸”å”¯è‹¥ `d(i - 1, j - 1) = 1` ä¸” `s[i] = p[j]`ã€‚ä¹Ÿå°±æ˜¯å¦‚æœ `s[1 ~ i - 1]` åŒ¹é…åˆ° `p[1 ~ j - 1]` ä¸” `s[i] = p[j]`ã€‚\n3. è‹¥ `p[j] = '?'`ï¼Œå‰‡èˆ‡ç¬¬äºŒé»é¡ä¼¼ã€‚å› ç‚º `'?'` èƒ½åŒ¹é…åˆ°ä»»ä½•å­—å…ƒï¼Œæ‰€ä»¥ `s[i] = p[j]` çš„æ¢ä»¶æ°¸é æˆç«‹ã€‚\n  \n## DP ç¸½æ•´ç†\nç¶œåˆä¸Šè¿° 3 é»ï¼Œå¾—åˆ°ï¼š\n  $$d(i,\\ j)=d(i-1,\\ j)\\ |\\ d(i,\\ j-1)\\quad if\\ p[j]=*$$\n  $$d(i,\\ j)=d(i-1,\\ j-1)\\quad if\\ s[i]=p[j]\\ or\\ p[j]=?$$\n\næœ€å¾Œè€ƒæ…®é‚Šç•Œæƒ…æ³ï¼š\n1. åˆå§‹åŒ– DP é™£åˆ—ç‚º `false`\n2. `d(0, 0) = 1`ï¼š`s` èˆ‡ `p` ç‚ºç©ºæ‡‰è©²ç®—æ˜¯åŒ¹é…ã€‚\n3. `d(i, 0) = 0, i > 0`ï¼š`p` ç‚ºç©ºï¼Œä½† `s` ä¸ç‚ºç©ºï¼Œä¸åŒ¹é…ã€‚\n4. `d(0, i)`ï¼šèˆ‡ DP è½‰ç§»å¼ç›¸åŒï¼Œä½†åªèƒ½å¾ `d(0, i - 1)` è½‰ç§»ï¼ˆå› ç‚ºç„¡ `d(-1, i)`ï¼‰ã€‚\n\næœ€çµ‚ç­”æ¡ˆç‚º `dp[|s|][|p|]`ã€‚\n\n# å¯¦ä½œç´°ç¯€\nçœŸå¯¦æ¸…æ³ä¸­ï¼Œ `s` èˆ‡ `p` çš†ç‚º Base 0ï¼ˆç´¢å¼•å¾ 0 é–‹å§‹ï¼‰ï¼Œå› æ­¤æ‰€æœ‰çš„è½‰ç§»éƒ½ç”± `d(i, j)` è½‰ç‚º `d(i + 1, j + 1)`ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/wildcard-matching/\n * Runtime: 356ms\n */\n\nclass Solution {\npublic:\n  bool isMatch(string s, string p) {\n    int sl = (int)s.length();\n    int pl = (int)p.length();\n    vector<vector<bool>> dp(sl + 1, vector<bool>(pl + 1));\n\n    // åˆå§‹åŒ–é™£åˆ—\n    dp[0][0] = true;\n    for (int i = 0; i < pl; i++) {\n      if (p[i] == '*') dp[0][i + 1] = dp[0][i];\n    }\n\n    for (int i = 0; i < sl; i++) {\n      for (int j = 0; j < pl; j++) {\n        if (p[j] == '*') {\n          \b// è½‰ç§» 1\n          dp[i + 1][j + 1] = (dp[i][j + 1] || dp[i + 1][j]);\n        } else if (p[j] == '?' || s[i] == p[j]) {\n          // è½‰ç§» 2\n          dp[i + 1][j + 1] = dp[i][j];\n        }\n      }\n    }\n    return dp[sl][pl];\n  }\n};\n\n```","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 42 - Trapping Rain Water","url":"/LeetCode-Trapping-Rain-Water/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/trapping-rain-water/](https://leetcode.com/problems/trapping-rain-water/)\n\nçµ¦å®šä¸€å€‹é•·åº¦ç‚º `N` å€‹åºåˆ—ï¼Œä»£è¡¨æµ·æ‹”é«˜åº¦ï¼Œæ¯å€‹æ¢çš„å¯¬åº¦éƒ½æ˜¯ 1ï¼Œæ±‚ä¸‹é›¨æ™‚æœƒæœ‰å¤šå°‘æ ¼æ°´ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n```\nExample:\n\nInput: [0,1,0,2,1,0,1,3,2,1,2,1]\nOutput: 6\n```\n\n![](/assets/LeetCode-Trapping-Rain-Water/trapping-rain-water-sample.png)\n\nä¸Šåœ–é¡¯ç¤ºè¼¸å…¥ç‚º `[0,1,0,2,1,0,1,3,2,1,2,1]` å¾Œ 6 æ ¼æ°´ï¼ˆè—è‰²ï¼‰æ‰€åœ¨çš„ä½ç½®ã€‚\n\n<!-- More -->\n\n# æƒ³æ³•\n\næŠŠæ¯ä¸€å€‹ä½ç½®çš„æœ€é«˜æ°´é¢é«˜åº¦åˆ†é–‹è¨ˆç®—ï¼Œåœ¨æŸå€‹ä½ç½® `i` çš„æ°´é¢é«˜åº¦ç‚ºä»¥æ­¤æ¢å¾€å·¦çš„æœ€å¤§é«˜åº¦å’Œå¾€å³çš„æœ€å¤§é«˜åº¦ä¹‹æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯ï¼š\n$$min(max(height[x]), max(height[y])),\\quad\\ \\forall x\\lt i,\\ y\\gt i$$\n\næ¯å€‹ä½ç½®çš„æœ€é«˜æ°´é¢é«˜åº¦å†æ¸›å»æ­¤ä½ç½®åŸæœ¬çš„é«˜åº¦å°±æ˜¯èƒ½ç´¯ç©çš„æ°´é‡ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nå…ˆç´€éŒ„ `left[i]` ä»£è¡¨ä½ç½® `i` çš„å·¦é‚Šå‡ºç¾éçš„æœ€å¤§é«˜åº¦ã€‚ä»¥åŠ `right[i]` ä»£è¡¨ä½ç½® `i` çš„å³é‚Šå‡ºç¾éçš„æœ€å¤§é«˜åº¦ã€‚å…ˆå°‡ `height` é™£åˆ—è¤‡è£½åˆ° `left`, `right`ã€‚\n\næ‰€ä»¥ `left` æ‡‰è©²è¦ç”±å·¦åˆ°å³è¨ˆç®— `left[i] = max(left[i], left[i - 1])`ã€‚\n\nè€Œ `right` æ‡‰è©²è¦ç”±å³åˆ°å·¦è¨ˆç®— `right[i] = max(right[i], right[i + 1])`ã€‚\n\nè¨ˆç®—å¾Œï¼Œä½ç½® `i` çš„æ°´é¢æœ€å¤§é«˜åº¦ç‚º `min(left[i], right[i])`ã€‚æ°´é‡ç‚º `min(left[i], right[i]) - height[i]`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/trapping-rain-water/\n * Runtime: 12ms\n */\n\nclass Solution {\npublic:\n  int trap(vector<int>& height) {\n    int n = (int)height.size();\n    vector<int> left(height);\n    vector<int> right(height);\n\n    for (int i = 1; i < n; i++) {\n      int j = n - i - 1;\n      left[i] = max(left[i], left[i - 1]);\n      right[j] = max(right[j], right[j + 1]);\n    }\n\n    int sum = 0;\n    for (int i = 0; i < n; i++) sum += min(left[i], right[i]) - height[i];\n    return sum;\n  }\n};\n\n```","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 41 - First Missing Positive","url":"/LeetCode-First-Missing-Positive/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/first-missing-positive/](https://leetcode.com/problems/first-missing-positive/)\n\nçµ¦ä¸€æ•¸å­—åºåˆ—ï¼Œæ‰¾å‡ºåºåˆ—ä¸­æœ€å°æ²’æœ‰å‡ºç¾çš„æ­£æ•´æ•¸ã€‚\n\nè¦æ±‚æ™‚é–“è¤‡é›œåº¦ `O(N)`ï¼Œç©ºé–“è¤‡é›œåº¦ `O(1)`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1\n```\nInput: [1,2,0]\nOutput: 3\n```\n\n## Example 2:\n```\nInput: [3,4,-1,1]\nOutput: 2\n```\n\n## Example 3:\n```\nInput: [7,8,9,11,12]\nOutput: 1\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\nå‡è¨­åºåˆ—åç‚º `a`ï¼Œé•·ç‚º `N`ï¼Œç´¢å¼•å¾é–‹å§‹ï¼Œå‰‡ç­”æ¡ˆä¸€å®šåœ¨ `1 ~ N + 1` ä¹‹é–“ã€‚\n\nè‹¥åºåˆ—æœ‰å‡ºç¾ `x`ï¼Œä¸” `x` åœ¨ `1 ~ N` ä¹‹é–“ï¼Œä¸”å°‡ `a[x - 1]` è¨­ç½®ç‚º `x` ä¾†ä»£è¡¨æ•¸å­— `x` æœ‰å‡ºç¾éã€‚å‰‡ç”±å·¦è‡³å³ç¬¬ä¸€å€‹ `a[i - 1] != i` çš„ `i` å°±æ˜¯æˆ‘å€‘è¦æ‰¾çš„ç­”æ¡ˆã€‚\n\nåœ¨å°‡ `a[x - 1]` è¨­ç½®ç‚º `x` æ™‚ï¼Œ`a[x - 1]` å¯èƒ½é‚„å­˜æ”¾è‘—å…¶ä»–æ•¸å­—ï¼Œä½†é€™æ™‚å€™å­˜æ”¾ `x` çš„ä½ç½®å°±ç©ºä¸‹ä¾†äº†ï¼Œæ‰€ä»¥å¯ä»¥æƒ³æˆæ˜¯å°‡å…©å€‹æ•¸å­—äº¤æ›ã€‚\n\næ•¸å­—äº¤æ›å¾Œï¼Œ`a[x - 1]` è¢«æ”¾ç½®åˆ°ç•¶å‰çš„ä½ç½®ï¼Œæ‰€ä»¥ `a[x - 1]` æ‰€å­˜ä¹‹æ•¸å­—è¦ç«‹å³è¢«è™•ç†ï¼Œå¦å‰‡å°‡ç¹¼çºŒå‘ä¸‹éæ­·å°±ä¸æœƒå†ç¶“éé€™å€‹æ•¸å­—äº†ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/first-missing-positive/\n * Runtime: 4ms\n */\n\nclass Solution {\npublic:\n  int firstMissingPositive(vector<int>& nums) {\n    int n = (int)nums.size();\n    for (int i = 0; i < n; i++) {\n      while (nums[i] > 0 && nums[i] <= n && nums[nums[i] - 1] != nums[i])\n        swap(nums[nums[i] - 1], nums[i]);\n    }\n    for (int i = 0; i < n; i++)\n      if (nums[i] != i + 1)\n        return i + 1;\n    return n + 1;\n  }\n};\n\n```\n","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 37 - Sudoku Solver","url":"/LeetCode-Sudoku-Solver/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/sudoku-solver/](https://leetcode.com/problems/sudoku-solver/)\n\nçµ¦ä¸€å€‹æ•¸ç¨ï¼Œä¿è­‰å­˜åœ¨å”¯ä¸€ä¸€çµ„è§£ï¼Œæ±‚å‡ºæ•¸ç¨ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n**A sudoku puzzle:**\n![](/assets/LeetCode-Sudoku-Solver/sudoku-solver-start.png)\n**The sudoku puzzle solution:**\n![](/assets/LeetCode-Sudoku-Solver/sudoku-solver-end.png)\n\n<!-- More -->\n\n# æƒ³æ³•\n\nè§£æ•¸ç¨æœ€ç°¡å–®çš„æ–¹æ³•ç‚ºå›æœ”æ³•ã€‚æ‰€è¬‚å›æœ”æ³•å…¶å¯¦å°±æ˜¯åˆ©ç”¨éè¿´æš´åŠ›å˜—è©¦ï¼Œå°æ–¼æ¯ä¸€å€‹æ•¸ç¨çš„ç©ºæ ¼ï¼Œéƒ½æš´åŠ›å˜—è©¦å¡«å…¥ `1 ~ 9`ã€‚è‹¥ç™¼ç¾å¡«ä¸ä¸‹å»äº†ï¼Œå‰‡è¿”å›åˆ°ä¸Šä¸€æ­¥å˜—è©¦å¡«å…¥ä¸‹ä¸€ç¨®æ•¸å­—ã€‚\n\nç•¶ç„¶ï¼Œè‹¥è¦è§£çš„æ•¸ç¨æ¯”ä¹ä¹˜ä¹å¤§å°æ›´å¤§ï¼Œå¯ä»¥å°‡æ•¸ç¨è½‰æ›ç‚º**ç²¾æº–è¦†è“‹å•é¡Œ**ï¼Œå†åˆ©ç”¨**èˆè¹ˆéˆ**æ±‚è§£ã€‚ï¼ˆå¾…è£œï¼‰\n\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šï¼Œéè¿´å‡½æ•¸ `solver` æ”œå¸¶ `x`, `y` ä»£è¡¨ç•¶å‰ä½ç½®ã€‚å¦‚æœç•¶å‰ä½ç½®ç‚ºæ•¸å­—å‰‡è·³éï¼Œå¦å‰‡å˜—è©¦å¡«å…¥ `1 ~ 9`ã€‚\n\nå¡«å…¥æ•¸å­— `i` æ™‚æª¢æŸ¥æ­¤ä½ç½®æ˜¯å¦èƒ½å¤ å¡«å…¥ï¼Œæ‰€ä»¥åªè¦æª¢æŸ¥ï¼š\n1. ç¬¬ `x` åˆ—ï¼ˆrowï¼‰æ˜¯å¦æœ‰ `i`ã€‚\n2. ç¬¬ `y` è¡Œï¼ˆcolumnï¼‰æ˜¯å¦æœ‰ `i`ã€‚\n3. `(x, y)` æ‰€åœ¨çš„æ–¹æ ¼ï¼ˆblockï¼‰å…§æ˜¯å¦æœ‰å¡«å…¥ `i`ã€‚\n   è‹¥æˆ‘å€‘å°‡æ–¹æ ¼ç·¨è™Ÿï¼Œç”±å·¦åˆ°å³ã€ç”±ä¸Šåˆ°ä¸‹ç‚º `0 ~ 9` è™Ÿï¼Œå‰‡ `(x, y)` æ‰€åœ¨çš„æ–¹æ ¼ç·¨è™Ÿç‚º `x / 3 * 3 + y / 3`ã€‚\n\næª¢æŸ¥æ•¸å­—å¯ä»¥ä½¿ç”¨è¿´åœˆæª¢æŸ¥ï¼Œæˆ–æ˜¯é¡å¤–ç´€éŒ„å¸ƒæ—å€¼é™£åˆ— `row[i][j]`, `col[i][j]`, `block[i][j]` åˆ†åˆ¥ä»£è¡¨ç¬¬ `i` å€‹åˆ—ã€è¡Œã€æ–¹æ ¼æœ‰æ²’æœ‰æ•¸å­— `j`ã€‚\nç•¶ç„¶ï¼Œè¦é¡å¤–ç´€éŒ„é™£åˆ—å°±å¿…é ˆåœ¨åˆå§‹åŒ–æ™‚å…ˆéæ­·æ•´å€‹æ•¸ç¨ï¼Œä½†æ˜¯åœ¨æª¢æŸ¥æ™‚å¯ä»¥ `O(1)` çŸ¥é“æ•¸å­—èƒ½å¦å¡«å…¥ã€‚\nä¸é¡å¤–ç´€éŒ„é™£åˆ—é›–ç„¶ç¨‹å¼ç¢¼è¼ƒç°¡æ½”ï¼Œä½†é€Ÿåº¦ç¨æ…¢ä¸€äº›ã€‚\n\nåœ¨ `(x, y)` å¡«å…¥æ•¸å­— `i` å¾Œï¼Œå‘ä¸‹ä¸€æ ¼éè¿´ã€‚**ä¸è¦å¿˜è¨˜åœ¨éè¿´è¿”å›å¾Œæ¢å¾©åŸæœ¬çš„ç›¤é¢**ï¼ˆåœ¨å‘¼å«å‡½æ•¸å¾Œçš„ä¸‹ä¸€è¡Œï¼‰ã€‚\nè‹¥æœ‰é¡å¤–ç´€éŒ„ `row`, `col`, `block` é™£åˆ—ï¼Œå¡«å…¥æ•¸å­—æ™‚è¦å°‡ `row[x][i]`, `col[y][i]`, `block[x / 3 * 3 + y / 3][i]` æ”¹ç‚º `true`ï¼Œéè¿´è¿”å›å¾Œï¼Œé€™äº›å€¼ä¹Ÿè¦æ¢å¾©æˆ `false`ã€‚\n\næœ€å¾Œï¼Œéè¿´çš„çµ‚æ­¢æ¢ä»¶ç‚º `x = 9`ï¼Œä»£è¡¨æ‰€æœ‰æ ¼å­å·²ç¶“å¡«å®Œã€‚\n\nå¦å¤–è¦æ³¨æ„ `board` å…§å­˜çš„ç‚º `char`ï¼Œè½‰ç‚ºå°æ‡‰æ•¸å­—æ™‚æ‡‰è©²è¦å‰ªå»å­—å…ƒçš„ ASCII ç·¨ç¢¼ã€‚\n\n# ç¨‹å¼ç¢¼\n\n## ä¸é¡å¤–ç´€éŒ„ row, col, block\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0>\n * Problem: https://leetcode.com/problems/sudoku-solver/\n * Runtime: 28ms\n */\n\nclass Solution {\nprivate:\n  bool solver(int x, int y, vector<vector<char>>& board) {\n    // éè¿´é‚Šç•Œï¼Œæ‰¾åˆ°è§£\n    if (x == 9) return true;\n\n    int nextX = y == 8 ? x + 1 : x;\n    int nextY = y == 8 ? 0 : y + 1;\n    if (board[x][y] == '.') {\n      // å˜—è©¦å¡«å…¥ 1 ~ 9\n      for (int i = 1; i <= 9; i++) {\n        bool valid = true;\n        char cell = i + '0';\n        // æª¢æŸ¥æ˜¯å¦å¯ä»¥åœ¨ (x, y) å¡«å…¥æ•¸å­— i\n        for (int j = 0; j < 9; j++) {\n          int blockX = (x / 3) * 3 + (j / 3);\n          int blockY = (y / 3) * 3 + (j % 3);\n          if (board[x][j] == cell || board[j][y] == cell || board[blockX][blockY] == cell) {\n            valid = false;\n            break;\n          }\n        }\n        if (!valid) continue;\n        // å¯ä»¥å¡«å…¥\n        board[x][y] = cell;\n        if (solver(nextX, nextY, board)) return true;\n        // æ¢å¾©ç›¤é¢\n        board[x][y] = '.';\n      }\n    } else {\n      // åŸæœ¬å°±æœ‰æ•¸å­—ï¼Œè·³é (x, y)\n      return solver(nextX, nextY, board);\n    }\n    return false;\n  }\npublic:\n  void solveSudoku(vector<vector<char>>& board) {\n    solver(0, 0, board);\n  }\n};\n\n```\n\n## é¡å¤–ç´€éŒ„ row, col, block ä¸‰å€‹å¸ƒæ—å€¼é™£åˆ—\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0>\n * Problem: https://leetcode.com/problems/sudoku-solver/\n * Runtime: 8ms\n */\n\nclass Solution {\nprivate:\n  // é¡å¤–ç´€éŒ„å¸ƒæ—é™£åˆ— col, row, block\n  bool row[9][9], col[9][9], block[9][9];\n  // å°‡é¡å¤–ç´€éŒ„çš„å¸ƒæ—é™£åˆ—å€¼åè½‰\n  inline void toggleState(int x, int y, int i) {\n    row[x][i] ^= true;\n    col[y][i] ^= true;\n    block[x / 3 * 3 + y / 3][i] ^= true;\n  }\n  bool solver(int x, int y, vector<vector<char>>& board) {\n    // éè¿´é‚Šç•Œï¼Œæ‰¾åˆ°è§£\n    if (x == 9) return true;\n\n    int nextX = y == 8 ? x + 1 : x;\n    int nextY = y == 8 ? 0 : y + 1;\n    if (board[x][y] == '.') {\n      // å˜—è©¦å¡«å…¥ 1 ~ 9\n      for (int i = 0; i < 9; i++) {\n        if (!row[x][i] && !col[y][i] && !block[x / 3 * 3 + y / 3][i]) {\n          // å¯ä»¥åœ¨ (x, y) å¡«å…¥æ•¸å­— i\n          board[x][y] = i + '1';\n          // å°‡ row, col, block è¨­æˆ 1\n          toggleState(x, y, i);\n          if (solver(nextX, nextY, board)) return true;\n          // å°‡ row, col, block è¨­æˆ 0\n          toggleState(x, y, i);\n          // æ¢å¾©ç›¤é¢\n          board[x][y] = '.';\n        }\n      }\n    } else {\n      // åŸæœ¬å°±æœ‰æ•¸å­—ï¼Œè·³é (x, y)\n      return solver(nextX, nextY, board);\n    }\n    return false;\n  }\npublic:\n  void solveSudoku(vector<vector<char>>& board) {\n    // åˆå§‹åŒ– row, col, block\n    memset(row, false, sizeof row);\n    memset(col, false, sizeof col);\n    memset(block, false, sizeof block);\n    for (int i = 0; i < 9; i++) {\n      for (int j = 0; j < 9; j++) {\n        if (board[i][j] != '.') {\n          int cell = board[i][j] - '1';\n          row[i][cell] = true;\n          col[j][cell] = true;\n          block[i / 3 * 3 + j / 3][cell] = true;\n        }\n      }\n    }\n    solver(0, 0, board);\n  }\n};\n\n```\n","tags":["LeetCode","å›æœ”æ³•ï¼ˆBacktrackingï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 32 - Longest Valid Parentheses","url":"/LeetCode-Longest-Valid-Parentheses/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/longest-valid-parentheses/](https://leetcode.com/problems/longest-valid-parentheses/)\n\nçµ¦å®šä¸€å€‹åªåŒ…å« `'('` å’Œ `')'` çš„å­—ä¸² `s`ï¼Œæ‰¾åˆ°æœ€é•·çš„åˆæ³•æ‹¬è™Ÿå­å­—ä¸²ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n\n```\nInput: \"(()\"\nOutput: 2\nExplanation: The longest valid parentheses substring is \"()\"\n```\n\n## Example 2:\n\n```\nInput: \")()())\"\nOutput: 4\nExplanation: The longest valid parentheses substring is \"()()\"\n```\n\n<!-- More -->\n\n# æƒ³æ³•\n\né¦–å…ˆï¼Œè¦åˆ¤æ–·ä¸€å€‹å­—ä¸²æ˜¯å¦ç‚ºåˆæ³•çš„æ‹¬è™Ÿå­—ä¸²ã€‚ä¸€å€‹åˆæ³•çš„æ‹¬è™Ÿï¼Œè‹¥ä¸”å”¯è‹¥ï¼Œå­—ä¸²å·¦æ‹¬è™Ÿçš„æ•¸é‡ä¸€å®šè¦ç­‰æ–¼å³æ‹¬è™Ÿçš„æ•¸é‡ï¼Œä¸”ç”±å·¦è‡³å³æ•¸ä»»ä¸€å€‹æ™‚åˆ»ï¼Œå·¦æ‹¬è™Ÿçš„æ•¸é‡éƒ½æ‡‰è©²å¤§æ–¼ç­‰æ–¼å³æ‹¬è™Ÿå‡ºç¾çš„æ•¸é‡ã€‚\n\nè¦åˆ¤æ–·å­—ä¸²æ˜¯å¦æœ‰ä¸Šè¿°çš„æ€§è³ªï¼Œå¯ä»¥ä½¿ç”¨ä¸€å€‹ `stack`ï¼Œ`stack` ç‚ºå…ˆé€²å¾Œå‡ºï¼ˆFirst-in-last-out, FILOï¼‰ä¹‹è³‡æ–™çµæ§‹ã€‚çµ¦å®šä¹‹å­—ä¸²ç”±å·¦è‡³å³ï¼Œæ¯æ¬¡é‡åˆ°å·¦æ‹¬è™Ÿï¼Œå°±å°‡å·¦æ‹¬è™Ÿæ”¾å…¥ `stack` ä¹‹ä¸­ï¼›åä¹‹ï¼Œé‡åˆ°å³æ‹¬è™Ÿæ™‚ï¼Œå°‡ `stack` ä¹‹é ‚ç«¯å…ƒç´ æ‹¿å‡ºã€‚`stack` ä¹‹é ‚ç«¯å·¦æ‹¬è™Ÿå³ç‚ºç•¶å‰å³æ‹¬è™Ÿä¹‹åŒ¹é…ã€‚è‹¥ `stack` ç‚ºç©ºï¼Œä»£è¡¨å³æ‹¬è™Ÿå‡ºç¾çš„æ•¸é‡æ¯”å·¦æ‹¬è™Ÿé‚„å¤šï¼Œæ­¤å­—ä¸²ç‚ºä¸åˆæ³•çš„å­—ä¸²ã€‚è‹¥éæ­·å®Œå­—ä¸²å¾Œ `stack` å…§é‚„æœ‰å‰©é¤˜å…ƒç´ ï¼Œä»£è¡¨å·¦æ‹¬è™Ÿæ•¸é‡å¤§æ–¼å³æ‹¬è™Ÿï¼Œæ‰€ä»¥æ­¤å­—ä¸²ä¹Ÿéåˆæ³•å­—ä¸²ã€‚\n\næœ‰äº†ä¸Šè¿°æ¦‚å¿µï¼Œæ­¤é¡Œç›®è¦æ±‚æœ€é•·åˆæ³•æ‹¬è™Ÿå­å­—ä¸²ã€‚é¡å¤–ç´€éŒ„ç•¶å‰åˆæ³•å€é–“çš„å·¦é‚Šç•Œ `left`ï¼Œä¸€é–‹å§‹ç‚º `left = -1` ä»£è¡¨ç›®å‰æ•´å€‹å­—ä¸²éƒ½æ˜¯åˆæ³•çš„ã€‚å­—ä¸²å·¦è‡³å³ï¼Œå¦‚æœé‡åˆ°å·¦æ‹¬è™Ÿï¼Œå‰‡åŠ å…¥ `stack` ä¹‹ä¸­ã€‚ç•¶é‡åˆ°å³æ‹¬è™Ÿæ™‚ï¼š\n1. `stack` ç‚ºç©ºï¼Œä»£è¡¨æ­¤å³æ‹¬è™Ÿæ²’æœ‰ä»»ä½•ä»»ä½•å·¦æ‹¬è™Ÿå¯ä»¥åŒ¹é…ï¼Œæ›´æ–° `left` ç­‰æ–¼æ­¤å³æ‹¬è™Ÿçš„ç´¢å¼•ã€‚\n2. `stack` ä¸ç‚ºç©ºï¼šå°‡å³æ‹¬è™Ÿæ‰€åŒ¹é…çš„å·¦æ‹¬è™Ÿå¾ `stack` ç§»é™¤ã€‚\n   1. å¦‚æœ `stack` å…§é‚„æœ‰å…ƒç´ ï¼Œå‰‡å³æ‹¬è™Ÿåˆ° `stack` çš„é ‚ç«¯å·¦æ‹¬è™Ÿä¹‹é–“éƒ½æ˜¯åˆæ³•æ‹¬è™Ÿå­å­—ä¸²ã€‚\n   2. å¦‚æœ `stack` ç‚ºç©ºï¼Œå‰‡å³æ‹¬è™Ÿåˆ°ä¸Šè¿°ç´€éŒ„çš„åˆæ³•å€é–“å·¦é‚Šç•Œéƒ½æ˜¯åˆæ³•æ‹¬è™Ÿå­å­—ä¸²ã€‚\n\næ¯ä¸€å€‹å­—å…ƒéƒ½åªéæ­·ä¸€æ¬¡ï¼Œè‹¥å­—ä¸²é•·åº¦ç‚º `N`ï¼Œç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N)`ã€‚\n# å¯¦ä½œç´°ç¯€\n\nå¯¦ä½œä¸Šç‚ºäº†æ–¹ä¾¿ï¼Œç­†è€…å°‡ `left` æ¨å…¥ `stack` ä¹‹ä¸­ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œç•¶é‡åˆ°å³æ‹¬è™Ÿæ™‚ï¼š\n1. `stack` é ‚ç«¯å…ƒç´ **ç­‰æ–¼** `left`ï¼Œä»£è¡¨æ­¤å³æ‹¬è™Ÿæ²’æœ‰ä»»ä½•ä»»ä½•å·¦æ‹¬è™Ÿå¯ä»¥åŒ¹é…ï¼Œæ›´æ–° `left` ç­‰æ–¼å³æ‹¬è™Ÿçš„ç´¢å¼•ï¼Œ**ä¸¦å°‡æ­¤åˆæ³•é‚Šç•Œæ¨å…¥ `stack` ä¹‹ä¸­**ã€‚\n2. `stack` é ‚ç«¯å…ƒç´ **ä¸ç­‰æ–¼** `left`ï¼šå°‡å³æ‹¬è™Ÿæ‰€åŒ¹é…çš„å·¦æ‹¬è™Ÿå¾ `stack` ç§»é™¤ï¼Œå³æ‹¬è™Ÿåˆ° `stack` çš„é ‚ç«¯å…ƒç´ ä¹‹é–“éƒ½æ˜¯åˆæ³•æ‹¬è™Ÿå­å­—ä¸²ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/longest-valid-parentheses/\n * Runtime: 8ms\n */\n\nclass Solution {\npublic:\n  int longestValidParentheses(string s) {\n    stack<int> box;\n    // å°‡ left æ¨å…¥ stack ä¹‹ä¸­\n    box.push(-1);\n    int left = -1;\n    // ç´€éŒ„ç­”æ¡ˆç”¨\n    int ans = 0;\n    for (int i = 0; i < (int)s.length(); i++) {\n      if (s[i] == '(') {\n        // å·¦æ‹¬è™Ÿï¼Œæ¨å…¥ stack ä¹‹ä¸­\n        box.push(i);\n      } else {\n        if (box.top() != left) {\n          box.pop();\n          // å³æ‹¬è™Ÿåˆ° stack ä¹‹é ‚ç«¯å…ƒç´ éƒ½ç‚ºåˆæ³•æ‹¬è™Ÿå­å­—ä¸²\n          ans = max(ans, i - box.top());\n        } else {\n          // å³æ‹¬è™Ÿæ²’æœ‰ä»»ä½•å·¦æ‹¬è™Ÿèƒ½åŒ¹é…ï¼Œæ›´æ–° left ä¸¦æ¨å…¥ stack ä¹‹ä¸­\n          box.push(i);\n          left = i;\n        }\n      }\n    }\n    return ans;\n  }\n};\n\n```\n","tags":["LeetCode","å †ç–Šï¼ˆStackï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 30 - Substring with Concatenation of All Words","url":"/LeetCode-Substring-with-Concatenation-of-All-Words/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/substring-with-concatenation-of-all-words/](https://leetcode.com/problems/substring-with-concatenation-of-all-words/)\n\nçµ¦å®šä¸€å€‹å­—ä¸² `s` å’Œä¸€å€‹ `words` é™£åˆ—ï¼Œ`words` å…§åŒ…å«é•·åº¦ä¸€æ¨£çš„å–®è©ã€‚\næ‰¾åˆ°æ‰€æœ‰çš„å­å­—ä¸²çš„é–‹é ­ç´¢å¼•å€¼ï¼Œå­å­—ä¸²å¿…é ˆæ˜¯ `words` ä¸­çš„æ¯ä¸€å€‹å–®è©å„å‡ºç¾ä¸€æ¬¡çš„é€£æ¥å­—ä¸²ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n## Example 1\n```\nInput:\n  s = \"barfoothefoobarman\",\n  words = [\"foo\",\"bar\"]\nOutput: [0,9]\nExplanation: Substrings starting at index 0 and 9 are \"barfoo\" and \"foobar\" respectively.\nThe output order does not matter, returning [9,0] is fine too.\n```\n\n## Example 2\n```\nInput:\n  s = \"wordgoodgoodgoodbestword\",\n  words = [\"word\",\"good\",\"best\",\"word\"]\nOutput: []\n```\n\n<!-- More -->\n\n# æƒ³æ³•\nå‡è¨­ `wl` ç‚ºæ¯ä¸€å€‹å–®è©çš„é•·åº¦ã€‚\n\nè¦æ‰¾çš„å­å­—ä¸²å¿…é ˆç›¸é€£ï¼Œæ‰€ä»¥å°‡å­—ä¸² `s` åˆ†ç‚º `wl` å€‹é›†åˆï¼Œåˆ†åˆ¥ç‚ºï¼š\n\n- `0`, `0 + wl`, `0 + 2 * wl`, `0 + 3 * wl` ...\n- `1`, `1 + wl`, `1 + 2 * wl`, `1 + 3 * wl` ...\n- ...\n- `(wl - 1)`, `(wl - 1) + wl`, `(wl - 1) + 2 * wl`, `(wl - 1) + 3 * wl` ...\n\nä¾‹å¦‚ `Example 1` ä¸­çš„ `s = \"barfoothefoobarman\"`, `words = [\"foo\", \"bar\"]`ï¼Œ å‰‡å¯ä»¥åˆ†ç‚º `{ \"bar\", \"foo\", \"the\", \"foo\", \"bar\", \"man\" }`, `{ \"arf\", \"oot\", \"hef\", \"oob\", \"arm\" }`, `{ \"rfo\", \"oth\", \"efo\", \"oba\", \"rma\" }` ä¸‰å€‹é›†åˆã€‚\n\nç­”æ¡ˆå¿…å®šç‚ºåŒä¸€å€‹é›†åˆå…§çš„é€£çºŒä¸€æ®µå­å­—ä¸²ã€‚\n\nåœ¨ä¸€å€‹é›†åˆä¹‹ä¸­ï¼Œåˆ©ç”¨ **Sliding Window** æ‰¾å°‹ç­”æ¡ˆã€‚æ‰€è¬‚ **Sliding Window** æ˜¯æŒ‡åˆ©ç”¨å…©å€‹æŒ‡æ¨™æ¨™ç¤ºç›®å‰çš„ç¯„åœï¼Œæˆ–æ˜¯ç¨±ä½œã€Œçª—å£ã€ã€‚åŸæœ¬çª—å£å…§ç‚ºç©ºé›†åˆï¼Œå¾ç¬¬ä¸€å€‹å­—ä¸²é–‹å§‹ï¼Œå°‡å­—ä¸²åŠ å…¥çª—å£ï¼ˆçª—å£çš„å³å´å¢åŠ ï¼Œçª—å£è®Šå¤§ï¼‰ï¼Œå¦‚æœç•¶å‰çš„å­—ä¸²åŠ å…¥å¾Œï¼Œçª—å£å…§çš„å­—ä¸²å€‘ç„¡æ³•å½¢æˆç­”æ¡ˆï¼Œå°±é€æ¬¡å°‡çª—å£å·¦å´å‘å³ï¼ˆçª—å£è®Šå°ï¼‰ï¼Œç›´åˆ°çª—å£å…§çš„å­—ä¸²å€‘å¯ä»¥å½¢æˆç­”æ¡ˆï¼Œæˆ–æ˜¯çª—å£ç‚ºç©ºã€‚\n\nè¦åˆ¤æ–·çª—å£å…§çš„ç­”æ¡ˆå¯å¦å½¢æˆç­”æ¡ˆï¼Œä¹Ÿå°±æ˜¯è¦åˆ¤æ–·çª—å£å…§çš„å­å­—ä¸²å€‘æ˜¯ä¸æ˜¯ `words` çš„å­é›†åˆã€‚å†è€…ï¼Œè‹¥çª—å£å…§çš„å­å­—ä¸²å€‘æ°å¥½ç­‰æ–¼ `words` çš„å–®è©é›†åˆï¼Œé‚£çª—å£æœ€å·¦å´çš„å­—ä¸²ä¹‹ç´¢å¼•å€¼å°±æ˜¯ä¸€å€‹åˆæ³•ç­”æ¡ˆã€‚\n\nä¸€æ¨£ä»¥ `Example 1` ç‚ºä¾‹å­ï¼Œä¸€é–‹å§‹çª—å£ç‚º `[]`ã€‚\n1. `\"bar\"` -> å°‡ `\"bar\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"bar\"]`ï¼Œæ˜¯ `words` çš„å­é›†åˆã€‚\n2. `\"foo\"` -> å°‡ `\"foo\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"bar\", \"foo\"]`ï¼Œæ°å¥½ç­‰æ–¼ `words`ï¼Œæ‰€ä»¥çª—å£å·¦å´ `\"bar\"` çš„ç´¢å¼•ç‚ºä¸€çµ„ç­”æ¡ˆã€‚\n3. `\"the\"` -> å°‡ `\"the\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"bar\", \"foo\", \"the\"]`ï¼Œä¸ç‚º `words` çš„å­é›†åˆï¼Œä¾æ¬¡å°‡å·¦å´çª—å£å‘å³ç›´åˆ°çª—å£ç‚º `words` ä¹‹å­é›†åˆæˆ–æ˜¯çª—å£ç‚ºç©ºï¼Œ`[\"bar\", \"foo\", \"the\"] -> [\"foo\", \"the\"]-> [\"the\"] -> []`ã€‚\n4. `\"foo\"` -> å°‡ `\"foo\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"foo\"]`ï¼Œæ˜¯ `words` çš„å­é›†åˆã€‚\n5. `\"bar\"` -> å°‡ `\"bar\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"foo\", \"bar\"]`ï¼Œæ°å¥½ç­‰æ–¼ `words`ï¼Œæ‰€ä»¥çª—å£å·¦å´ `\"foo\"` çš„ç´¢å¼•ç‚ºä¸€çµ„ç­”æ¡ˆã€‚\n3. `\"man\"` -> å°‡ `\"man\"` åŠ å…¥çª—å£ï¼Œçª—å£ç‚º `[\"foo\", \"bar\", \"man\"]`ï¼Œä¸ç‚º `words` çš„å­é›†åˆï¼Œä¾æ¬¡å°‡å·¦å´çª—å£å‘å³ç›´åˆ°çª—å£ç‚º `words` ä¹‹å­é›†åˆæˆ–æ˜¯çª—å£ç‚ºç©ºï¼Œ`[\"foo\", \"bar\", \"man\"] -> [\"bar\", \"man\"]-> [\"man\"] -> []`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n\nç‚ºäº†ç¶­è­·çª—å£å…§çš„å­é›†åˆï¼Œå¯ä»¥ä½¿ç”¨ **`C++ STL unordered_multiset`**ï¼Œ`unordered_multiset` ç‚ºä½¿ç”¨ `Hashmap` å¯¦ä½œçš„é›†åˆï¼Œå¯ä»¥ `O(1)` åŠ å…¥ã€åˆªé™¤ã€æŸ¥æ‰¾ä¸€å€‹å€¼ã€‚èˆ‡ `unordered_set` ä¸åŒçš„æ˜¯ï¼Œ`unordered_set` è¦–ç›¸åŒçš„å€¼ç‚ºé›†åˆå…§çš„åŒä¸€å€‹å…ƒç´ ï¼Œä½† `unordered_multiset` è¦–åŒä¸€å€‹å€¼ç‚ºé›†åˆå…§çš„ä¸åŒå…ƒç´ ã€‚æ°å¥½ç¬¦åˆ `words` å…§å¯èƒ½æœ‰ç›¸åŒå–®è©çš„æ€§è³ªã€‚\n\nå‡è¨­ `dict` ç‚ºä¸€ `unordered_multiset`ï¼Œåˆå§‹ç‚ºç©ºã€‚\n\nå¯¦ä½œä¸Šï¼Œå…ˆå°‡ `words` å…§çš„å–®è©éƒ½å…ˆåŠ å…¥ `dict` ä¹‹ä¸­ï¼Œç•¶æ–°çš„å­å­—ä¸²è¦åŠ å…¥çª—å£ï¼Œå°±å¿…é ˆåœ¨ `dict` ä¸­æ‰¾åˆ°æ­¤å­å­—ä¸²æ‰ä»£è¡¨æ­¤å­å­—ä¸²åŠ å…¥å¾Œçª—å£æœƒæ˜¯ `words` çš„å­é›†åˆã€‚å­å­—ä¸²åŠ å…¥å¾Œï¼Œå¾ `dict` ä¸­åˆªé™¤æ­¤å­å­—ä¸²ï¼Œè‹¥ `dict` ç‚ºç©ºï¼Œèªªæ˜ç•¶å‰çª—å£æ°å¥½ç­‰æ–¼ `words`ï¼Œå·¦å´çª—å£ç´¢å¼•å€¼ç´€éŒ„ã€‚ç•¶å·¦å´çª—å£å‘å³ç§»å‹•æ™‚ï¼Œå‰‡æŠŠé›¢é–‹çª—å£çš„å­å­—ä¸²åŠ å› `dict` ä¹‹ä¸­ã€‚\n\nå®Œæˆå¾Œä¸å¿˜æŠŠçª—å£å…§çš„å…ƒç´ éƒ½åŠ å› `dict` ä¹‹ä¸­ï¼Œè®“ `dict` æ¢å¾©æˆåŸæœ¬çš„æ¨£å­ï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€çµ„çš„é›†åˆä½¿ç”¨ã€‚\n\nå‡è¨­ `N = å­—ä¸² s é•·åº¦`ï¼Œæ¯ä¸€å€‹å­å­—ä¸²åªæœƒè¢«åŠ å…¥ Sliding Window ä¸€æ¬¡ï¼Œåªæœƒå¾ Sliding Window ä¸­è¢«ç§»é™¤ä¸€æ¬¡ï¼ŒåŠ å…¥ã€åˆªé™¤çš„æ™‚é–“è¤‡é›œåº¦å‡æ˜¯ `O(1)`ã€‚æ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(2N) = O(N)`ã€‚\n\nä¸é C++ çš„ `String.substr` æ™‚é–“è¤‡é›œåº¦ç‚º `O(String Length)`ï¼Œæ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦æ‡‰è©²ç‚º `O(wl * N)`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/substring-with-concatenation-of-all-words/\n * Runtime: 52ms\n */\n\nclass Solution {\npublic:\n  vector<int> findSubstring(string s, vector<string>& words) {\n    // ç´€éŒ„ç­”æ¡ˆçš„ç´¢å¼•å€¼ç”¨\n    vector<int> indices;\n    // æ’é™¤ä¸€å®šç„¡è§£çš„ç‹€æ³\n    int sl = (int)s.length();\n    if (!sl || words.empty()) return indices;\n    int wl = (int)words[0].length();\n    if (sl < wl * (int)words.size() || !wl) return indices;\n\n    // å…ˆå°‡ words ä¸­çš„å–®è©åŠ å…¥ dict\n    unordered_multiset<string> dict;\n    for (auto word: words) dict.insert(word);\n\n    // å…± wl å€‹é›†åˆï¼Œåˆ†åˆ¥æª¢é©—\n    for (int i = 0; i < wl; i++) {\n      // çª—å£å·¦å´ç´¢å¼•å€¼\n      int left = i;\n      // é€æ¬¡å°‡çª—å£å³å´å‘å³\n      for (int j = i; j + wl <= sl; j += wl) {\n        string substring = s.substr(j, wl);\n        // è‹¥ç•¶å‰å­å­—ä¸²åŠ å…¥å¾Œçª—å£ä¸ç‚º words ä¹‹å­é›†åˆï¼Œå‰‡é€æ¬¡å°‡çª—å£å·¦å´å‘å³ï¼Œç›´åˆ°å¯ä»¥åŠ å…¥æˆ–çª—å£ç‚ºç©º\n        while (left < j && dict.find(substring) == dict.end()) {\n          dict.insert(s.substr(left, wl));\n          left += wl;\n        }\n        auto it = dict.find(substring);\n        if (it != dict.end()) {\n          // å°‡ç•¶å‰å­å­—ä¸²åŠ å…¥çª—å£\n          dict.erase(it);\n          // è‹¥ dict ç‚ºç©ºï¼Œçª—å£å·¦å´ç´¢å¼•ç‚ºä¸€çµ„åˆæ³•ç­”æ¡ˆ\n          if (dict.empty()) indices.emplace_back(left);\n        } else {\n          // ç•¶å‰å­å­—ä¸²ç„¡æ³•åŠ å…¥çª—å£\n          left = j + wl;\n        }\n      }\n      // å°‡çª—å£å…§å…ƒç´ åŠ å› dict ä¹‹ä¸­ï¼Œå¾©åŸ dict è®“ä¸‹ä¸€å€‹é›†åˆä½¿ç”¨\n      while (left + wl <= sl) {\n        dict.insert(s.substr(left, wl));\n        left += wl;\n      }\n    }\n    return indices;\n  }\n};\n\n```\n","tags":["LeetCode","æ»‘å‹•çª—å£ï¼ˆSliding Windowï¼‰","é›œæ¹Šï¼ˆHash tableï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 25 - Reverse Nodes in k Group","url":"/LeetCode-Reverse-Nodes-in-k-Group/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/reverse-nodes-in-k-group/](https://leetcode.com/problems/reverse-nodes-in-k-group/)\n\nçµ¦å®šä¸€å€‹ Linked Listï¼ˆä»¥ä¸‹ç°¡ç¨±ä¸²åˆ—ï¼‰ï¼Œä»¥æ¯ `k` å€‹ç¯€é»ç‚ºä¸€æ®µåšåè½‰ã€‚\n\nä¿è­‰ `k > 0` ä¸” `k <= ä¸²åˆ—é•·åº¦`ï¼Œå¦‚æœå‰©ä¸‹çš„ä¸€æ®µé•·åº¦ä¸è¶³ `k` å‰‡ä¸éœ€è¦åè½‰ã€‚\n\n# ç¯„ä¾‹èªªæ˜\nGiven this linked list: `1->2->3->4->5`\n\nFor `k = 2`, you should return: `2->1->4->3->5`\n\nFor `k = 3`, you should return: `3->2->1->4->5`\n\n<!-- More -->\n\n# æƒ³æ³•\n\næŠŠé¡Œç›®æ‹†æˆå…©å€‹éè¿´å¼ä¾†æƒ³ã€‚\n\né¦–å…ˆï¼Œå¦‚æœåªè¦å°‡ä¸²åˆ— `head` çš„å‰ `k` å€‹ç¯€é»åšåè½‰ï¼Œ\n\nä¾‹å¦‚ï¼š`k = 3`ï¼š `1->2->3->...` -> `3->2->1->...`\n\nå¯ä»¥ç™¼ç¾é™¤äº†ç¬¬ä¸€å€‹ç¯€é»å¤–ï¼Œæ¯ä¸€å€‹ç¯€é»éƒ½è¦é€£å‘ä¸Šä¸€å€‹ç¯€é»ã€‚æ‰€ä»¥éè¿´å‡½æ•¸ä¸­ï¼Œç´€éŒ„ `ç•¶å‰ç¯€é» head`, `ä¸Šä¸€å€‹ç¯€é» lastNode`ï¼Œ`å‰©é¤˜æ•¸é‡ k`ï¼Œå¦‚ä¸‹ï¼š\n\n`reverseSingleGroup(head, lastNode, k)`\n\næ¯æ¬¡éƒ½å°‡ `head->next` é€£å‘ `lastNode`ï¼Œä¸¦ä¸”éè¿´å‘ä¸‹ `reverseSingleGroup(head->next, head, k - 1)`ï¼Œè¦æ³¨æ„åœ¨ä¿®æ”¹ `head->next` ä¹‹å‰è¦å…ˆæŠŠ `head->next` è¨˜éŒ„ä¸‹ä¾†ã€‚\n\nç•¶åšåˆ° `k = 1` æ™‚ï¼Œä»£è¡¨ç•¶å‰ `head` ç­‰æ–¼åè½‰ä¸²åˆ—å¾Œçš„æ–°çš„ `head`ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸€è·¯å°‡ `head` è¿”å›ã€‚\n\nå†ä¾†ï¼Œæ¯ `k` å€‹ç¯€é»ç‚ºä¸€æ®µåšåè½‰ï¼Œæˆ‘å€‘å®šç¾©éè¿´å‡½æ•¸ `reverseKGroup(head, k)`ï¼Œ\n\nå¯ä»¥ç™¼ç¾ `reverseKGroup(head, k) = reverseSingleGroup(head, reverseKGroup({ the k + 1 Node }, k), k)`ï¼Œ\n\nä¹Ÿå°±æ˜¯ `reverseKGroup(head, k)` ç­‰æ–¼å°‡å‰ `k` å€‹ç¯€é»åè½‰ï¼ˆ`reverseSingleGroup(head, ..., k)`ï¼‰ï¼Œä¸”å¾ç¬¬ `k + 1` å€‹ç¯€é»ç¹¼çºŒåšæ¯ `k` å€‹ç¯€é»ç‚ºä¸€é»åè½‰ï¼Œï¼ˆ`reverseKGroup({ the k + 1 Node}, k)`ï¼‰ã€‚\n\né‚„æœ‰ä¸€é»è¦æ³¨æ„ï¼Œåœ¨ `reverseSingleGroup(head, lastNode, k)` ä¸­æœ‰æåˆ°ï¼Œæ¯æ¬¡éƒ½æ‡‰è©²è¦å°‡ `head->next = lastNode`ï¼Œä½†ç¬¬ä¸€æ¬¡å‘¼å«çš„ `lastNode` ä¸Šé¢ä¸¦æ²’æœ‰ç‰¹åˆ¥èªªæ˜ã€‚å› ç‚ºç¬¬ä¸€æ¬¡å‘¼å«çš„ `lastNode` æ‡‰è©²è¦ç­‰æ–¼ `reverseKGroup({ the k + 1 Node }, k)` æ‰€è¿”å›çš„æ–°çš„ `head`ã€‚ä¾‹å¦‚ï¼š\n\n`1->2->3->4->5->6`, `k = 3`ï¼Œå‘¼å« `reverseSingleGroup(1, reverseKGroup(4, 3), 3)`ï¼Œä¸” `reverseKGroup(4, 3) = reverseSingleGroup(4, nullptr, 3) = 6->5->4`ï¼Œæ‰€ä»¥ï¼š`reverseSingleGroup(1, 6->5->4, 3)`ï¼Œæ‰€ä»¥ç¯€é» `1` æ‡‰è©²è¦é€£å‘ç¯€é» `6`ã€‚å³ï¼š`3->2->1->6->5->4`ã€‚\n\næœ€å¾Œï¼Œè‹¥ `reverseKGroup` æ™‚é•·åº¦å·²ç¶“ä¸è¶³ `k`ï¼Œå‰‡ç›´æ¥è¿”å›ä¸²åˆ—ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/reverse-nodes-in-k-group/\n * Runtime: 16ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode() : val(0), next(nullptr) {}\n *     ListNode(int x) : val(x), next(nullptr) {}\n *     ListNode(int x, ListNode *next) : val(x), next(next) {}\n * };\n */\nclass Solution {\nprivate:\n  ListNode* reverseSingleGroup(ListNode* head, ListNode* lastNode, int k) {\n    // å…ˆå°‡ä¸‹ä¸€å€‹ç¯€é»ç´€éŒ„\n    ListNode* nextNode = head->next;\n    // å°‡ç•¶å‰ç¯€é»é€£å‘ä¸Šä¸€å€‹ç¯€é»\n    head->next = lastNode;\n    // éè¿´çµ‚é»ï¼šè¿”å›æ–°çš„ head\n    if (k == 1) return head;\n    // å‘ä¸‹éè¿´\n    return reverseSingleGroup(nextNode, head, k - 1);\n  }\npublic:\n  ListNode* reverseKGroup(ListNode* head, int k) {\n    // æ‰¾å°‹ç¬¬ k å€‹ç¯€é»\n    ListNode* node = head;\n    for (int i = 1; i < k && node != nullptr; i++)\n      node = node->next;\n    // è‹¥ç¬¬ k å€‹ç¯€é»ç‚º nullptrï¼Œå‰‡ä»£è¡¨é•·åº¦ä¸è¶³ï¼Œç›´æ¥è¿”å›ä¸²åˆ—\n    if (node == nullptr)\n      return head;\n    // å‘ä¸‹éè¿´\n    return reverseSingleGroup(head, reverseKGroup(node->next, k), k);\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 23 - Merge k Sorted Lists","url":"/LeetCode-Merge-k-Sorted-Lists/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/merge-k-sorted-lists/](https://leetcode.com/problems/merge-k-sorted-lists/)\n\nåˆä½µ `k` å€‹å·²æ’åºå¥½çš„éˆçµä¸²åˆ—æˆä¸€å€‹æ’åºå¥½çš„éˆçµä¸²åˆ—ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n```\nInput:\n[\n  1->4->5,\n  1->3->4,\n  2->6\n]\nOutput: 1->1->2->3->4->4->5->6\n```\n\n<!-- More -->\n\n# æƒ³æ³•\nä»¥ä¸‹ç°¡ç¨± Linked list ç‚ºä¸²åˆ—ã€‚\n\n## æ–¹æ³•ä¸€ï¼šæ™‚é–“è¤‡é›œåº¦ O(KN)ã€ç©ºé–“è¤‡é›œåº¦ O(KN)\nåˆä½µå…©å€‹é•·åº¦åˆ†åˆ¥ç‚º `N`, `M`ï¼Œæ’åºå¥½çš„ä¸²åˆ—ï¼Œæˆ‘å€‘å¯ä»¥ç”¨é›™æŒ‡é‡éæ­·å…©å€‹ä¸²åˆ—ï¼Œæ¯æ¬¡éƒ½å°‡æ¯”è¼ƒå°çš„å€¼åŠ å…¥ä¸€å€‹**æ–°çš„åºåˆ—**ä¸­ï¼Œæ™‚é–“è¤‡é›œåº¦ç‚º `O(N + M)`ï¼Œç©ºé–“è¤‡é›œåº¦ç‚º `O(N + M)`ã€‚è¦‹ä¸‹åœ–ï¼š\n\n<img width=\"50%\" src=\"/assets/LeetCode-Merge-k-Sorted-Lists/merge-k-sorted-lists-double-pointer.gif\">\n\nå‡è¨­æ‰€æœ‰ä¸²åˆ—ä¹‹ç¸½é•·ç‚º `N`ã€‚\n\nå¦‚æœæ¯æ¬¡é€æ¬¡å°‡ç¬¬ä¸€ã€äºŒå€‹ä¸²åˆ—åˆä½µï¼Œå†å°‡åˆä½µçµæœèˆ‡ç¬¬ä¸‰å€‹ä¸²åˆ—åˆä½µã€å†å°‡åˆä½µçµæœèˆ‡ç¬¬å››å€‹ä¸²åˆ—åˆä½µï¼Œæœ€çµ‚æˆ‘å€‘åˆä½µäº† `k - 1` æ¬¡ï¼Œæ¯æ¬¡åˆä½µçš„æ™‚é–“è¤‡é›œåº¦ä¸è¶…é `O(N)`ã€‚\n\næ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(KN)`ï¼Œç©ºé–“è¤‡é›œåº¦ç‚º `O(KN)`ã€‚\n\n## æ–¹æ³•äºŒï¼šæ™‚é–“è¤‡é›œåº¦ O(NlogK)ã€ç©ºé–“è¤‡é›œåº¦ O(1)\n\nå…ˆè€ƒæ…®åˆä½µåºåˆ—çš„æ–¹æ³•ï¼Œè‹¥æ”¹ç‚ºå…ˆå°‡ä¸²åˆ—å…©å…©é…å°åˆä½µï¼Œä¸‹ä¸€è¼ªå†å°‡åˆä½µéå¾Œçš„ä¸²åˆ—å…©å…©é…å°åˆä½µ...ï¼Œç›´åˆ°å‰©ä¸‹ä¸€å€‹ä¸²åˆ—ç‚ºæ­¢ã€‚å¦‚ä¸‹åœ–ï¼š\n\n<img width=\"70%\" src=\"/assets/LeetCode-Merge-k-Sorted-Lists/merge-k-sorted-lists-merge.png\">\n\næ¯ä¸€è¼ªåˆä½µï¼Œä¸²åˆ—çš„æ•¸é‡æ¸›åŠï¼Œç¸½å…±åˆä½µäº† `logK + 1` è¼ªã€‚å†åŠ ä¸Šæ¯ä¸€è¼ªéƒ½æœƒéæ­·æ‰€æœ‰çš„ä¸²åˆ—æ¯ä¸€å€‹æ•¸å­—ï¼Œç¸½é•·åº¦ç‚º `N`ã€‚ç¸½æ™‚é–“è¤‡é›œåº¦é™ç‚º `O(NLogK)`ã€‚\n\nå†ä¾†æ”¹å–„è¨˜æ†¶é«”ç©ºé–“çš„ä½¿ç”¨ï¼Œè‹¥åˆä½µå…©åºåˆ—èƒ½ä¸èŠ±è²»é¡å¤–çš„ç©ºé–“å„²å­˜ï¼Œå³å¯åšåˆ°ç©ºé–“è¤‡é›œåº¦ `O(1)`ã€‚\nè§£æ±ºè¾¦æ³•å…¶å¯¦ä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯åš in-placeï¼ˆåŸåœ°ï¼‰åˆä½µã€‚\n\nåˆä½µå…©ä¸²åˆ—æ™‚ `lhs`, `rhs` æ™‚ï¼Œè‹¥ `lhs->val < rhs->val`ï¼Œå‰‡ `lhs` å³ç‚ºåˆä½µå¾Œä¸²åˆ—çš„é ­ï¼Œä¸” `lhs->next` æœƒç­‰æ–¼åˆä½µ `lhs->next`, `rhs` å…©ä¸²åˆ—çš„çµæœã€‚åä¹‹äº¦ç„¶ï¼Œè‹¥ `lhs->val > rhs->val`ï¼Œå‰‡ `rhs` å³ç‚ºåˆä½µå¾Œä¸²åˆ—çš„é ­ï¼Œä¸” `rhs->next` ç‚ºåˆä½µ `lhs`, `rhs->next` å…©ä¸²åˆ—çš„çµæœã€‚\n\nèˆ‰ä¾‹ä¾†èªªï¼Œä¸²åˆ— `lhs=1->3->7->8`, `rhs=2->4->5->6`ã€‚å› ç‚º `lhs->val = 1 < 2 = rhs->val`ï¼Œæ‰€ä»¥ `lhs` ç‚ºåˆä½µ `lhs`, `rhs` å¾Œä¸²åˆ—çš„é ­ï¼Œè€Œ `lhs->next` ç­‰æ–¼åˆä½µ `lhs->next=3->7->8`, `rhs=2->4->5->6` å…©ä¸²åˆ—çš„çµæœã€‚\n\n# å¯¦ä½œç´°ç¯€\n## åˆä½µ K å€‹ä¸²åˆ—\n\nç­†è€…æ˜¯é€™æ¨£æ€è€ƒçš„ï¼š`x <- y` ç‚ºå°‡ä¸²åˆ— `y` åˆä½µé€²ä¸²åˆ— `x`ã€‚\n- ç¬¬ä¸€è¼ªï¼š`0 <- 1`, `2 <- 3`, `4 <- 5`, `6 <- 7`... `x = 0, 2, 4, 6 ...`, `y = x + 1`\n- ç¬¬äºŒè¼ªï¼š`0 <- 2`, `4 <- 6`, `8 <- 10`, `12 <- 14`... `x = 0, 4, 8, 12 ...`, `y = x + 2`\n- ç¬¬ä¸‰è¼ªï¼š`0 <- 4`, `8 <- 12`, `16 <- 20`, `24 <- 28`... `x = 0, 8, 16, 24 ...`, `y = x + 4`\n\nç¸½çµä¾†èªªï¼Œç¬¬ `k` è¼ªï¼š\n$$x=0,\\ 1\\times(2^k),\\ 2\\times(2^k),\\ 3\\times(2^k)...$$\n$$y=x+2^{k-1}$$\n\næ‰€ä»¥ï¼š\n```cpp\n// i = 2^(k-1), so i = 1, 2, 4, 8, ....\nfor (int i = 1; i < listsLength; i <<= 1) {\n  /**\n   * j = 0, 1 * (2^k), 2 * (2^k), 3 * (2^k), so\n   * x = j, y = i + j\n   * so we merge lists[i + j] into lists[j]\n   */\n  for (int j = 0; j + i < listsLength; j += i * 2) {\n    lists[j] = inplaceMerge(lists[j], lists[j + i]);\n  }\n}\n```\n\n## åˆä½µå…©å€‹ä¸²åˆ—\n\nå¯«æˆéè¿´çš„å½¢å¼ï¼Œè¦‹ä¸‹æ–¹ç¨‹å¼ç¢¼ `inplaceMerge`ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/merge-k-sorted-lists/\n * Runtime: 28ms\n */\n\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode() : val(0), next(nullptr) {}\n *     ListNode(int x) : val(x), next(nullptr) {}\n *     ListNode(int x, ListNode *next) : val(x), next(next) {}\n * };\n */\nclass Solution {\nprivate:\n  ListNode* inplaceMerge(ListNode* lhs, ListNode* rhs) {\n    if (!lhs) return rhs;\n    if (!rhs) return lhs;\n\n    if (lhs->val < rhs->val) {\n      // å¦‚æœ lhs->val < rhs->val, lhs->next ç‚ºåˆä½µ lhs->next, rhs ä¹‹çµæœ\n      lhs->next = inplaceMerge(lhs->next, rhs);\n      // å¦‚æœ lhs->val < rhs->valï¼Œlhs ç‚ºåˆä½µå…©ä¸²åˆ—ä¹‹é ­\n      return lhs;\n    } else {\n      rhs->next = inplaceMerge(lhs, rhs->next);\n      return rhs;\n    }\n  }\npublic:\n  ListNode* mergeKLists(vector<ListNode*>& lists) {\n    if (lists.empty()) return nullptr;\n    int listsLength = (int)lists.size();\n    // i = 2^(k-1), so i = 1, 2, 4, 8, ....\n    for (int i = 1; i < listsLength; i <<= 1) {\n      /**\n      * j = 0, 1 * (2^k), 2 * (2^k), 3 * (2^k), so\n      * x = j, y = i + j\n      * so we merge lists[i + j] into lists[j]\n      */\n      for (int j = 0; j + i < listsLength; j += i * 2) {\n        lists[j] = inplaceMerge(lists[j], lists[j + i]);\n      }\n    }\n    return lists[0];\n  }\n};\n\n```\n","tags":["LeetCode","éˆçµä¸²åˆ—ï¼ˆLinked Listï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 10 - Regular Expression Matching","url":"/LeetCode-Regular-Expression-Matching/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/regular-expression-matching/](https://leetcode.com/problems/regular-expression-matching/)\n\nçµ¦ä¸€å€‹å­—ä¸² `s` å’Œæ¨£æ¿ï¼ˆpatternï¼‰ `p`ï¼Œå¯¦ä½œæ”¯æ´ `.` å’Œ `*` çš„ regular expressionã€‚\n\n```\n'.' Matches any single character. åŒ¹é…ä¸€å€‹ä»»ä¸€å­—å…ƒã€‚\n'*' Matches zero or more of the preceding element. åŒ¹é…é›¶åˆ°ä»»æ„å¤šå€‹å‰ä¸€å€‹å­—å…ƒ\n```\n\nè¨ˆç®— `s` æ˜¯å¦åŒ¹é… `p`ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n## Example 1:\n```\nInput:\ns = \"aa\"\np = \"a\"\nOutput: false\nExplanation: \"a\" does not match the entire string \"aa\".\n```\n\n## Example 2:\n```\nInput:\ns = \"aa\"\np = \"a*\"\nOutput: true\nExplanation:\n'*' means zero or more of the preceding element, 'a'.\nTherefore, by repeating 'a' once, it becomes \"aa\".\n```\n\n<!-- More -->\n\n## Example 3:\n```\nInput:\ns = \"ab\"\np = \".*\"\nOutput: true\nExplanation:\n\".*\" means \"zero or more (*) of any character (.)\".\n```\n\n## Example 4:\n```\nInput:\ns = \"aab\"\np = \"c*a*b\"\nOutput: true\nExplanation:\nc can be repeated 0 times, a can be repeated 1 time. \nTherefore, it matches \"aab\".\n```\n\n## Example 5:\n```\nInput:\ns = \"mississippi\"\np = \"mis*is*p*.\"\nOutput: false\n```\n\n# æƒ³æ³•\n\n## å‹•æ…‹è¦åŠƒ Dynamic programming\né¦–å…ˆï¼Œé‡åˆ°å…©å­—ä¸²åŒ¹é…çš„å•é¡Œï¼Œæˆ‘å€‘é€šå¸¸éƒ½å¯ä»¥ç”¨ä¸€å€‹äºŒç¶­çš„ dynamic programming è¡¨æ ¼ä¾†è§£æ±ºã€‚\nç­†è€…å–œæ­¡å°‡ DP è¡¨æ ¼å¾ä¸€é–‹å§‹ç·¨è™Ÿï¼Œå› ç‚º 0 æ˜¯é‚Šç•Œï¼Œå¸¸å¸¸æ‹¿ä¾†å„²å­˜é‚Šç•Œè³‡è¨Šã€‚è€Œé€™é¡Œä¹Ÿä¸ä¾‹å¤–ã€‚\né‡åˆ° DP å•é¡Œï¼Œç­†è€…é€šå¸¸éƒ½æœƒæ€è€ƒå…©å€‹æ–¹å‘ï¼š\n1. ç‹€æ…‹ï¼šå®šç¾© `d(i)`, `d(i, j)` ... ä»£è¡¨ä»€éº¼æ„ç¾©ã€‚\n2. è½‰ç§»ï¼šå®šç¾© `d(i)` çš„ç­”æ¡ˆå¾å“ªè£¡ä¾†ï¼Œ`d(i, j)` çš„ç­”æ¡ˆå¾å“ªè£¡ä¾†...\n\nè½‰ç§»æ™‚å‹™å¿…è¦æ³¨æ„ç­”æ¡ˆè¦å¾å·²ç¶“è¨ˆç®—å®Œçš„å€é–“å¾—ä¾†ã€‚\n\n## DP ç‹€æ…‹\nå‡è¨­å…©å­—ä¸²åˆ†åˆ¥ç‚º `s` ä»¥åŠ `p`ï¼Œè€Œä¸”å¾ç´¢å¼• 1 é–‹å§‹ç·¨è™Ÿã€‚\næ‰€ä»¥æˆ‘å€‘å¯ä»¥å®šç¾© DP ç‹€æ…‹ç‚ºï¼š `d(i, j) = s[1 ~ i], p[1 ~ j] æ˜¯å¦åŒ¹é…`ã€‚\n\n## DP è½‰ç§»\n\n1. é¦–å…ˆï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œå¦‚æœä¸€å€‹å­—å…ƒçš„å¾Œé¢ç‚ºä¸€å€‹ `*` å­—å…ƒï¼Œé‚£éº¼æˆ‘å€‘æ‡‰è©²è¦æŠŠé€™å€‹å­—å…ƒè·Ÿé€£è‘—çš„ `*` çœ‹æˆä¸€çµ„ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœé‡åˆ°ä¸€å€‹å­—å…ƒå¾Œé¢ç·Šæ¥è‘—ä¸€å€‹ `*`ï¼Œé‚£éº¼æˆ‘å€‘å¯ä»¥ç›´æ¥æŠŠå¿½ç•¥é€™å€‹å­—å…ƒçš„ä½œç”¨ç›´æ¥ç¹¼æ‰¿ä¸Šä¸€æ’çš„ç‹€æ…‹ï¼Œæ‰€ä»¥è½‰ç§»å¼ç‚ºï¼š\n\n  $$d(i,\\ j)=d(i,\\ j-1)\\quad if\\ \\textcolor{red}{p[j+1]=*}$$\n\n2. å†ä¾†ï¼Œå¦‚æœ `p[j]` ç‚ºä¸€èˆ¬çš„å­—æ¯ä¸”åŒ¹é…åˆ° `s[i]`ï¼Œé‚£éº¼æˆ‘å€‘ `d(i, j)=1` è‹¥ä¸”å”¯è‹¥ `d(i - 1, j - 1) = 1`ã€‚ä¹Ÿå°±æ˜¯å¦‚æœ `s[1 ~ i - 1]` èƒ½åŒ¹é…åˆ° `p[1 ~ j - 1]` ä¸” `s[i] == p[j]`ï¼Œé‚£éº¼ `s[1 ~ i]` åŒ¹é…åˆ° `p[1 ~ j]`ã€‚æ‰€ä»¥è½‰ç§»å¼ç‚ºï¼š\n\n  $$d(i,\\ j)=d(i-1,\\ j-1)\\quad if\\ \\textcolor{red}{p[j+1]\\ne*}\\ \\& \\ \\textcolor{red}{s[i]=p[j]}$$\n\n3. å†ä¾†æˆ‘å€‘è€ƒæ…® `p[j]='.'` çš„æƒ…æ³ï¼Œå¯ä»¥ç™¼ç¾å…¶å¯¦ `p[j]='.'` çš„è½‰ç§»èˆ‡ç¬¬äºŒé»é¡ä¼¼ï¼Œåªæ˜¯ `.` å¯ä»¥ä»£è¡¨ä»»æ„å­—å…ƒï¼Œå› æ­¤æˆ‘å€‘ `s[i]=p[j]` çš„æ¢ä»¶æ°¸é æˆç«‹ã€‚æ‰€ä»¥è½‰ç§»å¼ç‚ºï¼š\n\n  $$d(i,\\ j)=d(i-1,\\ j-1)\\quad if\\ \\textcolor{red}{p[j+1]\\ne*}\\ \\&\\ \\textcolor{red}{p[j]=.}$$\n\n4. æœ€å¾Œæˆ‘å€‘è€ƒæ…® `p[j]='*'` çš„æƒ…æ³ï¼Œæœ‰å…©ç¨®æƒ…æ³èƒ½ä½¿ `d(i, j) = 1`ã€‚\n   \n   1. å¦‚æœ `*` é‡è¤‡äº† 0 æ¬¡ï¼Œä»£è¡¨æ­¤ç‹€æ…‹è·Ÿä¸Šä¸€æ’ä¸€æ¨£ï¼Œæ‰€ä»¥è½‰ç§»å¼æ‡‰è©²èˆ‡ç¬¬ä¸€é»ç›¸åŒã€‚\n   2. å¦‚æœ `*` é‡è¤‡ä¸€æ¬¡ä»¥ä¸Šï¼Œå¿…é ˆæ»¿è¶³ `*` çš„å‰ä¸€å€‹å­—å…ƒ `p[j - 1]` æ‡‰è©²ç­‰æ–¼ç•¶å‰çš„ `s[i]`ï¼ˆç•¶ç„¶ `p[j - 1] = '.'` ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰ï¼Œä¸” `s[1 ~ i - 1]` è¦èƒ½åŒ¹é… `p[1 ~ j]`ï¼Œä¹Ÿå°±æ˜¯ `d(i - 1, j) = 1`ã€‚æ»¿è¶³ä¸Šè¿°å…©é»æ€§è³ªï¼Œå°±ä»£è¡¨æˆ‘å€‘å¯ä»¥å†åŠ ä¸Šä¸€å€‹ `p[j - 1]` å­—å…ƒä½¿å¾— `d(i, j) = 1`ã€‚\n  \n    æ‰€ä»¥è½‰ç§»å¼ç‚ºï¼š\n    $$d(i,\\ j)=(\\textcolor{red}{d(i,\\ j-1)=1}\\ |\\ \\textcolor{blue}{(}\\textcolor{red}{d(i-1,j)=1}\\ \\&\\ \\textcolor{purple}{(}\\textcolor{red}{p[j-1]=s[i]}\\ |\\ \\textcolor{red}{p[j-1]=.}\\textcolor{purple}{)}\\textcolor{blue}{)}) \\quad if\\ \\textcolor{red}{p[j]=*}$$\n\n## DP ç¸½æ•´ç†\n\næœ‰äº†ä¸Šè¿° 4 é»ï¼Œå¯ä»¥æ•´ç†è½‰ç§»å¼ç‚ºï¼š\n  $$d(i,\\ j)=d(i,\\ j-1)\\quad if\\ \\textcolor{red}{p[j+1]=*}$$\n\n  $$d(i,\\ j)=d(i-1,\\ j-1)\\quad else\\ if\\ \\textcolor{red}{s[i]=p[j]\\ |\\ p[j]=.}$$\n\n  $$d(i,\\ j)=(\\textcolor{red}{d(i,\\ j-1)}\\ |\\ \\textcolor{blue}{(}\\textcolor{red}{d(i-1,j)}\\ \\&\\ \\textcolor{purple}{(}\\textcolor{red}{p[j-1]=s[i]}\\ |\\ \\textcolor{red}{p[j-1]=.}\\textcolor{purple}{)}\\textcolor{blue}{)}) \\quad else\\ if\\ \\textcolor{red}{p[j]=*}$$\n\næœ€å¾Œæˆ‘å€‘è€ƒæ…®é‚Šç•Œæƒ…æ³ï¼Œç™¼ç¾ï¼š\n\n1. `d(0, 0)=1`ï¼š`s` èˆ‡ `p` åŒæ™‚ç‚ºç©ºæ‡‰è©²è¦ç®—æ˜¯åŒ¹é…ã€‚\n2. `d(i, 0)=0, i > 0`ï¼š`p` ç‚ºç©ºä½† `s` ä¸ç‚ºç©ºï¼Œä¸åŒ¹é…ã€‚\n3. `d(0, i)`ï¼šèˆ‡ DP è½‰ç§»å¼ç›¸åŒï¼Œåªæ˜¯ç„¡æ³•å¾ `d(-1, i)` è½‰ç§»ï¼Œæ‰€æœ‰è½‰ç§»çš†å¾ `d(0, i - 1)` è€Œä¾†ã€‚\n\næœ€çµ‚ç­”æ¡ˆå³æ˜¯ `dp[|s|][|p|]`\n\n# ç¯„ä¾‹èˆ‡ DP å°ç…§\n## Example 1\n\n| s\\p | X | a |\n|-----|---|---|\n| X   | 1 | 0 |\n| a   | 0 | 1 |\n| a   | 0 | 0 |\n\n## Example 2\n\n| s\\p | X | a | * |\n|-----|---|---|---|\n| X   | 1 | 1 | 1 |\n| a   | 0 | 0 | 1 |\n| a   | 0 | 0 | 1 |\n\n## Example 4\n\n| s\\p | x | c | * | a | * | b |\n|-----|---|---|---|---|---|---|\n| x   | 1 | 1 | 1 | 1 | 1 | 0 |\n| a   | 0 | 0 | 0 | 0 | 1 | 0 |\n| a   | 0 | 0 | 0 | 0 | 1 | 0 |\n| b   | 0 | 0 | 0 | 0 | 0 | 1 |\n\n# å¯¦ä½œç´°ç¯€\nå› ç‚ºçœŸå¯¦æƒ…æ³ä¸­ï¼Œ`s` èˆ‡ `p` çš†ç‚º Base 0ï¼ˆç´¢å¼•å¾ 0 é–‹å§‹ï¼‰ï¼Œæ‰€ä»¥å¯¦ä½œä¸­å¯ä»¥è€ƒæ…®å…©ç¨®åšæ³•ï¼š\n1. å°‡å­—ä¸²éƒ½è½‰æ›ç‚º Base 1ã€‚\n2. å°‡è½‰ç§»å¼ä¸­çš„ `d(i, j)` éƒ½è®Šç‚º `d(i + 1, j + 1)`ã€‚\n\nç­†è€…å¯¦ä½œä¸­æ¡ç”¨çš„æ˜¯ç¬¬äºŒç¨®æ–¹æ³•ã€‚\n\n# ç¨‹å¼ç¢¼\n\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/regular-expression-matching/\n * Runtime: 24ms\n */\n\nclass Solution {\npublic:\n  bool isMatch(string s, string p) {\n    int sLength = (int)s.length();\n    int pLength = (int)p.length();\n\n    // å®£å‘Š (sLength + 1) * (pLength + 1) å¤§å°çš„ 2D DP é™£åˆ—è¡¨æ ¼ï¼Œä¸¦åˆå§‹åŒ–ç‚º 0\n    vector<vector<bool>> dp(sLength + 1, vector<bool>(pLength + 1, false));\n    // é‚Šç•Œ 1\n    dp[0][0] = true;\n\n    // é‚Šç•Œ 3\n    for (int i = 0; i < pLength; i++) {\n      if ((i != pLength - 1 && p[i + 1] == '*') || p[i] == '*')\n        dp[0][i + 1] = dp[0][i];\n    }\n\n    for (int i = 0; i < sLength; i++) {\n      for (int j = 0; j < pLength; j++) {\n        if (j != pLength - 1 && p[j + 1] == '*') {\n          // è½‰ç§» 1\n          dp[i + 1][j + 1] = dp[i + 1][j];\n        } else if ((p[j] == s[i] || p[j] == '.')) {\n          // è½‰ç§» 2\n          dp[i + 1][j + 1] = dp[i][j];\n        } else if (p[j] == '*') {\n          // è½‰ç§» 3\n          dp[i + 1][j + 1] = (dp[i + 1][j] || (dp[i][j + 1] && (p[j - 1] == s[i] || p[j - 1] == '.')));\n        }\n      }\n    }\n\n    return dp[sLength][pLength];\n  }\n};\n\n```\n\n# æ„Ÿæƒ³\né€™é¡Œé›–ç„¶æ²’æœ‰å¾ˆè¤‡é›œï¼Œä½†æ˜¯è¦æŠŠ DP çš„æƒ³æ³•è¡¨é”çš„æ¸…æ¥šçœŸçš„ä¸ç°¡å–®å‘¢ï¼\n\nå¸Œæœ›å¤§å®¶æœƒå–œæ­¡ï¼Œå–œæ­¡çš„è©±å¯ä»¥ç•™ä¸‹ Comments æˆ–æ˜¯é»å€‹è®šï¼Œè¬è¬æ”¯æŒï½\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]},{"title":"LeetCode 4 - Median of Two Sorted Arrays","url":"/LeetCode-Median-of-Two-Sorted-Arrays/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/median-of-two-sorted-arrays/](https://leetcode.com/problems/median-of-two-sorted-arrays/)\n\nçµ¦å®šå…©å€‹æ’åºå¥½çš„åºåˆ— `nums1` å’Œ `nums2`ï¼Œé•·åº¦åˆ†åˆ¥ç‚º `m` å’Œ `n`ã€‚\n\næ‰¾åˆ°å…©å€‹åºåˆ—çš„ä¸­ä½æ•¸ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n\n**Example 1**\n```\nnums1 = [1, 3]\nnums2 = [2]\n\nThe median is 2.0\n```\n\n**Example 2**\n```\nnums1 = [1, 2]\nnums2 = [3, 4]\n\nThe median is (2 + 3)/2 = 2.5\n```\n\n<!-- more -->\n\n# æƒ³æ³•\næˆ‘å€‘å…ˆå°‡é¡Œç›®æƒ³æˆå¾å…©å€‹åºåˆ—ä¸­æ±‚å‡ºç¬¬ k å¤§çš„æ•¸å­—ã€‚\n\né¡Œç›®è¦æ±‚æ™‚é–“è¤‡é›œåº¦ç‚º `O(log(m + n))`ï¼Œæ‰€ä»¥æˆ‘å€‘é¦–å…ˆæƒ³åˆ°å¦‚æœèƒ½æ¯ä¸€æ¬¡éƒ½æ¨å»ç¸½é•·åº¦ä¸€åŠçš„åºåˆ—ï¼Œé‚£æˆ‘å€‘çš„æœ€çµ‚æ™‚é–“è¤‡é›œåº¦å°±æœƒæ˜¯ `O(log(m + n))`ã€‚\n\né‚£æˆ‘å€‘è¦å¦‚ä½•çŸ¥é“å“ªæ®µåºåˆ—æ˜¯å¯ä»¥æ¨å»çš„å‘¢ï¼Ÿ\nå‡è¨­ `nums1` ä»¥åŠ `nums2` éƒ½æ˜¯å¾ç´¢å¼•å€¼ 0 é–‹å§‹ç·¨è™Ÿã€‚\n\n**æˆ‘å€‘æ¯”è¼ƒä»»æ„ `nums1[i]` ä»¥åŠ `nums2[j]`ï¼Œå¦‚æœ `nums1[i] < nums2[j]`ï¼Œé‚£ `nums1[i]` æœ€å¤§çš„å¯èƒ½æ€§ç‚ºç¬¬ `i + j + 1` å¤§ï¼ˆå¦‚æœ `nums1[0] ~ nums1[i - 1], nums2[0] ~ nums2[j - 1]` éƒ½å°æ–¼ `nums1[i]`ï¼‰ã€‚åä¹‹äº¦ç„¶ï¼Œå¦‚æœ `nums1[i] > nums2[j]`ï¼Œé‚£ `nums2[j]` æœ€å¤§çš„å¯èƒ½æ€§ä¹Ÿæ˜¯ç¬¬ `i + j + 1` å¤§**ã€‚\n\nä¹Ÿå°±æ˜¯ï¼š\n1. `nums1[i] < nums2[j]`ï¼Œ`nums1[i]` æœ€å¤§ç‚ºç¬¬ `i + j + 1` å¤§ã€‚\n2. `nums1[i] >= nums2[j]`, `nums2[j]` æœ€å¤§ç‚ºç¬¬ `i + j + 1` å¤§ã€‚\n\nçŸ¥é“äº†é€™å€‹æ€§è³ªå¾Œï¼Œå¦‚æœæˆ‘å€‘å– `i = k / 2 - 1` ä¸” `j = k / 2 - 1`ï¼Œé‚£ä¸Šè¿°å…©é»æœƒè®Šç‚ºï¼š\n1. `nums1[i] < nums2[j]`ï¼Œ`nums1[i]` æœ€å¤§ç‚ºç¬¬ `k - 1` å¤§ã€‚\n2. `nums1[i] >= nums2[j]`, `nums2[j]` æœ€å¤§ç‚ºç¬¬ `k - 1` å¤§ã€‚\n\nä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœ `nums1[i] < nums2[j]`ï¼Œæˆ‘å€‘å¯ä»¥æ¨å» `nums1[0] ~ nums1[i]`ï¼Œå› ç‚º `nums1[i]` è‡³å¤šæ‰ç¬¬ `k - 1` å¤§è€Œå·²ã€‚æ¨å»å¾Œéƒ¨åˆ†åºåˆ—å¾Œï¼Œæˆ‘å€‘è¦æ‰¾çš„è®Šæˆå‰©ä¸‹çš„åºåˆ—ä¸­ç¬¬ `k - æ¨å»çš„æ•¸å­—æ•¸é‡` å¤§çš„æ•¸å­—ã€‚\n\næœ€å¾Œï¼Œå¦‚æœä¸€åºåˆ—å·²è¢«å®Œå…¨æ¨æ£„ï¼Œé‚£ç­”æ¡ˆå¿…å®šæ˜¯å¦ä¸€å€‹åºåˆ—çš„ç¬¬ `k` å¤§æ•¸å­—ã€‚æˆ–æ˜¯ç•¶ `k` å‰©ä¸‹ 1 æ™‚ï¼Œæˆ‘å€‘çŸ¥é“ç­”æ¡ˆç‚ºå…©å€‹åºåˆ—çš„ç¬¬ä¸€å€‹æ•¸å­—çš„æœ€å°å€¼ã€‚\n\nå› ç‚ºæˆ‘å€‘æ¯æ¬¡éƒ½æ¨å»è‡³å°‘ `k / 2` å€‹æ•¸å­—ï¼Œæ‰€ä»¥ `k` æ¯æ¬¡éƒ½æœƒè®Šå°ä¸€åŠï¼Œç›´åˆ° `k = 1` ç‚ºæ­¢ï¼Œæ‰€ä»¥æ™‚é–“è¤‡é›œåº¦ç‚º `O(log(k))`ã€‚è€Œ `k = m + n / 2`ï¼Œæ‰€ä»¥ç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(log(m + n / 2)) = O(log(m + n))`ã€‚\n\n# å¯¦ä½œç´°ç¯€\n`arr1` ç‚º `nums1` ä¹‹åºåˆ—æŒ‡æ¨™ï¼›`arr2` ç‚º `nums2` ä¹‹åºåˆ—æŒ‡æ¨™ã€‚\n\n`m` ç‚º `arr1` ç•¶å‰ä¹‹é•·åº¦ï¼Œ`n` ç‚º `arr2` ç•¶å‰ä¹‹é•·åº¦ã€‚\n\n[å¯ä»¥åˆ©ç”¨ `vector.data()` ä¾†æ‹¿åˆ°åºåˆ—çš„æŒ‡æ¨™ã€‚](http://www.cplusplus.com/reference/vector/vector/data/)\n\nè‹¥è¦åˆªé™¤ `arr1[0] ~ arr1[i - 1]`ï¼Œå‰‡å°‡æŒ‡æ¨™å‘å¾Œç§»å‹• `i` æ ¼ï¼Œå°‡åºåˆ—é•·åº¦ `m` æ¸›å°‘ `i`ï¼Œå°‡ `k` æ¸›å» `i`ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/median-of-two-sorted-arrays/\n * Runtime: 44ms\n */\n\nclass Solution {\n  // åœ¨ arr1[0 ~ m - 1], arr2[0 ~ n - 1] ä¸­ï¼Œæ‰¾åˆ°ç¬¬ k å¤§æ•¸å­—ã€‚\n  int findKthNumber(int *arr1, int *arr2, int m, int n, int k) {\n    // ç•¶ arr1 ç‚ºç©ºï¼Œç­”æ¡ˆåœ¨ arr2 ä¸­\n    if (m == 0) {\n      return arr2[k - 1];\n    }\n    // ç•¶ arr2 ç‚ºç©ºï¼Œç­”æ¡ˆåœ¨ arr1 ä¸­\n    if (n == 0) {\n      return arr1[k - 1];\n    }\n    // ç•¶ k = 1ï¼Œç­”æ¡ˆç‚ºå…©åºåˆ—ä¸­ç¬¬ä¸€å€‹æ•¸å­—çš„æœ€å°å€¼\n    if (k == 1) {\n      return arr1[0] < arr2[0] ? arr1[0] : arr2[0];\n    }\n\n    // ç•¶ m < k / 2 æˆ–æ˜¯ n < k / 2 æ™‚ï¼Œå– i = m æˆ–æ˜¯ j = nï¼Œä¸€æ¨£æ»¿è¶³ä¸Šè¿°å¼å­\n    int i = min(k / 2, m);\n    int j = min(k / 2, n);\n    // æ¨æ£„è¼ƒå°ä¸€ç«¯çš„éƒ¨åˆ†åºåˆ—\n    if (arr1[i - 1] < arr2[j - 1]) {\n      // æ¨æ£„ arr1[0] ~ arr1[i - 1]\n      return findKthNumber(arr1 + i, arr2, m - i, n, k - i);\n    } else {\n      // æ¨æ£„ arr2[0] ~ arr2[j - 1]\n      return findKthNumber(arr1, arr2 + j, m, n - j, k - j);\n    }\n  }\npublic:\n  double findMedianSortedArrays(vector<int>& nums1, vector<int>& nums2) {\n    int m = (int)nums1.size();\n    int n = (int)nums2.size();\n    int k = (n + m) / 2 + 1;\n    // å¦‚æœç¸½é•·åº¦ç‚ºå¥‡æ•¸ï¼Œä¸­ä½æ•¸ = ç¬¬ (n + m) / 2 + 1 å¤§çš„æ•¸å­—\n    if ((n + m) & 1) {\n      return findKthNumber(nums1.data(), nums2.data(), m, n, k);\n    }\n    // å¦‚æœç¸½é•·åº¦ç‚ºå¶æ•¸ï¼Œä¸­ä½æ•¸ \b= ç¬¬ (n + m) / 2 + 1, (n + m) / 2 å¤§çš„æ•¸å­—ä¹‹å¹³å‡\n    return (findKthNumber(nums1.data(), nums2.data(), m, n, k) + findKthNumber(nums1.data(), nums2.data(), m, n, k - 1)) / 2.0;\n};\n\n```\n","tags":["LeetCode"],"categories":["LeetCode"]},{"title":"LeetCode 514 - Freedom Trail","url":"/LeetCode-Freedom-Trail/","content":"\n# é¡Œç›®\né¡Œç›®é€£çµï¼š[https://leetcode.com/problems/freedom-trail/](https://leetcode.com/problems/freedom-trail/)\n\nçµ¦å®šä¸€å€‹ç’°ç‹€çš„å­—ä¸² `ring`ï¼Œå†çµ¦ä¸€å€‹å­—ä¸² `key`ï¼Œè¦æ±‚åˆ©ç”¨ `ring` åœ¨æœ€å°‘æ­¥æ•¸å…§æ‹¼å‡ºå­—ä¸² `key`ã€‚\n\nä¸€é–‹å§‹æŒ‡æ¨™åœ¨å­—ä¸² `ring` çš„ç¬¬ä¸€å€‹å­—å…ƒä¸Šï¼Œå°‡æŒ‡æ¨™é †æ™‚é˜æˆ–æ˜¯é€†æ™‚é˜å‹•ä¸€æ ¼ç®—æ˜¯ä¸€æ­¥ã€‚ç•¶æŒ‡æ¨™æ‰€æŒ‡çš„å­—å…ƒç­‰æ–¼ä½ è¦æ‹¼çš„ `key` ä¸­çš„å­—å…ƒï¼Œä½ é‚„å¿…é ˆèŠ±ä¸€æ­¥ä¾†æŒ‰ä¸‹ç¢ºèªæŒ‰éˆ•ã€‚\n\n# ç¯„ä¾‹èªªæ˜\n<img src=\"/assets/LeetCode-Freedom-Trail/freedom-trail-ring.jpg\" width=\"30%\" />\n\n<!-- more -->\n\n**è¼¸å…¥ï¼š**\n\n`ring = \"godding\"`\n\n`key = \"gd\"`\n\n**è¼¸å‡ºï¼š** 4\n\n**èªªæ˜ï¼š** ä¸€é–‹å§‹æŒ‡æ¨™åœ¨ `ring` çš„ç¬¬ä¸€å€‹å­—å…ƒ `g`ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦èŠ±ä¸€æ­¥æŒ‰ä¸‹ç¢ºèªéˆ•å°±å¥½ã€‚å†ä¾†æˆ‘å€‘èŠ±è²»å…©æ­¥é€†æ™‚é‡æ—‹è½‰ `ring` å…©æ¬¡ï¼Œè®“æŒ‡æ¨™åˆ°é” `d`ã€‚å†èŠ±ä¸€æ­¥æŒ‰ä¸‹ç¢ºèªéˆ•ï¼Œç¸½å…±èŠ±è²» 4 æ­¥ã€‚\n\n# æƒ³æ³•\n`ring` ä¸­çš„å­—å…ƒæ˜¯æœƒé‡è¤‡çš„ï¼Œå› æ­¤æˆ‘å€‘ç„¡æ³•ç¢ºå®šé›¢ç•¶å‰æŒ‡æ¨™æ¯”è¼ƒè¿‘çš„ç›®æ¨™å­—å…ƒæœƒä½¿æˆ‘å€‘çš„ç­”æ¡ˆæœ€ä½³åŒ–ã€‚\nå› æ­¤æˆ‘å€‘æ›å€‹æƒ³æ³•ï¼Œå¦‚æœåœ¨æœå°‹ç¬¬ `i` å€‹å­—å…ƒ `key[i]` æ™‚ï¼Œæ—‹è½‰åˆ°ä½ç½® `j` çš„æœ€ä½³ç­”æ¡ˆï¼Œç´€éŒ„ç‚º `dp(i, j)`ã€‚\n\nå®šç¾© `N = ring çš„é•·åº¦`, `M = key çš„é•·åº¦`ã€‚\nå®šç¾©å°‡ `ring` å¾ä½ç½® `k` è½‰åˆ°ä½ç½® `j` çš„æœ€å°èŠ±è²»ç‚º `dist(k, j)`ã€‚é‚£éº¼æˆ‘å€‘å¯ä»¥è¼•æ˜“ç™¼ç¾ï¼š\n$$dp(i, j) = min(dp(i - 1,k)+dist(k,j)+1), \\quad \\forall i \\in [1, M]\\ ,\\forall j \\in [0, N) $$\nä¹Ÿå°±æ˜¯ `dp(i, j)` ç­‰æ–¼å¾ç¬¬ `i - 1` æ­¥çš„ä»»æ„ä½ç½®è½‰åˆ°ä½ç½® `j` çš„èŠ±è²»åŠ ä¸ŠåŸä¾†è¨˜éŒ„çš„æœ€å°èŠ±è²»`dp(i - 1, k)`ï¼Œå†åŠ ä¸Šä¸€æ­¥æŒ‰ç¢ºèªéµã€‚\n\nåˆå§‹åŒ–æ™‚åªè¦å°‡ `dp(0, 0)` è¨­æˆ 0ï¼Œå…¶é¤˜ä½ç½®è¨­æˆç„¡é™å¤§ï¼Œ`dp(i, j)` åªåœ¨ `ring[j] = key[i]` æ™‚è¨ˆç®—ã€‚ä¾¿èƒ½æ±‚å‡ºç­”æ¡ˆç‚ºï¼š\n$$min(dp(M, j)), \\quad \\forall\\ j \\in [0, N)$$\n\nç¸½æ™‚é–“è¤‡é›œåº¦ç‚º `O(N^2 * M)`ã€‚\n\n# ç¨‹å¼ç¢¼\n```cpp\n/**\n * Author: justin0u0<mail@justin0u0.com>\n * Problem: https://leetcode.com/problems/freedom-trail/\n * Runtime: 116ms\n */\n\nclass Solution {\nprivate:\n  const int INF = 0x3f3f3f3f;\npublic:\n  int findRotateSteps(string ring, string key) {\n    const int rl = (int)ring.length();\n    const int kl = (int)key.length();\n    // åˆå§‹åŒ– kl * rl çš„é™£åˆ—ï¼Œä¸¦å°‡å€¼éƒ½è¨­ç‚ºç„¡é™å¤§\n    vector<vector<int>> dp(kl + 1, vector<int>(rl, INF));\n    dp[0][0] = 0;\n\n    for (int i = 1; i <= kl; i++) {\n      for (int j = 0; j < rl; j++) {\n        if (key[i - 1] == ring[j]) {\n          for (int k = 0; k < rl; k++) {\n            // å¾ä½ç½® k åˆ°ä½ç½® jï¼Œdist(k, j) = min(abs(k - j), rl - abs(k - j)) + 1\n            int dist = abs(k - j);\n            dp[i][j] = min(dp[i][j], dp[i - 1][k] + min(dist, rl - dist) + 1);\n          }\n        }\n      }\n    }\n\n    // ç­”æ¡ˆç‚º dp[kl] ä¸­çš„æœ€å°å€¼\n    int steps = INF;\n    for (int i = 0; i < rl; i++) {\n      steps = min(steps, dp[kl][i]);\n    }\n    return steps;\n  }\n};\n\n```\n","tags":["LeetCode","å‹•æ…‹è¦åŠƒï¼ˆDynamic Programming, DPï¼‰"],"categories":["LeetCode"]}]